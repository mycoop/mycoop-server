/*
 * (c) Copyright Ascensio System SIA 2010-2014
 *
 * This program is a free software product. You can redistribute it and/or 
 * modify it under the terms of the GNU Affero General Public License (AGPL) 
 * version 3 as published by the Free Software Foundation. In accordance with 
 * Section 7(a) of the GNU AGPL its Section 15 shall be amended to the effect 
 * that Ascensio System SIA expressly excludes the warranty of non-infringement
 * of any third-party rights.
 *
 * This program is distributed WITHOUT ANY WARRANTY; without even the implied 
 * warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR  PURPOSE. For 
 * details, see the GNU AGPL at: http://www.gnu.org/licenses/agpl-3.0.html
 *
 * You can contact Ascensio System SIA at Lubanas st. 125a-25, Riga, Latvia,
 * EU, LV-1021.
 *
 * The  interactive user interfaces in modified source and object code versions
 * of the Program must display Appropriate Legal Notices, as required under 
 * Section 5 of the GNU AGPL version 3.
 *
 * Pursuant to Section 7(b) of the License you must retain the original Product
 * logo when distributing the program. Pursuant to Section 7(e) we decline to
 * grant you any rights under trademark law for use of our trademarks.
 *
 * All the Product's GUI elements, including illustrations and icon sets, as
 * well as technical writing content are licensed under the terms of the
 * Creative Commons Attribution-ShareAlike 4.0 International. See the License
 * terms at http://creativecommons.org/licenses/by-sa/4.0/legalcode
 *
 * Version: 1.0 (build:1)
 */
if(Common===undefined)var Common={};Common.Gateway=new function(){var e=this,t=$(e),n={init:function(e){t.trigger("init",e)},openDocument:function(e){t.trigger("opendocument",e)},showMessage:function(e){t.trigger("showmessage",e)},applyEditRights:function(e){t.trigger("applyeditrights",e)},processSaveResult:function(e){t.trigger("processsaveresult",e)},processRightsChange:function(e){t.trigger("processrightschange",e)},processMouse:function(e){t.trigger("processmouse",e)},internalCommand:function(e){t.trigger("internalcommand",e)},resetFocus:function(e){t.trigger("resetfocus",e)}},r=function(e){window.parent&&window.JSON&&window.parent.postMessage(window.JSON.stringify(e),"*")},i=function(e){var t=e.data;if(Object.prototype.toString.apply(t)!=="[object String]"||!window.JSON)return;var r,i;try{r=window.JSON.parse(t)}catch(s){r=""}r&&(i=n[r.command],i&&i.call(this,r.data))},s=function(e){i(e)};return window.attachEvent?window.attachEvent("onmessage",s):window.addEventListener("message",s,!1),{ready:function(){r({event:"onReady"})},goBack:function(){r({event:"onBack"})},save:function(e){r({event:"onSave",data:e})},requestEditRights:function(){r({event:"onRequestEditRights"})},reportError:function(e,t){r({event:"onError",data:{errorCode:e,errorDescription:t}})},setDocumentModified:function(e){r({event:"onDocumentStateChange",data:e})},internalMessage:function(e,t){r({event:"onInternalMessage",data:{type:e,data:t}})},on:function(n,r){var i=function(t,n){r.call(e,n)};t.on(n,i)}}};if(Common===undefined)var Common={};Common.component=Common.component||{},Common.Analytics=Common.component.Analytics=new function(){var e;return{initialize:function(t,n){if(typeof t=="undefined")throw"Analytics: invalid id.";if(typeof n=="undefined"||Object.prototype.toString.apply(n)!=="[object String]")throw"Analytics: invalid category type.";e=n,$("head").append('<script type="text/javascript">var _gaq = _gaq || [];_gaq.push(["_setAccount", "'+t+'"]);'+'_gaq.push(["_trackPageview"]);'+"(function() {"+'var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;'+'ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";'+'var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);'+"})();"+"</script>")},trackEvent:function(t,n,r){if(typeof t!="undefined"&&Object.prototype.toString.apply(t)!=="[object String]")throw"Analytics: invalid action type.";if(typeof n!="undefined"&&Object.prototype.toString.apply(n)!=="[object String]")throw"Analytics: invalid label type.";if(typeof r!="undefined"&&(Object.prototype.toString.apply(r)!=="[object Number]"||!isFinite(r)))throw"Analytics: invalid value type.";if(typeof _gaq=="undefined")return;if(e==="undefined")throw"Analytics is not initialized.";_gaq.push(["_trackEvent",e,t,n,r])}}};if(Common===undefined)var Common={};Common.IrregularStack=function(e){var t=[],n=function(e,t){return typeof e=="object"&&typeof t=="object"&&window.JSON?window.JSON.stringify(e)===window.JSON.stringify(t):e===t};e=e||{};var r=e.strongCompare||n,i=e.weakCompare||n,s=function(e,n){for(var r=t.length-1;r>=0;r--)if(n(t[r],e))return r;return-1},o=function(e){t.push(e)},u=function(e){var n=s(e,r);if(n!=-1){var i=t.splice(n,1);return i[0]}return undefined},a=function(e){var n=s(e,i);return n!=-1?t[n]:undefined},f=function(e){return!(s(e,r)<0)};return{push:o,pop:u,get:a,exist:f}},Ext.Loader.setConfig({enabled:!0,disableCaching:!1,paths:{Common:"../../common/main/lib"}}),Ext.define("Common.plugin.ScrollPane",{extend:"Ext.AbstractPlugin",alias:"plugin.scrollpane",areaSelector:".x-panel-body",settings:{},init:function(e){var t=this,n;t.settings=$.extend({enableKeyboardNavigation:!0,verticalDragMinHeight:16,horizontalDragMinWidth:16},t.settings),n=e.afterComponentLayout,e.afterComponentLayout=function(r,i){n.apply(e,arguments),r>0&&i>0&&t.initScrollPane()},t.callParent(arguments)},initScrollPane:function(e){var t=this,n,r,i;if(t.initializing)return;t.initializing=!0;if(!t.area||!t.area.length)i=e||t.cmp.getEl().dom,t.area=$(i).find("*").andSelf().filter(t.areaSelector).first();n=t.area.children(),r=n.filter("div.jspContainer"),n.length>1&&r.length>0&&(r.replaceWith($(".jspPane",r).children()),r=$()),t.jspApi&&r.length===0&&t.area.removeData("jsp"),t.area.jScrollPane(t.settings),t.jspApi=t.area.data("jsp"),t.doLayout(),delete t.initializing,i=e||t.cmp.getEl().dom,this._initSelectingScroll(i);if(r.length){var s=r.find(">.jspVerticalBar").find(">.jspTrack").find(">.jspDrag");s.on("mousedown.asc",function(e){return s[0].setCapture&&s[0].setCapture(),t.cmp.scrolllocked=!0,$("html").bind("mouseup.asc",function(e){s[0].releaseCapture&&s[0].releaseCapture(),t.cmp.scrolllocked=!1,$("html").unbind("mouseup.asc")}),!1})}},_initSelectingScroll:function(e){var t=this;$(e).off("mousedown.jsp"),$(e).on("mousedown.jsp",function(e){$(document).on("mousemove.jsp",i),$(document).on("mouseup.jsp",function(e){$(document).off("mousemove.jsp").off("mouseup.jsp"),s()})});var n=function(e,t){var n=t=="X"?"Left":"Top";return e["page"+t]||e["client"+t]+(document.documentElement["scroll"+n]||document.body["scroll"+n])||0},r,i=function(i){var o=$(e).offset().top,u=o+$(e).innerHeight(),a=n(i,"Y"),f=a<o?a-o:a>u?a-u:0;f==0?s():r||(r=setInterval(function(){t.jspApi.scrollByY(f)},10))},s=function(){r&&(clearInterval(r),r=undefined)}},updateScrollPane:function(e){this.initScrollPane(e),this.area&&this.area.attr("tabindex","-1")},scrollToElement:function(e,t,n){var r=this;r.jspApi&&r.jspApi.scrollToElement(e,t,n)},doLayout:function(){var e=this,t=e.cmp.items;t&&typeof t.each=="function"&&t.each(function(e){e.doComponentLayout()})}}),Ext.define("Common.plugin.DataViewScrollPane",{extend:"Common.plugin.ScrollPane",alias:"plugin.dataviewscrollpane",areaSelector:".x-component",init:function(e){var t=this,n;t.callParent(arguments),n=t.cmp.getStore(),n&&n.on("datachanged",function(){t.cmp&&t.cmp.rendered&&t.cmp.getWidth()>0&&t.cmp.getHeight()>0&&t.updateScrollPane()},t,{buffer:10}),t.cmp.on("viewready",t.onViewReady,t,{single:!0})},onKeyDown:function(e,t){var n=this,r=n.cmp.getStore(),i=function(e){var t=n.cmp.getNode(r.getAt(e)),i=Ext.create("Ext.Element",t);if(t){var s=Ext.getDom(n.cmp.getTargetEl())||Ext.getBody().dom,o=i.getOffsetsTo(s),u=o[1]+s.scrollTop,a=u+t.offsetHeight,f=s.clientHeight,l=parseInt(s.scrollTop,10),c=l+f;t.offsetHeight>f||u<l?n.jspApi&&n.jspApi.scrollByY(u,!1):a>c&&n.jspApi&&n.jspApi.scrollByY(a-f,!1)}};switch(e.getKey()){case e.UP:case e.DOWN:var s=n.cmp.getSelectionModel().getLastSelected(),o=s?r.indexOf(s):-1;i(o);break;case e.PAGE_UP:case e.PAGE_DOWN:break;case e.HOME:n.cmp.select(0),i(0);break;case e.END:n.cmp.select(r.count()-1),i(r.count()-1)}},onViewReady:function(){var e=this;e.cmp.getEl().on("keydown",e.onKeyDown,e)}}),Ext.define("Common.plugin.TextAreaAutoHeight",{extend:"Ext.AbstractPlugin",alias:"plugin.textareaautoheight",settings:{minHeight:32,maxHeight:120,growStep:17},init:function(e){this.callParent(arguments),e.addEvents("elastic"),e.on("afterrender",this.onAfterRender,this),e.on("change",this.onChange,this)},onAfterRender:function(e){var t=e.getEl().down("textarea");t&&(this.initHelper(t.id),this.elasticTextArea(t.id))},onChange:function(e){this.textareaElId||(this.textareaElId=e.getEl().down("textarea").id),this.elasticTextArea(this.textareaElId)},initHelper:function(e){var t=function(e,t){var n={},r=t.length;for(var i=0;i<r;i++)n[t[i]]=e.getStyle(t[i]);return n},n=function(e,t){if(t){var n=0,r;e=Ext.fly(e),Ext.isFunction(t)&&(t=t.call());if(typeof t=="string"){t=t.split(/:|;/g);for(r=t.length;n<r;)e.setStyle(t[n++],t[n++])}else Ext.isObject(t)&&e.setStyle(t)}};this.domEl=Ext.get(e),this.textareaElId=e;var r=t(this.domEl,["font-size","font-family","font-weight","font-style","line-height","letter-spacing","padding-left","padding-top","padding-right","padding-bottom"]);this.domEl.setStyle("overflow","hidden"),this.helperEl||(this.helperEl=Ext.DomHelper.append(this.domEl.parent(),{id:e+"-textarea-elastic-helper",tag:"div",style:"position: absolute; top: 0; left: 0; visibility: hidden; white-space: pre-wrap; word-wrap: break-word;"},!0),n(this.helperEl,r))},elasticTextArea:function(e){var t=this,n=this.domEl.dom.value||"&nbsp;";this.helperEl.setWidth(this.domEl.getWidth()),this.helperEl.update(n.replace(/<br \/>&nbsp;/,"<br />").replace(/<|>/g," ").replace(/&/g,"&amp;").replace(/\n/g,"<br />"));var r=this.helperEl.getHeight();r>t.settings.maxHeight&&t.settings.maxHeight>0&&(r=t.settings.maxHeight,this.domEl.setStyle("overflow","auto")),r<t.settings.minHeight&&t.settings.minHeight>0&&(r=t.settings.minHeight);var i=r+t.settings.growStep;t.cmp.getHeight()!=i&&(t.cmp.setHeight(i),t.cmp.fireEvent("elastic",t.cmp,this.domEl.getWidth(),i))}}),Ext.define("Common.plugin.MenuExpand",{extend:"Ext.AbstractPlugin",alias:"plugin.menuexpand",init:function(e){var t=this,n=e.onMouseLeave;e.onMouseLeave=function(t){n.apply(e,arguments),e.parentItem&&(e.parentItem.menuEntered=!1)},e.onMouseOver=t.onMouseOver,e.checkItemMenuEntered=t.checkItemMenuEntered,t.callParent(arguments)},checkItemMenuEntered:function(){var e=this;e.activeItem&&e.activeItem.menuEntered&&e.MouseOverInterval&&(clearInterval(e.MouseOverInterval),e.MouseOverInterval=undefined,e.activeItem.menuEntered=!1,e.checkeditem&&e.checkeditem.el.removeCls(e.checkeditem.activeCls),e.activeItem.el.addCls(e.activeItem.activeCls))},onMouseOver:function(e){var t=this,n=e.getRelatedTarget(),r=!t.el.contains(n),i=t.getItemFromEvent(e);r&&t.parentMenu&&(t.parentMenu.setActiveItem(t.parentItem),t.parentMenu.mouseMonitor.mouseenter());if(t.disabled)return;t.checkeditem&&i!=t.checkeditem&&t.checkeditem.el.removeCls(t.checkeditem.activeCls),(t.checkeditem=i)&&t.checkeditem.el.addCls(t.checkeditem.activeCls);if(t.activeItem&&t.activeItem.menu){if(i&&i!=t.activeItem&&i!=t.focusedItem&&t.MouseOverInterval===undefined){var s=0;t.activeItem.menuEntered=!1,t.MouseOverInterval=setInterval(function(){t.checkItemMenuEntered(),s++>8&&(clearInterval(t.MouseOverInterval),t.MouseOverInterval=undefined,t.checkeditem&&(t.setActiveItem(t.checkeditem),t.checkeditem.activated&&t.checkeditem.expandMenu&&t.checkeditem.expandMenu()))},20)}}else i&&(t.setActiveItem(i),i.activated&&i.expandMenu&&i.expandMenu());r&&(t.parentItem&&(t.parentItem.menuEntered=!0),t.fireEvent("mouseenter",t,e)),t.fireEvent("mouseover",t,i,e)}}),Ext.define("Common.component.LoadMask",{extend:"Ext.Component",alias:"widget.cmdloadmask",mixins:{floating:"Ext.util.Floating"},useMsg:!0,disabled:!1,baseCls:"cmd-loadmask",config:{title:""},renderTpl:['<div style="position:relative" class="{baseCls}-body">',"<div>",'<div class="{baseCls}-image"></div>','<div class="{baseCls}-title"></div>',"</div>",'<div class="{baseCls}-pwd-ct">','<div class="{baseCls}-pwd-by">POWERED BY</div>','<div class="{baseCls}-pwd-tm">ONLYOFFICE</div>',"</div>","</div>"],modal:!0,width:"auto",floating:{shadow:!1},focusOnToFront:!1,constructor:function(e,t){var n=this;e.isComponent?(n.ownerCt=e,n.bindComponent(e)):(n.ownerCt=new Ext.Component({el:Ext.get(e),rendered:!0,componentLayoutCounter:1}),n.container=e),n.callParent([t]),n.renderSelectors={titleEl:"."+n.baseCls+"-title"}},bindComponent:function(e){this.mon(e,{resize:this.onComponentResize,scope:this})},applyTitle:function(e){var t=this;t.title=e;if(t.rendered){t.titleEl.update(t.title);var n=t.floatParent?t.floatParent.getTargetEl():t.container,r=t.getEl().getAlignToXY(n,"c-c"),i=n.translatePoints(r[0],r[1]);(Ext.isDefined(i.left)||Ext.isDefined(i.top))&&t.setPosition(i.left,i.top)}},afterRender:function(){this.callParent(arguments),this.container=this.floatParent.getContentTarget()},onComponentResize:function(){var e=this;e.rendered&&e.isVisible()&&(e.toFront(),e.center())},onDisable:function(){this.callParent(arguments),this.loading&&this.onLoad()},onBeforeLoad:function(){var e=this,t=e.ownerCt||e.floatParent,n;this.disabled||(t.componentLayoutCounter?Ext.Component.prototype.show.call(e):(n=t.afterComponentLayout,t.afterComponentLayout=function(){t.afterComponentLayout=n,n.apply(t,arguments),e.loading&&Ext.Component.prototype.show.call(e)}))},onHide:function(){var e=this;e.callParent(arguments),e.showOnParentShow=!0},onShow:function(){var e=this;e.callParent(arguments),e.loading=!0,e.setTitle(e.title)},afterShow:function(){this.callParent(arguments),this.center()},onLoad:function(){this.loading=!1,Ext.Component.prototype.hide.call(this)}}),Ext.define("Common.component.SplitColorButton",{extend:"Ext.button.Split",alias:"widget.cmdsplitcolorbutton",color:"FF0000",colorHeight:4,verticalOffset:0,horizontalOffset:0,initComponent:function(){this.addEvents("changecolor"),this.callParent(arguments)},afterRender:function(){this.callParent(arguments),this.on({disable:function(e,t){if(this.getEl()){var n=this.getEl().down(".x-btn-color");n&&n.applyStyles({"background-color":"#9c9c9c"})}},enable:function(e,t){var n=this.getEl().down(".x-btn-color");n&&n.applyStyles({"background-color":this.color=="transparent"?this.color:"#"+this.color})}},this);var e=this.getEl().down("button");if(e){Ext.DomHelper.append(e,{tag:"span",cls:"x-btn-color"});var t=e.child(".x-btn-color");t.applyStyles({position:"absolute",left:this.verticalOffset+"px",top:e.getHeight()-this.colorHeight-this.horizontalOffset+"px","background-color":"#"+this.color}),this.isDisabled()&&t.applyStyles({"background-color":"#9c9c9c"}),t.setSize(e.getWidth()-2*this.verticalOffset,this.colorHeight)}},setColor:function(e,t){this.color=e;var n=this.getEl().down(".x-btn-color");n&&(this.isDisabled()?n.applyStyles({"background-color":"#9c9c9c"}):n.applyStyles({"background-color":this.color=="transparent"?this.color:"#"+this.color})),t!==!1&&this.fireEvent("changecolor",this,e)},getColor:function(){return this.color||null}}),Ext.define("Common.component.MetricSpinner",{extend:"Ext.form.field.Spinner",alias:"widget.commonmetricspinner",defaultUnit:"px",minValue:0,maxValue:100,step:1,textAlign:"right",allowAuto:!1,autoText:"Auto",mouseWheelEnabled:!1,constructor:function(e){var t=function(e,t,n){var r=Math.pow(10,n||2);return(Math.round(e*r)+Math.round(t*r))/r},n=this.minValue;this.setValue=function(e,r){if(!Ext.isDefined(e)||e==="")this.value="";else if(this.allowAuto&&(Math.abs(parseFloat(e)+1)<1e-4||e==this.autoText))this.value=this.autoText;else{var i=t(parseFloat(e),0,3);if(!Ext.isDefined(i)||isNaN(i))i=n;var s=this.defaultUnit;if(Ext.isDefined(e.match)){var o=e.match(/(px|em|%|en|ex|pt|in|cm|mm|pc|s|ms)$/i);null!==o&&Ext.isDefined(o[0])&&(s=o[0].toLowerCase())}this.defaultUnit!==s&&(i=this._recalcUnits(i,s)),i>this.maxValue&&(i=this.maxValue),i<this.minValue&&(i=this.minValue),this.value=(i+" "+this.defaultUnit).trim(),n=i}r!==!0&&this.checkChange();var u=function(e){this.setRawValue(e)};this.rendered?u.call(this,this.value):this.on("afterrender",Ext.bind(u,this,[this.value]),{single:!0})},this.onSpinUp=function(){var e=this;if(!e.readOnly){var r=e.step;e.getValue()!==""?(e.allowAuto&&e.getValue()==e.autoText?r=e.minValue-e.step:r=parseFloat(e.getValue()),isNaN(r)&&(r=n)):r=e.minValue-e.step,e.setValue((t(r,e.step,3)+" "+this.defaultUnit).trim(),!0)}},this.onSpinDown=function(){var e=this;if(!e.readOnly){var r=e.step;if(e.getValue()!==""){e.allowAuto&&e.getValue()==e.autoText?r=e.minValue:r=parseFloat(e.getValue()),isNaN(r)&&(r=n);if(e.allowAuto&&t(r,-e.step,3)<e.minValue){e.setValue(e.autoText,!0);return}}else r=e.minValue;e.setValue((t(r,-e.step,3)+" "+this.defaultUnit).trim(),!0)}},this.callParent(arguments)},initComponent:function(){Ext.isDefined(this.value)||(this.value=(this.minValue+" "+this.defaultUnit).trim()),this.on("specialkey",function(e,t){t.getKey()==t.ENTER&&(this.onEnterValue(),t.stopEvent())},this),this.callParent(arguments)},setDefaultUnit:function(e){if(this.defaultUnit!=e){var t=this.defaultUnit;this.defaultUnit=e,this.setMinValue(this._recalcUnits(this.minValue,t)),this.setMaxValue(this._recalcUnits(this.maxValue,t)),this.setValue(this._recalcUnits(this.getNumberValue(),t),!0)}},setMinValue:function(e){this.minValue=e},setMaxValue:function(e){this.maxValue=e},setStep:function(e){this.step=e},getNumberValue:function(){return this.allowAuto&&this.value==this.autoText?-1:parseFloat(this.value)},getUnitValue:function(){return this.defaultUnit},getValue:function(){return this.value},onEnterValue:function(){if(Ext.isDefined(this.inputEl)){var e=this.inputEl.getValue();this.setValue(e===""?this.value:e)}},afterRender:function(){var e=this;this.callParent(arguments),this.inputEl&&Ext.DomHelper.applyStyles(this.inputEl,Ext.String.format("text-align:{0}",this.textAlign)),this.triggerRepeater&&this.triggerRepeater.on("mouseup",function(){e.checkChange()},this)},onBlur:function(e,t){if(Ext.isDefined(this.inputEl)){var n=this.inputEl.getValue();this.setValue(n===""?this.value:n)}},_recalcUnits:function(e,t){if(t.match(/(s|ms)$/i)&&this.defaultUnit.match(/(s|ms)$/i)){var n=e;return t=="ms"&&(n/=1e3),this.defaultUnit=="ms"&&(n*=1e3),n}if(t.match(/(pt|in|cm|mm|pc)$/i)===null||this.defaultUnit.match(/(pt|in|cm|mm|pc)$/i)===null)return e;var n=e;return t=="cm"?n*=10:t=="pt"?n=n*25.4/72:t=="in"?n*=25.4:t=="pc"&&(n=n*25.4/6),this.defaultUnit=="cm"?n/=10:this.defaultUnit=="pt"?n=parseFloat(Ext.Number.toFixed(n*72/25.4,3)):this.defaultUnit=="in"?n/=25.4:this.defaultUnit=="pc"&&(n=n*6/25.4),n}}),Ext.define("Common.component.IndeterminateCheckBox",{extend:"Ext.form.field.Checkbox",alias:"widget.cmdindeterminatecheckbox",value:"unchecked",indeterminate:!1,indeterminateCls:Ext.baseCSSPrefix+"form-cb-indeterminate",onBoxClick:function(e){var t=this;!t.disabled&&!t.readOnly&&(this.indeterminate?(this.indeterminate=!1,this.setValue(!1)):this.setValue(!this.checked))},getRawValue:function(){return this.value},getValue:function(){return this.value},setRawValue:function(e){var t=this,n=t.inputEl,r=t.inputValue,i=e===!0||e==="true"||e==="1"||e===1||((Ext.isString(e)||Ext.isNumber(e))&&r?e==r:t.onRe.test(e)),s=e==="indeterminate";return n&&(n.dom.setAttribute("aria-checked",i),n.dom.setAttribute("aria-indeterminate",s),t[s?"addCls":"removeCls"](t.indeterminateCls),t[i?"addCls":"removeCls"](t.checkedCls)),t.checked=t.rawValue=i,t.indeterminate=s,t.value=s?"indeterminate":i?"checked":"unchecked",i},setValue:function(e){var t=this,n=function(e,n){return Ext.isArray(e)?t.getManager().getByName(t.name).each(function(t){t.setValue(Ext.Array.contains(e,t.inputValue))}):(t.setRawValue(e),(!Ext.isDefined(n)||!n)&&t.checkChange()),t};this.rendered?n.call(this,e):this.on("afterrender",Ext.bind(n,this,[e,!0]),{single:!0})}}),Ext.define("Common.component.SearchField",{extend:"Ext.container.Container",alias:"widget.commonsearchfield",height:22,layout:{type:"hbox",align:"stretch"},cls:"common-searchfield",require:["Ext.data.Store","Ext.button.Button","Ext.container.Container"],initComponent:function(){var e=this;e.searching=!1,e.txtSearchQuery=Ext.create("Ext.form.field.Text",{flex:1,emptyText:this.emptyText,tabIndex:this.tabIndex||-1,listeners:{specialkey:function(t,n){n.getKey()==n.ENTER?(e.stopSearch(),e.startSearch()):n.getKey()==n.TAB&&(e.stopSearch(),e.focus(),e.blur())},change:function(t,n){e.btnClear.setVisible(!e.isValueEmpty())},blur:function(t,n){e.isValueValid()||e.clear()}}}),e.btnClear=Ext.create("Ext.button.Button",{iconCls:"search-btn-clear-icon",hidden:!0,listeners:{click:function(){e.searching?e.stopSearch():e.clear()}}}),e.items=[e.txtSearchQuery,e.btnClear],e.relayEvents(e.txtSearchQuery,["change"]),e.addEvents("searchstart","searchstop","searchclear"),e.callParent(arguments)},startSearch:function(e){var t=this;!t.searching&&t.isValueValid()&&(t.searching=!0,t.btnClear.setIconCls("search-btn-start-icon").toggle(!0).disable(),e||t.fireEvent("searchstart",t,t.getText()))},stopSearch:function(e){var t=this;t.searching&&(t.searching=!1,t.btnClear.setIconCls("search-btn-clear-icon").toggle(!1).enable(),e||t.fireEvent("searchstop",t))},clear:function(e){var t=this;t.searching||(t.txtSearchQuery.reset(),e||t.fireEvent("searchclear",t))},isValueValid:function(){var e=this.txtSearchQuery.getValue();return!Ext.isEmpty(e)},isValueEmpty:function(){return this.txtSearchQuery.getValue().length==0},setText:function(e){this.txtSearchQuery.setValue(e)},getText:function(){return this.txtSearchQuery.getValue()},setValue:function(e){this.txtSearchQuery.setValue(e)},getValue:function(){return this.txtSearchQuery.getValue()},focus:function(e,t){this.txtSearchQuery.focus(e,t)}});if(Common===undefined)var Common={};Common.MetricSettings=new function(){var e=this;return e.c_MetricUnits={cm:0,pt:1},e.currentMetric=e.c_MetricUnits.pt,e.metricName=["cm","pt"],{c_MetricUnits:e.c_MetricUnits,metricName:e.metricName,setCurrentMetric:function(t){e.currentMetric=t},getCurrentMetric:function(){return e.currentMetric},fnRecalcToMM:function(t){if(t!==null&&t!==undefined)switch(e.currentMetric){case e.c_MetricUnits.cm:return t*10;case e.c_MetricUnits.pt:return t*25.4/72}return t},fnRecalcFromMM:function(t){switch(e.currentMetric){case e.c_MetricUnits.cm:return parseFloat(Ext.Number.toFixed(t/10,4));case e.c_MetricUnits.pt:return parseFloat(Ext.Number.toFixed(t*72/25.4,3))}return t}}},Ext.define("Common.model.User",{extend:"Ext.data.Model",fields:[{type:"string",name:"id",defaultValue:""},{type:"string",name:"username",defaultValue:"Guest"},{type:"string",name:"color"},{type:"boolean",name:"online",defaultValue:!1}]}),Ext.define("Common.model.ChatMessage",{extend:"Ext.data.Model",fields:[{type:"int",name:"type"},{type:"string",name:"userid"},{type:"string",name:"message"}]}),Ext.define("Common.model.Comment",{extend:"Ext.data.Model",fields:[{type:"string",name:"id"},{type:"string",name:"userid"},{type:"string",name:"username",defaultValue:"Guest"},{type:"int",name:"date"},{type:"string",name:"quote"},{type:"string",name:"comment"},{type:"boolean",name:"resolved",defaultValue:!1},{type:"boolean",name:"lock",defaultValue:!1},{type:"string",name:"lockuserid"}],proxy:{type:"memory"},hasMany:{model:"Common.model.Reply",name:"replys"}}),Ext.define("Common.model.Reply",{extend:"Ext.data.Model",fields:[{type:"int",name:"id"},{type:"string",name:"userid"},{type:"string",name:"username",defaultValue:""},{type:"int",name:"date"},{type:"string",name:"reply"}],proxy:{type:"memory"},belongsTo:{model:"Common.model.Comment",name:"comment"}}),Ext.define("Common.store.ChatMessages",{extend:"Ext.data.Store",model:"Common.model.ChatMessage"}),Ext.define("Common.store.Comments",{extend:"Ext.data.Store",model:"Common.model.Comment",sorters:[{property:"date",direction:"DESC"}]}),Ext.define("Common.store.Users",{extend:"Ext.data.Store",model:"Common.model.User",getOnlineUserCount:function(){var e=this.getCount(),t,n=0;while(e>0)t=this.getAt(--e),t.data.online&&n++;return n}}),Ext.define("Common.view.About",{extend:"Ext.container.Container",alias:"widget.commonabout",cls:"common-about-body",requires:["Ext.container.Container","Ext.form.Label"],constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){var e="2.5",t="support@onlyoffice.com",n="+371 660-16425",r="www.onlyoffice.com",i="Ascensio System SIA";this.items=[{xtype:"container",layout:{type:"table",columns:1,tableAttrs:{style:"width: 100%;"},tdAttrs:{align:"center"}},items:[{xtype:"container",cls:"asc-about-office"},{xtype:"tbspacer",height:5},{xtype:"label",cls:"asc-about-version",text:this.txtVersion+e},{xtype:"tbspacer",height:40}]},{xtype:"container",layout:{type:"table",columns:3,tableAttrs:{style:"width: 100%;"}},items:[{cellCls:"about-separator-cell",xtype:"tbspacer",width:"100%",html:'<div style="width: 100%; height: 3px !important; background-color: #e1e1e1"></div>'},{xtype:"label",cls:"asc-about-header",text:this.txtLicensor},{cellCls:"about-separator-cell",xtype:"tbspacer",width:"100%",html:'<div style="width: 100%; height: 3px !important; background-color: #e1e1e1"></div>'}]},{xtype:"container",layout:{type:"table",columns:1,tableAttrs:{style:"width: 100%;"},tdAttrs:{align:"center"}},items:[{xtype:"tbspacer",height:20},{xtype:"label",cls:"asc-about-companyname",text:i},{xtype:"tbspacer",height:10},{xtype:"container",items:[{xtype:"label",cls:"asc-about-desc-name",text:this.txtAddress},{xtype:"label",cls:"asc-about-desc",text:this.txtAscAddress}]},{xtype:"tbspacer",height:10},{xtype:"container",items:[{xtype:"label",cls:"asc-about-desc-name",text:this.txtMail},{xtype:"label",cls:"asc-about-desc",html:Ext.String.format('<a href="mailto:{0}">{0}</a>',t)}]},{xtype:"tbspacer",height:10},{xtype:"container",items:[{xtype:"label",cls:"asc-about-desc-name",text:this.txtTel},{xtype:"label",cls:"asc-about-desc",text:n}]},{xtype:"tbspacer",height:10},{xtype:"label",cls:"asc-about-desc",html:Ext.String.format('<a href="http://{0}" target="_blank">{0}</a>',r)},{xtype:"tbspacer",height:40}]},{xtype:"container",layout:{type:"table",columns:3,tableAttrs:{style:"width: 100%;"}},items:[{cellCls:"about-separator-cell",xtype:"tbspacer",width:"100%",html:'<div style="width: 100%; height: 3px !important; background-color: #e1e1e1"></div>'},{xtype:"label",cls:"asc-about-header",text:this.txtLicensee},{cellCls:"about-separator-cell",xtype:"tbspacer",width:"100%",html:'<div style="width: 100%; height: 3px !important; background-color: #e1e1e1"></div>'}]},this.cntLicenseeInfo=Ext.create("Ext.Container",{layout:{type:"table",columns:1,tableAttrs:{style:"width: 100%;"},tdAttrs:{align:"center"}},items:[{xtype:"tbspacer",height:20},this.imgCompanyLogo=Ext.create("Ext.Container",{html:'<img src="" />'}),{xtype:"tbspacer",height:10},this.lblCompanyName=Ext.create("Ext.form.Label",{cls:"asc-about-companyname",text:""}),{xtype:"tbspacer",height:10},{xtype:"container",items:[{xtype:"label",cls:"asc-about-desc-name",text:this.txtAddress},this.lblCompanyAddress=Ext.create("Ext.form.Label",{cls:"asc-about-desc",text:""})]},{xtype:"tbspacer",height:10},{xtype:"container",items:[{xtype:"label",cls:"asc-about-desc-name",text:this.txtMail},this.lblCompanyMail=Ext.create("Ext.form.Label",{cls:"asc-about-desc",text:""})]},{xtype:"tbspacer",height:10},this.lblCompanyUrl=Ext.create("Ext.form.Label",{cls:"asc-about-desc",text:""}),{xtype:"tbspacer",height:10},this.lblCompanyLic=Ext.create("Ext.form.Label",{cls:"asc-about-lic",text:""})]})],this.callParent(arguments),this.items.items[3].hide(),this.cntLicenseeInfo.hide()},setLicInfo:function(e){if(e&&typeof e=="object"){this.items.items[3].show(),this.cntLicenseeInfo.show(),this.lblCompanyName.setText(e.asc_getCustomer());var t=e.asc_getCustomerAddr();t&&t.length?this.lblCompanyAddress.setText(t):(this.cntLicenseeInfo.items.getAt(5).hide(),this.cntLicenseeInfo.items.getAt(6).hide()),t=e.asc_getCustomerMail(),t&&t.length?this.lblCompanyMail.update(Ext.String.format('<a href="mailto:{0}">{0}</a>',t)):(this.cntLicenseeInfo.items.getAt(7).hide(),this.cntLicenseeInfo.items.getAt(8).hide()),t=e.asc_getCustomerWww();if(t&&t.length){var n=/^label:(.+);url:(.+)/.exec(t);if(n)r=n[2],t=n[1];else var r=/^https?:\/\//.test(t)?t:"http://"+t;this.lblCompanyUrl.update(Ext.String.format('<a href="{0}" target="_blank">{1}</a>',r,t))}else this.cntLicenseeInfo.items.getAt(9).hide(),this.cntLicenseeInfo.items.getAt(10).hide();(t=e.asc_getCustomerInfo())&&t.length?this.lblCompanyLic.setText(t):this.cntLicenseeInfo.items.getAt(11).hide(),(t=e.asc_getCustomerLogo())&&t.length?this.imgCompanyLogo.html='<img src="'+t+'" />':(this.imgCompanyLogo.hide(),this.cntLicenseeInfo.items.getAt(2).hide())}else this.items.items[3].hide(),this.cntLicenseeInfo.hide()},txtVersion:"Version ",txtLicensor:"LICENSOR",txtLicensee:"LICENSEE",txtAddress:"address: ",txtAscAddress:"Lubanas st. 125a-25, Riga, Latvia, EU, LV-1021",txtMail:"email: ",txtTel:"tel.: "}),Ext.define("Common.view.Header",{extend:"Ext.container.Container",alias:"widget.commonheader",cls:"common-header",config:{headerCaption:"Default Caption",documentCaption:"",canBack:!1},constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){this.html='<div id="header-logo"></div><span id="header-caption"></span><span id="header-delimiter">-</span><span id="header-documentcaption"></span><span id="header-back">'+this.textBack+"</span>",this.callParent(arguments)},afterRender:function(e){this.callParent(arguments),$("#header-logo").on("click",function(e){var t=window.open("http://www.onlyoffice.com");t&&t.focus()})},applyHeaderCaption:function(e){var t=Ext.fly("header-caption");return t&&Ext.DomHelper.overwrite(t,e),e},applyDocumentCaption:function(e){e||(e="");var t=Ext.fly("header-delimiter");t&&t.setVisible(e.length>0);var n=Ext.fly("header-documentcaption");return n&&Ext.DomHelper.overwrite(n,Ext.htmlEncode(e)),e},applyCanBack:function(e){var t=Ext.fly("header-back");t&&(t.un("click"),t.setVisible(e),e&&t.on("click",Ext.bind(this.onBackClick,this)))},onBackClick:function(e){Common.Gateway.goBack(),Common.component.Analytics.trackEvent("Back to Folder")},textBack:"Go to Documents"}),Ext.define("Common.view.ChatPanel",{extend:"Ext.container.Container",alias:"widget.commonchatpanel",cls:"common-chatpanel",requires:["Common.plugin.DataViewScrollPane","Ext.XTemplate","Ext.view.View","Ext.form.Label","Ext.util.TextMetrics"],layout:{type:"vbox",align:"stretch"},createDelayedElements:function(){var e=this,t=Ext.getStore("Common.store.Users");e.add([{xtype:"label",cls:"chat-header",text:this.textChat,width:"100%"},{xtype:"dataview",height:65,width:"100%",id:"id-chat-users",cls:"chat-users-view",group:"scrollable",store:"Common.store.Users",blockRefresh:!0,disableSelection:!0,tpl:new Ext.XTemplate('<tpl for=".">','<tpl if="online">','<div class="chat-user-wrap">','<div class="color" style="background-color: {[this.getUserColor(values.id)]};"></div>','<label class="name">{[this.getUserName(values.id)]}</label>',"</div>","</tpl>",'<tpl if="!online">','<div class="chat-user-wrap hidden"></div>',"</tpl>","</tpl>",{compiled:!0,getUserColor:function(e){if(t){var n=t.findRecord("id",e);if(n)return n.data.color}return"#000"},getUserName:function(e){if(t){var n=t.findRecord("id",e);if(n)return Ext.String.ellipsis(Ext.String.htmlEncode(n.get("username")),23,!0)}return this.textAnonymous}}),itemSelector:"div.chat-user-wrap",overItemCls:"x-item-over",emptyText:"There is no authorized users",autoScroll:!0,plugins:[{ptype:"dataviewscrollpane",pluginId:"scrollpane",areaSelector:".chat-users-view",settings:{enableKeyboardNavigation:!0,verticalGutter:1}}]},{xtype:"dataview",flex:1,id:"id-chat-msg",cls:"chat-msg-view",group:"scrollable",store:"Common.store.ChatMessages",blockRefresh:!0,disableSelection:!0,tpl:new Ext.XTemplate('<tpl for=".">','<div class="chat-msg-wrap">','<tpl if="type == 1">','<div class="message service">{[this.fixMessage(values.message)]}</div>',"</tpl>",'<tpl if="type != 1">','<label class="user" data-can-copy="true" style="color: {[this.getUserColor(values.userid)]};">{username}:&nbsp</label>','<label class="message" data-can-copy="true">{[this.fixMessage(values.message)]}</label>',"</tpl>","</div>","</tpl>",{compiled:!0,getUserColor:function(e){if(t){var n=t.findRecord("id",e);if(n)return n.data.color}return"#000"},getUserName:function(n){if(t){var r=t.findRecord("id",n);if(r)return Ext.String.ellipsis(Ext.String.htmlEncode(r.get("username")),23,!0)}return e.textAnonymous},fixMessage:function(e){var t=function(e){var t=/[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}/i.exec(e);if(t)e=e.replace(t[0],'<a href="mailto:'+t[0]+">"+t[0]+"</a>");else{t=e.match(/((https?|ftps?):\/\/)(www.)?([a-z0-9-]+)(\.[a-z]{2,6})?(\/\S*)?/ig),!t&&(t=e.match(/((https?|ftps?):\/\/)?(www.)?([a-z0-9-]+)(\.[a-z]{2,6})(\/\S*)?/ig));for(var n in t)e=e.replace(t[n],'<a href="'+(t[n].search(/((https?|ftps?):\/\/)/g)<0?"http://":"")+t[n]+'" target="_blank">'+t[n]+"</a>")}return e},n=function(e){return Ext.String.htmlEncode(e)};return t(n(e)).replace(/\n/g,"<br/>")}}),itemSelector:"div.chat-msg-wrap",emptyText:"",autoScroll:!0,plugins:[{ptype:"scrollpane",pluginId:"scrollpane",areaSelector:".chat-msg-view",settings:{enableKeyboardNavigation:!0,verticalGutter:1}}]},{xtype:"tbspacer",height:10},{xtype:"container",layout:{type:"vbox",align:"stretch"},cls:"add-msg-container",height:100,items:[{xtype:"textarea",id:"id-chat-textarea",height:62,enableKeyEvents:!0},{xtype:"container",layout:"hbox",items:[{xtype:"tbspacer",flex:1},{xtype:"button",id:"id-btn-send-msg",cls:"btn-send-msg asc-blue-button",text:this.textSend}]}]}])},textChat:"Chat",textSend:"Send",textAnonymous:"Guest"}),Ext.define("Common.view.CommentsEditForm",{extend:"Ext.container.Container",alias:"widget.commoncommentseditform",cls:"common-commentseditform",requires:["Common.plugin.TextAreaAutoHeight","Ext.form.TextArea","Ext.Button"],layout:{type:"vbox",align:"stretch"},constructor:function(e){this.initConfig(e);if(!e||!e.scope||!e.editId||!e.renderTo||!e.onEditHandler||!e.onCancelHandler)throw Error("Common.view.CommentsEditForm creation failed: required parameters are missing.");return this.callParent(arguments),this},initComponent:function(){var e=this;e.id="controls-edit-msg-"+e.editId,e.cls="controls-edit-msg-container",e.height=80,e.items=[{xtype:"textarea",height:20,value:e.msgValue,enableKeyEvents:!0,listeners:{elastic:Ext.bind(this.elasticTextArea,this),keydown:Ext.bind(this.keyDownTextArea,this)},plugins:[{ptype:"textareaautoheight",pluginId:"elastic-helper"}]},{xtype:"container",layout:"hbox",height:26,id:"controls-edit-msg-"+e.editId+"-buttons",items:[{xtype:"button",text:e.textEdit,cls:"asc-blue-button",action:"edit",handler:Ext.bind(function(t,n){e.onEditHandler.call(e.scope,t)},e.scope)},{xtype:"tbspacer",width:10},{xtype:"button",text:e.textCancel,handler:Ext.bind(function(t,n){e.onCancelHandler.call(e.scope,t)},e.scope)}]}],e.on("afterrender",Ext.bind(this.onAfterRender,this)),e.callParent(arguments)},onAfterRender:function(e){var t=e.down("textarea");t&&t.fireEvent("change")},elasticTextArea:function(e,t,n){var r=e.ownerCt;if(r){var i=r.down("container");if(i){var s=parseInt(r.getEl().getStyle("padding-top")),o=parseInt(r.getEl().getStyle("padding-bottom")),u=i.rendered?i.getHeight():i.height||0;r.setHeight(n+u+s+o+5)}}},keyDownTextArea:function(e,t){if(t.getKey()==t.ENTER&&(t.ctrlKey||t.metaKey)&&!t.shiftKey){var n=this;e.getValue().length>0&&(t.stopEvent(),n.onEditHandler.call(n.scope,n.down("button[action=edit]")))}},textEdit:"Edit",textCancel:"Cancel"}),Ext.define("Common.view.CommentsPanel",{extend:"Ext.container.Container",alias:"widget.commoncommentspanel",cls:"common-commentspanel",requires:["Common.plugin.DataViewScrollPane","Ext.Date","Ext.XTemplate","Ext.form.Label"],uses:["Common.plugin.TextAreaAutoHeight","Ext.util.TextMetrics"],layout:{type:"vbox",align:"stretch"},config:{currentUserId:-1},constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){var e=this,t=Ext.getStore("Common.store.Users");e.items=[{xtype:"label",cls:"comments-header",text:e.textComments,width:"100%"},{xtype:"dataview",flex:1,id:"id-comments",cls:"comments-view",group:"scrollable",store:Ext.getStore("Common.store.Comments")||Ext.create("Common.store.Comments",{storeId:"Common.store.Comments"}),blockRefresh:!0,disableSelection:!0,tpl:new Ext.XTemplate('<tpl for=".">','<tpl if="lock">','<div class="comment-wrap lock" id="comment-{id}">',"</tpl>",'<tpl if="!lock">','<div class="comment-wrap" id="comment-{id}">',"</tpl>",'<div class="header">','<div class="user-info" >','<div class="user">{[this.getUserName(values.userid, values.username)]}</div>','<div class="date">{[this.getLocaleDate(values.date)]}</div>',"</div>",'<div class="edit-info">','<tpl if="this.canEditReply(userid)">','<div class="btn-header comment edit"></div>','<div class="btn-header comment delete"></div>',"</tpl>",'<tpl if="resolved">','<label class="resolve resolved">',e.textResolved,"</label>","</tpl>",'<tpl if="!resolved">','<label class="resolve">',e.textResolve,"</label>","</tpl>","</div>","</div>",e.noQuotes?"":'<div class="quote">{[this.getFixedQuote(values.quote)]}</div>','<div class="comment-message">','<div class="comment" data-can-copy="true">{[this.fixMessage(values.comment)]}</div>',"</div>",'<div class="replys">','<tpl for="replys">','<div class="reply" id="reply-{id}">','<div class="header">','<div class="user-info" >','<div class="user">{[this.getUserName(values.userid, values.username)]}</div>','<div class="date">{[this.getLocaleDate(values.date)]}</div>',"</div>",'<div class="edit-info">','<tpl if="this.canEditReply(userid)">','<div class="btn-header reply edit"></div>','<div class="btn-header reply delete"></div>',"</tpl>","</div>","</div>",'<div class="reply-message">','<div class="message" data-can-copy="true">{[this.fixMessage(values.reply)]}</div>',"</div>","</div>","</tpl>","</div>",'<div id="comment-{id}-add-reply-container" class="add-reply-container"></div>','<div class="separator"></div>','<div class="lock-area"></div>','<div class="lock-author">{[this.getLockUserName(values.lockuserid)]}</div>',"</div>","</tpl>",'<div class="last-clear"></div>','<div class="x-clear"></div>',{compiled:!0,canEditReply:function(e){return!0},getFixedQuote:function(e){return Ext.String.ellipsis(Ext.String.htmlEncode(e),120,!0)},getLocaleDate:function(e){if(!e)return Ext.String.format("{0} {1}","--/--/--","--:-- AM");var t=new Date(e);return Ext.String.format("{0} {1}",Ext.Date.format(t,"n/j/Y"),Ext.Date.format(t,"g:i A"))},getUserName:function(n,r){if(t){var i=t.findRecord("id",n);if(i)return Ext.String.ellipsis(Ext.String.htmlEncode(i.get("username")),15,!0);if(Ext.isString(r)&&r.length>0)return r}return e.textAnonym},getLockUserName:function(n){if(t){var r=t.findRecord("id",n);if(r)return Ext.String.ellipsis(Ext.String.htmlEncode(r.get("username")),15,!0)}return e.textAnonym},fixMessage:function(e){var t=function(e){var t=/[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}/i.exec(e);if(t)e=e.replace(t[0],'<a href="mailto:'+t[0]+">"+t[0]+"</a>");else{t=e.match(/((https?|ftps?):\/\/)(www.)?([a-z0-9-]+)(\.[a-z]{2,6})?(\/\S*)?/ig),!t&&(t=e.match(/((https?|ftps?):\/\/)?(www.)?([a-z0-9-]+)(\.[a-z]{2,6})(\/\S*)?/ig));for(var n in t)e=e.replace(t[n],'<a href="'+(t[n].search(/((https?|ftps?):\/\/)/g)<0?"http://":"")+t[n]+'" target="_blank">'+t[n]+"</a>")}return e},n=function(e){return Ext.String.htmlEncode(e)};return t(n(e)).replace(/\n/g,"<br/>")}}),itemSelector:"div.comment-wrap",emptyText:"",autoScroll:!0,plugins:[{ptype:"dataviewscrollpane",pluginId:"scrollpane",areaSelector:".comments-view",settings:{enableKeyboardNavigation:!0,verticalGutter:1}}]},{xtype:"container",id:"id-add-comment-link",cls:"add-comment-container add-link",html:"<label>"+e.textAddCommentToDoc+"</label>",height:45},{xtype:"container",layout:{type:"vbox",align:"stretch"},id:"id-add-comment-container",cls:"add-comment-container",height:115,hidden:!0,items:[{xtype:"textarea",id:"id-comment-textarea",height:62,enableKeyEvents:!0},{xtype:"container",layout:"hbox",items:[{xtype:"button",id:"id-btn-send-comment",cls:"btn-send-comment asc-blue-button",text:e.textAddComment},{xtype:"tbspacer",flex:1},{xtype:"button",id:"id-btn-cancel-comment",text:e.textCancel}]}]}],this.getAddReplyForm=function(t){var n=t.scope,r=t.commentId,i=t.textAreaHandlers,s=t.onReplyHandler,o=t.onCloseHandler;return Ext.widget("container",{id:"controls-reply-"+r,cls:"controls-reply-container",layout:{type:"vbox",align:"stretch"},hidden:!0,height:80,items:[{xtype:"textarea",flex:1,emptyText:e.textAddReply,enableKeyEvents:!0,listeners:{focus:Ext.bind(i.onFocus,n),blur:Ext.bind(i.onBlur,n),keydown:Ext.bind(i.onKeyDown,n),elastic:Ext.bind(i.onElastic,n)},plugins:[{ptype:"textareaautoheight",pluginId:"elastic-helper"}]},{xtype:"container",layout:"hbox",height:26,id:"controls-reply-"+r+"-buttons",items:[{xtype:"button",text:e.textReply,cls:"asc-blue-button",action:"reply",handler:Ext.bind(function(e,t){s.call(n,e)},n)},{xtype:"tbspacer",width:10},{xtype:"button",text:e.textClose,handler:Ext.bind(function(e,t){o.call(n,e)},n)}]}]})},e.callParent(arguments)},textComments:"Comments",textAnonym:"Guest",textAddCommentToDoc:"Add Comment to Document",textAddComment:"Add Comment",textCancel:"Cancel",textAddReply:"Add Reply",textReply:"Reply",textClose:"Close",textResolved:"Resolved",textResolve:"Resolve"}),Ext.define("Common.view.CommentsPopover",{extend:"Ext.container.Container",alias:"widget.commoncommentspopover",cls:"common-commentspopover",requires:["Common.plugin.DataViewScrollPane","Common.plugin.TextAreaAutoHeight","Ext.XTemplate","Ext.view.View"],layout:{type:"vbox",align:"stretch"},width:250,height:300,minHeight:50,maxHeight:300,hideMode:"display",config:{commentId:0,userId:0},constructor:function(e){if(!e||!e.commentId||!e.userId)throw Error("Common.view.CommentsPopover creation failed: required parameters are missing.");return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){var e=this,t=Ext.getStore("Common.store.Users");e.id="id-popover-comments-"+e.commentId,e.items=[{xtype:"container",html:'<div class="popover-arrow"></div>'},{xtype:"dataview",flex:1,id:"id-popover-comments-view-"+e.commentId,cls:"comments-view popover",store:"Common.store.Comments",blockRefresh:!0,disableSelection:!0,tpl:new Ext.XTemplate('<tpl for=".">','<tpl if="this.canDisplay(values.id)">','<div class="comment-wrap" id="id-popover-comment-{id}">','<div class="header">','<div class="user-info" >','<div class="user">{[this.getUserName(values.userid, values.username)]}</div>','<div class="date">{[this.getLocaleDate(values.date)]}</div>',"</div>",'<div class="edit-info" <tpl if="!this.hideControls()">style="display:none;"</tpl> >','<tpl if="this.canEditReply(userid)">','<div class="btn-header comment edit"></div>','<div class="btn-header comment delete"></div>',"</tpl>",'<tpl if="resolved">','<label class="resolve resolved">',e.textResolved,"</label>","</tpl>",'<tpl if="!resolved">','<label class="resolve">',e.textResolve,"</label>","</tpl>","</div>","</div>",'<div class="comment-message">','<div class="comment" data-can-copy="true">{[this.fixMessage(values.comment)]}</div>',"</div>",'<div class="replys">','<tpl for="replys">','<div class="reply" id="reply-{id}">','<div class="header">','<div class="user-info" >','<div class="user">{[this.getUserName(values.userid, values.username)]}</div>','<div class="date">{[this.getLocaleDate(values.date)]}</div>',"</div>",'<div class="edit-info" <tpl if="!this.hideControls()">style="display:none;"</tpl> >','<tpl if="this.canEditReply(userid)">','<div class="btn-header reply edit"></div>','<div class="btn-header reply delete"></div>',"</tpl>","</div>","</div>",'<div class="reply-message">','<div class="message" data-can-copy="true">{[this.fixMessage(values.reply)]}</div>',"</div>","</div>","</tpl>","</div>","</div>","</tpl>",'<tpl if="!this.canDisplay(values.id)">','<div class="comment-wrap hidden"></div>',"</tpl>","</tpl>",'<div class="x-clear"></div>',{compiled:!0,canDisplay:function(t){return t==e.commentId},canEditReply:function(e){return!0},getFixedQuote:function(e){return Ext.String.ellipsis(Ext.String.htmlEncode(e),120,!0)},getLocaleDate:function(e){if(!e)return Ext.String.format("{0} {1}","--/--/--","--:-- AM");var t=new Date(e);return Ext.String.format("{0} {1}",Ext.Date.format(t,"n/j/Y"),Ext.Date.format(t,"g:i A"))},getUserColor:function(e){if(t){var n=t.findRecord("id",e);if(n)return n.data.color}return"#000"},getUserName:function(n,r){if(t){var i=t.findRecord("id",n);if(i)return Ext.String.ellipsis(Ext.String.htmlEncode(i.get("username")),15,!0);if(Ext.isString(r)&&r.length>0)return r}return e.textAnonym},fixMessage:function(e){var t=function(e){var t=/[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}/i.exec(e);if(t)e=e.replace(t[0],'<a href="mailto:'+t[0]+">"+t[0]+"</a>");else{t=e.match(/((https?|ftps?):\/\/)(www.)?([a-z0-9-]+)(\.[a-z]{2,6})?(\/\S*)?/ig),!t&&(t=e.match(/((https?|ftps?):\/\/)?(www.)?([a-z0-9-]+)(\.[a-z]{2,6})(\/\S*)?/ig));for(var n in t)e=e.replace(t[n],'<a href="'+(t[n].search(/((https?|ftps?):\/\/)/g)<0?"http://":"")+t[n]+'" target="_blank">'+t[n]+"</a>")}return e},n=function(e){return Ext.String.htmlEncode(e)};return t(n(e)).replace(/\n/g,"<br/>")},hideControls:function(){return e.editable!==!1}}),itemSelector:"div.comment-wrap",emptyText:"",autoScroll:!0,plugins:[{ptype:"dataviewscrollpane",pluginId:"scrollpane",areaSelector:".comments-view",settings:{enableKeyboardNavigation:!0,verticalGutter:1}}]},{xtype:"container",id:"id-popover-add-reply-link-"+e.commentId,cls:"reply-link-container add-link",action:"add-reply-link-container",hidden:e.editable===!1,items:[{xtype:"label",text:e.textAddReply,action:"link"}]},{xtype:"container",id:"id-popover-controls-reply-"+e.commentId,cls:"controls-reply-container",action:"add-reply-form-container",layout:{type:"vbox",align:"stretch"},height:100,hidden:!0,items:[{xtype:"textarea",emptyText:e.textAddReply,action:"add-reply-textarea",enableKeyEvents:!0,plugins:[{ptype:"textareaautoheight",pluginId:"elastic-helper"}]},{xtype:"container",layout:"hbox",height:26,id:"id-popover-controls-reply-"+e.commentId+"-buttons",items:[{xtype:"button",text:e.textReply,cls:"asc-blue-button",action:"reply"},{xtype:"tbspacer",width:10},{xtype:"button",text:e.textClose,action:"close"}]}]}],e.callParent(arguments)},afterRender:function(){this.callParent(arguments);var e=this.getEl();e&&Ext.DomHelper.append(e,'<div class="lock-area"></div><div class="lock-author"></div>')},fireTransformToAdd:function(){this.fireEvent("transformToAdd",this)},textAnonym:"Guest",textResolved:"Resolved",textResolve:"Resolve",textAddReply:"Add Reply",textReply:"Reply",textClose:"Close"}),Ext.define("Common.view.DocumentAccessDialog",{extend:"Ext.window.Window",alias:"widget.commondocumentaccessdialog",uses:["Common.component.LoadMask"],modal:!0,resizable:!1,plain:!0,constrain:!0,height:534,width:850,layout:"fit",closable:!0,style:"background-color:white;",initComponent:function(){this.items=[{xtype:"container",flex:1,html:'<div id="id-sharing-placeholder"></div>'}],this.title=this.textTitle,this.addEvents("accessrights"),this.callParent(arguments)},afterRender:function(e){this.callParent(arguments);var t=document.createElement("iframe");t.src=this.settingsurl,t.width=850,t.height=500,t.align="top",t.frameBorder=0,t.scrolling="no",t.onload=Ext.bind(this._onLoad,this);var n=e.down("#id-sharing-placeholder",!0);n.parentNode.replaceChild(t,n),this.loadMask=Ext.widget("cmdloadmask",this),this.loadMask.setTitle(this.textLoading),this.loadMask.show(),this._bindWindowEvents.call(this)},_bindWindowEvents:function(){var e=this;window.addEventListener?window.addEventListener("message",function(t){e._onWindowMessage(t)},!1):window.attachEvent&&window.attachEvent("onmessage",function(t){e._onWindowMessage(t)})},_onWindowMessage:function(e){if(e&&window.JSON)try{this._onMessage.call(this,window.JSON.parse(e.data))}catch(t){}},_onMessage:function(e){e&&e.needUpdate&&this.fireEvent("accessrights",this,e.sharingSettings),this.close()},_onLoad:function(){this.loadMask.hide()},textTitle:"Sharing Settings",textLoading:"Loading"}),Ext.define("Common.view.SearchDialog",{extend:"Ext.window.Window",alias:"widget.commonsearchdialog",requires:["Ext.window.Window","Ext.form.field.Checkbox"],closable:!0,resizable:!1,height:120,width:550,padding:"12px 20px 0 20px",constrain:!0,layout:{type:"vbox",align:"stretch"},listeners:{show:function(){this.txtSearchQuery.focus(!1,100)}},initComponent:function(){var e=this;this.isSearchMode=!0,this.isViewMode=Ext.isDefined(this.initialConfig.isViewMode)?this.initialConfig.isViewMode:!1,this.btnSearchPrev=Ext.create("Ext.Button",{cls:"dlg-search",width:45,iconCls:"asc-btn-search previous",style:"margin: 0 6px 0 8px",group:"search-text",direction:"prev"}),this.btnSearchNext=Ext.create("Ext.Button",{cls:"dlg-search",width:45,iconCls:"asc-btn-search next",group:"search-text",direction:"next"}),this.btnReplace=Ext.create("Ext.Button",{text:this.txtBtnReplace,height:22,width:96,group:"replace-text",style:"margin: 0 0 0 8px",type:"single"}),this.btnReplaceAll=Ext.create("Ext.Button",{text:this.txtBtnReplaceAll,height:22,width:96,group:"replace-text",hidden:!0,type:"all"}),this.btnOpenReplace=Ext.create("Ext.Button",{text:this.txtBtnReplace,height:22,width:96,hidden:this.isViewMode,handler:function(){e.replaceMode()}}),this.chCaseSensitive=Ext.widget("checkbox",{boxLabel:this.textMatchCase,style:"margin: 0 20px 0 0",checked:this.matchcase&&this.matchcase.checked===!0,hidden:this.matchcase===!1||typeof this.matchcase=="object"&&this.matchcase.visible===!1}),this.chWholeWords=Ext.widget("checkbox",{boxLabel:this.textWholeWords,style:"margin: 0 20px 0 0",checked:this.wholewords&&this.wholewords.checked===!0,hidden:this.wholewords===!1||typeof this.wholewords=="object"&&this.wholewords.visible===!1}),this.chHighlight=Ext.widget("checkbox",{boxLabel:this.textHighlight,style:"margin: 0 20px 0 0",action:"highlight",checked:this.highlight&&this.highlight.checked===!0,hidden:this.highlight===!1||typeof this.highlight=="object"&&this.highlight.visible===!1}),this.txtSearchQuery=Ext.create("Common.component.SearchField",{id:"search-dialog-text-search",flex:1,emptyText:this.textSearchStart,tabIndex:1,style:"border-radius: 2px;"}),this.txtReplaceQuery=Ext.create("Common.component.SearchField",{id:"search-dialog-text-replace",flex:1,style:"border-radius: 2px;",emptyText:this.textSearchStart,tabIndex:2,listeners:{searchstart:function(e,t){e.stopSearch(!0)}}}),this.items=[{xtype:"container",width:310,height:22,layout:{type:"hbox",align:"stretch"},items:[this.txtSearchQuery,this.btnSearchPrev,this.btnSearchNext]},{xtype:"container",width:310,height:22,style:"margin: 10px 0 0 0",hidden:!0,layout:{type:"hbox"},items:[this.txtReplaceQuery,this.btnReplace]},{xtype:"container",width:310,height:22,style:"margin: 10px 0 0 0",layout:{type:"hbox"},items:[this.chCaseSensitive,this.chWholeWords,this.chHighlight,{xtype:"box",flex:1},this.btnReplaceAll,this.btnOpenReplace]}],this.simplesearch&&(this.items[2].hidden=!0,this.minHeight=86,this.height=86),this.callParent(arguments),this.setTitle(this.isViewMode?this.textTitle2:this.textTitle)},replaceMode:function(){this.isSearchMode=!1,this.setSize({height:150}),this.items.getAt(1).show(),this.btnReplaceAll.show(),this.btnOpenReplace.hide()},searchMode:function(){this.isSearchMode=!0,this.setSize({height:120}),this.items.getAt(1).hide(),this.btnReplaceAll.hide(),this.isViewMode||this.btnOpenReplace.show()},getSettings:function(){var e={textsearch:this.txtSearchQuery.getText(),casesensitive:this.chCaseSensitive.getValue(),wholewords:this.chWholeWords.getValue(),highlight:this.chHighlight.getValue()};return!this.isSearchMode&&(e.textreplace=this.txtReplaceQuery.getText()),e},selectSearch:function(){this.txtSearchQuery.getText().length>0&&this.txtSearchQuery.focus(100,!0)},setViewMode:function(e){this.isViewMode!==e&&(this.isViewMode=e,this.setTitle(this.isViewMode?this.textTitle2:this.textTitle),this.btnOpenReplace.setVisible(!e))},textTitle:"Search & Replace",textTitle2:"Search",txtBtnReplace:"Replace",txtBtnReplaceAll:"Replace All",textMatchCase:"Case sensitive",textWholeWords:"Whole words only",textHighlight:"Highlight results",textSearchStart:"Enter text here"}),Ext.define("Common.view.Participants",{extend:"Ext.container.Container",alias:"widget.statusinfoparticipants",requires:["Ext.form.Label","Ext.toolbar.Spacer","Ext.Img"],layout:{type:"hbox",align:"middle"},height:27,width:80,hidden:!0,config:{pack:"start"},constructor:function(e){return this.layout&&e&&(this.layout.pack=e.pack),this.initConfig(e),this.callParent(arguments),this},initComponent:function(){var e=this;this.btnUsers=Ext.widget("button",{text:"1",cls:"asc-statusinfo-text-btn",iconCls:Ext.isDefined(this.userIconCls)?this.userIconCls:"icon-statusinfo-users",listeners:{click:function(){var e=Ext.getCmp("view-main-menu"),t=Ext.getCmp("id-menu-chat");e&&t&&(t.pressed?t.toggle(!1):e.selectMenu("menuChat"))},render:function(t){t.getEl().set({"data-qtip":e.tipUsers,"data-qalign":"bl-tl?"})}}}),this.items=[{xtype:"tbseparator",width:2,height:27,style:"padding-top:2px;",html:'<div style="width: 100%; height: 100%; border-left: 1px solid rgba(0, 0, 0, 0.1); border-right: 1px solid rgba(255, 255, 255, 0.5);"></div>'},{xtype:"tbspacer",width:12},this.btnUsers,{xtype:"tbspacer",width:10},{xtype:"tbseparator",width:2,height:27,style:"padding-top:2px;",html:'<div style="width: 100%; height: 100%; border-left: 1px solid rgba(0, 0, 0, 0.1); border-right: 1px solid rgba(255, 255, 255, 0.5);"></div>'}],this.callParent(arguments)},setApi:function(e){return this.api=e,this.api.asc_registerCallback("asc_onParticipantsChanged",Ext.bind(this._onParticipantsChanged,this)),this.api.asc_registerCallback("asc_onAuthParticipantsChanged",Ext.bind(this._onParticipantsChanged,this)),this},_onParticipantsChanged:function(e){e.length>1&&this.setVisible(!0),this.btnUsers.setText(e.length);if(this.btnUsers.getEl()){var t=this.tipUsers+"<br/><br/>";for(var n=0;n<e.length&&n<4;n++)t+="<br/>"+e[n].asc_getUserName();e.length>4&&(t+="<br/>"+this.tipMoreUsers.replace("%1",e.length-4),t+="<br/><br/>"+this.tipShowUsers),this.btnUsers.getEl().set({"data-qtip":t,"data-qalign":"bl-tl?","data-qwidth":"250"})}},setMode:function(e){this.editorConfig={user:e.user}},tipUsers:"Document is in the collaborative editing mode.",tipMoreUsers:"and %1 users.",tipShowUsers:"To see all users click the icon below."}),Ext.define("Common.controller.Chat",{extend:"Ext.app.Controller",views:["ChatPanel"],refs:[{ref:"chatPanel",selector:"commonchatpanel"},{ref:"messageList",selector:"#id-chat-msg"},{ref:"userList",selector:"#id-chat-users"},{ref:"messageTextArea",selector:"#id-chat-textarea"},{ref:"btnSend",selector:"#id-btn-send-msg"}],stores:["Common.store.ChatMessages","Common.store.Users"],init:function(){this.control({"#id-btn-send-msg":{afterrender:this.onBtnSendAfterRender,click:this.onBtnSendClick},"#id-chat-msg":{itemadd:this.onAddMessage},"#id-chat-textarea":{keydown:this.onTextAreaKeyDown,keyup:this.onTextAreaKeyUp},"#id-chat-users":{viewready:function(){this.onUpdateUser()},itemclick:this.onUserListItemClick,itemupdate:this.onUpdateUser},"#view-main-menu":{panelshow:this.onShowPanel}})},setApi:function(e){return this.api=e,this.api.asc_registerCallback("asc_onParticipantsChanged",Ext.bind(this.onParticipantsChanged,this)),this.api.asc_registerCallback("asc_onCoAuthoringChatReceiveMessage",Ext.bind(this.onCoAuthoringChatReceiveMessage,this)),this.api.asc_registerCallback("asc_onAuthParticipantsChanged",Ext.bind(this.onAuthParticipantsChanged,this)),this.api.asc_registerCallback("asc_onConnectionStateChanged",Ext.bind(this.onConnectionStateChanged,this)),this.api.asc_coAuthoringGetUsers(),this.api.asc_coAuthoringChatGetMessages(),this},onLaunch:function(){Common.Gateway.on("init",Ext.bind(this.loadConfig,this))},loadConfig:function(e){},_sendMessage:function(){var e=this.getMessageTextArea(),t=this;if(e){var n=Ext.String.trim(e.getValue());if(n.length>0&&this.api){var r=function(e,t){var n=[];while(e){if(e.length<t){n.push(e);break}n.push(e.substr(0,t)),e=e.substr(t)}return n},i=r(n,2048);Ext.each(i,function(e){t.api.asc_coAuthoringChatSendMessage(e)}),e.setValue("")}}},_updateUserOnline:function(e,t){e&&(e.beginEdit(),e.set("online",t),e.get("color").length<1&&e.set("color","#"+("000000"+Math.floor(Math.random()*16777215).toString(16)).substr(-6)),e.endEdit(),e.commit())},onBtnSendClick:function(e,t){this._sendMessage();var n=Ext.getCmp("id-chat-textarea");if(n){var r=new Ext.util.DelayedTask(function(){this.api.asc_enableKeyEvents(!1),n.focus()},this);r.delay(100)}},onBtnSendAfterRender:function(e){var t=e.getEl(),n=this.getMessageTextArea();Ext.supports.Placeholder&&(t.on("mousedown",function(){n.emptyText=this.textEnterMessage,n.applyEmptyText()},this),t.on("mouseup",function(){n.emptyText=" ",n.applyEmptyText()},this))},onAddMessage:function(e,t,n){var r=this.getMessageList();if(r){var i=r.getPlugin("scrollpane");if(i&&i.jspApi){var s=i.jspApi.getPercentScrolledY()>.999;r.getWidth()>0&&i.updateScrollPane(),s&&Ext.defer(function(){var e=r.getNode(t);e&&i.scrollToElement(e,!1,!0)},100,this)}}},onUpdateUser:function(e,t,n){var r=this.getUserList();if(r){var i=r.getStore().getOnlineUserCount();i>10&&(i=10),r.setHeight(i<4?70:i*18+12);var s=r.getPlugin("scrollpane");s&&r.getEl().dom.clientWidth>0&&s.updateScrollPane()}},onTextAreaKeyUp:function(e,t){t.getKey()==t.ENTER&&(e.emptyText=" ",e.applyEmptyText())},onTextAreaKeyDown:function(e,t){t.getKey()==t.ENTER&&(t.ctrlKey||t.metaKey)&&!t.shiftKey&&(e.getValue().length<1?(e.emptyText=this.textEnterMessage,e.applyEmptyText()):this._sendMessage(),t.stopEvent())},onUserListItemClick:function(e,t,n,r,i){},onParticipantsChanged:function(e){},onCoAuthoringChatReceiveMessage:function(e){var t=this.getCommonStoreChatMessagesStore();t&&Ext.each(e,function(e){t.add({type:0,userid:e.user,message:e.message,username:e.username})})},onAuthParticipantsChanged:function(e){var t=this.getCommonStoreUsersStore();if(t){var n,r=this;Ext.each(e,function(e){n=t.add({id:e.asc_getId(),username:e.asc_getUserName()})[0],this._updateUserOnline(n,!0)},this)}},onConnectionStateChanged:function(e){var t=this.getCommonStoreUsersStore();if(t){var n=t.findRecord("id",e.asc_getId());n||(n=t.add({id:e.asc_getId(),username:e.asc_getUserName()})[0]),this._updateUserOnline(t.findRecord("id",e.asc_getId()),e.asc_getState())}},onShowPanel:function(e,t){var n=e.down("container");if(n&&n.isXType("commonchatpanel")){var r=this.getMessageList(),i=this.getUserList(),s;r&&(s=r.getPlugin("scrollpane"),s&&(s.updateScrollPane(),s.jspApi.scrollToPercentY(100,!0))),i&&(s=i.getPlugin("scrollpane"),s&&s.updateScrollPane())}},textEnterMessage:"Enter your message here",capGuest:"Guest"}),Ext.define("Common.controller.CommentsBase",{extend:"Ext.app.Controller",models:["Common.model.Reply","Common.model.Comment"],stores:["Common.store.Comments","Common.store.Users"],config:{currentUserId:undefined,currentUserName:undefined},timeZoneOffsetInMs:(new Date).getTimezoneOffset()*6e4,init:function(){},loadConfig:function(e){this.setCurrentUserId(e.config.user.id),this.setCurrentUserName(e.config.user.name)},setApi:function(e){this.api=e},utcDateToString:function(e){return Object.prototype.toString.call(e)==="[object Date]"?(e.getTime()-this.timeZoneOffsetInMs).toString():""},addComment:function(e){if(this.api){var t=Ext.String.trim(e);if(t.length>0){var n=new asc_CCommentData;n&&(n.asc_putText(t),n.asc_putTime(this.utcDateToString(new Date)),n.asc_putUserId(this.getCurrentUserId()),n.asc_putUserName(this.getCurrentUserName()),n.asc_putSolved(!1),this.api.asc_addComment(n))}}},resolveComment:function(e,t){if(this.api){var n=this.getCommonStoreCommentsStore(),r=new asc_CCommentData,i=this;if(n&&r){var s=n.findRecord("id",e);s&&(r.asc_putText(s.get("comment")),r.asc_putQuoteText(s.get("quote")),r.asc_putTime(this.utcDateToString(new Date(s.get("date")))),r.asc_putUserId(s.get("userid")),r.asc_putUserName(s.get("username")),r.asc_putSolved(t),s.replys().each(function(e){var t=new asc_CCommentData;t.asc_putText(e.get("reply")),t.asc_putTime(i.utcDateToString(new Date(e.get("date")))),t.asc_putUserId(e.get("userid")),t.asc_putUserName(e.get("username")),r.asc_addReply(t)}),this.api.asc_changeComment(e,r))}}},editComment:function(e,t){if(this.api){var n=Ext.String.trim(t),r=this.getCommonStoreCommentsStore(),i=this;if(n.length>0){var s=new asc_CCommentData,o=r.findRecord("id",e);s&&(s.asc_putText(n),s.asc_putQuoteText(o.get("quote")),s.asc_putTime(this.utcDateToString(new Date(o.get("date")))),s.asc_putUserId(this.getCurrentUserId()),s.asc_putUserName(this.getCurrentUserName()),s.asc_putSolved(o.get("resolved")),o.replys().each(function(e){var t=new asc_CCommentData;t.asc_putText(e.get("reply")),t.asc_putTime(i.utcDateToString(new Date(e.get("date")))),t.asc_putUserId(e.get("userid")),t.asc_putUserName(e.get("username")),s.asc_addReply(t)}),this.api.asc_changeComment(e,s))}}},deleteComment:function(e){this.api&&this.api.asc_removeComment(e)},selectComment:function(e){this.api&&(this.api.asc_selectComment(e),this.api.asc_showComment(e))},addReply:function(e,t){if(this.api){var n=Ext.String.trim(t),r=this.getCommonStoreCommentsStore(),i=this;if(r&&t.length>0){var s=new asc_CCommentData,o=r.findRecord("id",e);if(s&&o){s.asc_putText(o.get("comment")),s.asc_putQuoteText(o.get("quote")),s.asc_putTime(this.utcDateToString(new Date(o.get("date")))),s.asc_putUserId(o.get("userid")),s.asc_putUserName(o.get("username")),s.asc_putSolved(o.get("resolved"));var u=function(e){var t=new asc_CCommentData;t.asc_putText(e.reply),t.asc_putTime(e.date),t.asc_putUserId(e.userid),t.asc_putUserName(e.username),s.asc_addReply(t)};return u({reply:n,date:this.utcDateToString(new Date),userid:this.getCurrentUserId(),username:this.getCurrentUserName()}),o.replys().each(function(e){u({reply:e.get("reply"),date:i.utcDateToString(new Date(e.get("date"))),userid:e.get("userid"),username:e.get("username")})}),this.api.asc_changeComment(e,s),!0}}}return!1},editReply:function(e,t,n){if(this.api){var r=Ext.String.trim(n),i=this,s=this.getCommonStoreCommentsStore();if(s&&r.length>0){var o=new asc_CCommentData,u=s.findRecord("id",e);if(o){o.asc_putText(u.get("comment")),o.asc_putQuoteText(u.get("quote")),o.asc_putTime(this.utcDateToString(new Date(u.get("date")))),o.asc_putUserId(u.get("userid")),o.asc_putUserName(u.get("username")),o.asc_putSolved(u.get("resolved"));var a=function(e){var t=new asc_CCommentData;t.asc_putText(e.reply),t.asc_putTime(e.date),t.asc_putUserId(e.userid),t.asc_putUserName(e.username),o.asc_addReply(t)};u.replys().each(function(e){var n=e.get("id");a({reply:n==t?r:e.get("reply"),date:i.utcDateToString(new Date(e.get("date"))),userid:n==t?i.getCurrentUserId():e.get("userid"),username:n==t?i.getCurrentUserName():e.get("username")})}),this.api.asc_changeComment(e,o)}}}},deleteReply:function(e,t){if(this.api){var n=this.getCommonStoreCommentsStore(),r=this.getCommonStoreCommentsStore(),i=new asc_CCommentData,s=this;if(n&&r&&i){var o=n.findRecord("id",e),u=r.findRecord("id",o.get("userid"));i.asc_putText(o.get("comment")),i.asc_putQuoteText(o.get("quote")),i.asc_putTime(this.utcDateToString(new Date(o.get("date")))),i.asc_putUserId(o.get("userid")),i.asc_putUserName(u?u.get("username"):""),i.asc_putSolved(o.get("resolved"));var a=function(e){var t=new asc_CCommentData;t.asc_putText(e.reply),t.asc_putTime(e.date),t.asc_putUserId(e.userid),t.asc_putUserName(e.username),i.asc_addReply(t)};o.replys().each(function(e){if(t!=e.get("id")){var n=new asc_CCommentData;n.asc_putText(e.get("reply")),n.asc_putTime(s.utcDateToString(new Date(e.get("date")))),n.asc_putUserId(e.get("userid")),n.asc_putUserName(e.get("username")),i.asc_addReply(n)}}),this.api.asc_changeComment(e,i)}}},updateHandlers:function(e,t,n){var r=this,i=e.get("id"),s=Ext.get(t);if(Ext.isDefined(s)){var o=function(e,t){var n=s.down(e);if(n){var o=Ext.bind(function(e,n){t.call(n,i)},r);n.un("click"),n.on("click",o)}},u=function(e,t){var n=s.down(".replys");if(n){var o=n.query(e);Ext.each(o,function(e){var n=Ext.get(e),s=n.up(".reply");if(s){var o=s.id.match(/\d+/g);if(o!=null&&o.length>0){var u=Ext.bind(function(e,n){t.call(n,i,o)},r);n.un("click"),n.on("click",u)}}})}},a=function(e,t){var n=s.down(".replys");if(n){var o=n.query(e);Ext.each(o,function(e){var n=Ext.get(e);if(n){var s=Ext.bind(function(e,n){t.call(n,i)},r);n.un("click"),n.on("click",s)}})}};o(".resolve",function(e){n&&n.onResolveComment&&n.onResolveComment.call(r,e)}),o(".comment.edit",function(e){n&&n.showEditCommentControls&&n.showEditCommentControls.call(r,e)}),o(".comment.delete",function(e){r.deleteComment(e)}),o(".quote",function(e){r.selectComment(e)}),o(".comment-message",function(e){r.selectComment(e)}),a(".reply-message",function(e){r.selectComment(e)}),u(".edit",function(e,t){n&&n.showEditReplyControls&&n.showEditReplyControls.call(r,e,t)}),u(".delete",function(e,t){r.deleteReply(e,t[0])})}}}),Ext.define("Common.controller.CommentsList",{extend:"Common.controller.CommentsBase",requires:["Common.view.CommentsEditForm"],views:["CommentsPanel"],stores:["Common.store.Comments","Common.store.Users"],refs:[{ref:"commentsPanel",selector:"commoncommentspanel"},{ref:"commentsList",selector:"#id-comments"},{ref:"commentTextArea",selector:"#id-comment-textarea"},{ref:"btnAddComment",selector:"#id-btn-send-comment"},{ref:"linkAddComment",selector:"#id-add-comment-link"},{ref:"containerAddComment",selector:"#id-add-comment-container"}],init:function(){this.control({"#id-btn-send-comment":{afterrender:this.onBtnAddAfterRender,click:this.onBtnAddCommentClick},"#id-btn-cancel-comment":{click:this.hideAddCommentControls},"#id-comments":{afterrender:this.onAfterRenderComments,itemadd:this.onAddComment,itemremove:this.onRemoveComment,itemupdate:this.onUpdateComment,viewready:this.onViewReadyComments,refresh:this.onRefreshComments},"#id-comment-textarea":{keydown:this.onTextAreaKeyDown,keyup:this.onTextAreaKeyUp},"#id-add-comment-link":{afterrender:this.onAfterRenderAddCommentLink},"#view-main-menu":{panelshow:this.onShowPanel}})},setConfig:function(e,t){this.loadConfig(e),this.setApi(t)},loadConfig:function(e){var t=this.getCommentsPanel(),n=this.getCommentsList(),r=this;t?(t.setCurrentUserId(e.config.user.id),n.refresh()):this.control({commoncommentspanel:{beforerender:function(){var t=r.getCommentsPanel();t&&(t.setCurrentUserId(e.config.user.id),r.getCommentsList().refresh())}}}),this.callParent(arguments)},setApi:function(e){this.callParent(arguments)},registerCallbacks:function(){this.api.asc_registerCallback("asc_onAddComment",Ext.bind(this.onApiAddComment,this)),this.api.asc_registerCallback("asc_onAddComments",Ext.bind(this.onApiAddComments,this)),this.api.asc_registerCallback("asc_onRemoveComment",Ext.bind(this.onApiRemoveComment,this)),this.api.asc_registerCallback("asc_onChangeCommentData",Ext.bind(this.onApiChangeCommentData,this)),this.api.asc_registerCallback("asc_onLockComment",Ext.bind(this.onApiLockComment,this)),this.api.asc_registerCallback("asc_onUnLockComment",Ext.bind(this.onApiUnLockComment,this))},onApiAddComment:function(e,t){var n=this.getCommonStoreCommentsStore(),r=this;if(n){var i=n.findRecord("id",e);if(i){i.beginEdit(),i.set("comment",t.asc_getText()),i.set("date",t.asc_getTime()==""?undefined:this.stringUtcToLocalDate(t.asc_getTime())),i.set("userid",t.asc_getUserId()),i.set("username",t.asc_getUserName()),i.set("resolved",t.asc_getSolved()),i.set("quote",t.asc_getQuoteText()),i.replys().removeAll();var s=t.asc_getRepliesCount();for(var o=0;o<s;o++){var u=++Ext.idSeed;i.replys().add({id:u,userid:t.asc_getReply(o).asc_getUserId(),username:t.asc_getReply(o).asc_getUserName(),date:this.stringUtcToLocalDate(t.asc_getReply(o).asc_getTime()),reply:t.asc_getReply(o).asc_getText()})}i.replys().sort("date","DESC"),i.endEdit(),i.commit(),i.replys().each(function(t){r.hideEditReplyControls(e,t.get("id"))})}else{var a=n.add({id:e,userid:t.asc_getUserId(),username:t.asc_getUserName(),date:t.asc_getTime()==""?undefined:this.stringUtcToLocalDate(t.asc_getTime()),quote:t.asc_getQuoteText(),comment:t.asc_getText(),resolved:t.asc_getSolved()});if(a&&a.length>0){var f=a[0];f.beginEdit();var s=t.asc_getRepliesCount();for(var o=0;o<s;o++){var u=++Ext.idSeed;f.replys().add({id:u,userid:t.asc_getReply(o).asc_getUserId(),username:t.asc_getReply(o).asc_getUserName(),date:this.stringUtcToLocalDate(t.asc_getReply(o).asc_getTime()),reply:t.asc_getReply(o).asc_getText()})}f.replys().sort("date","DESC"),f.endEdit(),f.commit()}}this.commentsFilter&&!this.commentsFilter[0].value.test(e)&&n.filter(this.commentsFilter),this.applySort()}this.hideAddCommentControls()},onApiAddComments:function(e){var t=this.getCommonStoreCommentsStore();if(t){var n=[];for(var r=0;r<e.length;r++){if(t.findRecord("id",e[r].Id))continue;n.push({id:e[r].Id,userid:e[r].Comment.asc_getUserId(),username:e[r].Comment.asc_getUserName(),date:e[r].Comment.asc_getTime()==""?undefined:this.stringUtcToLocalDate(e[r].Comment.asc_getTime()),quote:e[r].Comment.asc_getQuoteText(),comment:e[r].Comment.asc_getText(),resolved:e[r].Comment.asc_getSolved()})}var i=t.add(n),s,o,u;for(var a=0;a<i.length;a++){s=i[a],s.beginEdit(),o=e[a].Comment.asc_getRepliesCount();for(var r=0;r<o;r++)u=++Ext.idSeed,s.replys().add({id:u,userid:e[a].Comment.asc_getReply(r).asc_getUserId(),username:e[a].Comment.asc_getReply(r).asc_getUserName(),date:this.stringUtcToLocalDate(e[a].Comment.asc_getReply(r).asc_getTime()),reply:e[a].Comment.asc_getReply(r).asc_getText()});s.replys().sort("date","DESC"),s.endEdit(),s.commit()}this.commentsFilter&&t.filter(this.commentsFilter),this.applySort()}this.hideAddCommentControls()},onApiRemoveComment:function(e){var t=this.getCommonStoreCommentsStore();if(t){var n=t.findRecord("id",e);n?t.remove(n):this.commentsFilter&&(t.clearFilter(),n=t.findRecord("id",e),t.remove(n),t.filter(this.commentsFilter))}},onApiChangeCommentData:function(e,t){var n=this.getCommonStoreCommentsStore(),r=this;if(n){var i=n.findRecord("id",e);if(!i&&r.commentsFilter){var s=!0;n.clearFilter(),i=n.findRecord("id",e)}if(i){i.beginEdit(),i.set("comment",t.asc_getText()),i.set("date",this.stringUtcToLocalDate(t.asc_getTime())),i.set("userid",t.asc_getUserId()),i.set("username",t.asc_getUserName()),i.set("resolved",t.asc_getSolved()),i.set("quote",t.asc_getQuoteText()),i.replys().removeAll();var o=t.asc_getRepliesCount();for(var u=0;u<o;u++){var a=++Ext.idSeed;i.replys().add({id:a,userid:t.asc_getReply(u).asc_getUserId(),username:t.asc_getReply(u).asc_getUserName(),date:this.stringUtcToLocalDate(t.asc_getReply(u).asc_getTime()),reply:t.asc_getReply(u).asc_getText()})}i.replys().sort("date","DESC"),i.endEdit(),i.commit(),i.replys().each(function(t){r.hideEditReplyControls(e,t.get("id"))})}r.commentsFilter&&s&&n.filter(r.commentsFilter)}this.applySort(),this.editControls=undefined},onApiLockComment:function(e,t){var n=this.getCommonStoreCommentsStore();if(n){var r=n.findRecord("id",e);if(!r&&this.commentsFilter){var i=!0;n.clearFilter(),r=n.findRecord("id",e)}r&&!r.get("lock")&&(r.beginEdit(),r.set("lock",!0),r.set("lockuserid",t),r.endEdit(),r.commit()),this.commentsFilter&&i&&n.filter(this.commentsFilter)}},onApiUnLockComment:function(e){var t=this.getCommonStoreCommentsStore();if(t){var n=t.findRecord("id",e);if(!n&&this.commentsFilter){var r=!0;t.clearFilter(),n=t.findRecord("id",e)}n&&n.get("lock")&&(n.beginEdit(),n.set("lock",!1),n.endEdit(),n.commit()),this.commentsFilter&&r&&t.filter(this.commentsFilter)}},stringUtcToLocalDate:function(e){return typeof e=="string"?parseInt(e)+this.timeZoneOffsetInMs:0},applySort:function(){var e=this.getCommentsList(),t=this.getCommonStoreCommentsStore();t&&t.sort(),e&&e.refresh()},updateCommentsScrollView:function(e){var t=this.getCommentsList();if(t){var n=t.getPlugin("scrollpane");if(n){var r=new Ext.util.DelayedTask(function(){n.scrollToElement(e,!1,!0)});Ext.isDefined(e)&&r.delay(100),t.getWidth()>0&&n.updateScrollPane()}}},scrollViewToEnd:function(e){if(e){var t=e.getPlugin("scrollpane");if(t){var n=new Ext.util.DelayedTask(function(){t.jspApi.scrollToPercentY(100,!0)});n.delay(100)}}},scrollViewToNode:function(e,t){if(e&&t){var n=e.getPlugin("scrollpane");if(n){var r=new Ext.util.DelayedTask(function(){n.scrollToElement(t,!1,!0)});r.delay(100)}}},createAddReplyControls:function(e){var t=this,n=e.get("id"),r=this.getCommentsPanel();Ext.widget("container",{renderTo:"comment-"+n+"-add-reply-container",layout:{type:"vbox",align:"stretch"},height:16,id:"root-add-reply-"+n,cls:"root-add-reply",items:[{xtype:"container",id:"add-reply-link-"+n,cls:"reply-link-container add-link",action:"comments-list-add-reply-link-container",height:16,items:[{xtype:"label",text:t.textAddReply,listeners:{afterrender:function(e){e.getEl().on("click",Ext.bind(function(n,r){t.showAddReplyControls(e)}),this)}}}]},r.getAddReplyForm({scope:t,commentId:n,textAreaHandlers:{onFocus:t.onFocusRetryTextArea,onBlur:Ext.emptyFn,onKeyDown:t.onKeyDownRetryTextArea,onElastic:t.onElasticReplyTextArea},onReplyHandler:t.onBtnAddReply,onCloseHandler:t.onBtnCloseReply})],listeners:{afterrender:Ext.bind(function(e){e.setHeight(16);var t=this.getCommentsList();t&&t.on("resize",function(){e.doLayout()},this,{delay:300})},this)}})},showEditCommentControls:function(e){var t=this.getCommentsList(),n=this.getCommentsPanel();if(t&&n){var r=t.getEl().down("#comment-"+e),i=r.down(".comment-message");if(i){var s=i.down(".comment"),o=r.down(".edit-info"),u=Ext.getCmp("controls-edit-msg-list-"+e),a=this.getCommonStoreCommentsStore();if(a){var f=a.findRecord("id",e);if(f){u&&u.destroy(),o&&o.hide(),s&&(s.setVisibilityMode(Ext.Element.DISPLAY),s.hide()),this.hideEditControls(),this.editControls={action:"edit-comment",comment:e};var l=Ext.widget("commoncommentseditform",{scope:this,editId:"list-"+e,renderTo:i,msgValue:f.get("comment"),onEditHandler:this.onBtnEditComment,onCancelHandler:this.onBtnCancelEditComment});if(l){t.on("resize",function(){l.doLayout()},this,{delay:100}),this.updateCommentsScrollView();var c=Ext.get("controls-edit-msg-list-"+e);c&&this.scrollViewToNode(t,c.dom);var h=l.down("textarea");h&&(h.focus(),h.getValue()&&h.selectText(h.getValue().length))}}}}}},hideEditCommentControls:function(e){var t=this.getCommentsList(),n=this.getCommentsPanel();if(t&&n){var r=t.getEl().down("#comment-"+e),i=r.down(".comment-message");if(i){var s=i.down(".comment"),o=r.down(".edit-info"),u=Ext.getCmp("controls-edit-msg-list-"+e);o&&o.show(),u&&u.hide(),s&&(s.setVisibilityMode(Ext.Element.DISPLAY),s.show()),this.editControls=undefined}}},showEditReplyControls:function(e,t){var n=this.getCommentsList(),r=this.getCommentsPanel();if(n&&r){var i=n.getEl().down("#reply-"+t),s=i.down(".reply-message");if(s){var o=s.down(".message"),u=i.down(".edit-info"),a=Ext.getCmp("controls-edit-msg-list-"+t),f=this.getCommonStoreCommentsStore();if(f){var l=f.findRecord("id",e);if(l){var c=l.replys().findRecord("id",t);if(c){a&&a.destroy(),u&&u.hide(),o&&(o.setVisibilityMode(Ext.Element.DISPLAY),o.hide()),this.hideEditControls(),this.editControls={action:"edit-reply",comment:e,reply:t};var h=Ext.widget("commoncommentseditform",{scope:this,editId:"list-"+t,renderTo:s,msgValue:c.get("reply"),onEditHandler:this.onBtnEditReply,onCancelHandler:this.onBtnCancelEditReply});if(h){n.on("resize",function(){h.doLayout()},this,{delay:100}),this.updateCommentsScrollView();var p=Ext.get("controls-edit-msg-list-"+t);p&&this.scrollViewToNode(n,p.dom);var d=h.down("textarea");d&&(d.focus(),d.getValue()&&d.selectText(d.getValue().length))}}}}}}},hideEditReplyControls:function(e,t){var n=this.getCommentsList(),r=this.getCommentsPanel();if(n&&r){var i=n.getEl().down("#reply-"+t),s=i.down(".reply-message");if(s){var o=s.down(".message"),u=i.down(".edit-info"),a=Ext.getCmp("controls-edit-msg-list-"+t);u&&u.show(),a&&a.hide(),o&&(o.setVisibilityMode(Ext.Element.DISPLAY),o.show()),this.editControls=undefined}}},showAddCommentControls:function(){var e=this.getLinkAddComment(),t=this.getContainerAddComment();if(e&&t){e.hide(),t.show(),this.hideEditControls(),this.editControls={action:"add-comment"};var n=Ext.getCmp("id-comment-textarea");if(n){var r=new Ext.util.DelayedTask(function(){this.api.asc_enableKeyEvents(!1),n.focus()},this);r.delay(100)}}},hideAddCommentControls:function(){var e=this.getLinkAddComment(),t=this.getContainerAddComment(),n=this.getCommentTextArea();e&&t&&n&&(n.setValue(""),t.hide(),e.show(),this.editControls=undefined)},showAddReplyControls:function(e){var t=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("root-add-reply"))return!0});if(t){var n=t.getId().match(/root-add-reply-(.+)/)[1];if(n!=null&&n.length>0){var r=t.down("#add-reply-link-"+n),i=t.down("#controls-reply-"+n),s=t.down("textarea");if(r&&i&&s){this.hideEditControls(),this.editControls={action:"add-reply",component:e},r.setVisible(!1),i.setVisible(!0),t.setHeight(80),(new Ext.util.DelayedTask(function(){this.api.asc_enableKeyEvents(!1),s.focus()},this)).delay(100);var o=this.getCommentsList();if(o){var u=Ext.get("controls-reply-"+n);u&&(this.updateCommentsScrollView(),this.scrollViewToNode(o,u.dom))}}}}},hideAddReplyControls:function(e){var t=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("root-add-reply"))return!0});if(t){var n=t.getId().match(/root-add-reply-(.+)/)[1];if(n!=null&&n.length>0){var r=t.down("#add-reply-link-"+n),i=t.down("#controls-reply-"+n);r&&i&&(r.setVisible(!0),i.setVisible(!1),t.setHeight(16),this.editControls=undefined)}}},doDelayedTask:function(){this.onAfterRenderAddCommentLink()},applyCommentsFilter:function(e){this.commentsFilter=e;var t=this.getCommonStoreCommentsStore();t.clearFilter(),this.commentsFilter&&t.filter(this.commentsFilter);var n=this;if(!n.getCommentsList()||!n.getCommentsList().viewReady)var r=setInterval(function(){n.getCommentsList()&&n.getCommentsList().viewReady&&(clearInterval(r),n.applySort())},100);else n.applySort()},hideEditControls:function(){if(this.editControls)switch(this.editControls.action){case"add-comment":this.hideAddCommentControls();break;case"edit-comment":this.hideEditCommentControls(this.editControls.comment);break;case"add-reply":this.hideAddReplyControls(this.editControls.component);break;case"edit-reply":this.hideEditReplyControls(this.editControls.comment,this.editControls.reply)}},onBtnAddReply:function(e){var t=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("root-add-reply"))return!0});if(t){var n=t.down("textarea");if(n){if(n.getValue()<1)return;var r=Ext.String.trim(n.getValue()),i=t.getId().match(/root-add-reply-(.+)/)[1];i!=null&&i.length>0&&this.addReply(i,r)}}},onBtnCloseReply:function(e){var t=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("root-add-reply"))return!0});if(t){var n=t.down("textarea");n&&(n.setValue(""),this.hideAddReplyControls(e))}},onFocusRetryTextArea:function(e){this.showAddReplyControls(e)},onBtnEditReply:function(e){var t=e.getEl().up(".reply"),n=e.getEl().up(".comment-wrap");if(t&&n){var r=n.id.match(/comment-(.+)/)[1],i=t.id.match(/\d+/g),s=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("controls-edit-msg-container"))return!0});if(s){var o=s.down("textarea");o&&this.editReply(r,i,o.getValue())}}},onBtnCancelEditReply:function(e){var t=e.getEl().up(".reply"),n=e.getEl().up(".comment-wrap");t&&n&&this.hideEditReplyControls(n.id.match(/comment-(.+)/)[1],t.id.match(/\d+/g))},onKeyDownRetryTextArea:function(e,t){if(t.getKey()==t.ENTER&&(t.ctrlKey||t.metaKey)&&!t.shiftKey){var n=this,r=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("root-add-reply"))return!0});if(r){var i=Ext.String.trim(e.getValue()),s=r.getId().match(/root-add-reply-(.+)/)[1];s!=null&&s.length>0&&i.length>0&&(t.stopEvent(),this.addReply(s,i))}}},onElasticReplyTextArea:function(e,t,n){var r=e.ownerCt,i=this;if(r){var s=r.down("container");if(s){var o=function(){r.setHeight(n+s.getHeight()+5);var e=r.ownerCt;e&&e.setHeight(n+s.getHeight()+5),i.updateCommentsScrollView()};s.rendered?o():s.on("afterrender",function(e){o()},i,{single:!0})}}},onBtnEditComment:function(e){var t=e.getEl().up(".comment-wrap");if(t){var n=t.id.match(/comment-(.+)/)[1],r=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("controls-edit-msg-container"))return!0});if(r){var i=r.down("textarea");i&&this.editComment(n,i.getValue())}this.hideEditCommentControls(n)}},onBtnCancelEditComment:function(e){var t=e.getEl().up(".comment-wrap");t&&this.hideEditCommentControls(t.id.match(/comment-(.+)/)[1])},onResolveComment:function(e){var t=this,n=this.getCommentsList(),r=Ext.getCmp("comments-list-menu-resolve-"+e);if(n){var i=n.getEl().down("#comment-"+e),s=i.down(".resolve");if(s){var o=this.getCommonStoreCommentsStore();if(o){var u=o.findRecord("id",e);if(u){var a=u.get("resolved");a?(r||(r=Ext.widget("menu",{id:"comments-list-menu-resolve-"+e,renderTo:Ext.getBody(),plain:!0,minWidth:50,bodyCls:"menu-resolve-comment",items:[{text:t.textOpenAgain,listeners:{click:function(n,r){n.ownerCt.hide(),t.resolveComment(e,!1)}}}]})),r.show(),r.showBy(s,"tr-br",[0,5])):this.resolveComment(e,!a)}}}}},onBtnAddCommentClick:function(e,t){var n=this.getCommentTextArea();n&&this.addComment(n.getValue())&&n.setValue("")},onBtnAddAfterRender:function(e){var t=e.getEl(),n=this.getCommentTextArea();t.on("mousedown",function(){n.emptyText=this.textEnterCommentHint,n.applyEmptyText()},this),t.on("mouseup",function(){n.emptyText=" ",n.applyEmptyText()},this)},onTextAreaKeyUp:function(e,t){t.getKey()==t.ENTER&&(e.emptyText=" ",e.applyEmptyText())},onTextAreaKeyDown:function(e,t){if(t.getKey()==t.ENTER){var n=this.getCommentTextArea();(t.ctrlKey||t.metaKey)&&!t.shiftKey&&(e.getValue().length<1?(e.emptyText=this.textEnterCommentHint,e.applyEmptyText()):n&&this.addComment(n.getValue())&&n.setValue(""),t.stopEvent())}},onAfterRenderComments:function(e){e.getSelectionModel().keyNav.disable()},onAfterRenderAddCommentLink:function(e){var t=this,n=this.getLinkAddComment();if(n&&n.getEl()){var r=n.getEl().down("label");r&&r.on("click",function(e,n){t.showAddCommentControls()})}},onAddComment:function(e,t,n){var r=this,i=this.getCommentsList();Ext.each(e,function(e){r.createAddReplyControls(e),r.updateHandlers(e,"comment-"+e.get("id"),{onResolveComment:r.onResolveComment,showEditCommentControls:r.showEditCommentControls,showEditReplyControls:r.showEditReplyControls})}),i&&this.updateCommentsScrollView(i.getNode(t)),i&&i.fireEvent("resize")},onRemoveComment:function(e,t){var n=Ext.getCmp("root-add-reply-"+e.get("id"));n&&n.destroy()},onUpdateComment:function(e,t,n){var r=this,i=this.getCommentsList(),s=e.get("id"),o=Ext.getCmp("root-add-reply-"+s);Ext.isDefined(o)&&o.destroy(),r.createAddReplyControls(e),i.doComponentLayout(),r.updateHandlers(e,"comment-"+s,{onResolveComment:r.onResolveComment,showEditCommentControls:r.showEditCommentControls,showEditReplyControls:r.showEditReplyControls}),i&&this.updateCommentsScrollView(i.getNode(t))},onViewReadyComments:function(e){var t=this,n=e.getStore();n.each(function(e){t.createAddReplyControls(e),t.updateHandlers(e,"comment-"+e.get("id"),{onResolveComment:t.onResolveComment,showEditCommentControls:t.showEditCommentControls,showEditReplyControls:t.showEditReplyControls})})},onRefreshComments:function(e){if(e.viewReady){var t=this,n=e.getStore(),r=0;n.each(function(e){t.onUpdateComment(e,r)});var i=e.getNodes(),s=e.getWidth();s=s?s+"px":"100%";for(var o in i)i[o].style.width=s}},onShowPanel:function(e,t){var n=e.down("container");if(n&&n.isXType("commoncommentspanel")){var r=Ext.ComponentQuery.query("container[action=comments-list-add-reply-link-container]");r&&Ext.each(r,function(e){var t=e.ownerCt;t&&t.doLayout()})}},textAddReply:"Add Reply",textOpenAgain:"Open Again",textEnterCommentHint:"Enter your comment here"}),Ext.define("Common.controller.CommentsPopover",{extend:"Common.controller.CommentsBase",requires:["Common.view.CommentsEditForm"],views:["Common.view.CommentsPopover"],init:function(){this.visiblePopovers=new Ext.util.MixedCollection,this.isDocumentContentReady=!1,this.control({commoncommentspopover:{afterrender:this.onAfterRenderPopover,transformToAdd:this.onTransformToAdd},"commoncommentspopover > dataview":{afterrender:this.onAfterRenderComment,itemupdate:this.onUpdateComment,viewready:this.onViewReadyComments},"commoncommentspopover textarea[action=add-reply-textarea]":{elastic:this.onElasticAddReply,keydown:this.onKeyDownTextArea},"commoncommentspopover label[action=link]":{afterrender:this.onAfterRenderAddReply},"commoncommentspopover button[action=reply]":{click:this.onBtnAddReply},"commoncommentspopover button[action=close]":{click:this.onBtnCloseReply}})},config:{movingTopLimit:-32,movingBottomLimit:-6,autoPopup:!0,lastPosition:{x:0,y:0}},sdkViewName:"#id_main",setConfig:function(e,t){this.superclass.loadConfig.call(this,e),this.setApi(t),this.sdkViewName=e.sdkviewname||this.sdkViewName,this.setMovingTopLimit(e.movingtoplimit||-32),this.setMovingBottomLimit(e.movingbottomlimit||-6),this.setAutoPopup(e.autopopup||!0)},setApi:function(e){this.callParent(arguments)},registerCallbacks:function(){this.api.asc_registerCallback("asc_onAddComment",Ext.bind(this.onApiAddComment,this)),this.api.asc_registerCallback("asc_onShowComment",Ext.bind(this.onApiShowComment,this)),this.api.asc_registerCallback("asc_onHideComment",Ext.bind(this.onApiHideComment,this)),this.api.asc_registerCallback("asc_onUpdateCommentPosition",Ext.bind(this.onApiUpdateCommentPosition,this)),this.api.asc_registerCallback("asc_onRemoveComment",Ext.bind(this.onApiRemoveComment,this))},onApiAddComment:function(e,t){this.isDocumentContentReady&&this.getAutoPopup()&&(this.api.asc_selectComment(e),this.api.asc_showComment(e,!0))},onApiShowComment:function(e,t,n,r,i){e=e[e.length-1];if(!Ext.isEmpty(Ext.get("id-doc-comment-"+e)))return;this.setLastPosition({x:t,y:n,lx:r}),this.onApiHideComment();var s=Ext.getCmp("editor_sdk");if(s){var o=s.getEl().down(this.sdkViewName);if(o){var u=o.createChild({tag:"div",id:"id-doc-comment-"+e,cls:"comment-popover-root",style:"top: "+n+"px; left: "+t+"px;"});if(u){var a=Ext.widget("commoncommentspopover",{commentId:e,userId:this.getCurrentUserId(),editable:i!==!1,renderTo:u,maxHeight:o.getHeight()+this.getMovingTopLimit()+this.getMovingBottomLimit()});if(a){if(t+a.getWidth()>o.getWidth())if(r)u.addCls("left-sided").setLeft(r-a.getWidth()-parseInt(u.getStyle("margin-right")));else{var f=parseInt(u.getStyle("margin-left"));f&&u.setLeft(o.getWidth()-a.getWidth()-f*2)}n+a.getHeight()>o.getHeight()&&u.setTop(o.getHeight()-a.getHeight()),a.getEl().alignTo(u,"tl"),a.show(),this.visiblePopovers.add(e,a)}}}}},onApiHideComment:function(){this.visiblePopovers.length&&(this.keepIncompleteComments(),this.visiblePopovers.eachKey(function(e,t){var n=Ext.get("id-doc-comment-"+e);n&&(t.destroy(),n.remove())}),this.visiblePopovers.clear(),this.editControls=undefined)},onApiRemoveComment:function(e){this.clearIncompleteComments(e);var t=Ext.get("id-doc-comment-"+e);if(t){var n=this.visiblePopovers.get(e);n&&(n.destroy(),t.remove(),this.visiblePopovers.removeAtKey(e),!this.visiblePopovers.length&&(this.editControls=undefined))}},onApiUpdateCommentPosition:function(e,t,n,r){var i=Ext.get("id-doc-comment-"+e),s=this.getViewByCommentId(e),o=Ext.getCmp("editor_sdk"),u=this;if(o&&i&&s){var a=o.getEl().down(this.sdkViewName);if(a){var f=parseInt(i.getStyle("margin-left")),l=parseInt(i.getStyle("margin-top"));this.setLastPosition({x:t,y:n,lx:r});if(n>0&&n<a.getHeight()){if(!s.isVisible()){s.show();var c=this.getDataViewInView(s);c&&(c.doComponentLayout(),u.updateCommentsScrollView(c,!0)),this.fixViewSize(s)}}else s.hide();if(s.isVisible()){t+s.getWidth()>a.getWidth()?r?i.addCls("left-sided").setLeft(r-s.getWidth()-parseInt(i.getStyle("margin-right"))):i.setLeft(a.getWidth()-s.getWidth()-f*2):i.removeCls("left-sided").setLeft(t);var h=s.getEl().down(".popover-arrow"),p=h.up(".x-container");if(n+s.getHeight()+l-this.getMovingBottomLimit()>a.getHeight()&&n<a.getHeight()){var d=a.getHeight()-s.getHeight()-l+this.getMovingBottomLimit();n-d+h.getHeight()+5+(h.getTop()-p.getTop())<s.getHeight()&&p.setStyle("margin-top",n-d+"px"),i.setTop(a.getHeight()-s.getHeight()-l+this.getMovingBottomLimit())}else n<Math.abs(l+this.getMovingTopLimit())?i.setTop(Math.abs(l+this.getMovingTopLimit())):(/^0/.test(p.getStyle("margin-top"))||p.setStyle("margin-top",0),i.setTop(n))}var v=this.visiblePopovers.get(e);v&&v.getEl().alignTo(i,"tl-tl")}}},onDocumentContentReady:function(){this.isDocumentContentReady=!0},getViewByCommentId:function(e){return Ext.getCmp("id-popover-comments-"+e)},getViewByCmp:function(e){return e?e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("common-commentspopover"))return!0}):null},getDataViewInView:function(e){return e?e.down("dataview"):null},fixViewSize:function(e){var t=e.down("dataview"),n=e.down("container[action=add-reply-link-container]"),r=e.down("container[action=add-reply-form-container]");if(t){var i=t.getEl(),s=i.getHeight(),o=t.getPlugin("scrollpane");if(o){var u=i.down(".jspPane");u&&(s=u.getHeight())}s<e.minHeight&&(s=e.minHeight),r&&!r.isHidden()?s+=r.getHeight():n&&(s+=n.getHeight()),s>e.maxHeight&&(s=e.maxHeight),e.setHeight(s),this.onApiUpdateCommentPosition(e.getCommentId(),this.getLastPosition().x,this.getLastPosition().y,this.getLastPosition().lx)}},onAfterRenderPopover:function(e){this.fixViewSize(e)},onTransformToAdd:function(e){var t=this;this.showEditCommentControls(e.commentId);var n=e.down("#id-popover-add-reply-link-"+e.commentId),r=Ext.getCmp("controls-edit-msg-popover-"+e.commentId);n&&n.hide();if(r){var i=r.query("button"),s=r.query("textarea");s&&s[0].focus(!1,100),Ext.each(i,function(e){e.action=="edit"&&e.setText(t.textAdd),e.on("click",function(r){Ext.each(i,function(e){e.un("click")}),n&&n.show(),t.hideEditCommentControls(r),e.action!="edit"&&t.onApiHideComment()},{single:!0})})}e.doLayout(),e.doComponentLayout(),t.fixViewSize(e)},onAfterRenderAddReply:function(e){var t=this;e.getEl().on("click",function(n,r){t.showAddReplyControls(e)})},onAfterRenderComment:function(e){e.getSelectionModel().keyNav.disable()},onUpdateComment:function(e,t,n){var r=this,i=e.get("id"),s=this.getViewByCommentId(i);if(s){var o=this.getDataViewInView(s);if(o){o.doComponentLayout(),r.updateHandlers(e,"id-popover-comment-"+i,{onResolveComment:r.onResolveComment,showEditCommentControls:r.showEditCommentControls,showEditReplyControls:r.showEditReplyControls});var u=e.get("replays");u&&u.each(function(e){r.hideEditReplyControls(i,e.get("id"))}),o&&this.updateCommentsScrollView(o,!0)}this.fixViewSize(s);var a=s.getEl();if(e.get("lock")){a.addCls("lock");var f=this.getCommonStoreUsersStore(),l=r.textAnonym;if(f){var c=f.findRecord("id",e.get("lockuserid"));c&&(l=c.get("username"))}var h=a.down(".lock-author");h&&(h.dom.innerHTML=l)}else a.removeCls("lock")}},onViewReadyComments:function(e){var t=this,n=this.getViewByCmp(e),r=this.getDataViewInView(n),i=e.getStore(),s=i.findRecord("id",n.getCommentId());s&&t.updateHandlers(s,"id-popover-comment-"+n.getCommentId(),{onResolveComment:t.onResolveComment,showEditCommentControls:t.showEditCommentControls,showEditReplyControls:t.showEditReplyControls});if(r){n.editable&&this.showIncompleteCommentEditControls(n.getCommentId()),this.updateCommentsScrollView(r),this.fixViewSize(n);var o=n.getEl();if(s&&s.get("lock")){o.addCls("lock");var u=this.getCommonStoreUsersStore(),a=t.textAnonym;if(u){var f=u.findRecord("id",s.get("lockuserid"));f&&(a=f.get("username"))}var l=o.down(".lock-author");l&&(l.dom.innerHTML=a)}else o.removeCls("lock")}},updateCommentsScrollView:function(e,t){if(e){var n=e.getPlugin("scrollpane");if(n){var r=this.getViewByCmp(e);r&&r.doLayout(),n.updateScrollPane(),e.fireEvent("resize"),t&&this.scrollViewToBegin(e)}}},scrollViewToBegin:function(e){if(e){var t=e.getPlugin("scrollpane");if(t){var n=new Ext.util.DelayedTask(function(){t.jspApi.scrollToPercentY(0,!0)});n.delay(100)}}},scrollViewToNode:function(e,t){if(e&&t){var n=e.getPlugin("scrollpane");if(n){var r=new Ext.util.DelayedTask(function(){n.scrollToElement(t,!1,!0)});r.delay(100)}}},showAddReplyControls:function(e,t){var n=this.getViewByCmp(e),r=e.up("#id-popover-comments-"+n.getCommentId()),i=r.down("#id-popover-controls-reply-"+n.getCommentId()),s=r.down("#id-popover-add-reply-link-"+n.getCommentId()),o=r.down("textarea");i&&s&&(this.hideEditControls(),this.editControls={action:"add-reply",component:e},i.show(),s.hide(),o&&(t&&o.setValue(t),(new Ext.util.DelayedTask(function(){o.focus()},this)).delay(100))),this.fixViewSize(n)},hideAddReplyControls:function(e){var t=this.getViewByCmp(e),n=e.up("#id-popover-comments-"+t.getCommentId()),r=n.down("#id-popover-controls-reply-"+t.getCommentId()),i=n.down("#id-popover-add-reply-link-"+t.getCommentId());r&&i&&(i.show(),r.hide()),t.doLayout(),t.doComponentLayout(),this.fixViewSize(t),this.editControls=undefined},onResolveComment:function(e){var t=this,n=this.getViewByCommentId(e),r=Ext.getCmp("comments-popover-menu-resolve-"+e);if(n){var i=n.getEl().down(".resolve");if(i){var s=this.getCommonStoreCommentsStore();if(s){var o=s.findRecord("id",e);if(o){var u=o.get("resolved");u?(r||(r=Ext.widget("menu",{id:"comments-popover-menu-resolve-"+e,renderTo:Ext.getBody(),plain:!0,minWidth:50,bodyCls:"menu-resolve-comment",items:[{text:t.textOpenAgain,listeners:{click:function(n,r){n.ownerCt.hide(),t.resolveComment(e,!1)}}}]})),r.show(),r.showBy(i,"tr-br",[0,5])):this.resolveComment(e,!u)}}}}},showEditCommentControls:function(e,t){var n=this,r=this.getViewByCommentId(e);if(r){var i=this.getDataViewInView(r);if(i){var s=i.getEl().down("#id-popover-comment-"+e);if(s){var o=s.down(".comment-message");if(o){var u=o.down(".comment"),a=s.down(".edit-info"),f=Ext.getCmp("controls-edit-msg-popover-"+e),l=i.getStore();if(l){var c=l.findRecord("id",e);if(c){f&&f.destroy(),a&&a.hide(),u&&(u.setVisibilityMode(Ext.Element.DISPLAY),u.hide()),this.hideEditControls(),this.editControls={action:"comment",comment:e};var h=Ext.widget("commoncommentseditform",{scope:this,editId:"popover-"+e,renderTo:o,msgValue:t||c.get("comment"),onEditHandler:this.onBtnEditComment,onCancelHandler:this.onBtnCancelEditComment});i.on("resize",function(){h.doLayout()},this,{delay:100});var p=function(){n.fixViewSize(r),n.updateCommentsScrollView(i)};if(h){var d=h.down("textarea");d&&(d.on("elastic",p),(new Ext.util.DelayedTask(function(){d.focus(),d.getValue()&&d.selectText(d.getValue().length)},this)).delay(100))}p()}}}}}}},hideEditCommentControls:function(e){var t=this.getViewByCommentId(e);if(t){var n=this.getDataViewInView(t);if(n){var r=n.getEl().down("#id-popover-comment-"+e),i=r.down(".comment-message");if(i){var s=i.down(".comment"),o=r.down(".edit-info"),u=Ext.getCmp("controls-edit-msg-popover-"+e);o&&o.show(),u&&u.hide(),s&&(s.setVisibilityMode(Ext.Element.DISPLAY),s.show()),this.fixViewSize(t),this.updateCommentsScrollView(n),this.editControls=undefined}}}},showEditReplyControls:function(e,t,n){var r=this,i=this.getViewByCommentId(e);if(i){var s=this.getDataViewInView(i);if(s){var o=s.getEl().down("#reply-"+t),u=o.down(".reply-message");if(u){var a=u.down(".message"),f=o.down(".edit-info"),l=Ext.getCmp("controls-edit-msg-popover-"+t),c=Ext.getStore("Common.store.Comments");if(c){var h=c.findRecord("id",e);if(h){var p=h.replys().findRecord("id",t);if(p){l&&l.destroy(),f&&f.hide(),a&&(a.setVisibilityMode(Ext.Element.DISPLAY),a.hide()),this.hideEditControls(),this.editControls={action:"edit-reply",comment:e,reply:t};var d=Ext.widget("commoncommentseditform",{scope:this,editId:"popover-"+t,renderTo:u,msgValue:n||p.get("reply"),onEditHandler:this.onBtnEditReply,onCancelHandler:this.onBtnCancelEditReply});s.on("resize",function(){d.doLayout()},this,{delay:100});var v=function(){r.fixViewSize(i),r.updateCommentsScrollView(s);var e=Ext.get("controls-edit-msg-popover-"+t);e&&r.scrollViewToNode(s,e.dom)};if(d){var m=d.down("textarea");m&&(m.on("elastic",v),(new Ext.util.DelayedTask(function(){m.focus(),m.getValue()&&m.selectText(m.getValue().length)},this)).delay(100))}v()}}}}}}},hideEditReplyControls:function(e,t){var n=this.getViewByCommentId(e);if(n){var r=this.getDataViewInView(n);if(r){var i=r.getEl().down("#reply-"+t),s=i.down(".reply-message");if(s){var o=s.down(".message"),u=i.down(".edit-info"),a=Ext.getCmp("controls-edit-msg-popover-"+t);u&&u.show(),a&&a.hide(),o&&(o.setVisibilityMode(Ext.Element.DISPLAY),o.show()),this.fixViewSize(n),this.updateCommentsScrollView(r),this.editControls=undefined}}}},makeCommentEditable:function(e){var t=Ext.ComponentQuery.query("commoncommentspopover")[0];$("#"+t.id).find(".edit-info").show();var n=t.down("#id-popover-add-reply-link-"+e);n&&n.show(),t.editable=!0,t.doLayout(),t.doComponentLayout(),this.fixViewSize(t)},onBtnEditComment:function(e){var t=e.getEl().up(".comment-wrap");if(t){var n=t.id.match(/id-popover-comment-(.+)/)[1],r=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("controls-edit-msg-container"))return!0});if(r){var i=r.down("textarea");i&&this.editComment(n,i.getValue())}var s=Ext.getCmp("id-popover-add-reply-link-"+n);s&&s.show(),this.hideEditCommentControls(n)}},onBtnCancelEditComment:function(e){var t=e.getEl().up(".comment-wrap");t&&this.hideEditCommentControls(t.id.match(/id-popover-comment-(.+)/)[1])},onBtnEditReply:function(e){var t=e.getEl().up(".reply"),n=e.getEl().up(".comment-wrap");if(t&&n){var r=n.id.match(/id-popover-comment-(.+)/)[1],i=t.id.match(/\d+/g),s=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("controls-edit-msg-container"))return!0});if(s){var o=s.down("textarea");o&&this.editReply(r,i,o.getValue())}this.editControls=undefined}},onBtnCancelEditReply:function(e){var t=e.getEl().up(".reply"),n=e.getEl().up(".comment-wrap");t&&n&&this.hideEditReplyControls(n.id.match(/id-popover-comment-(.+)/)[1],t.id.match(/\d+/g))},onBtnAddReply:function(e){var t=this.getViewByCmp(e),n=this.getDataViewInView(t),r=e.up("#id-popover-comments-"+t.getCommentId());if(r){var i=r.down("textarea");if(i){if(i.getValue().length<1)return;var s=Ext.String.trim(i.getValue());this.addReply(t.getCommentId(),s)&&(i.setValue(""),this.hideAddReplyControls(e),this.updateCommentsScrollView(n,!0))}}},onBtnCloseReply:function(e){var t=this.getViewByCmp(e),n=e.up("#id-popover-comments-"+t.getCommentId());if(n){var r=n.down("textarea");r&&(r.setValue(""),this.hideAddReplyControls(e))}},onElasticAddReply:function(e,t,n){var r=e.ownerCt;if(r){var i=r.down("container");if(i&&i.rendered){var s=parseInt(r.getEl().getStyle("padding-top")),o=parseInt(r.getEl().getStyle("padding-bottom"));r.setHeight(n+i.getHeight()+s+o+5);var u=r.ownerCt;u&&this.fixViewSize(u)}}},onKeyDownTextArea:function(e,t){if(t.getKey()==t.ENTER&&(t.ctrlKey||t.metaKey)&&!t.shiftKey){var n=this.getViewByCmp(e),r=this.getDataViewInView(n),i=e.up("#id-popover-comments-"+n.getCommentId());if(i){if(e.getValue().length<1)return;var s=Ext.String.trim(e.getValue());this.addReply(n.getCommentId(),s)&&(e.setValue(""),this.hideAddReplyControls(e),this.updateCommentsScrollView(r,!0))}}},keepIncompleteComments:function(){var e,t,n=this,r;n.visiblePopovers.eachKey(function(i,s){s.editable&&(n.clearIncompleteComments(i),e=[],n.editControls&&(n.editControls.action=="comment"?(r="self",t=$("#controls-edit-msg-popover-"+i+" textarea").filter(":visible")):n.editControls.action=="add-reply"?(r="reply",t=$("#id-popover-controls-reply-"+i+" textarea").filter(":visible")):(r=n.editControls.reply,t=$("#controls-edit-msg-popover-"+r+" textarea").filter(":visible")),t&&t[0]&&t[0].value.length&&(e.push(r),window.sessionStorage.setItem(r,t[0].value))),e.length&&window.sessionStorage.setItem(i,e))})},clearIncompleteComments:function(e){var t=window.sessionStorage.getItem(e);t&&(t=t.match(/[a-zA-Z0-9-_]+/),t.forEach(function(e){window.sessionStorage.removeItem(e)}),window.sessionStorage.removeItem(e))},showIncompleteCommentEditControls:function(e){var t=this,n=window.sessionStorage.getItem(e),r;n&&(n=n.match(/[a-zA-Z0-9-_]+/ig),n.forEach(function(n){r=window.sessionStorage.getItem(n);if(n=="self")t.showEditCommentControls(e,r);else if(n=="reply"){var i=Ext.getCmp("id-popover-add-reply-link-"+e);t.showAddReplyControls(i,r)}else t.showEditReplyControls(e,n,r)}))},hideEditControls:function(){if(this.editControls)switch(this.editControls.action){case"comment":this.hideEditCommentControls(this.editControls.comment);break;case"add-reply":this.hideAddReplyControls(this.editControls.component);break;case"edit-reply":this.hideEditReplyControls(this.editControls.comment,this.editControls.reply)}},textAnonym:"Guest",textOpenAgain:"Open Again",textAdd:"Add"}),Ext.define("Common.view.ComboFonts",{extend:"Ext.form.field.ComboBox",alias:"widget.commoncombofonts",queryMode:"local",matchFieldWidth:!1,displayField:"name",showlastused:!1,constructor:function(e){var t=this,n=302,r=FONT_THUMBNAIL_HEIGHT;this.addEvents("createpicker");var i=document.createElement("canvas");i.height=r,i.width=n;var s=i.getContext("2d"),o=Ext.create("Ext.XTemplate",'<tpl for=".">','<a class="font-item" style="display: block;">','<img id="{[Ext.id()]}" src="{[this.getImageUri(values)]}" width="{[this.getImageWidth()]}" height="{[this.getImageHeight()]}" style="vertical-align: middle;margin: 0 0 0 -10px;">',"</a>","</tpl>",{getImageUri:function(e){return e.cloneid?t.picker.listEl.down("#"+e.cloneid).dom.src:(s.clearRect(0,0,n,r),s.drawImage(t.spriteThumbs,0,-FONT_THUMBNAIL_HEIGHT*e.imgidx),i.toDataURL())},getImageWidth:function(){return n},getImageHeight:function(){return r}});return Ext.apply(e,{listConfig:{id:"combo-fonts-list",emptyText:"no fonts found",mode:"local",width:326,maxHeight:468,height:468,minHeight:150,itemTpl:o,blockRefresh:!0,listeners:{viewready:function(e){t.spriteThumbs=undefined}}}}),this.initConfig(e),this.callParent(arguments),this},initComponent:function(){this.addListener("beforequery",this._beforeQuery,this),this.callParent(arguments)},onRender:function(e){this.callParent(arguments),this.el.set({"data-qtip":this.tooltip}),this.validate()},createPicker:function(){return this.callParent(arguments),this.showlastused&&this.fireEvent("createpicker",this,this.picker),this.picker},fillFonts:function(e,t){this._loadSprite(),this.getStore().loadData(e);if(t&&this.getStore().getCount()){var n=this.getStore().findRecord("name","Arial");n?this.select(n):this.select(this.getStore().getAt(0))}},_loadSprite:function(){var e=this;e.spriteThumbs=new Image,e.spriteThumbs.src=window.g_standart_fonts_thumbnail},_beforeQuery:function(e){e.forceAll=!0,e.cancel=!0;if(e.combo){e.combo.expand();var t=e.combo.getPicker(),n=e.combo.store.find("name",e.query);if(n<0)$("#"+t.id+" ."+t.overItemCls).removeClass(t.overItemCls);else{var r=t.getNode(e.combo.store.getAt(n));if(r){t.highlightItem(r);var i=t.listEl.getHeight()/2-30,s=t.listEl.getTop(),o=Ext.get(r).getY()-s-i;if(Math.abs(o)>i){var u=$("#"+t.listEl.id).data("jsp");u&&u.scrollByY(o,!0)}}}}}}),Ext.define("Common.model.Font",{extend:"Ext.data.Model",fields:["id","name","cloneid",{type:"int",name:"imgidx"},{type:"int",name:"type"}]}),Ext.define("Common.store.Fonts",{extend:"Ext.data.Store",model:"Common.model.Font"});var FONT_TYPE_USERUSED=4;Ext.define("Common.controller.Fonts",{extend:"Ext.app.Controller",views:["ComboFonts"],refs:[{ref:"combo",selector:"commoncombofonts"}],stores:["Common.store.Fonts"],init:function(){this.control({commoncombofonts:{expand:function(e){var t=this.getCombo(),n=t.getPlugin("scrollpane");if(n)var r=new Ext.util.DelayedTask(function(){var e=t.picker.getNode(t.lastSelection[0]);e&&n.scrollToElement(e,!1,!1)});r.delay(10)},select:this._selectitem}})},setApi:function(e){this.api=e,this.api.asc_registerCallback("asc_onInitEditorFonts",Ext.bind(this._onloadfonts,this)),this.api.asc_registerCallback("asc_onFontFamily",Ext.bind(this._onfontchange,this))},_isfontsaved:function(e,t){var n=t.get("type")==FONT_TYPE_USERUSED,r=-1,i=e.getCount(),s,o=t.get("name");while(!n&&++r<i){s=e.getAt(r);if(s.get("type")!=FONT_TYPE_USERUSED)break;n=s.get("name")==o}return n},_selectitem:function(e,t,n){if(e.showlastused&&!this._isfontsaved(e.getStore(),t[0])){var r=e.picker.getNode(t[0]),i=t[0].data,s={id:i.id,name:i.name,imgidx:i.imgidx,cloneid:r.querySelector("img").id,type:FONT_TYPE_USERUSED};e.getStore().insert(0,[s]);var o=e.picker.getEl().down(".used-fonts-separator");o||(o=document.createElement("div"),o.setAttribute("class","x-menu-item-separator used-fonts-separator"),o.setAttribute("style","padding:0 10px;margin-left: 10px;"),r=e.picker.getNode(e.getStore().getAt(1)),r.parentNode.insertBefore(o,r)),s=e.getStore().getAt(5);if(s.data.type==FONT_TYPE_USERUSED)e.getStore().remove(s);else{var u=e.getPlugin("scrollpane");u&&u.updateScrollPane()}}},_onfontchange:function(e){var t=this.getCombo(),n=e.get_Name(),r=t.store.findRecord("name",n,0,!1,!1,!0);t.clearValue(),r?t.select(r):t.setRawValue(n)},_onloadfonts:function(e,t){var n=[];Ext.each(e,function(e){n.push({id:e.asc_getFontId(),name:e.asc_getFontName(),imgidx:e.asc_getFontThumbnail(),type:e.asc_getFontType()})});var r=this.getCombo();r?r.fillFonts(n,t):this.fontscash=n,window.required_downloads--},loadFonts:function(e){if(this.api){var t=this.api.get_PropertyEditorFonts();t&&this._onloadfonts(t,e)}},fillFonts:function(e){var t=this.getCombo();t&&t.rendered&&this.fontscash&&(t.fillFonts(this.fontscash,e),delete this.fontscash)}}),Ext.define("PE.model.ModelHelpMenu",{extend:"Ext.data.Model",fields:[{type:"string",name:"name"},{type:"string",name:"src"},{type:"string",name:"headername"}]}),Ext.define("PE.view.DocumentHelp",{extend:"Ext.container.Container",alias:"widget.pedocumenthelp",cls:"pe-documenthelp-body",autoScroll:!0,requires:["Ext.container.Container","Ext.XTemplate","Ext.view.View","Ext.data.Model","Ext.data.Store","Common.plugin.DataViewScrollPane"],constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){var e=this;this.urlPref="resources/help/en/";var t=[{src:"UsageInstructions/SetPageParameters.htm",name:"Set page parameters",headername:"Usage Instructions"},{src:"UsageInstructions/CopyPasteUndoRedo.htm",name:"Copy/paste text passages, undo/redo your actions"},{src:"UsageInstructions/AlignText.htm",name:"Align your text in a line or paragraph"},{src:"UsageInstructions/LineSpacing.htm",name:"Set paragraph line spacing"},{src:"UsageInstructions/CopyClearFormatting.htm",name:"Copy/clear text formatting"},{src:"UsageInstructions/CreateLists.htm",name:"Create lists"},{src:"UsageInstructions/InsertImages.htm",name:"Insert images"},{src:"UsageInstructions/ViewDocInfo.htm",name:"View document information"},{src:"UsageInstructions/SavePrintDownload.htm",name:"Save/print/download your document"},{src:"UsageInstructions/OpenCreateNew.htm",name:"Create a new document or open an existing one"},{src:"HelpfulHints/About.htm",name:"About ONLYOFFICE Document Editor",headername:"Helpful Hints"},{src:"HelpfulHints/SupportedFormats.htm",name:"Supported Formats of Electronic Documents"},{src:"HelpfulHints/Navigation.htm",name:"Navigation through Your Document"},{src:"HelpfulHints/Search.htm",name:"Search Function"},{src:"HelpfulHints/KeyboardShortcuts.htm",name:"Keyboard Shortcuts"}];this.menuStore=Ext.create("Ext.data.Store",{model:"PE.model.ModelHelpMenu",proxy:{type:"ajax",url:"help/Contents.json",noCache:!1},listeners:{load:function(n,r,i){i||(e.urlPref.indexOf("resources/help/en/")<0?(e.urlPref="resources/help/en/",n.getProxy().url="resources/help/en/Contents.json",n.load()):(e.urlPref="resources/help/en/",n.loadData(t)))}}});var n=new Ext.XTemplate('<tpl for=".">','<tpl if="headername">','<div class="header-wrap">','<span class="header">{headername}</span>',"</div>","</tpl>",'<div class="thumb-wrap">','<span class="caption">{name}</span>',"</div>","</tpl>",'<div class="x-clear"></div>');this.cntMenu=Ext.create("Ext.container.Container",{layout:"fit",cls:"help-menu-container",width:200,items:[this.menuView=Ext.create("Ext.view.View",{store:this.menuStore,tpl:n,singleSelect:!0,trackOver:!0,width:"100%",overItemCls:"x-item-over",itemSelector:"div.thumb-wrap",cls:"help-menu-view",listeners:{afterrender:function(t){t.getSelectionModel().deselectOnContainerClick=!1,t.getStore().getCount()&&(t.select(0),e.iFrame.src=e.urlPref+t.getStore().getAt(0).data.src)},selectionchange:function(t,n){var r=t.getLastSelected();r&&(e.iFrame.src=e.urlPref+r.data.src)}},plugins:[{ptype:"dataviewscrollpane",areaSelector:".help-menu-view",pluginId:"docHelpPluginId",settings:{enableKeyboardNavigation:!0,keyboardSpeed:.001}}]})]}),this.iFrame=document.createElement("iframe"),this.iFrame.src="",this.iFrame.align="top",this.iFrame.frameBorder="0",this.iFrame.width="100%",this.iFrame.height="100%",this.iFrame.onload=Ext.bind(function(){var e=arguments[0].currentTarget.contentDocument.URL;Ext.each(this.menuStore.data.items,function(t,n){var r=e.indexOf(t.data.src);if(r>0){this.menuView.select(n);var i=this.menuView.getNode(n),s=this.menuView.getPlugin("docHelpPluginId");return s&&s.scrollToElement(i),!1}},this)},this),this.items=[{xtype:"container",layout:{type:"hbox",align:"stretch"},height:"100%",items:[this.cntMenu,{xtype:"tbspacer",width:2,style:"border-left: 1px solid #C7C7C7"},{xtype:"container",flex:1,layout:"fit",listeners:{afterrender:function(t){t.getEl().appendChild(e.iFrame)}}}]}],this.callParent(arguments)},setApi:function(e){e&&(this.api=e)},setLangConfig:function(e){e&&(e=e.split("-")[0],this.menuStore.getProxy().url="resources/help/"+e+"/Contents.json",this.menuStore.load(),this.urlPref="resources/help/"+e+"/")}}),Ext.define("PE.view.DocumentInfo",{extend:"Ext.container.Container",alias:"widget.pedocumentinfo",cls:"pe-documentinfo-body",autoScroll:!0,requires:["Ext.button.Button","Ext.container.Container","Common.plugin.ScrollPane","Ext.form.Label","Ext.XTemplate","Ext.Date"],uses:["Common.view.DocumentAccessDialog"],listeners:{afterrender:function(e,t){e.updateInfo(e.doc)}},constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){this.infoObj={PageCount:0,WordsCount:0,ParagraphCount:0,SymbolsCount:0,SymbolsWSCount:0},this.inProgress=!1,this.lblTitle=Ext.create("Ext.form.Label",{text:"-",height:14}),this.lblPlacement=Ext.create("Ext.form.Label",{text:"-",width:150,height:14,style:"text-align:left",hideId:"element-to-hide"}),this.lblDate=Ext.create("Ext.form.Label",{text:"-",width:150,height:14,style:"text-align:left",hideId:"element-to-hide"});var e=Ext.create("Ext.XTemplate",'<span class="userLink">{text:htmlEncode}</span>');this.cntAuthor=Ext.create("Ext.container.Container",{tpl:e,data:{text:"-"},hideId:"element-to-hide"});var t=Ext.create("Ext.XTemplate","<table>",'<tpl for=".">',"<tr>",'<td style="padding: 0 20px 5px 0;"><span class="userLink">{user:htmlEncode}</span></td>','<td style="padding: 0 20px 5px 0;">{permissions:htmlEncode}</td>',"</tr>","</tpl>","</table>");this.cntRights=Ext.create("Ext.container.Container",{tpl:t,hideId:"element-to-hide"}),this.items=[{xtype:"tbspacer",height:30},{xtype:"container",layout:{type:"table",columns:2,tableAttrs:{style:"width: 100%;"},tdAttrs:{style:"padding: 5px 10px;vertical-align: top;"}},items:[{xtype:"label",cellCls:"doc-info-label-cell",text:this.txtTitle,style:"display: block;text-align: right;",width:"100%"},this.lblTitle,{xtype:"label",cellCls:"doc-info-label-cell",text:this.txtAuthor,style:"display: block;text-align: right;",width:"100%"},this.cntAuthor,{xtype:"label",cellCls:"doc-info-label-cell",text:this.txtPlacement,style:"display: block;text-align: right;",width:"100%"},this.lblPlacement,{xtype:"label",cellCls:"doc-info-label-cell",text:this.txtDate,style:"display: block;text-align: right;",width:"100%"},this.lblDate,{xtype:"tbspacer",colspan:2,height:5},{xtype:"label",cellCls:"doc-info-label-cell",text:this.txtRights,style:"display: block;text-align: right;",width:"100%"},this.cntRights,this.tbsRights=Ext.create("Ext.toolbar.Spacer",{colspan:2,height:5,hideId:"element-to-hide"}),{xtype:"box"},this.btnEditRights=Ext.widget("button",{id:"doc-info-set-rights",cls:"asc-blue-button",text:this.txtBtnAccessRights,hideId:"element-to-hide",listeners:{click:Ext.bind(this._changeAccessRights,this)}})]}],Ext.apply(this,{plugins:[{ptype:"scrollpane",areaSelector:".x-container",pluginId:"docInfoPluginId",settings:{enableKeyboardNavigation:!0}}]}),this.callParent(arguments)},updateInfo:function(e){this.doc=e;if(!this.rendered)return;e=e||{},this.lblTitle.setText(e.title?e.title:"-"),e.info?(e.info.author&&this.cntAuthor.update({text:e.info.author}),this._ShowHideInfoItem(this.cntAuthor,e.info.author!==undefined&&e.info.author!==null),e.info.created&&this.lblDate.setText(e.info.created),this._ShowHideInfoItem(this.lblDate,e.info.created!==undefined&&e.info.created!==null),e.info.folder&&this.lblPlacement.setText(e.info.folder),this._ShowHideInfoItem(this.lblPlacement,e.info.folder!==undefined&&e.info.folder!==null),e.info.sharingSettings&&this.cntRights.update(e.info.sharingSettings),this._ShowHideInfoItem(this.cntRights,e.info.sharingSettings!==undefined&&e.info.sharingSettings!==null&&this._readonlyRights!==!0),this._ShowHideInfoItem(this.tbsRights,e.info.sharingSettings!==undefined&&e.info.sharingSettings!==null&&this._readonlyRights!==!0),this._ShowHideInfoItem(this.btnEditRights,!!this.sharingSettingsUrl&&this.sharingSettingsUrl.length&&this._readonlyRights!==!0)):this._ShowHideDocInfo(!1)},_ShowHideInfoItem:function(e,t){var n=e.getEl().up("tr");n&&n.setDisplayed(t)},_ShowHideDocInfo:function(e){var t=Ext.ComponentQuery.query('[hideId="element-to-hide"]',this);for(var n=0;n<t.length;n++)this._ShowHideInfoItem(t[n],e)},setApi:function(e){},loadConfig:function(e){return this.sharingSettingsUrl=e.config.sharingSettingsUrl,this},_changeAccessRights:function(e,t,n){var r=Ext.widget("commondocumentaccessdialog",{settingsurl:this.sharingSettingsUrl}),i=this;r.on("accessrights",function(e,t){i.doc.info.sharingSettings=t,i.cntRights.update(t)}),r.show()},onLostEditRights:function(){this._readonlyRights=!0;if(!this.rendered)return;this._ShowHideInfoItem(this.cntRights,!1),this._ShowHideInfoItem(this.tbsRights,!1),this._ShowHideInfoItem(this.btnEditRights,!1)},txtTitle:"Document Title",txtAuthor:"Author",txtPlacement:"Placement",txtDate:"Creation Date",txtRights:"Persons who have rights",txtBtnAccessRights:"Change access rights"}),Ext.define("PE.view.DocumentSettings",{extend:"Ext.container.Container",alias:"widget.pedocumentsettings",cls:"pe-documentsettings-body",requires:["Ext.button.Button","Ext.container.Container","Ext.form.Label","Ext.form.field.Checkbox"],listeners:{show:function(e,t){e.updateSettings()}},constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){this._changedProps={zoomIdx:0,unitIdx:0,saveVal:600,showchangesIdx:1},this._oldUnit=undefined,this.chInputMode=Ext.create("Ext.form.field.Checkbox",{id:"docsettings-input-mode",boxLabel:this.strInputMode,width:500}),this.chLiveComment=Ext.create("Ext.form.field.Checkbox",{id:"docsettings-live-comment",checked:!0,boxLabel:this.strLiveComment,width:500}),this._arrZoom=[[-1,this.txtFitSlide],[50,"50%"],[60,"60%"],[70,"70%"],[80,"80%"],[90,"90%"],[100,"100%"],[110,"110%"],[120,"120%"],[150,"150%"],[175,"175%"],[200,"200%"]],this.cmbZoom=Ext.create("Ext.form.field.ComboBox",{id:"docsettings-combo-zoom",width:150,editable:!1,store:this._arrZoom,mode:"local",triggerAction:"all",value:this._arrZoom[0][1],listeners:{select:Ext.bind(function(e,t,n){this._changedProps.zoomIdx=t[0].index,e.blur()},this)}}),this._arrUnit=[[Common.MetricSettings.c_MetricUnits.cm,this.txtCm],[Common.MetricSettings.c_MetricUnits.pt,this.txtPt]],this.cmbUnit=Ext.create("Ext.form.field.ComboBox",{id:"docsettings-combo-unit",width:150,editable:!1,store:this._arrUnit,mode:"local",triggerAction:"all",value:this._arrUnit[0][1],listeners:{select:Ext.bind(function(e,t,n){this._changedProps.unitIdx=t[0].index,e.blur()},this)}}),this._arrAutoSave=[[0,this.textDisabled],[60,this.textMinute],[300,this.text5Minutes],[600,this.text10Minutes],[1800,this.text30Minutes],[3600,this.text60Minutes]],this.cmbAutoSave=Ext.create("Ext.form.field.ComboBox",{id:"docsettings-combo-save",width:150,editable:!1,store:this._arrAutoSave,mode:"local",triggerAction:"all",value:this._arrAutoSave[3][1],listeners:{select:Ext.bind(function(e,t,n){this._changedProps.saveVal=t[0].data.field1,e.blur()},this)}}),this._arrShowChanges=[this.txtAll,this.txtLast],this.cmbShowChanges=Ext.create("Ext.form.field.ComboBox",{id:"docsettings-show-changes",width:150,editable:!1,store:this._arrShowChanges,mode:"local",triggerAction:"all",value:this._arrShowChanges[1],listeners:{select:Ext.bind(function(e,t,n){this._changedProps.showchangesIdx=t[0].index,e.blur()},this)}}),this.btnOk=Ext.widget("button",{cls:"asc-blue-button",width:90,height:22,text:this.okButtonText,listeners:{click:function(e){this.applySettings()},scope:this}}),this.items=[{xtype:"container",layout:{type:"table",columns:2,tableAttrs:{style:"width: 100%;"},tdAttrs:{style:"padding: 5px 10px;"}},items:[{xtype:"label",cellCls:"doc-info-label-cell",text:this.txtInput,style:"display: block;text-align: right; margin-bottom: 1px;",width:"100%",hideId:"element-edit-mode"},this.chInputMode,{xtype:"tbspacer",hideId:"element-edit-mode"},{xtype:"tbspacer"},{xtype:"label",cellCls:"doc-info-label-cell",text:this.strZoom,style:"display: block;text-align: right; margin-bottom: 5px;",width:"100%"},this.cmbZoom,{xtype:"tbspacer",hideId:"element-edit-mode"},{xtype:"tbspacer"},{xtype:"label",cellCls:"doc-info-label-cell",text:this.strShowChanges,style:"display: block;text-align: right; margin-bottom: 5px;",width:"100%",hideId:"element-coauthoring"},this.cmbShowChanges,{xtype:"tbspacer",hideId:"element-coauthoring"},{xtype:"tbspacer"},{xtype:"label",cellCls:"doc-info-label-cell",text:this.textAutoSave,style:"display: block;text-align: right; margin-bottom: 5px;",width:"100%",hideId:"element-autosave"},this.cmbAutoSave,{xtype:"tbspacer",hideId:"element-autosave"},{xtype:"tbspacer"},{xtype:"label",cellCls:"doc-info-label-cell",text:this.strUnit,style:"display: block;text-align: right; margin-bottom: 5px;",width:"100%",hideId:"element-edit-mode"},this.cmbUnit,{xtype:"tbspacer",height:10},{xtype:"tbspacer",height:10},{xtype:"tbspacer"},this.btnOk]}],this.addEvents("savedocsettings"),this.addEvents("changemeasureunit"),this.callParent(arguments)},setApi:function(e){return this.api=e,this},applySettings:function(){this.api.SetTextBoxInputMode(this.chInputMode.getValue()),this.mode.canAutosave>-1&&this.api.asc_setAutoSaveGap(this._changedProps.saveVal),this.api.SetCollaborativeMarksShowType(this._changedProps.showchangesIdx==0?c_oAscCollaborativeMarksShowType.All:c_oAscCollaborativeMarksShowType.LastChanges),window.localStorage.setItem("pe-settings-inputmode",this.chInputMode.getValue()?1:0),window.localStorage.setItem("pe-settings-zoom",this._arrZoom[this._changedProps.zoomIdx][0]),window.localStorage.setItem("pe-settings-showchanges",this._changedProps.showchangesIdx),window.localStorage.setItem("pe-settings-livecomment",this.chLiveComment.getValue()?1:0),window.localStorage.setItem("pe-settings-unit",this._arrUnit[this._changedProps.unitIdx][0]),window.localStorage.setItem("pe-settings-autosave",this._changedProps.saveVal),Common.component.Analytics.trackEvent("File Menu","SaveSettings"),this.fireEvent("savedocsettings",this),this._oldUnit!==this._arrUnit[this._changedProps.unitIdx][0]&&this.fireEvent("changemeasureunit",this)},updateSettings:function(){var e=window.localStorage.getItem("pe-settings-inputmode");this.chInputMode.setValue(e!==null&&parseInt(e)==1),e=window.localStorage.getItem("pe-settings-livecomment"),this.chLiveComment.setValue(e===null||parseInt(e)!=0),e=window.localStorage.getItem("pe-settings-zoom"),this._changedProps.zoomIdx=0;if(e!==null)for(var t=0;t<this._arrZoom.length;t++)if(this._arrZoom[t][0]==parseInt(e)){this._changedProps.zoomIdx=t;break}this.cmbZoom.setValue(this._arrZoom[this._changedProps.zoomIdx][1]),e=window.localStorage.getItem("pe-settings-showchanges"),this._changedProps.showchangesIdx=e!==null&&parseInt(e)==0?0:1,this.cmbShowChanges.setValue(this._arrShowChanges[this._changedProps.showchangesIdx]),e=window.localStorage.getItem("pe-settings-unit"),this._changedProps.unitIdx=0;if(e!==null)for(var t=0;t<this._arrUnit.length;t++)if(this._arrUnit[t][0]==parseInt(e)){this._changedProps.unitIdx=t;break}this.cmbUnit.setValue(this._arrUnit[this._changedProps.unitIdx][1]),this._oldUnit=this._arrUnit[this._changedProps.unitIdx][0],e=window.localStorage.getItem("pe-settings-autosave"),e=e!==null?parseInt(e):600,this._changedProps.saveVal=600;var n=3;for(var t=0;t<this._arrAutoSave.length;t++)if(this._arrAutoSave[t][0]==e){this._changedProps.saveVal=e,n=t;break}this.cmbAutoSave.setValue(this._arrAutoSave[n][1]),this._ShowHideDocSettings("element-edit-mode",this.mode.isEdit),this._ShowHideDocSettings("element-coauthoring",this.mode.canCoAuthoring&&this.mode.isEdit),this._ShowHideDocSettings("element-autosave",this.mode.isEdit&&this.mode.canAutosave>-1)},_ShowHideSettingsItem:function(e,t){var n=e.getEl().up("tr");n&&n.setDisplayed(t)},_ShowHideDocSettings:function(e,t){var n=Ext.ComponentQuery.query('[hideId="'+e+'"]',this);for(var r=0;r<n.length;r++)this._ShowHideSettingsItem(n[r],t)},setMode:function(e){this.mode=e;if(this.mode.canAutosave>-1){var t=0;for(t=1;t<this._arrAutoSave.length;t++)if(this.mode.canAutosave<this._arrAutoSave[t][0])break}var n=[];n=this._arrAutoSave.slice(t,this._arrAutoSave.length),n.unshift(this._arrAutoSave[0]),n.length>0&&this.cmbAutoSave.getStore().loadData(n)},strInputMode:"Turn on hieroglyphs",strZoom:"Default Zoom Value",okButtonText:"Apply",txtFitSlide:"Fit Slide",txtInput:"Alternate Input",strLiveComment:"Turn on option",txtLiveComment:"Live Commenting",strUnit:"Unit of Measurement",txtCm:"Centimeter",txtPt:"Point",textDisabled:"Disabled",textMinute:"Every Minute",text5Minutes:"Every 5 Minutes",text10Minutes:"Every 10 Minutes",text30Minutes:"Every 30 Minutes",text60Minutes:"Every Hour",textAutoSave:"Autosave",strShowChanges:"Realtime Collaboration Changes",txtAll:"View All",txtLast:"View Last"}),Ext.define("PE.view.File",{extend:"Ext.panel.Panel",alias:"widget.pefile",cls:"pe-file-body",layout:"card",toolbarWidth:260,activeBtn:undefined,requires:["Ext.toolbar.Toolbar","Ext.button.Button","Ext.container.Container"],uses:["PE.view.DocumentInfo","PE.view.DocumentHelp","PE.view.DocumentSettings","Common.view.About"],listeners:{afterrender:function(e,t){var n=this.ownerCt;Ext.isDefined(n)&&n.addListener("show",Ext.Function.bind(this._onShow,this))}},initComponent:function(){this.addEvents("editdocument"),this.callParent(arguments)},loadConfig:function(e){this.editorConfig=e.config},loadDocument:function(e){this.document=e.doc},_onShow:function(){if(this.activeBtn===undefined){var e=this[this.btnDomnloadAs.isVisible()?"btnDomnloadAs":"btnDocumentInfo"];this.activeBtn=e.toggle(!0)}else this.redrawButton(this.activeBtn);this.activeBtn==this.btnDocumentInfo?this.getLayout().setActiveItem(this.cardDocumentInfo):this.activeBtn==this.btnDocumentSettings&&(this.getLayout().setActiveItem(this.cardDocumentSettings),this.cardDocumentSettings.updateSettings())},buildItems:function(){var e=[{name:"PDF",imgCls:"doc-format btn-pdf",type:c_oAscFileType.PDF},{name:"PPTX",imgCls:"doc-format btn-pptx",type:c_oAscFileType.PPTX}];this.cardDownloadAs=Ext.widget("container",{cls:"pe-file-table",layout:{type:"table",columns:4}});var t=this;return Ext.each(e,function(e){this.cardDownloadAs.add({xtype:"container",items:[{xtype:"button",id:"file-format-"+e.name,cls:e.imgCls+" download-button-style",docType:e.type,width:102,height:129,margin:"65px 25px 0 25px",listeners:{click:Ext.bind(function(n){var r=t.ownerCt.getApi();r&&(r.asc_DownloadAs(n.docType),t.closeMenu()),Common.component.Analytics.trackEvent("Download As",e.name)},this)}}]})},this),this.cardDocumentInfo=Ext.widget("pedocumentinfo"),this.cardCreateNew=Ext.widget("pecreatenew"),this.cardRecentFiles=Ext.widget("perecentfiles"),this.cardHelp=Ext.widget("pedocumenthelp"),this.cardDocumentSettings=Ext.widget("pedocumentsettings"),this.cardDocumentSettings.addListener("savedocsettings",Ext.bind(this.closeMenu,this)),[this.cardDownloadAs,this.cardDocumentInfo,this.cardCreateNew,this.cardRecentFiles,this.cardHelp,this.cardDocumentSettings]},buildDockedItems:function(){return this.btnSave=Ext.create("Ext.button.Button",{id:"file-button-save",text:this.btnSaveCaption,textAlign:"left",enableToggle:!0,cls:"asc-filemenu-btn",padding:"0 27px",height:27,listeners:{click:Ext.bind(function(e){e.pressed&&(this.api=this.ownerCt.getApi(),this.api&&(this.redrawButton(e),this.api.asc_Save(),this.closeMenu()),Common.component.Analytics.trackEvent("Save"),Common.component.Analytics.trackEvent("File Menu","Save"))},this)}}),this.btnPrint=this.btnSave.cloneConfig({id:"file-button-print",text:this.btnPrintCaption,listeners:{click:Ext.bind(function(e){e.pressed&&(this.api=this.ownerCt.getApi(),this.api&&(this.api.asc_Print(),this.closeMenu()),Common.component.Analytics.trackEvent("Print"),Common.component.Analytics.trackEvent("File Menu","Print"))},this)}}),this.btnToEdit=this.btnSave.cloneConfig({id:"file-button-edit",text:this.btnToEditCaption,listeners:{click:Ext.bind(function(e){this.redrawButton(e),e.pressed&&(this.closeMenu(),this.fireEvent("editdocument"),Common.component.Analytics.trackEvent("Edit"),Common.component.Analytics.trackEvent("File Menu","Edit"))},this)}}),this.btnDomnloadAs=Ext.create("Ext.button.Button",Ext.applyIf(this.getFileMenuButton(this.btnDownloadCaption,this.cardDownloadAs),{id:"file-button-download"})),this.btnDocumentInfo=Ext.create("Ext.button.Button",Ext.applyIf(this.getFileMenuButton(this.btnInfoCaption,this.cardDocumentInfo),{id:"file-button-info"})),this.btnDocumentSettings=Ext.create("Ext.button.Button",Ext.applyIf(this.getFileMenuButton(this.btnSettingsCaption,this.cardDocumentSettings),{id:"file-button-settings"})),this.btnBack=this.btnSave.cloneConfig({id:"file-button-back",text:this.btnBackCaption,listeners:{click:Ext.bind(function(e){this.redrawButton(e),e.pressed&&(Common.Gateway.goBack(),this.closeMenu())},this)}}),this.btnHelp=Ext.create("Ext.button.Button",this.getFileMenuButton(this.btnHelpCaption,this.cardHelp)),this.btnReturn=Ext.create("Ext.button.Button",{id:"file-button-return",text:this.btnReturnCaption,textAlign:"left",enableToggle:!0,cls:"asc-filemenu-btn",padding:"0 27px",height:27,listeners:{click:Ext.bind(function(e){e.pressed&&(this.closeMenu(),Common.component.Analytics.trackEvent("File Menu","Return"))},this)}}),this.btnCreateNew=Ext.create("Ext.button.Button",{id:"file-button-createnew",text:this.btnCreateNewCaption,textAlign:"left",enableToggle:!0,cls:"asc-filemenu-btn",padding:"0 27px",height:27}),this.btnOpenRecent=Ext.create("Ext.button.Button",Ext.applyIf(this.getFileMenuButton(this.btnRecentFilesCaption,this.cardRecentFiles),{id:"file-button-recentfiles",label:"Recent"})),this.tbFileMenu=Ext.create("Ext.toolbar.Toolbar",{dock:"left",layout:{type:"vbox",align:"stretch"},cls:"pe-file-toolbar",vertical:!0,width:this.toolbarWidth,defaults:{height:22,width:"100%"},items:[{xtype:"container",height:15},this.btnReturn,this.getSeparator(),this.btnSave,this.btnToEdit,this.btnDomnloadAs,this.btnPrint,this.getSeparator(),this.btnOpenRecent,this.btnCreateNew,this.getSeparator(),this.btnDocumentInfo,this.getSeparator(),this.btnDocumentSettings,this.getSeparator(),this.btnHelp,this.getSeparator(),this.btnBack]}),this.tbFileMenu},setApi:function(e){this.api=e},getSeparator:function(){return{xtype:"container",html:'<hr class="pe-file-separator" />'}},getFileMenuButton:function(e,t){return{text:e,textAlign:"left",enableToggle:!0,cls:"asc-filemenu-btn",padding:"0 27px",height:27,listeners:{click:Ext.Function.bind(function(e){e.pressed&&(this.activeBtn!=e&&(this.getLayout().setActiveItem(t),this.activeBtn=e),Common.component.Analytics.trackEvent("File Menu",e.label))},this),toggle:Ext.Function.bind(function(e){this.redrawButton(e)},this)}}},redrawButton:function(e){var t=this.tbFileMenu;for(var n=0;n<t.items.length;n++){var r=t.items.items[n];r.componentCls==="x-btn"&&r.id!=e.id&&r.pressed&&r.toggle(!1,!0)}e.toggle(!0,!0)},closeMenu:function(){this.ownerCt.closeMenu()},applyMode:function(){this.cardDocumentInfo.updateInfo(this.document),this.btnBack.setVisible(this.mode.canBack),this.tbFileMenu.items.items[16].setVisible(this.mode.canBack),this.btnOpenRecent.setVisible(this.mode.canOpenRecent),this.btnCreateNew.setVisible(this.mode.canCreateNew),this.tbFileMenu.items.items[10].setVisible(this.mode.canCreateNew),this.btnDomnloadAs.setVisible(this.mode.canDownload),this.hkSaveAs[this.mode.canDownload?"enable":"disable"](),this.btnSave.setVisible(this.mode.isEdit),this.btnToEdit.setVisible(this.mode.canEdit&&this.mode.isEdit===!1),this.cardDocumentSettings.setMode(this.mode)},setMode:function(e,t){e.isDisconnected?(this.mode.canEdit=this.mode.isEdit=!1,this.mode.canOpenRecent=this.mode.canCreateNew=!1):this.mode=e,t||this.applyMode()},createDelayedElements:function(){this.hkSaveAs=new Ext.util.KeyMap(document,{key:"s",ctrl:!0,shift:!0,defaultEventAction:"stopEvent",scope:this,fn:function(){this.ownerCt&&this.ownerCt.isVisible()&&(this.btnDomnloadAs.toggle(!0),this.btnDomnloadAs.fireEvent("click",this.btnDomnloadAs))}}),this.hkHelp=new Ext.util.KeyMap(document,{key:Ext.EventObject.F1,ctrl:!1,shift:!1,defaultEventAction:"stopEvent",scope:this,fn:function(){this.ownerCt&&this.ownerCt.isVisible()&&(this.btnHelp.toggle(!0),this.btnHelp.fireEvent("click",this.btnHelp))}}),this.add(this.buildItems.call(this)),this.addDocked(this.buildDockedItems()),this.setConfig(),this.applyMode()},setConfig:function(){var e=this;this.editorConfig.templates&&this.editorConfig.templates.length>0?(this.btnCreateNew.setText(this.btnCreateNew.getText()+"..."),this.btnCreateNew.enableToggle=!0,this.btnCreateNew.on("click",function(t){t.pressed&&(e.activeBtn!=t&&(e.getLayout().setActiveItem(e.cardCreateNew),e.activeBtn=t),Common.component.Analytics.trackEvent("File Menu","Create"))}),this.btnCreateNew.on("toggle",function(t){e.redrawButton(t)})):this.btnCreateNew.on("click",function(t){if(Ext.isEmpty(e.editorConfig.createUrl))Ext.MessageBox.show({title:e.textError,msg:e.textCanNotCreateNewDoc,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR,width:300});else if(t.pressed){var n=window.open(Ext.String.format("{0}?title={1}&action=create&doctype=presentation",e.editorConfig.createUrl,e.newDocumentTitle));n&&n.focus(),Common.component.Analytics.trackEvent("Create New","Blank")}this.closeMenu()}),this.cardHelp.setLangConfig(this.editorConfig.lang)},btnSaveCaption:"Save",btnDownloadCaption:"Download as...",btnInfoCaption:"Document Info...",btnCreateNewCaption:"Create New",btnRecentFilesCaption:"Open Recent...",btnPrintCaption:"Print",btnHelpCaption:"Help...",btnReturnCaption:"Back to Document",btnToEditCaption:"Edit Document",btnBackCaption:"Go to Documents",newDocumentTitle:"Unnamed presentation",textError:"Error",textCanNotCreateNewDoc:"Can not create a new presentation. Address to create a document is not configured.",btnSettingsCaption:"Advanced Settings...",btnAboutCaption:"About"}),Ext.define("PE.view.CreateFile",{extend:"Ext.panel.Panel",alias:"widget.pecreatenew",cls:"pe-file-createnew",layout:{type:"vbox",align:"stretch"},requires:["Ext.container.Container","Ext.data.Model","Ext.data.Store","Ext.view.View","Ext.XTemplate","Common.plugin.DataViewScrollPane"],constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){this.callParent(arguments);var e=this;e.add({xtype:"container",html:"<h3>"+e.fromBlankText+"</h3>"+"<hr noshade>"+'<div class="blank-document">'+'<div id="id-create-blank-document" class="btn-blank-document"></div>'+'<div class="blank-document-info">'+"<h3>"+e.newDocumentText+"</h3>"+e.newDescriptionText+"</div>"+"</div>"+'<div style="clear: both;"></div>'+"<h3>"+e.fromTemplateText+"</h3>"+"<hr noshade>"},{xtype:"container",flex:1,layout:"fit",cls:"container-template-list",items:[{xtype:"dataview",store:"FileTemplates",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="thumb-wrap">','<tpl if="this.isEmptyIcon(icon)">','<div class="thumb"></div>',"</tpl>",'<tpl if="this.isEmptyIcon(icon) == false">','<div class="thumb" style="background-image: url(\'{icon}\');"></div>',"</tpl>",'<div class="title">{name:htmlEncode}</div>',"</div>","</tpl>",{isEmptyIcon:function(e){return e==""}}),singleSelect:!0,trackOver:!0,autoScroll:!0,overItemCls:"x-item-over",itemSelector:"div.thumb-wrap",cls:"x-view-context",emptyText:'<div class="empty-text">'+this.noTemplatesText+"</div>",deferEmptyText:!1,plugins:[{ptype:"dataviewscrollpane",pluginId:"scrollpane",areaSelector:".x-view-context",settings:{enableKeyboardNavigation:!0}}]}]})},fromBlankText:"From Blank",newDocumentText:"New Presentation",newDescriptionText:"Create a new blank presentation which you will be able to style and format after it is created during the editing. Or choose one of the templates to start a document of a certain type or purpose where some styles have already been pre-applied.",fromTemplateText:"From Template",noTemplatesText:"There are no templates"}),Ext.define("PE.view.RecentFiles",{extend:"Ext.panel.Panel",alias:"widget.perecentfiles",cls:"pe-recentfiles",layout:{type:"vbox",align:"stretch"},requires:["Ext.container.Container","Ext.data.Model","Ext.data.Store","Ext.view.View","Ext.XTemplate","Common.plugin.DataViewScrollPane"],constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){this.callParent(arguments);var e=this;e.add({xtype:"container",flex:1,layout:"fit",cls:"container-recent-file-list",items:[{xtype:"dataview",store:"RecentFiles",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="thumb-wrap">','<div class="thumb"></div>','<div class="file-name">{title:htmlEncode}</div>','<div class="file-info">{folder:htmlEncode}</div>',"</div>","</tpl>"),singleSelect:!0,trackOver:!0,style:"overflow:auto",overItemCls:"x-item-over",itemSelector:"div.thumb-wrap",cls:"x-view-context",plugins:[{ptype:"dataviewscrollpane",pluginId:"scrollpane",areaSelector:".x-view-context",settings:{enableKeyboardNavigation:!0}}]}]})}}),Ext.define("PE.view.DocumentStatusInfo",{extend:"Ext.container.Container",alias:"widget.documentstatusinfo",requires:["Ext.form.field.Number","Ext.button.Button","Ext.form.Label","Ext.toolbar.Spacer","Ext.util.Cookies"],uses:["Ext.tip.ToolTip","Ext.menu.Menu","Common.view.Participants"],layout:{type:"hbox",align:"middle"},config:{caption:""},cls:"pe-documentstatusinfo",height:27,initComponent:function(){var e=this,t=Ext.apply({},e.initialConfig);this.addEvents("editcomplete");var n=Ext.widget("label",{id:"status-label-pages",text:Ext.String.format(e.pageIndexText,0,0),cls:"statusinfo-pages",style:"cursor: pointer;margin:0 40px;",listeners:{afterrender:function(t){t.getEl().on("mousedown",f,e)}}}),r=Ext.widget("label",{id:"status-label-caption",text:this.getCaption(),cls:"statusinfo-caption",height:14}),i=Ext.widget("label",{id:"status-label-zoom",text:Ext.String.format(e.zoomText,0),cls:"statusinfo-pages",style:"cursor: pointer; white-space:nowrap; text-align: center; margin: 0 5px;",listeners:{afterrender:Ext.bind(function(t){t.getEl().on("mousedown",l,this),t.getEl().set({"data-qtip":e.tipZoomFactor,"data-qalign":"bl-tl?"}),t.setWidth(Ext.util.TextMetrics.measure(t.getEl(),Ext.String.format(e.zoomText,999)).width)},this)}}),s=Ext.widget("button",{id:"status-button-fit-page",cls:"asc-statusbar-icon-btn",iconCls:"asc-statusbar-btn btn-fittopage",enableToggle:!0,listeners:{toggle:function(t,n){e.api&&(n?e.api.zoomFitToPage():e.api.zoomCustomMode()),o.toggle(!1,!0)},render:function(t){t.getEl().set({"data-qtip":e.tipFitPage,"data-qalign":"bl-tl?"})}}}),o=Ext.widget("button",{id:"status-button-fit-width",cls:"asc-statusbar-icon-btn",iconCls:"asc-statusbar-btn btn-fittowidth",enableToggle:!0,style:"margin: 0 20px 0 5px;",listeners:{toggle:function(t,n){e.api&&(n?e.api.zoomFitToWidth():e.api.zoomCustomMode()),s.toggle(!1,!0)},render:function(t){t.getEl().set({"data-qtip":e.tipFitWidth,"data-qalign":"bl-tl?"})}}}),u=Ext.widget("button",{id:"status-button-zoom-in",cls:"asc-btn-zoom asc-statusbar-icon-btn",iconCls:"asc-statusbar-btn btn-zoomin",style:"margin-right:40px",listeners:{click:function(){e.api&&e.api.zoomIn()},render:function(t){t.getEl().set({"data-qtip":e.tipZoomIn+" (Ctrl++)","data-qalign":"bl-tl?"})}}}),a=Ext.widget("button",{id:"status-button-zoom-out",cls:"asc-btn-zoom asc-statusbar-icon-btn",iconCls:"asc-statusbar-btn btn-zoomout",listeners:{click:function(){e.api&&e.api.zoomOut()},render:function(t){t.getEl().set({"data-qtip":e.tipZoomOut+" (Ctrl+-)","data-qalign":"bl-tl?"})}}});this.userPanel=Ext.widget("statusinfoparticipants",{userIconCls:"pe-icon-statusinfo-users"}),this.fieldPageNumber=Ext.widget("numberfield",{id:"status-field-page",width:40,minValue:1,maxValue:1e4,value:1,allowDecimals:!1,hideTrigger:!0,keyNavEnabled:!1,mouseWheelEnabled:!1,enableKeyEvents:!0,selectOnFocus:!0,listeners:{specialkey:function(t,n,r){if(n.getKey()==n.ENTER&&e.api){var i=e.fieldPageNumber.getValue();Ext.isNumber(i)&&(i>e.fieldPageNumber.maxValue&&(i=e.fieldPageNumber.maxValue),i<e.fieldPageNumber.minValue&&(i=e.fieldPageNumber.minValue),e.fieldPageNumber.setValue(i),e.fieldPageNumber.selectText(),e.api.goToPage(i-1))}}}});var f=function(){this.menuGoToPage.show(),this.menuGoToPage.showBy(n,"bl-tl",[0,-10])},l=function(){e.menuZoomTo.show(),e.menuZoomTo.showBy(i,"b-t",[0,-10])},c=function(t,n){s.toggle(n==2,!0),o.toggle(n==1,!0),i.setText(Ext.String.format(e.zoomText,t)),i.zf=t,e.doLayout()},h=function(t){e.api&&n.setText(Ext.String.format(e.pageIndexText,e.api.getCurrentPage()+1,t)),e.fieldPageNumber.setMinValue(t>0?1:0),e.fieldPageNumber.setMaxValue(t)},p=function(t){e.api&&n.setText(Ext.String.format(e.pageIndexText,t+1,e.api.getCountPages())),e.fieldPageNumber.setValue(t+1)};this.setApi=function(e){return this.api=e,this.api&&(this.api.asc_registerCallback("asc_onZoomChange",Ext.bind(c,this)),this.api.asc_registerCallback("asc_onCountPages",Ext.bind(h,this)),this.api.asc_registerCallback("asc_onCurrentPage",Ext.bind(p,this)),this.userPanel.setApi(this.api)),this},this.items=[n,e.userPanel,{xtype:"container",flex:1,layout:{type:"hbox",pack:"center"},items:[r]},s,o,a,i,u],e.callParent(arguments)},applyCaption:function(e){var t=Ext.get("status-label-caption");return t&&Ext.DomHelper.overwrite(t,e),this.doLayout(),e},createDelayedElements:function(){function i(t){e.api&&e.api.zoom(t.zf)}var e=this,t=Ext.widget("label",{id:"status-label-page",text:e.goToPageText}),n=20,r=7;this.menuGoToPage=Ext.widget("menu",{id:"status-menu-page",autoHeight:!0,autoWidth:!0,plain:!0,items:[{xtype:"container",cls:"pe-documentstatusinfo-menu-inner",layout:{type:"hbox",align:"middle",padding:n/2+"px "+n+"px"},items:[t,{xtype:"tbspacer",width:r},e.fieldPageNumber],listeners:{afterrender:function(i){var s=t.getWidth();i.getEl().setWidth(r+2*n+s+e.fieldPageNumber.getWidth())}}}],listeners:{show:function(t){e.api&&(e.fieldPageNumber.setValue(e.api.getCurrentPage()+1),e.fieldPageNumber.focus(!0,300))}}}),this.menuZoomTo=Ext.widget("menu",{plain:!0,bodyCls:"status-zoom-menu",minWidth:100,defaults:{listeners:{click:i}},listeners:{hide:function(){e.fireEvent("editcomplete",e)}},items:[{text:"50%",zf:50},{text:"75%",zf:75},{text:"100%",zf:100},{text:"125%",zf:125},{text:"150%",zf:150},{text:"175%",zf:175},{text:"200%",zf:200}]})},setMode:function(e){this.userPanel.setMode(e)},zoomText:"Zoom {0}%",goToPageText:"Go to Slide",pageIndexText:"Slide {0} of {1}",tipFitPage:"Fit Slide",tipFitWidth:"Fit Width",tipZoomIn:"Zoom In",tipZoomOut:"Zoom Out",tipZoomFactor:"Magnification"});var c_paragraphLinerule={LINERULE_LEAST:0,LINERULE_AUTO:1,LINERULE_EXACT:2},c_tableBorder={BORDER_VERTICAL_LEFT:0,BORDER_HORIZONTAL_TOP:1,BORDER_VERTICAL_RIGHT:2,BORDER_HORIZONTAL_BOTTOM:3,BORDER_VERTICAL_CENTER:4,BORDER_HORIZONTAL_CENTER:5,BORDER_INNER:6,BORDER_OUTER:7,BORDER_ALL:8,BORDER_NONE:9,BORDER_ALL_TABLE:10,BORDER_NONE_TABLE:11,BORDER_INNER_TABLE:12,BORDER_OUTER_TABLE:13};Ext.define("PE.view.DocumentHolder",{extend:"Ext.container.Container",alias:"widget.pedocumentholder",cls:"pe-documentholder",requires:["Ext.String"],uses:["Ext.menu.Menu","Ext.menu.Manager","PE.view.InsertTableDialog","PE.view.ImageSettingsAdvanced","PE.view.TableSettingsAdvanced","PE.view.ShapeSettingsAdvanced","PE.view.ParagraphSettingsAdvanced","PE.view.HyperlinkSettings","Common.component.MenuDataViewPicker","Common.plugin.MenuExpand"],layout:"fit",constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){var e=this;e.html="",e.usertips=[],e._TtHeight=20;var t=Ext.getStore("Common.store.Users"),n=window.localStorage.getItem("pe-settings-livecomment");e.isLiveCommenting=n===null||parseInt(n)!=0,this.hotKeys=new Ext.util.KeyMap(document,[{key:Ext.EventObject.F5,ctrl:!0,shift:!1,alt:!1,defaultEventAction:"stopEvent",fn:function(){var t=Ext.getCmp("pe-preview");e.checkCanHotKey()&&t&&!t.isVisible()&&(t.setPosition(0,0),t.setSize(Ext.getBody().getWidth(),Ext.getBody().getHeight()),t.show(),Ext.getCmp("pe-applicationUI").hide(),e.api&&e.api.StartDemonstration("presentation-preview",0))}}]);var r=function(t,n,r,i,s){if(Ext.isDefined(t)&&t!==null){Ext.menu.Manager.hideAll();var o=[r.get_X(),r.get_Y()];Ext.isFunction(t.initMenu)&&t.initMenu(n),e.currentMenu=t,t.showAt(o)}},i=function(t,n,i){if(e.api&&e.mode.isEdit){var s={},o=null,u=e.api.getSelectedElements();if(u&&Ext.isArray(u)){for(var a=0;a<u.length;a++){var f=u[a].get_ObjectType(),l=u[a].get_ObjectValue();c_oAscTypeSelectElement.Image==f?(o=e.pictureMenu,s.imgProps={},s.imgProps.value=l,s.imgProps.locked=l?l.get_Locked():!1):c_oAscTypeSelectElement.Table==f?(o=e.tableMenu,s.tableProps={},s.tableProps.value=l,s.tableProps.locked=l?l.get_Locked():!1):c_oAscTypeSelectElement.Hyperlink==f?(s.hyperProps={},s.hyperProps.value=l):c_oAscTypeSelectElement.Shape==f?(o=e.pictureMenu,s.shapeProps={},s.shapeProps.value=l,s.shapeProps.locked=l?l.get_Locked():!1):c_oAscTypeSelectElement.Slide==f?(s.slideProps={},s.slideProps.value=l,s.slideProps.locked=l?l.get_LockDelete():!1):c_oAscTypeSelectElement.Paragraph==f&&(s.paraProps={},s.paraProps.value=l,s.paraProps.locked=l?l.get_Locked():!1,s.shapeProps&&s.shapeProps.value&&s.tableProps===undefined&&(o=e.textMenu))}o===null&&s.paraProps!==undefined&&(o=e.textMenu),r(o,s,t,n,i)}}},s=function(t){t.get_Type()==c_oAscContextMenuTypes.Thumbnails?r(e.slideMenu,{isSlideSelect:t.get_IsSlideSelect()},t):i(t)},o=function(t){if(e.api){var n=t.getWheelDelta();t.ctrlKey&&(n<0?e.api.zoomOut():n>0&&e.api.zoomIn(),t.stopEvent())}},u=function(t){if(e.api){var n=t.getKey();if((t.ctrlKey||t.metaKey)&&!t.shiftKey){if(n===t.NUM_PLUS||Ext.isOpera&&n==43)return e.api.zoomIn(),t.stopEvent(),!1;if(n===t.NUM_MINUS||Ext.isOpera&&n==45)return e.api.zoomOut(),t.stopEvent(),!1}if(e.currentMenu&&e.currentMenu.isVisible())if(n==t.DOWN)e.currentMenu.focus(),e.currentMenu.setActiveItem(e.currentMenu.items.items[0]);else if(n==t.UP){e.currentMenu.focus();for(var r=e.currentMenu.items.length-1;r>=0;r--)if(e.currentMenu.items.items[r].isVisible()){e.currentMenu.setActiveItem(e.currentMenu.items.items[r]);break}}}},a=function(){e._Height=e.getEl().getHeight(),e._Width=e.getEl().getWidth(),e._BodyWidth=Ext.getBody().getWidth(),e.slideNumDiv&&(Ext.destroy(e.slideNumDiv),e.slideNumDiv=undefined)},f=function(t){var n=e.getEl();n&&n.on({contextmenu:{fn:function(){},preventDefault:!0},mousewheel:o,click:function(t,n){n instanceof HTMLTextAreaElement||n instanceof HTMLInputElement||e.focus(!1)}}),Ext.getDoc().on("mousewheel",o,e),Ext.getDoc().on("keydown",u,e),e.addListener("resize",a,e)},l=function(n){if(t){var r=t.findRecord("id",n);if(r)return Ext.String.ellipsis(Ext.String.htmlEncode(r.get("username")),25,!0)}return e.guestText},c={toolTip:Ext.create("Ext.tip.ToolTip",{html:"props<br><b>Press Ctrl and click link</b>",shadow:!1,dismissDelay:0,style:"word-wrap: break-word;"}),strTip:"",isHidden:!0},h=Ext.create("Ext.tip.ToolTip",{dismissDelay:0,html:e.tipIsLocked}),p=function(e,t,n){if(h!==undefined){h.setTarget(t),h.show();var r=h.getEl().getAlignToXY(t,"bl-tl?");r[0]+=25,r[1]-=10,h.showAt(r)}},d=function(t,n,r){if(h!==undefined&&h.target&&n==h.target.dom){h=undefined;for(var i=0;i<e.usertips.length;i++)e.usertips[i].un("mouseover",p),e.usertips[i].un("mouseout",d)}},v=function(e){e&&window.open(e)},m=function(){c.isHidden=!0,e.usertips.length>0&&Ext.destroy(e.usertips),e.usertips=[],e.usertipcount=0},g=function(){c.isHidden&&c.toolTip.isVisible()&&c.toolTip.hide()},y=function(t){e._XY===undefined&&e.getEl()&&(e._XY=e.getEl().getXY(),e._Height=e.getEl().getHeight(),e._Width=e.getEl().getWidth(),e._BodyWidth=Ext.getBody().getWidth());if(t){var n,r;if(t.get_Type()==1){var i=!1,s=t.get_Hyperlink();if(s){c.isHidden=!1,r=s.get_ToolTip()?s.get_ToolTip():s.get_Value(),r=Ext.String.htmlEncode(r);if(c.tipLength!==r.length||c.strTip.indexOf(r)<0)c.toolTip.update(r+"<br><b>"+e.txtPressLink+"</b>"),c.tipLength=r.length,c.strTip=r,i=!0;n=[t.get_X(),t.get_Y()],n[1]+=e._XY[1]-15,n[0]+=e._XY[0]+5,c.toolTip.isVisible()||c.toolTip.showAt([-1e4,-1e4]),i&&(c.tipHeight=c.toolTip.getHeight()),n[1]-=c.tipHeight,c.toolTip.getEl().applyStyles({top:n[1]+"px",left:n[0]+"px"})}}else if(t.get_Type()==2&&e.mode.isEdit){var o;e.usertipcount>=e.usertips.length&&(o=Ext.DomHelper.append(Ext.getBody(),{tag:"div",cls:"username-tip"},!0),o.applyStyles({height:e._TtHeight+"px",position:"absolute",zIndex:"19000",visibility:"visible"}),h!==undefined&&(o.on("mouseover",p),o.on("mouseout",d)),e.usertips.push(o)),o=e.usertips[e.usertipcount],e.usertipcount++,r=l(t.get_UserId()),n=[t.get_X(),t.get_Y()],n[1]+=e._XY[1],n[0]+=e._XY[0],n[0]=e._BodyWidth-n[0],n[1]-=t.get_LockedObjectType()==2?e._TtHeight:0,n[1]>e._XY[1]&&n[1]+e._TtHeight<e._XY[1]+e._Height&&(Ext.DomHelper.overwrite(o,r),o.applyStyles({visibility:"visible"}),o.applyStyles({top:n[1]+"px",right:n[0]+"px"}))}else c.toolTip.hide()}},b=function(){var t,n;if(e.api){var r=e.api.can_AddHyperlink();if(r!==!1){var i=[];for(var s=0;s<e.api.getCountPages();s++)i.push(s+1);n=new CHyperlinkProperty,n.put_Text(r),t=Ext.create("PE.view.HyperlinkSettings",{slides:i}),t.setSettings(n,e.api.getCurrentPage())}}t&&(t.addListener("onmodalresult",Ext.bind(function(r){r==1&&(n=t.getSettings(),e.api.add_Hyperlink(n)),e.fireEvent("editcomplete",e)},e),!1),t.show())},w=function(t){e._XY===undefined&&e.getEl()&&(e._XY=e.getEl().getXY(),e._Height=e.getEl().getHeight(),e._Width=e.getEl().getWidth(),e._BodyWidth=Ext.getBody().getWidth()),e.slideNumDiv===undefined&&(e.slideNumDiv=Ext.DomHelper.append(Ext.getBody(),{tag:"div",cls:"slidenum-div"},!0),e.slideNumDiv.applyStyles({height:"20px",position:"absolute",zIndex:"19000",display:"block"}),e.slideNumDiv.applyStyles({top:e._XY[1]+e._Height/2+"px",right:e._BodyWidth-e._XY[0]-e._Width+22+"px"})),Ext.DomHelper.overwrite(e.slideNumDiv,e.txtSlide+" "+(t+1)),e.slideNumDiv.applyStyles({display:"block"})},E=function(){e.slideNumDiv&&e.slideNumDiv.applyStyles({display:"none"})},S=function(){e.mode.isEdit=!1};this.changePosition=function(){e._XY=e.getEl().getXY(),m()},this.hideTips=function(){Ext.destroy(e.usertips),e.usertips=[],e.usertipcount=0},this.setLiveCommenting=function(e){this.isLiveCommenting=e},this.hkComments=new Ext.util.KeyMap(document,{key:"H",ctrl:!0,alt:!0,shift:!1,defaultEventAction:"stopEvent",fn:function(){e.checkCanHotKey()&&e.api.can_AddQuotedComment()!==!1&&e.addComment()}}),this.setApi=function(e){return this.api=e,this.api&&(this.api.asc_registerCallback("asc_onContextMenu",Ext.bind(s,this)),this.api.asc_registerCallback("asc_onMouseMoveStart",Ext.bind(m,this)),this.api.asc_registerCallback("asc_onMouseMoveEnd",Ext.bind(g,this)),this.api.asc_registerCallback("asc_onPaintSlideNum",Ext.bind(w,this)),this.api.asc_registerCallback("asc_onEndPaintSlideNum",Ext.bind(E,this)),this.api.asc_registerCallback("asc_onHyperlinkClick",Ext.bind(v,this)),this.api.asc_registerCallback("asc_onMouseMove",Ext.bind(y,this)),this.mode.isEdit===!0&&this.api.asc_registerCallback("asc_onDialogAddHyperlink",Ext.bind(b,this)),this.api.asc_registerCallback("asc_onСoAuthoringDisconnect",Ext.bind(S,this))),this},this.mode={},this.setMode=function(e){this.api&&e.isEdit&&this.api.asc_registerCallback("asc_onDialogAddHyperlink",Ext.bind(b,this)),this.mode=e,this.hkComments[this.mode.canCoAuthoring&&this.mode.isEdit?"enable":"disable"](),this.editorConfig={user:e.user}},e.on("afterrender",f,e),e.callParent(arguments)},_onSlideStoreDataChanged:function(){this.slideLayoutMenu.picker.needArrangeSlideItems=!0},_arrangeSlideItems:function(){if(!this.needArrangeSlideItems)return;var e=this;if(this.getEl()){var t=this.getEl().down(".jspPane");if(t&&t.getHeight()>0&&this.getEl().getHeight()>0)var n=0,r=setInterval(function(){e.needArrangeSlideItems&&e.resizeSlideItems();if(!e.needArrangeSlideItems){clearInterval(r),e.doLayout();return}n++>5&&clearInterval(r)},100)}},_resizeSlideItems:function(){var e=3,t="div.main-thumb",n=this.getEl(),r=n.query(t),i=0,s=this.itemHeight!==undefined?this.itemHeight:67;while(i<r.length){var o=0;for(var u=i;u<i+e;u++){if(u>=r.length)break;var a=Ext.get(r[u]),f=a.getHeight();if(f<s)return;f<o?a.setHeight(o):o=f}i+=e}r.length>0&&(this.needArrangeSlideItems=!1)},addHyperlink:function(e,t,n){var r,i=this;if(i.api){var s=[];for(var o=0;o<i.api.getCountPages();o++)s.push(o+1);r=Ext.create("PE.view.HyperlinkSettings",{slides:s}),r.setSettings(e.hyperProps.value,i.api.getCurrentPage())}r&&(r.addListener("onmodalresult",Ext.bind(function(e){if(e==1){var t=r.getSettings();i.api.add_Hyperlink(t)}i.fireEvent("editcomplete",i)},i),!1),r.show())},editHyperlink:function(e,t,n){var r,i=this;if(i.api){var s=[];for(var o=0;o<i.api.getCountPages();o++)s.push(o+1);r=Ext.create("PE.view.HyperlinkSettings",{slides:s}),r.setSettings(e.hyperProps.value,i.api.getCurrentPage())}r&&(r.addListener("onmodalresult",Ext.bind(function(e){if(e==1){var t=r.getSettings();i.api.change_Hyperlink(t)}i.fireEvent("editcomplete",i)},i),!1),r.show())},addComment:function(e,t,n){var r=this;if(r.api){var i=new asc_CCommentData,s=new Date,o=s.getTimezoneOffset()*6e4;if(i){i.asc_putText(""),i.asc_putTime((s.getTime()-o).toString()),i.asc_putUserId(r.editorConfig.user.id),i.asc_putUserName(r.editorConfig.user.name),i.asc_putSolved(!1),r.api.asc_addComment(i);var u=Ext.ComponentQuery.query("commoncommentspopover");if(u){var a=u[0];if(a){var f=a.query("dataview")[0];a.fireTransformToAdd(),f&&f.on("viewready",function(){a.fireTransformToAdd()},this)}}}}},checkCanHotKey:function(){var e=Ext.getDoc().query(".x-window");for(var t=0;t<e.length;t++){var n=Ext.getCmp(e[t].id);if(n&&n.isVisible()&&n.modal)return!1}return!0},createDelayedElements:function(){var e=this;e.addEvents("editcomplete");var t=Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="main-thumb">','<div class="thumb-wrap">','<img src="{imageUrl}" />',"</div>",'<tpl if="title">','<div class="caption"','<tpl if="itemWidth">',' style="width:{itemWidth}px;"',"</tpl>","><span>{title}</span></div>","</tpl>","</div>","</tpl>"),n=Ext.getStore("SlideLayouts");n.on("datachanged",e._onSlideStoreDataChanged,e);var r=Ext.widget("menuitem",{text:e.txtDeleteSlide,listeners:{click:function(t,n,r){e.api&&(e.api.DeleteSlide(),e.fireEvent("editcomplete",this))}}}),i=Ext.widget("menuitem",{text:e.txtChangeLayout,hideOnClick:!1,menu:e.slideLayoutMenu=Ext.create("Common.component.MenuDataViewPicker",{width:421,height:320,dataTpl:t,cls:"slide-picker",store:n,viewData:[],contentWidth:401,arrangeItems:e._arrangeSlideItems,resizeSlideItems:e._resizeSlideItems,listeners:{select:Ext.bind(function(t,n){e.api&&(e.api.ChangeLayout(n.data.data.idx),e.fireEvent("editcomplete",this))},e),hide:function(){e.fireEvent("editcomplete",e)},show:function(e){e.picker.selectByIndex(-1,!1)},beforeshow:Ext.bind(function(e){if(e.rendered){var t=e.picker.contentWidth,n=e.picker.store.getCount()>0?e.picker.store.getAt(0):null;if(n){var r=n.data.itemWidth*3+64;t!==r-20&&(e.picker.itemHeight=n.data.itemHeight,e.picker.contentWidth=r-20,e.setWidth(r))}}},e)},plugins:[{ptype:"menuexpand"}]})});e.slideMenu=Ext.widget("menu",{showSeparator:!1,bodyCls:"no-icons",listeners:{hide:function(t,n){e.fireEvent("editcomplete",e),e.currentMenu=null}},initMenu:function(t){for(var n=1;n<5;n++)e.slideMenu.items.items[n].setVisible(t.isSlideSelect);var s=e.api.getSelectedElements();if(s&&Ext.isArray(s))for(var n=0;n<s.length;n++)if(c_oAscTypeSelectElement.Slide==s[n].get_ObjectType()){var o=s[n].get_ObjectValue(),u=o.get_LockDelete(),a=o.get_LockRemove(),f=o.get_LockLayout();for(var n=0;n<2;n++)e.slideMenu.items.items[n].setDisabled(u);e.slideMenu.items.items[6].setDisabled(u),r.setDisabled(a||u),i.setDisabled(f||u);break}},items:[{text:e.txtNewSlide,listeners:{click:function(t,n,r){e.api&&(e.api.AddSlide(),e.fireEvent("editcomplete",this))}}},{text:e.txtDuplicateSlide,listeners:{click:function(t,n,r){e.api&&(e.api.DublicateSlide(),e.fireEvent("editcomplete",this))}}},r,{xtype:"menuseparator"},i,{xtype:"menuseparator"},{text:e.txtSelectAll,listeners:{click:function(t,n,r){e.api&&(e.api.SelectAllSlides(),e.fireEvent("editcomplete",this))}}},{xtype:"menuseparator"},{text:e.txtPreview,listeners:{click:function(t,n,r){var i=Ext.getCmp("pe-preview");i&&(i.setPosition(0,0),i.setSize(Ext.getBody().getWidth(),Ext.getBody().getHeight()),i.show(),Ext.getCmp("pe-applicationUI").hide());if(e.api){var s=e.api.getCurrentPage();e.api.StartDemonstration("presentation-preview",Ext.isNumber(s)?s:0)}}}}],plugins:[{ptype:"menuexpand"}]});var s=Ext.create("Ext.menu.Item",{text:e.mergeCellsText,listeners:{click:function(t){e.api&&e.api.MergeCells()}}}),o=Ext.create("Ext.menu.Item",{text:e.splitCellsText,listeners:{click:function(t){if(e.api){var n=Ext.create("PE.view.InsertTableDialog",{labelTitle:this.splitCellTitleText});n.addListener("onmodalresult",Ext.bind(function(t,n,r){n&&e.api.SplitCell(r[0],r[1]),e.fireEvent("editcomplete",e)},this),!1),n.show()}}}}),u=function(t,n){if(e.api){var r=new CTableProp;r.put_CellsVAlign(t.valign),e.api.tblApply(r)}},a=Ext.widget("menuitem",{text:e.cellAlignText,hideOnClick:!1,menu:{showSeparator:!1,bodyCls:"no-icons",items:[e.menuTableCellTop=Ext.widget("menucheckitem",{text:e.topCellText,checked:!1,group:"popuptablecellalign",valign:c_oAscVertAlignJc.Top,listeners:{click:u,scope:e}}),e.menuTableCellCenter=Ext.widget("menucheckitem",{text:e.centerCellText,checked:!1,group:"popuptablecellalign",valign:c_oAscVertAlignJc.Center,listeners:{click:u,scope:e}}),e.menuTableCellBottom=Ext.widget("menucheckitem",{text:e.bottomCellText,checked:!1,group:"popuptablecellalign",valign:c_oAscVertAlignJc.Bottom,listeners:{click:u,scope:e}})],plugins:[{ptype:"menuexpand"}]}}),f=Ext.widget("menuitem",{text:e.advancedTableText,listeners:{click:function(t,n,r){var i;if(e.api){var s=e.api.getSelectedElements();if(s&&Ext.isArray(s))for(var o=s.length-1;o>=0;o--){var u,a;u=s[o].get_ObjectType(),a=s[o].get_ObjectValue();if(c_oAscTypeSelectElement.Table==u){i=Ext.create("PE.view.TableSettingsAdvanced"),i.updateMetricUnit(),i.setSettings({tableProps:a,borderProps:e.borderAdvancedProps});break}}}i&&(i.addListener("onmodalresult",Ext.bind(function(t,n,r){if(n==1){var s=i.getSettings();e.borderAdvancedProps=s.borderProps,e.api.tblApply(s.tableProps)}e.fireEvent("editcomplete",e)},this),!1),i.show())}}}),l=Ext.widget("menuitem",{text:e.advancedImageText,listeners:{click:function(t,n,r){var i;if(e.api){var s=e.api.getSelectedElements();if(s&&Ext.isArray(s))for(var o=s.length-1;o>=0;o--){var u,a;u=s[o].get_ObjectType(),a=s[o].get_ObjectValue();if(c_oAscTypeSelectElement.Image==u){i=Ext.create("PE.view.ImageSettingsAdvanced",{}),i.updateMetricUnit(),i.setSettings(a);break}}}if(i){if(!A.isDisabled()){var f=e.api.get_OriginalSizeImage();f&&i.setSizeOriginal({width:f.get_ImageWidth(),height:f.get_ImageHeight()})}i.addListener("onmodalresult",Ext.bind(function(t,n,r){n==1&&r&&e.api.ImgApply(r),e.fireEvent("editcomplete",e)},this),!1),i.show()}},scope:e}}),c=Ext.widget("menuitem",{text:e.advancedShapeText,listeners:{click:function(t,n,r){var i;if(e.api){var s=e.api.getSelectedElements();if(s&&Ext.isArray(s))for(var o=s.length-1;o>=0;o--){var u,a;u=s[o].get_ObjectType(),a=s[o].get_ObjectValue();if(c_oAscTypeSelectElement.Shape==u){i=Ext.create("PE.view.ShapeSettingsAdvanced",{}),i.updateMetricUnit(),i.setSettings(a);break}}}i&&(i.addListener("onmodalresult",Ext.bind(function(t,n,r){n==1&&r&&e.api.ShapeApply(r),e.fireEvent("editcomplete",e)},this),!1),i.show())},scope:e}}),h=Ext.widget("menuitem",{text:e.advancedParagraphText,listeners:{click:function(e,t,n){var r,i=this;if(i.api){var s=i.api.getSelectedElements();if(s&&Ext.isArray(s))for(var o=s.length-1;o>=0;o--){var u,a;u=s[o].get_ObjectType(),a=s[o].get_ObjectValue();if(c_oAscTypeSelectElement.Paragraph==u){r=Ext.create("PE.view.ParagraphSettingsAdvanced"),r.updateMetricUnit(),r.setSettings({paragraphProps:a,api:i.api});break}}}r&&(r.on({onmodalresult:function(e,t,n){t==1&&n&&i.api.paraApply(n.paragraphProps)},close:function(e){i.fireEvent("editcomplete",i)}}),r.show())},scope:this}}),p=Ext.widget("menuseparator"),d=Ext.widget("menuitem",{text:e.hyperlinkText,listeners:{click:e.addHyperlink,scope:e}}),v=Ext.widget("menuitem",{text:e.editHyperlinkText,listeners:{click:e.editHyperlink,scope:e}}),m=Ext.widget("menuitem",{text:e.removeHyperlinkText,listeners:{click:function(t,n,r){e.api&&e.api.remove_Hyperlink(),e.fireEvent("editcomplete",e)}}}),g=Ext.widget("menuitem",{text:e.hyperlinkText,hideOnClick:!1,menu:{showSeparator:!1,bodyCls:"no-icons",items:[v,m]}}),y=Ext.widget("menuitem",{text:e.hyperlinkText,listeners:{click:e.addHyperlink,scope:e}}),b=Ext.widget("menuitem",{text:e.editHyperlinkText,listeners:{click:e.editHyperlink,scope:e}}),w=Ext.widget("menuitem",{text:e.removeHyperlinkText,listeners:{click:function(t,n,r){e.api&&e.api.remove_Hyperlink(),e.fireEvent("editcomplete",e)}}}),E=Ext.widget("menuitem",{text:e.hyperlinkText,hideOnClick:!1,menu:{showSeparator:!1,bodyCls:"no-icons",items:[b,w]}}),S=Ext.widget("menuseparator"),x=Ext.create("Ext.menu.Item",{iconCls:"mnu-icon-item mnu-group",text:this.txtGroup,listeners:{click:function(t,n){e.api&&e.api.groupShapes(),e.fireEvent("editcomplete",this)},scope:e}}),T=Ext.create("Ext.menu.Item",{iconCls:"mnu-icon-item mnu-ungroup",text:this.txtUngroup,listeners:{click:function(t,n){e.api&&e.api.unGroupShapes(),e.fireEvent("editcomplete",this)},scope:e}}),N=Ext.widget("menuitem",{text:e.txtArrange,hideOnClick:!1,menu:{showSeparator:!1,defaults:{cls:"toolbar-menu-icon-item"},items:[{iconCls:"mnu-icon-item mnu-arrange-front",text:this.textArrangeFront,listeners:{click:function(e,t){this.api&&this.api.shapes_bringToFront(),this.fireEvent("editcomplete",this)},scope:this}},{iconCls:"mnu-icon-item mnu-arrange-back",text:this.textArrangeBack,listeners:{click:function(e,t){this.api&&this.api.shapes_bringToBack(),this.fireEvent("editcomplete",this)},scope:this}},{iconCls:"mnu-icon-item mnu-arrange-forward",text:this.textArrangeForward,listeners:{click:function(e,t){this.api&&this.api.shapes_bringForward(),this.fireEvent("editcomplete",this)},scope:this}},{iconCls:"mnu-icon-item mnu-arrange-backward",text:this.textArrangeBackward,listeners:{click:function(e,t){this.api&&this.api.shapes_bringBackward(),this.fireEvent("editcomplete",this)},scope:this}},{xtype:"menuseparator"},x,T],plugins:[{ptype:"menuexpand"}]}}),C=Ext.widget("menuitem",{text:e.txtAlign,hideOnClick:!1,menu:{showSeparator:!1,defaults:{cls:"toolbar-menu-icon-item",listeners:{click:function(e,t){this.api&&this.api.put_ShapesAlign(e.halign),this.fireEvent("editcomplete",this)},scope:this}},items:[{iconCls:"mnu-icon-item mnu-shape-align-left",text:this.textShapeAlignLeft,halign:c_oAscAlignShapeType.ALIGN_LEFT},{iconCls:"mnu-icon-item mnu-shape-align-center",text:this.textShapeAlignCenter,halign:c_oAscAlignShapeType.ALIGN_CENTER},{iconCls:"mnu-icon-item mnu-shape-align-right",text:this.textShapeAlignRight,halign:c_oAscAlignShapeType.ALIGN_RIGHT},{iconCls:"mnu-icon-item mnu-shape-align-top",text:this.textShapeAlignTop,halign:c_oAscAlignShapeType.ALIGN_TOP},{iconCls:"mnu-icon-item mnu-shape-align-middle",text:this.textShapeAlignMiddle,halign:c_oAscAlignShapeType.ALIGN_MIDDLE},{iconCls:"mnu-icon-item mnu-shape-align-bottom",text:this.textShapeAlignBottom,halign:c_oAscAlignShapeType.ALIGN_BOTTOM},{xtype:"menuseparator"},{iconCls:"mnu-icon-item mnu-distrib-hor",text:this.txtDistribHor,listeners:{click:function(e,t){this.api&&this.api.DistributeHorizontally(),this.fireEvent("editcomplete",this)},scope:this}},{iconCls:"mnu-icon-item mnu-distrib-vert",text:this.txtDistribVert,listeners:{click:function(e,t){this.api&&this.api.DistributeVertically(),this.fireEvent("editcomplete",this)},scope:this}}],plugins:[{ptype:"menuexpand"}]}}),k=Ext.widget("menuitem",{text:e.vertAlignText,hideOnClick:!1,menu:{showSeparator:!1,bodyCls:"no-icons",items:[e.menuParagraphTop=Ext.widget("menucheckitem",{text:e.topCellText,checked:!1,group:"popupparagraphvalign",valign:c_oAscVerticalTextAlign.TEXT_ALIGN_TOP}),e.menuParagraphCenter=Ext.widget("menucheckitem",{text:e.centerCellText,checked:!1,group:"popupparagraphvalign",valign:c_oAscVerticalTextAlign.TEXT_ALIGN_CTR}),e.menuParagraphBottom=Ext.widget("menucheckitem",{text:e.bottomCellText,checked:!1,group:"popupparagraphvalign",valign:c_oAscVerticalTextAlign.TEXT_ALIGN_BOTTOM})],plugins:[{ptype:"menuexpand"}]}}),L=Ext.widget("menuseparator"),A=Ext.widget("menuitem",{text:e.originalSizeText,listeners:{click:function(t,n,r){if(e.api){var i=e.api.get_OriginalSizeImage();if(i){var s=new CImgProperty;s.put_Width(i.get_ImageWidth()),s.put_Height(i.get_ImageHeight()),e.api.ImgApply(s)}e.fireEvent("editcomplete",this)}},scope:e}}),O=Ext.widget("menuitem",{text:e.addCommentText,hidden:!0,listeners:{click:this.addComment,scope:this}}),M=Ext.widget("menuitem",{text:e.addCommentText,hidden:!0,listeners:{click:this.addComment,scope:this}}),_=Ext.widget("menuseparator",{hidden:!0}),D=Ext.widget("menuitem",{text:e.addCommentText,hidden:!0,listeners:{click:this.addComment,scope:this}});e.textMenu=Ext.widget("menu",{showSeparator:!1,bodyCls:"no-icons",listeners:{hide:function(t,n){e.fireEvent("editcomplete",e),e.currentMenu=null}},initMenu:function(t){var n=t.paraProps!==undefined&&t.paraProps.locked||t.slideProps!==undefined&&t.slideProps.locked,r=t.shapeProps&&t.shapeProps.value;k.setVisible(r);if(r){var i=t.shapeProps.value.get_VerticalTextAlign();e.menuParagraphTop.setChecked(i==c_oAscVerticalTextAlign.TEXT_ALIGN_TOP),e.menuParagraphCenter.setChecked(i==c_oAscVerticalTextAlign.TEXT_ALIGN_CTR),e.menuParagraphBottom.setChecked(i==c_oAscVerticalTextAlign.TEXT_ALIGN_BOTTOM)}k.setDisabled(n);var s=null;e.api&&(s=e.api.can_AddHyperlink()),d.setVisible(t.hyperProps===undefined&&s!==!1),g.setVisible(t.hyperProps!==undefined),v.hyperProps=t.hyperProps,s!==!1&&(d.hyperProps={},d.hyperProps.value=new CHyperlinkProperty,d.hyperProps.value.put_Text(s)),O.setVisible(e.api.can_AddQuotedComment()!==!1&&e.mode.canCoAuthoring),p.setVisible(O.isVisible()||d.isVisible()||g.isVisible()),d.setDisabled(n),g.setDisabled(n),O.setDisabled(n)},items:[k,h,p,O,d,g]}),e.tableMenu=Ext.widget("menu",{showSeparator:!1,bodyCls:"no-icons",listeners:{hide:function(t,n){e.fireEvent("editcomplete",e),e.currentMenu=null}},initMenu:function(t){if(t.tableProps===undefined)return;var n=t.slideProps!==undefined&&t.slideProps.locked;e.menuTableCellTop.setChecked(t.tableProps.value.get_CellsVAlign()==c_oAscVertAlignJc.Top),e.menuTableCellCenter.setChecked(t.tableProps.value.get_CellsVAlign()==c_oAscVertAlignJc.Center),e.menuTableCellBottom.setChecked(t.tableProps.value.get_CellsVAlign()==c_oAscVertAlignJc.Bottom),e.api&&(s.setDisabled(t.tableProps.locked||n||!e.api.CheckBeforeMergeCells()),o.setDisabled(t.tableProps.locked||n||!e.api.CheckBeforeSplitCells()));for(var r=1;r<4;r++)e.tableMenu.items.items[r].setDisabled(t.tableProps.locked||n);a.setDisabled(t.tableProps.locked||n),f.setDisabled(t.tableProps.locked||n);var i=null;e.api&&(i=e.api.can_AddHyperlink()),y.setVisible(t.hyperProps===undefined&&i!==!1),E.setVisible(t.hyperProps!==undefined),S.setVisible(y.isVisible()||E.isVisible()||M.isVisible()),b.hyperProps=t.hyperProps,i!==!1&&(y.hyperProps={},y.hyperProps.value=new CHyperlinkProperty,y.hyperProps.value.put_Text(i)),y.setDisabled(t.paraProps.locked||n),E.setDisabled(t.paraProps.locked||n),M.setVisible(e.api.can_AddQuotedComment()!==!1&&e.mode.canCoAuthoring),M.setDisabled(t.paraProps.locked||n)},items:[{text:e.selectText,hideOnClick:!1,menu:{showSeparator:!1,bodyCls:"no-icons",width:100,items:[{text:e.rowText,listeners:{click:function(t){e.api&&e.api.selectRow()}}},{text:e.columnText,listeners:{click:function(t){e.api&&e.api.selectColumn()}}},{text:e.cellText,listeners:{click:function(t){e.api&&e.api.selectCell()}}},{text:e.tableText,listeners:{click:function(t){e.api&&e.api.selectTable()}}}],plugins:[{ptype:"menuexpand"}]}},{text:e.insertRowText,hideOnClick:!1,menu:{showSeparator:!1,bodyCls:"no-icons",width:100,items:[{text:e.aboveText,listeners:{click:function(t){e.api&&e.api.addRowAbove()}}},{text:e.belowText,listeners:{click:function(t){e.api&&e.api.addRowBelow()}}}],plugins:[{ptype:"menuexpand"}]}},{text:e.insertColumnText,hideOnClick:!1,menu:{showSeparator:!1,bodyCls:"no-icons",width:100,items:[{text:e.insertColumnLeftText,listeners:{click:function(t){e.api&&e.api.addColumnLeft()}}},{text:e.insertColumnRightText,listeners:{click:function(t){e.api&&e.api.addColumnRight()}}}],plugins:[{ptype:"menuexpand"}]}},{text:e.deleteText,hideOnClick:!1,menu:{showSeparator:!1,bodyCls:"no-icons",width:100,items:[{text:e.rowText,listeners:{click:function(t){e.api&&e.api.remRow()}}},{text:e.columnText,listeners:{click:function(t){e.api&&e.api.remColumn()}}},{text:e.tableText,listeners:{click:function(t){e.api&&e.api.remTable()}}}],plugins:[{ptype:"menuexpand"}]}},{xtype:"menuseparator"},s,o,{xtype:"menuseparator"},a,{xtype:"menuseparator"},f,S,M,y,E],plugins:[{ptype:"menuexpand"}]}),e.pictureMenu=Ext.widget("menu",{showSeparator:!1,bodyCls:"no-icons",listeners:{hide:function(t,n){e.fireEvent("editcomplete",e),e.currentMenu=null}},initMenu:function(t){e.api&&(T.setDisabled(!e.api.canUnGroup()),x.setDisabled(!e.api.canGroup()));var n=t.imgProps!==undefined&&t.imgProps.locked,r=t.shapeProps!==undefined&&t.shapeProps.locked,i=t.chartProps!==undefined&&t.chartProps.locked,s=n||r||i||t.slideProps!==undefined&&t.slideProps.locked;A.setVisible(t.shapeProps===undefined&&t.chartProps===undefined),A.isVisible()&&A.setDisabled(s||t.imgProps.value.get_ImageUrl()===null||t.imgProps.value.get_ImageUrl()===undefined),l.setVisible(t.shapeProps===undefined&&t.chartProps===undefined),c.setVisible(t.imgProps===undefined&&t.chartProps===undefined),L.setVisible(l.isVisible()||c.isVisible()),D.setVisible(e.api.can_AddQuotedComment()!==!1&&e.mode.canCoAuthoring),_.setVisible(D.isVisible()),D.setDisabled(s),N.setDisabled(s),C.setDisabled(s),l.setDisabled(s),c.setDisabled(s)},items:[N,C,L,A,l,c,_,D],plugins:[{ptype:"menuexpand"}]})},insertColumnLeftText:"To Left",insertColumnRightText:"To Right",deleteText:"Delete",deleteRowText:"Delete Row",deleteColumnText:"Delete Column",deleteTableText:"Delete Table",mergeCellsText:"Merge Cells",splitCellsText:"Split Cell...",splitCellTitleText:"Split Cell",originalSizeText:"Default Size",advancedImageText:"Image Advanced Settings",hyperlinkText:"Hyperlink",editHyperlinkText:"Edit Hyperlink",removeHyperlinkText:"Remove Hyperlink",txtPressLink:"Press CTRL and click link",selectText:"Select",insertRowText:"Insert Row",insertColumnText:"Insert Column",rowText:"Row",columnText:"Column",cellText:"Cell",tableText:"Table",aboveText:"Above",belowText:"Below",advancedTableText:"Table Advanced Settings",txtSelectAll:"Select All",txtNewSlide:"New Slide",txtDuplicateSlide:"Duplicate Slide",txtDeleteSlide:"Delete Slide",txtBackground:"Background",txtChangeLayout:"Change Layout",txtPreview:"Preview",textShapeAlignLeft:"Align Left",textShapeAlignRight:"Align Right",textShapeAlignCenter:"Align Center",textShapeAlignTop:"Align Top",textShapeAlignBottom:"Align Bottom",textShapeAlignMiddle:"Align Middle",textArrangeFront:"Bring To Front",textArrangeBack:"Send To Back",textArrangeForward:"Bring Forward",textArrangeBackward:"Send Backward",txtGroup:"Group",txtUngroup:"Ungroup",txtArrange:"Arrange",txtAlign:"Align",txtDistribHor:"Distribute Horizontally",txtDistribVert:"Distribute Vertically",txtSlide:"Slide",topCellText:"Align Top",centerCellText:"Align Center",bottomCellText:"Align Bottom",cellAlignText:"Cell Vertical Alignment",advancedShapeText:"Shape Advanced Settings",addCommentText:"Add Comment",vertAlignText:"Vertical Alignment",advancedParagraphText:"Text Advanced Settings"}),Ext.define("PE.view.DocumentPreview",{extend:"Ext.container.Container",alias:"widget.pedocumentpreview",layout:"fit",shadow:!1,floating:!0,toFrontOnShow:!0,hidden:!0,modal:!0,requires:["Ext.container.Container","Ext.button.Button","Ext.form.Label"],constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},listeners:{afterrender:function(){var e=this.floatParent;Ext.isDefined(e)&&e.addListener("resize",Ext.bind(this.resizePreview,this))},hide:function(e,t){this.controlsContainer.hide(),Ext.getCmp("pe-applicationUI").show(),this.api&&setTimeout(Ext.bind(function(){this.api.Resize();var e=Ext.getCmp("toolbar-combo-view-themes");e&&(e.doComponentLayout(),e.fillComboView(e.dataMenu.picker.getSelectedRec(),!0,!0),e.dataMenu.picker.updateScrollPane())},this),50),this.fireEvent("editcomplete",this)},show:function(e,t){this.controlsContainer.show(),this.controlsContainer.setPosition(0,this.getHeight()-this._ControlPanelHeight);var n=this.btnPlay.getEl().down(".asc-slide-preview-btn");n.hasCls("btn-play")&&(n.removeCls("btn-play"),n.addCls("btn-pause"),this.btnPlay.getEl().set({"data-qtip":this.txtPause,"data-qalign":"bl-tl?"})),this.fireEvent("editcomplete",this)}},initComponent:function(){var e=this;e.btnPrev=Ext.create("Ext.button.Button",{iconCls:"asc-slide-preview-btn btn-prev",listeners:{click:function(){e.api&&e.api.DemonstrationPrevSlide()},render:function(t){t.getEl().set({"data-qtip":e.txtPrev,"data-qalign":"bl-tl?"})}}}),e.btnNext=Ext.create("Ext.button.Button",{iconCls:"asc-slide-preview-btn btn-next",listeners:{click:function(){e.api&&e.api.DemonstrationNextSlide()},render:function(t){t.getEl().set({"data-qtip":e.txtNext,"data-qalign":"bl-tl?"})}}}),e.btnClose=Ext.create("Ext.button.Button",{iconCls:"asc-slide-preview-btn btn-close",listeners:{click:function(){e.api&&e.api.EndDemonstration()},render:function(t){t.getEl().set({"data-qtip":e.txtClose,"data-qalign":"bl-tl?"})}}}),e.btnPlay=Ext.create("Ext.button.Button",{iconCls:"asc-slide-preview-btn btn-play",listeners:{click:function(){var t=e.btnPlay.getEl().down(".asc-slide-preview-btn");t.hasCls("btn-play")?(t.removeCls("btn-play"),t.addCls("btn-pause"),e.btnPlay.getEl().set({"data-qtip":e.txtPause,"data-qalign":"bl-tl?"}),e.api&&e.api.DemonstrationPlay()):t.hasCls("btn-pause")&&(t.removeCls("btn-pause"),t.addCls("btn-play"),e.btnPlay.getEl().set({"data-qtip":e.txtPlay,"data-qalign":"bl-tl?"}),e.api&&e.api.DemonstrationPause())},render:function(t){t.getEl().set({"data-qtip":e.txtPlay,"data-qalign":"bl-tl?"})}}}),e.txtPages=Ext.widget("label",{cls:"preview-slides",listeners:{afterrender:Ext.bind(function(e){e.getEl().on("mousedown",s,this)},this)}});var t=Ext.widget("label",{text:e.goToSlideText}),n=Ext.widget("numberfield",{id:"preview-field-slide",width:40,minValue:1,maxValue:1e4,value:1,allowDecimals:!1,hideTrigger:!0,keyNavEnabled:!1,mouseWheelEnabled:!1,enableKeyEvents:!0,selectOnFocus:!0,listeners:{specialkey:function(t,r,i){if(r.getKey()==r.ENTER&&e.api){var s=n.getValue();Ext.isNumber(s)&&(s>n.maxValue&&(s=n.maxValue),s<n.minValue&&(s=n.minValue),n.setValue(s),n.selectText(),e.api.DemonstrationGoToSlide(s-1))}}}}),r=20,i=7;e.menuGoToPage=Ext.widget("menu",{id:"preview-menu-slide",autoHeight:!0,autoWidth:!0,plain:!0,items:[{xtype:"container",cls:"pe-documentstatusinfo-menu-inner",layout:{type:"hbox",align:"middle",padding:r/2+"px "+r+"px"},items:[t,{xtype:"tbspacer",width:i},n],listeners:{afterrender:function(e){var s=t.getWidth();e.getEl().setWidth(i+2*r+s+n.getWidth())}}}],listeners:{show:function(t){e.api&&(n.setValue(e.api.getCurrentPage()+1),n.focus(!0,300))}}});var s=function(){e.menuGoToPage.show(),e.menuGoToPage.showBy(e.txtPages,"bl-tl",[0,-10])};e.onCountSlides=function(e){n.setMinValue(e>0?1:0),n.setMaxValue(e)},e.onDemonstrationSlideChanged=function(t){if(e.api&&Ext.isNumber(t)){var r=e.api.getCountPages();e.txtPages.setText(Ext.String.format(e.slideIndexText,t+1,r)),e.btnPrev.setDisabled(t<=0),e.btnNext.setDisabled(t>=r-1),n.setValue(t+1);var i=e.txtPages.getWidth();e._PagesPanelSize!==i&&(e.controlsContainer.setWidth(e._ControlPanelWidth+i),e._PagesPanelSize=i),e.controlsContainer.doLayout()}},e.items=[{xtype:"container",id:"presentation-preview",listeners:{resize:function(e,t,n,r){this.api&&setTimeout(Ext.bind(function(){this.api.Resize()},this),50)},scope:this}}],this.controlsContainer=Ext.create("Ext.container.Container",{id:"preview-controls-panel",cls:"pe-documentpreview",floating:!0,shadow:!1,toFrontOnShow:!0,layout:{type:"hbox",align:"middle"},height:e._ControlPanelHeight=35,width:e._ControlPanelWidth=122,items:[{xtype:"tbspacer",width:3},e.btnPrev,e.btnPlay,e.btnNext,{xtype:"tbseparator",width:2,height:"100%",style:"padding-top:8px; padding-bottom:8px;",html:'<div style="width: 100%; height: 100%; border-right: 1px solid #DADADA"></div>'},{xtype:"tbspacer",width:8},e.txtPages,{xtype:"tbspacer",width:8},{xtype:"tbseparator",width:6,height:"100%",style:"padding-top:8px; padding-bottom:8px;",html:'<div style="width: 100%; height: 100%; border-left: 1px solid #DADADA"></div>'},e.btnClose]}),this.addEvents("editcomplete"),this.callParent(arguments)},setApi:function(e){return this.api=e,this.api&&(this.api.asc_registerCallback("asc_onCountPages",Ext.bind(this.onCountSlides,this)),this.api.asc_registerCallback("asc_onEndDemonstration",Ext.bind(this.onEndDemonstration,this)),this.api.asc_registerCallback("asc_onDemonstrationSlideChanged",Ext.bind(this.onDemonstrationSlideChanged,this)),this.api.DemonstrationEndShowMessage(this.txtFinalMessage)),this},resizePreview:function(e,t,n,r){this.setSize(t,n),this.controlsContainer.setPosition(0,n-this._ControlPanelHeight),this.menuGoToPage.isVisible()&&this.menuGoToPage.showBy(this.txtPages,"bl-tl",[0,-10])},onEndDemonstration:function(){this.hide()},txtPrev:"Previous Slide",txtNext:"Next Slide",txtClose:"Close Preview",goToSlideText:"Go to Slide",slideIndexText:"Slide {0} of {1}",txtPlay:"Start Presentation",txtPause:"Pause Presentation",txtFinalMessage:"The end of slide preview. Click to exit."});var SCALE_MIN=40,SCALE_FULL="100%",SCALE_PART=250,MAINMENU_TOOLBAR_ID="mainmenu-toolbar-id",MAINMENU_PANEL_ID="mainmenu-panel-id",MAINMENU_FULL_PANEL_ID="mainmenu-full-panel-id";Ext.define("PE.view.MainMenu",{extend:"Ext.panel.Panel",alias:"widget.pemainmenu",requires:["Ext.toolbar.Toolbar","Ext.button.Button","Ext.container.Container","Ext.toolbar.Spacer"],cls:"lm-style",id:MAINMENU_PANEL_ID,bodyCls:"lm-body",width:SCALE_MIN,layout:"card",currentFullScaleMenuBtn:undefined,fullScaledItemCnt:undefined,buttonCollection:[],listeners:{afterrender:function(){var e=this.ownerCt;Ext.isDefined(e)&&e.addListener("resize",Ext.bind(this.resizeMenu,this))}},initComponent:function(){this.items=[],this.dockedItems=this.buildDockedItems(),this.slidesBtnVisible=!1,this.addEvents("panelshow","panelhide"),this.callParent(arguments)},buildDockedItems:function(){var e=[],t,n,r=this;for(var i=0;i<this.buttonCollection.length;i++)t=this.buttonCollection[i],n={xtype:"button",id:t.id,itemScale:t.scale,tooltip:t.tooltip,disabled:t.disabled===!0,toggleGroup:t.toggleGroup,cls:"asc-main-menu-buttons",iconCls:"asc-main-menu-btn "+t.cls,style:"margin-bottom: 8px;"},t.scale=="modal"?(n.enableToggle=!0,n.listeners=t.listeners,n.getApi=function(){return r.api}):(n.isFullScale=t.scale=="full",n.bodyItems=t.items,n.enableToggle=!0,n.listeners={click:function(e){e.pressed&&r.openButtonMenu(e)},toggle:function(e,t){e[t?"addCls":"removeCls"]("asc-main-menu-btn-selected");if(!t){r.fireEvent("panelbeforehide");if(e.isFullScale){Ext.isDefined(r.fullScaledItemCnt)&&r.fullScaledItemCnt.isVisible()&&(r.fullScaledItemCnt.hide(),r.currentFullScaleMenuBtn=undefined);var n=r.fullScaledItemCnt}else window.localStorage.setItem("pe-mainmenu-width",r.getWidth()),n=Ext.getCmp(e.bodyCardId),r.setWidth(SCALE_MIN);r.fireEvent("panelhide",n,e.isFullScale)}}}),e.push(n);return this.mainToolbar=Ext.create("Ext.toolbar.Toolbar",{cls:"lm-default-toolbar",width:this.width||SCALE_MIN,vertical:!0,dock:"left",defaultType:"button",items:e,style:"padding-top:15px;",listeners:{afterrender:function(e){e.getEl().on("keydown",r._onContainerKeyDown,r,{button:undefined})}}}),this.mainToolbar},closeFullScaleMenu:function(){Ext.isDefined(this.currentFullScaleMenuBtn)&&this.currentFullScaleMenuBtn.toggle(!1)},openButtonMenu:function(e){this.fireEvent("panelbeforeshow",e.isFullScale);if(Ext.isNumber(e.itemScale)){var t=window.localStorage.getItem("pe-mainmenu-width");t=t?parseInt(t):e.itemScale,this.setSize({width:t})}else this.setWidth(e.isFullScale?SCALE_MIN:SCALE_PART);if(e.isFullScale){var n=this.ownerCt.el,r=n.getXY(),i=this.fullScaledItemCnt;this.currentFullScaleMenuBtn=e,this.fullScaledItemCnt.setSize(n.getWidth()-SCALE_MIN,n.getHeight()),this.fullScaledItemCnt.setPosition(r[0]+this.width,r[1]),this.fullScaledItemCnt.show(),this.fullScaledItemCnt.getLayout().setActiveItem(Ext.getCmp(e.bodyCardId))}else i=Ext.getCmp(e.bodyCardId),this.getLayout().setActiveItem(e.bodyCardId);this.doComponentLayout(),this.fireEvent("panelshow",i,e.isFullScale),Common.component.Analytics.trackEvent("Main Menu",e.tooltip)},resizeMenu:function(e,t,n,r){if(Ext.isDefined(this.fullScaledItemCnt)&&this.fullScaledItemCnt.isVisible()){var i=this.ownerCt.el,s=i.getXY();this.fullScaledItemCnt.setSize(t-SCALE_MIN,n),this.fullScaledItemCnt.setPosition(s[0]+this.width,s[1])}else for(var o=0;o<this.items.length;o++)n!=this.items.items[o].getHeight()&&this.items.items[o].setHeight(n);this.doComponentLayout()},setApi:function(e){return this.api=e,this.api&&(this.api.asc_registerCallback("asc_onThumbnailsShow",Ext.bind(this.onThumbnailsShow,this)),this.api.asc_registerCallback("asc_onCoAuthoringChatReceiveMessage",Ext.bind(this.onCoAuthoringChatReceiveMessage,this)),this.api.asc_registerCallback("asc_onСoAuthoringDisconnect",Ext.bind(this.onCoAuthoringDisconnect,this)),this.api.asc_registerCallback("asc_onGetLicense",Ext.bind(this.onGetLicense,this)),this.api.asc_getLicense()),this},selectMenu:function(e,t){var n,r,i,s,o=this.mainToolbar;for(i=o.items.length;i>0;i--){n=o.items.items[i-1];if(!(!n.isVisible()||!n.iconCls||n.iconCls.search(e)<0))break;n=undefined}if(n&&!n.pressed){if(Ext.isDefined(o))for(i=0;i<o.items.length;i++)r=o.items.items[i],Ext.isDefined(r)&&r.componentCls==="x-btn"&&r.id!=n.id&&r.pressed&&(t===undefined||r.iconCls.search(t)<0)&&r.toggle(!1);n.toggle(!0),n.itemScale!="modal"&&this.openButtonMenu(n)}},clearSelection:function(e){var t,n,r=this.mainToolbar;if(Ext.isDefined(r))for(n=0;n<r.items.length;n++){t=r.items.items[n];if(Ext.isDefined(t)&&t.componentCls==="x-btn"&&t.pressed){if(e&&t.iconCls){var i=!1;for(var s=0;s<e.length;s++)if(!(t.iconCls.search(e[s])<0)){i=!0;break}if(i)continue}t.toggle(!1)}}},disableMenu:function(e,t){var n,r,i=this.mainToolbar;if(Ext.isDefined(i)){var s=!1;typeof e=="string"&&(e=="all"?s=!0:e=[e]);for(r=0;r<i.items.length;r++)n=i.items.items[r],Ext.isDefined(n)&&n.componentCls==="x-btn"&&(s||!(e.indexOf(n.id)<0))&&(n.pressed&&n.toggle(!1),n.setDisabled(t))}},onThumbnailsShow:function(e){e?this.selectMenu("menuSlides","menuSearch"):this.clearSelection(["menuSearch"]),this.slidesBtnVisible=e},selectThumbnailsBtn:function(e){var t,n,r=this.mainToolbar;for(n=r.items.length;n>0;n--){t=r.items.items[n-1];if(t.iconCls&&!(t.iconCls.search("menuSlides")<0)){t.toggle(e&&this.slidesBtnVisible,!0),this.api&&this.api.ShowThumbnails(e&&this.slidesBtnVisible);break}}},onCoAuthoringChatReceiveMessage:function(e){var t=Ext.getCmp("view-main-menu");if(t){var n=t.getLayout().getActiveItem().down("container");if(n){var r=Ext.getCmp("id-menu-chat");r&&(!n.isXType("commonchatpanel")||n.getWidth()<1)&&r.addCls("notify")}}},onCoAuthoringDisconnect:function(){this.disableMenu(["id-menu-comments","id-menu-chat"],!0)},onGetLicense:function(e){var t=Ext.getCmp("main-menu-about");t&&t.setLicInfo(e)},createDelayedElements:function(){var e=this;this.hkEsc=new Ext.util.KeyMap(document,[{key:Ext.EventObject.ESC,fn:function(t,n){Ext.isDefined(e.currentFullScaleMenuBtn)&&(n.stopPropagation(),n.preventDefault(),e.clearSelection(["menuSlides"]))}}]);var t=[],n=this.mainToolbar.items.items;for(var r=0;r<this.buttonCollection.length;r++){var i=this.buttonCollection[r],s=-1;if(i.scale=="modal")continue;if(i.scale!="full"){var o=Ext.create("Ext.container.Container",{items:i.items,menubutton:n[r],listeners:{afterrender:function(t){t.getEl().on("keydown",e._onContainerKeyDown,e,{button:t.menubutton})}}});n[r].bodyCardId=o.getId(),t.push(o)}else this.fullScaledItemCnt===undefined&&(this.fullScaledItemCnt=Ext.create("Ext.container.Container",{id:MAINMENU_FULL_PANEL_ID,layout:"card",shadow:!1,floating:!0,toFrontOnShow:!0,closeMenu:function(){e.closeFullScaleMenu()},getApi:function(){return e.api}})),n[r].bodyCardId=i.items[0].id,this.fullScaledItemCnt.add(i.items)}this.add(t)},_onContainerKeyDown:function(e,t,n){e.getKey()==e.ESC&&(n.button?n.button.toggle(!1):this.clearSelection(["menuSlides"]))}}),Ext.define("PE.view.Viewport",{extend:"Ext.container.Viewport",alias:"widget.peviewport",layout:"fit",requires:["Common.view.Header","PE.view.DocumentHolder","PE.view.MainMenu","PE.view.File","PE.view.DocumentStatusInfo","PE.view.DocumentPreview","Common.view.ChatPanel"],uses:["PE.view.Toolbar","PE.view.RightMenu","PE.view.CreateFile","PE.view.RecentFiles","Common.view.CommentsPanel"],initComponent:function(){this.header=Ext.widget("commonheader",{config:{headerCaption:"Presentation Editor"}}),this._documentHolder=Ext.widget("pedocumentholder",{id:"editor_sdk",flex:1,maintainFlex:!0,style:"background-color:#b0b0b0;"}),this.applicationUI=Ext.widget("container",{id:"pe-applicationUI",layout:{type:"vbox",align:"stretch"},flex:1,hidden:!0,hideMode:"offsets",items:[{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"pemainmenu",id:"view-main-menu",maxWidth:600,buttonCollection:[{cls:"menuFile",id:"id-menu-file",tooltip:this.tipFile+" (Alt+F)",scale:"full",disabled:!0,toggleGroup:"tbMainMenu",items:[{xtype:"pefile",id:"main-menu-file-options",width:"100%",height:"100%"}]},{cls:"menuSearch",scale:"modal",id:"main-menu-search",disabled:!0,tooltip:this.tipSearch+" (Ctrl+F)"},{cls:"menuSlides",id:"main-menu-slides",scale:"modal",tooltip:this.tipSlides,disabled:!0,listeners:{click:Ext.Function.bind(function(e){var t=Ext.getCmp("view-main-menu");t.slidesBtnVisible=e.pressed,e.pressed&&t.clearSelection(["menuSlides","menuSearch"])}),toggle:function(e,t){var n=e.getApi();n&&n.ShowThumbnails(t)}}},{cls:"menuComments",id:"id-menu-comments",hideMode:"display",scale:300,tooltip:this.tipComments+" (Ctrl+Shift+H)",toggleGroup:"tbMainMenu",disabled:!0,items:[{xtype:"commoncommentspanel",noQuotes:!0,height:"100%"}]},{cls:"menuChat",id:"id-menu-chat",scale:300,tooltip:this.tipChat+" (Ctrl+Alt+Q)",toggleGroup:"tbMainMenu",disabled:!0,items:[{xtype:"commonchatpanel",height:"100%"}]},{cls:"menuAbout",id:"id-menu-about",tooltip:"About",scale:"full",toggleGroup:"tbMainMenu",disabled:!0,items:[{xtype:"commonabout",id:"main-menu-about",width:"100%",height:"100%"}]}],listeners:{panelshow:Ext.bind(function(e,t){if(t){var n=Ext.getCmp("main-menu-search");n.pressed&&n.toggle()}var r=Ext.getCmp("view-main-menu");r.selectThumbnailsBtn(!1),t||this._documentHolder.changePosition()},this),panelhide:Ext.bind(function(e,t){var n=Ext.getCmp("view-main-menu");n.selectThumbnailsBtn(!0),t||this._documentHolder.changePosition()},this)}},{xtype:"splitter",id:"main-menu-splitter",cls:"splitter-document-area",defaultSplitMin:300,hidden:!0},{xtype:"container",flex:1,maintainFlex:!0,layout:{type:"vbox",align:"stretch"},items:[this._documentHolder]}]},this._documentStatus=Ext.widget("documentstatusinfo",{id:"view-status"})]}),this.items={xtype:"container",layout:{type:"vbox",align:"stretch"},items:[{id:"pe-preview",xtype:"pedocumentpreview"},this.header,this.applicationUI]},this.callParent(arguments)},checkCanHotKey:function(){var e=Ext.getDoc().query(".x-window");for(var t=0;t<e.length;t++){var n=Ext.getCmp(e[t].id);if(n&&n.isVisible()&&n.modal)return!1}return!0},applyMode:function(){this.hkSaveAs[this.mode.canDownload?"enable":"disable"](),this.hkCoAuth[this.mode.canCoAuthoring?"enable":"disable"](),this.hkComments[this.mode.canCoAuthoring&&this.mode.isEdit?"enable":"disable"]()},setMode:function(e,t){e.isDisconnected?(this.mode===undefined&&(this.mode={}),this.mode.canCoAuthoring=!1):this.mode=e,t||this.applyMode()},setApi:function(e){return this.api=e,this},applyEditorMode:function(){var e=this;e._toolbar=Ext.widget("petoolbar",{id:"view-toolbar"}),e.applicationUI.insert(0,e._toolbar),e._rightMenu=Ext.widget("perightmenu",{id:"view-right-menu"}),e.applicationUI.items.items[1].add(e._rightMenu);var t=window.localStorage.getItem("pe-hidden-status");t!==null&&parseInt(t)==1&&this._documentStatus.setVisible(!1)},createDelayedElements:function(){var e=this;this.hk=new Ext.util.KeyMap(document,[{key:"f",ctrl:!0,shift:!1,defaultEventAction:"stopEvent",fn:function(t,n){var r=Ext.getCmp("pe-preview");if(r&&r.isVisible())return;e.checkCanHotKey()&&(r=Ext.getCmp("view-main-menu"),r&&r.selectMenu("menuSearch","menuSlides"))}},{key:"f",alt:!0,defaultEventAction:"stopEvent",fn:function(t,n){var r=Ext.getCmp("pe-preview");if(r&&r.isVisible())return;e.checkCanHotKey()&&(Ext.menu.Manager.hideAll(),r=Ext.getCmp("view-main-menu"),r&&r.selectMenu("menuFile","menuSlides"))}}]),this.hkSaveAs=new Ext.util.KeyMap(document,{key:"s",ctrl:!0,shift:!0,defaultEventAction:"stopEvent",fn:function(t,n){var r=Ext.getCmp("pe-preview");if(r&&r.isVisible())return;e.checkCanHotKey()&&(Ext.menu.Manager.hideAll(),r=Ext.getCmp("view-main-menu"),r&&r.selectMenu("menuFile","menuSlides"))}}),this.hkHelp=new Ext.util.KeyMap(document,{key:Ext.EventObject.F1,ctrl:!1,shift:!1,defaultEventAction:"stopEvent",scope:this,fn:function(){var t=Ext.getCmp("pe-preview");if(t&&t.isVisible())return;e.checkCanHotKey()&&(Ext.menu.Manager.hideAll(),t=Ext.getCmp("view-main-menu"),t&&t.selectMenu("menuFile","menuSlides"))}}),this.hkCoAuth=new Ext.util.KeyMap(document,[{key:"q",ctrl:!0,alt:!0,defaultEventAction:"stopEvent",fn:function(t,n){var r=Ext.getCmp("pe-preview");if(r&&r.isVisible())return;e.checkCanHotKey()&&(r=Ext.getCmp("view-main-menu"),r&&r.selectMenu("menuChat"))}}]),this.hkComments=new Ext.util.KeyMap(document,{key:"H",ctrl:!0,shift:!0,defaultEventAction:"stopEvent",fn:function(){if(e.checkCanHotKey()){var t=Ext.getCmp("view-main-menu");t&&t.selectMenu("menuComments")}}}),Ext.tip.QuickTipManager.init(),this.applyMode()},tipFile:"File",tipTitles:"Titles",tipSlides:"Slides",tipSearch:"Search",tipChat:"Chat",tipComments:"Comments"}),Ext.define("PE.model.FileTemplate",{extend:"Ext.data.Model",fields:[{type:"string",name:"name"},{type:"string",name:"icon"}]}),Ext.define("PE.model.RecentFile",{extend:"Ext.data.Model",fields:[{type:"int",name:"type"},{type:"string",name:"title"},{type:"string",name:"url"},{type:"string",name:"folder"}]}),Ext.define("PE.store.FileTemplates",{extend:"Ext.data.Store",model:"PE.model.FileTemplate"}),Ext.define("PE.store.RecentFiles",{extend:"Ext.data.Store",model:"PE.model.RecentFile"}),Ext.define("PE.controller.CreateFile",{extend:"Ext.app.Controller",views:["CreateFile"],stores:["FileTemplates"],refs:[{ref:"filePanel",selector:"pefile"}],init:function(){Common.Gateway.on("init",Ext.bind(this.loadConfig,this)),this.control({pecreatenew:{afterrender:Ext.bind(this.onRenderView,this,{single:!0})},"pecreatenew dataview":{itemclick:this.onTemplateClick}})},applyConfig:function(e){if(e){this.createUrl=e.createUrl,this.nativeApp=e.nativeApp;var t=this.getFileTemplatesStore();t&&e.templates&&(t.removeAll(),t.add(e.templates))}},loadConfig:function(e){if(e&&e.config){this.createUrl=e.config.createUrl,this.nativeApp=e.config.nativeApp;var t=this.getFileTemplatesStore();t&&e.config.templates&&(t.removeAll(),t.add(e.config.templates))}},onRenderView:function(){var e=Ext.fly("id-create-blank-document");e&&(e.addClsOnOver("over"),e.on("click",this.onBlankDocClick,this))},setApi:function(e){return this.api=e,this},onBlankDocClick:function(e,t){var n=this.getFilePanel();n&&n.closeMenu();if(this.nativeApp===!0)this.api&&this.api.OpenNewDocument();else if(Ext.isEmpty(this.createUrl))Ext.MessageBox.show({title:this.textError,msg:this.textCanNotCreateNewDoc,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR,width:300});else{var r=window.open(Ext.String.format("{0}?title={1}&action=create&doctype=presentation",this.createUrl,this.newDocumentTitle));r&&r.focus(),Common.component.Analytics.trackEvent("Create New","Blank")}},onTemplateClick:function(e,t,n,r,i){var s=this.getFilePanel();s&&s.closeMenu();if(this.nativeApp===!0)this.api&&this.api.OpenNewDocument(t.data.name);else{var o=window.open(Ext.String.format("{0}?title={1}&template={2}&action=create&doctype=presentation",this.createUrl,this.newDocumentTitle,t.data.name));o&&o.focus()}Common.component.Analytics.trackEvent("Create New")},newDocumentTitle:"Unnamed presentation",textError:"Error",textCanNotCreateNewDoc:"Can not create a new presentation. Address to create a document is not configured."}),Ext.define("PE.controller.RecentFiles",{extend:"Ext.app.Controller",views:["RecentFiles"],stores:["RecentFiles"],refs:[{ref:"filePanel",selector:"pefile"}],init:function(){this.control({"perecentfiles dataview":{itemclick:this.onRecentFileClick}})},loadConfig:function(e){var t=this.getRecentFilesStore();t&&e&&e.config&&e.config.recent&&(t.removeAll(),t.add(e.config.recent))},onRecentFileClick:function(e,t,n,r,i){var s=this.getFilePanel();s&&s.closeMenu();var o=window.open(t.data.url);o&&o.focus(),Common.component.Analytics.trackEvent("Open Recent")}}),Ext.define("PE.controller.Search",{extend:"Ext.app.Controller",refs:[{ref:"searchQuery",selector:"#search-dialog-text-search"},{ref:"searchDialog",selector:"commonsearchdialog"}],init:function(){var e=this;this.control({"pemainmenu #main-menu-search":{toggle:this._showSearchDialog},"commonsearchdialog  button[group=search-text]":{click:function(e){this._startSearch(e.direction)}},"#search-dialog-text-search":{searchstart:function(e,t){this._startSearch("next"),e.stopSearch(!0)}}})},setApi:function(e){this.api=e},setMode:function(e){this.mode=e,this._frmSearch&&this._frmSearch.setViewMode(!this.mode.isEdit)},_startSearch:function(e){if(this.api&&this.getSearchQuery().isValueValid()){var t=this.getSearchDialog().getSettings();this.api.findText(t.textsearch,e=="next")||Ext.Msg.alert(this.textSearch,this.textNoTextFound)}},_showSearchDialog:function(e,t){var n=Ext.getCmp("view-main-menu");if(t){n.closeFullScaleMenu();var r=this;r._frmSearch||(r._frmSearch=Ext.create("Common.view.SearchDialog",{animateTarget:"main-menu-search",closeAction:"hide",simplesearch:!0,isViewMode:!0}),r._frmSearch.addListener("hide",function(t,r){e.ownrise||(e.ownrise=!0,e.toggle(!1),Ext.isDefined(n.currentFullScaleMenuBtn)||n.fireEvent("editcomplete",n)),e.ownrise=!1})),r._frmSearch.show()}else this._frmSearch&&!e.ownrise&&(e.ownrise=!0,this._frmSearch.hide(),Ext.isDefined(n.currentFullScaleMenuBtn)||n.fireEvent("editcomplete",n))},textSearch:"Search",textNoTextFound:"Text not found"}),Ext.define("PE.controller.DocumentHolder",{extend:"Ext.app.Controller",views:["DocumentHolder"],refs:[{ref:"splitterMainMenu",selector:"#main-menu-splitter"},{ref:"mainCanvas",selector:"#id-main"}],init:function(){this.control({"#view-main-menu":{panelbeforeshow:function(e){this._isMenuHided=!0,e!==!0&&this.getSplitterMainMenu().show()},panelbeforehide:function(){this._isMenuHided=!0},panelshow:function(e,t){this._isMenuHided=!1,!t},panelhide:function(e,t){this._isMenuHided=!1,this.getSplitterMainMenu().hide()}},"#main-menu-splitter":{beforedragstart:function(e,t){return!t.currentTarget.disabled},move:this._onDocumentSplitterMove},"menuitem[group=popupparagraphvalign]":{click:this._onParagraphVAlign}})},setApi:function(e){return this.api=e,this},_onDocumentSplitterMove:function(e,t,n){if(this._isMenuHided)return;var r,i=e.up("container").down("pemainmenu").getWidth();i>40&&(i-=40,Ext.ComponentQuery.query("dataview[group=scrollable]").forEach(function(e){var t=e.getNodes();for(var n in t)t[n].style.width=i+"px";e.getEl().setWidth(i),r=e.getEl().down(".jspContainer"),r&&(r.setWidth(i),e.getEl().down(".jspPane").setWidth(i))}))},_onParagraphVAlign:function(e,t){var n=new CAscShapeProp;n.put_VerticalTextAlign(e.valign),this.api.ShapeApply(n)}});var ApplyEditRights=-255,LoadingDocument=-256;Ext.define("PE.controller.Main",{extend:"Ext.app.Controller",uses:["Common.component.LoadMask","Ext.window.MessageBox","Ext.util.Cookies","PE.controller.Search"],views:["Common.view.Header","DocumentHolder","DocumentInfo"],stores:["Common.store.Users"],refs:[{ref:"header",selector:"commonheader"},{ref:"statusInfo",selector:"documentstatusinfo"},{ref:"mainMenu",selector:"pemainmenu"},{ref:"fileMenu",selector:"pefile"},{ref:"documentHolder",selector:"pedocumentholder"},{ref:"viewport",selector:"peviewport"},{ref:"rightPanel",selector:"perightpanel"},{ref:"rightMenu",selector:"perightmenu"},{ref:"documentInfo",selector:"pedocumentinfo"},{ref:"documentHelp",selector:"pedocumenthelp"},{ref:"documentPreview",selector:"pedocumentpreview"},{ref:"toolbar",selector:"petoolbar"},{ref:"documentSettings",selector:"pedocumentsettings"},{ref:"chatPanel",selector:"commonchatpanel"}],init:function(){this.getController("DocumentHolder").init(),Ext.isSafari&&/version\/7/.test(Ext.userAgent)&&Ext.getBody().on("mousewheel",function(e){e.stopEvent()},this),this.control({pedocumentholder:{resize:this.onDocumentHolderResize},pefile:{editdocument:this.requestEditRights},pemainmenu:{panelshow:function(e,t){if(this.api)if(t)this.fullscalemenu=!0,this.api.asc_enableKeyEvents(!1);else if(!Ext.isEmpty(e.query("commonchatpanel"))){Ext.defer(function(){Ext.getCmp("id-chat-textarea").focus()},100);var n=Ext.getCmp("id-menu-chat");n&&n.removeCls("notify"),this.api.asc_enableKeyEvents(!1)}else Ext.isEmpty(e.query("commoncommentspanel"))||(!this.isLiveCommenting,this.onEditComplete())},panelhide:function(e,t){this.api&&(!this.isLiveCommenting,t&&(this.fullscalemenu=!1),this.onEditComplete())}},petoolbar:{inserttable:this.onInsertTable,insertimage:this.onInsertImage,insertshape:this.onInsertShape},pedocumentsettings:{savedocsettings:function(){},changemeasureunit:function(){var e=window.localStorage.getItem("pe-settings-unit");Common.MetricSettings.setCurrentMetric(e!==null?parseInt(e):Common.MetricSettings.c_MetricUnits.cm),this.getRightPanel().updateMetricUnit()}}})},onLaunch:function(){window.storagename="presentation",this.stackLongActions=new Common.IrregularStack({strongCompare:function(e,t){return e.id===t.id&&e.type===t.type},weakCompare:function(e,t){return e.type===t.type}});if(typeof isBrowserSupported!="undefined"&&!isBrowserSupported()){Common.Gateway.reportError(undefined,this.unsupportedBrowserErrorText);return}var e=this.getViewport();if(!e)throw Error("PE.controller.Main failed: could not get Viewport.");e.applicationUI.setVisible(!0),this.api=new asc_docs_api("editor_sdk"),this.api.CreateComponents(),this.api.SetDrawingFreeze(!0),this.api.SetFontsPath("../../../sdk/Fonts/"),this.api.SetThemesPath("../../../sdk/PowerPoint/themes/"),this.api.Init(),this.api.asc_registerCallback("asc_onError",Ext.bind(this.onError,this)),this.api.asc_registerCallback("asc_onDocumentContentReady",Ext.bind(this.onDocumentContentReady,this)),this.api.asc_registerCallback("asc_onOpenDocumentProgress2",Ext.bind(this.onOpenDocument,this)),this.api.asc_registerCallback("asc_onThumbnailsShow",Ext.bind(this.onThumbnailsShow,this)),this.getStatusInfo().setApi(this.api).addListener("editcomplete",this.onEditComplete,this),this.editorConfig={},Common.Gateway.on("init",Ext.bind(this.loadConfig,this)),Common.Gateway.on("showmessage",Ext.bind(this.onExternalMessage,this)),Common.Gateway.on("opendocument",Ext.bind(this.loadDocument,this)),Common.Gateway.ready(),this.initNames(),this.recognizeBrowser(),Ext.isIE=Common.userAgent.isIE,Ext.isIE9=Common.userAgent.ieVersion==9},bindComponent:function(e){var t=Ext.ComponentQuery.query(e);for(var n=0;n<t.length;++n)t[n].addListener("editcomplete",this.onEditComplete,this)},loadConfig:function(e){this.editorConfig=Ext.merge(this.editorConfig,e.config);if(this.editorConfig.user===undefined||this.editorConfig.user===null){this.editorConfig.user={};if(this.editorConfig.users){this.editorConfig.userId=this.editorConfig.userId||0;for(var t=0;t<this.editorConfig.users.length;t++)if(this.editorConfig.users[t].id===this.editorConfig.userId){this.editorConfig.user={id:this.editorConfig.users[t].id,name:this.editorConfig.users[t].username};break}}}this.editorConfig.user.id=this.editorConfig.user.id||"uid-"+Ext.Date.now(),this.editorConfig.user.name=this.editorConfig.user.name||this.textAnonymous,this.getHeader().setCanBack(this.editorConfig.canBackToFolder===!0),this.editorConfig.lang&&this.api.asc_setLocale(this.editorConfig.lang)},applyModeCommonElements:function(){window.editor_elements_prepared=!0;var e={canDownload:this.editorConfig.nativeApp!==!0&&(this.permissions.download!==undefined?this.permissions.download:!0),canEdit:this.permissions.edit===!0,isEdit:this.modeEdit,canBack:this.editorConfig.nativeApp!==!0&&this.editorConfig.canBackToFolder===!0,canOpenRecent:this.editorConfig.nativeApp!==!0&&this.editorConfig.recent!==undefined,canCreateNew:!Ext.isEmpty(this.editorConfig.createUrl),nativeApp:this.editorConfig.nativeApp===!0,canCoAuthoring:this.editorConfig.canCoAuthoring===!0,user:this.editorConfig.user,canAutosave:this.canAutosave},t=window.localStorage.getItem("pe-hidden-title");t=this.modeEdit&&t!==null&&parseInt(t)==1,this.getHeader().setHeaderCaption(this.modeEdit?"Presentation Editor":"Presentation Viewer"),this.getHeader().setVisible(e.nativeApp!==!0&&!t),this.getViewport().setMode(e,!0),this.getDocumentHolder().setMode(e),this.getMainMenu().setVisible(!0),this.getStatusInfo().setDisabled(!1),this.getStatusInfo().setMode(e),this.getFileMenu()&&this.getFileMenu().setMode(e,!1);var n=Ext.getCmp("id-menu-comments"),r=Ext.getCmp("id-menu-chat");e.canCoAuthoring?(n[e.isEdit?"show":"hide"](),r.show()):(r.hide(),n.hide())},applyModeEditorElements:function(e){if(this.modeEdit){var t=this;window.editor_elements_prepared=!1;var n=function(){typeof Common.Locale!="undefined"&&Common.Locale.apply(),t.getStore("SlideLayouts"),t.getController("Common.controller.Fonts").init(),t.getController("Common.controller.Fonts").setApi(t.api),t.getController("PE.controller.Toolbar").init(),t.getController("PE.controller.Toolbar").setApi(t.api),t.getController("Common.controller.CommentsList").init(),t.getController("Common.controller.CommentsList").setConfig({config:t.editorConfig},t.api),t.getController("Common.controller.CommentsList").doDelayedTask(),t.getController("Common.controller.CommentsPopover").init(),t.getController("Common.controller.CommentsPopover").setConfig({config:t.editorConfig,movingtoplimit:-5},t.api),e=="view"&&(t.getController("Common.controller.CommentsList").onApiAddComments(t.api.asc_getComments()),t.getController("Common.controller.CommentsList").registerCallbacks(),t.getController("Common.controller.CommentsPopover").registerCallbacks()),t.getViewport().applyEditorMode();var n={canDownload:t.editorConfig.nativeApp!==!0&&(t.permissions.download!==undefined?t.permissions.download:!0),canEdit:t.permissions.edit===!0,isEdit:t.modeEdit,canBack:t.editorConfig.nativeApp!==!0&&t.editorConfig.canBackToFolder===!0,canOpenRecent:t.editorConfig.nativeApp!==!0&&t.editorConfig.recent!==undefined,canCreateNew:!Ext.isEmpty(t.editorConfig.createUrl),nativeApp:t.editorConfig.nativeApp===!0,canCoAuthoring:t.editorConfig.canCoAuthoring===!0};t.getToolbar().setApi(t.api).addListener("editcomplete",t.onEditComplete,t),t.getToolbar().setMode(n),t.getRightMenu().setApi(t.api).addListener("editcomplete",t.onEditComplete,t),t.getRightPanel().setApi(t.api).addListener("editcomplete",t.onEditComplete,t),t.getRightPanel().setMode(n),window.editor_elements_prepared=!0;var r=window.localStorage.getItem("pe-settings-unit");Common.MetricSettings.setCurrentMetric(r!==null?parseInt(r):Common.MetricSettings.c_MetricUnits.cm),t.api.asc_registerCallback("asc_onChangeObjectLock",Ext.bind(this._onChangeObjectLock,this)),t.api.asc_registerCallback("asc_onDocumentModifiedChanged",Ext.bind(t.onDocumentModifiedChanged,t)),t.api.asc_registerCallback("asc_onSaveUrl",Ext.bind(t.onSaveUrl,t)),t.api.asc_registerCallback("asc_onCollaborativeChanges",Ext.bind(t.onCollaborativeChanges,t)),t.getStatusInfo().setCaption(""),t.stackLongActions.exist({id:ApplyEditRights,type:c_oAscAsyncActionType.BlockInteraction})?t.onLongActionEnd(c_oAscAsyncActionType.BlockInteraction,ApplyEditRights):this._isDocReady||(t.hidePreloader(),t.onLongActionBegin(c_oAscAsyncActionType.BlockInteraction,LoadingDocument)),window.onbeforeunload=Ext.bind(t.onBeforeUnload,t)};this.getStatusInfo().setCaption(this.txtEditingMode),this.loadEditorStylesheets(n)}},loadDocument:function(e){var t=e.doc,n={};this.document=e.doc,this.permissions={},t&&(this.permissions=Ext.merge(this.permissions,t.permissions),n=new CDocInfo,n.put_Id(t.key),n.put_Url(t.url),n.put_Title(t.title),n.put_Format(t.fileType),n.put_VKey(t.vkey),n.put_Options(t.options),n.put_UserId(this.editorConfig.user.id),n.put_UserName(this.editorConfig.user.name),n.put_OfflineApp(this.editorConfig.nativeApp===!0)),this.api.asc_registerCallback("asc_onGetEditorPermissions",Ext.bind(this.onEditorPermissions,this)),this.api.asc_setDocInfo(n),this.api.asc_getEditorPermissions(),e.doc&&this.getHeader().setDocumentCaption(e.doc.title)},onEditorPermissions:function(e){this.permissions.edit!==!1&&(this.permissions.edit=e.asc_getCanEdit()),this.permissions.download!==!1&&(this.permissions.download=e.asc_getCanDownload()),this.modeEdit=this.permissions.edit===!0&&this.editorConfig.mode!=="view",this.canAutosave=e.asc_getIsAutosaveEnable()?e.asc_getAutosaveMinInterval():-1,this.editorConfig.canAutosave===!1&&(this.canAutosave=-1,this.api.asc_setAutoSaveGap(0)),this.editorConfig.canCoAuthoring!==!1&&(this.editorConfig.canCoAuthoring=e.asc_getCanCoAuthoring()),this.applyModeCommonElements(),this.applyModeEditorElements(),this.api.asc_setCoAuthoringEnable(this.editorConfig.canCoAuthoring===!0),this.api.SetViewMode(!this.modeEdit),this.api.LoadDocument(),this.modeEdit||(this.hidePreloader(),this.onLongActionBegin(c_oAscAsyncActionType.BlockInteraction,LoadingDocument))},onProcessSaveResult:function(e){this.api.asc_OnSaveEnd(e.result),e&&e.result===!1&&Ext.Msg.show({title:this.criticalErrorTitle,msg:Ext.isEmpty(e.message)?this.errorProcessSaveResult:e.message,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK})},onProcessRightsChange:function(e){e&&e.enabled===!1&&(this.api.asc_coAuthoringDisconnect(),this.getDocumentInfo().onLostEditRights(),Ext.Msg.show({title:this.notcriticalErrorTitle,msg:Ext.isEmpty(e.message)?this.warnProcessRightsChange:e.message,icon:Ext.Msg.WARNING,buttons:Ext.Msg.OK}))},goBack:function(){Common.Gateway.goBack()},onProcessMouse:function(e){if(e.type=="mouseup"){var t=document.getElementById("editor_sdk");if(t){var n=t.getBoundingClientRect();this.api.OnMouseUp(e.x-n.left,e.y-n.top)}}},onDocumentHolderResize:function(){this.api&&(this.api.Resize(),setTimeout(Ext.bind(function(){this.api.Resize()},this),50))},onEditComplete:function(e){this.getMainMenu().closeFullScaleMenu(),this.getDocumentHolder().blur(),this.getDocumentHolder().focus(!1,50)},onLongActionBegin:function(e,t){var n={id:t,type:e};this.stackLongActions.push(n),this.setLongActionView(n)},onLongActionEnd:function(e,t){var n={id:t,type:e};this.stackLongActions.pop(n),this.getHeader().setDocumentCaption(this.api.get_DocumentName()),this.updateWindowTitle(),n=this.stackLongActions.get({type:c_oAscAsyncActionType.Information}),n?this.setLongActionView(n):this.getStatusInfo().setCaption(""),n=this.stackLongActions.get({type:c_oAscAsyncActionType.BlockInteraction}),n?this.setLongActionView(n):this.loadMask&&(this.loadMask.hide(),this.onEditComplete(this.loadMask)),t==c_oAscAsyncAction["PrepareToSave"]&&(this.synchronizeChanges(),this.getController("Common.controller.CommentsPopover").setAutoPopup(!0)),this.api.asc_enableKeyEvents(!0)},setLongActionView:function(e){var t="",n="";switch(e.id){case c_oAscAsyncAction.Open:t=this.openTitleText,n=this.openTextText;break;case c_oAscAsyncAction.Save:t=this.saveTitleText,n=this.saveTextText;break;case c_oAscAsyncAction.LoadDocumentFonts:t=this.loadFontsTitleText,n=this.loadFontsTextText;break;case c_oAscAsyncAction.LoadDocumentImages:t=this.loadImagesTitleText,n=this.loadImagesTextText;break;case c_oAscAsyncAction.LoadFont:t=this.loadFontTitleText,n=this.loadFontTextText;break;case c_oAscAsyncAction.LoadImage:t=this.loadImageTitleText,n=this.loadImageTextText;break;case c_oAscAsyncAction.DownloadAs:t=this.downloadTitleText,n=this.downloadTextText;break;case c_oAscAsyncAction.Print:t=this.printTitleText,n=this.printTextText;break;case c_oAscAsyncAction.UploadImage:t=this.uploadImageTitleText,n=this.uploadImageTextText;break;case c_oAscAsyncAction.LoadTheme:t=this.loadThemeTitleText,n=this.loadThemeTextText;break;case c_oAscAsyncAction.ApplyChanges:t=this.applyChangesTitleText,n=this.applyChangesTextText;break;case c_oAscAsyncAction.PrepareToSave:this.getController("Common.controller.CommentsPopover").setAutoPopup(!1),t=this.savePreparingText,n=this.savePreparingTitle;break;case ApplyEditRights:t=this.txtEditingMode,n=this.txtEditingMode;break;case LoadingDocument:t=this.loadingDocumentTitleText,n=this.loadingDocumentTextText}e.type==c_oAscAsyncActionType["BlockInteraction"]?(this.loadMask||(this.loadMask=Ext.widget("cmdloadmask",Ext.getBody())),this.loadMask.setTitle(t),this.loadMask.show()):this.getStatusInfo().setCaption(n)},onError:function(e,t,n){this.hidePreloader(),this.onLongActionEnd(c_oAscAsyncActionType.BlockInteraction,LoadingDocument);var r={closable:!1};switch(e){case c_oAscError.ID.Unknown:r.msg=this.unknownErrorText;break;case c_oAscError.ID.ConvertationTimeout:r.msg=this.convertationTimeoutText;break;case c_oAscError.ID.ConvertationError:r.msg=this.convertationErrorText;break;case c_oAscError.ID.DownloadError:r.msg=this.downloadErrorText;break;case c_oAscError.ID.UplImageSize:r.msg=this.uploadImageSizeMessage;break;case c_oAscError.ID.UplImageExt:r.msg=this.uploadImageExtMessage;break;case c_oAscError.ID.UplImageFileCount:r.msg=this.uploadImageFileCountMessage;break;case c_oAscError.ID.SplitCellMaxRows:r.msg=this.splitMaxRowsErrorText.replace("%1",n.get_Value());break;case c_oAscError.ID.SplitCellMaxCols:r.msg=this.splitMaxColsErrorText.replace("%1",n.get_Value());break;case c_oAscError.ID.SplitCellRowsDivider:r.msg=this.splitDividerErrorText.replace("%1",n.get_Value());break;case c_oAscError.ID.VKeyEncrypt:r.msg=this.errorKeyEncrypt;break;case c_oAscError.ID.KeyExpire:r.msg=this.errorKeyExpire;break;case c_oAscError.ID.UserCountExceed:r.msg=this.errorUsersExceed;break;case c_oAscError.ID.CoAuthoringDisconnect:r.msg=this.errorCoAuthoringDisconnect;break;case c_oAscError.ID.ConvertationPassword:r.msg=this.errorFilePassProtect;break;default:r.msg=this.errorDefaultMessage.replace("%1",e)}t==c_oAscError.Level.Critical?(Common.Gateway.reportError(e,r.msg),r.title=this.criticalErrorTitle,r.icon=Ext.Msg.ERROR,this.editorConfig.canBackToFolder&&(r.msg+="<br/><br/>"+this.criticalErrorExtText+"<br/>&nbsp;",r.buttons=Ext.Msg.OK,r.fn=function(e){e=="ok"&&Common.Gateway.goBack()})):(r.title=this.notcriticalErrorTitle,r.icon=Ext.Msg.WARNING,r.buttons=Ext.Msg.OK,r.fn=Ext.bind(function(e){this.onEditComplete()},this)),Ext.Msg.show(r),Common.component.Analytics.trackEvent("Internal Error",e.toString())},onCoAuthoringDisconnect:function(){this.getFileMenu().setMode({isDisconnected:!0}),this.getViewport().setMode({isDisconnected:!0})},onExternalMessage:function(e){if(e){var t=e.msg.charAt(0).toUpperCase()+e.msg.substring(1),n=e.severity.indexOf("error")>=0?this.criticalErrorTitle:this.notcriticalErrorTitle;this.showTips([t],!1,n),Common.component.Analytics.trackEvent("External Error",e.title)}},onApplyEditRights:function(e){this.getStatusInfo().setCaption("");if(e)if(e.allowed){e.requestrights=!0,this.modeEdit=!0,this.onLongActionBegin(c_oAscAsyncActionType.BlockInteraction,ApplyEditRights);var t=this;setTimeout(function(){t.api.SetViewMode(!t.modeEdit),t.applyModeCommonElements(),t.applyModeEditorElements("view");var e=setInterval(function(){if(window.editor_elements_prepared){clearInterval(e),t.getViewport().applyMode(),t.getRightMenu().createDelayedElements(),t.getRightPanel().createDelayedElements(),t.getToolbar().createDelayedElements(),t.getController("PE.controller.Toolbar").createDelayedElements(),t.getController("Common.controller.Fonts").loadFonts(),t.getDocumentHolder().createDelayedElements(),t.getDocumentHolder().changePosition(),t.getController("PE.controller.Search").setMode({isEdit:t.modeEdit}),t.getController("Common.controller.CommentsPopover").onDocumentContentReady(),t.bindComponent.call(t,"peimagesettings"),t.bindComponent.call(t,"peparagraphsettings"),t.bindComponent.call(t,"petablesettings"),t.bindComponent.call(t,"peshapesettings"),t.bindComponent.call(t,"peslidesettings"),t.api.asc_registerCallback("asc_onFocusObject",Ext.bind(t.onFocusObject,t)),t.api.asc_registerCallback("asc_onUpdateLayout",Ext.bind(t.fillLayoutsStore,t)),t.api.asc_registerCallback("asc_onSendThemeColors",Ext.bind(t._onSendThemeColors,t));var n=t.api.get_PropertyEditorShapes();n&&t.fillAutoShapes(n[0],n[1]),t.api.UpdateInterfaceState()}},50)},100)}else Ext.Msg.show({title:this.requestEditFailedTitleText,msg:e.message||this.requestEditFailedMessageText,icon:Ext.Msg.INFO,buttons:Ext.Msg.OK})},onDocumentContentReady:function(){if(this._isDocReady)return;this._isDocReady=!0;var e=!0;window.editor_elements_prepared&&(this.api.SetDrawingFreeze(!1),this.onDocumentHolderResize(),this.hidePreloader(),this.onLongActionEnd(c_oAscAsyncActionType.BlockInteraction,LoadingDocument),e=!1);var t=window.localStorage.getItem("pe-settings-zoom"),n=t!==null?parseInt(t):-1;n==-1?this.api.zoomFitToPage():this.api.zoom(n);var r=this;setTimeout(function(){var t=[],n=Ext.fly(document.body.parentNode);Ext.isSafari&&/version\/7/.test(Ext.userAgent)&&n.addCls("safari-7"),Common.userAgent.ieVersion==9&&t.push(r.warnBrowserIE9),!Ext.isGecko&&Math.abs(r.getBrowseZoomLevel()-1)>.1&&t.push(r.warnBrowserZoom),t.length&&r.showTips(t),r.api.asc_registerCallback("asc_onStartAction",Ext.bind(r.onLongActionBegin,r)),r.api.asc_registerCallback("asc_onEndAction",Ext.bind(r.onLongActionEnd,r)),r.api.asc_registerCallback("asc_onСoAuthoringDisconnect",Ext.bind(r.onCoAuthoringDisconnect,r)),r.getHeader().setDocumentCaption(r.api.get_DocumentName()),r.updateWindowTitle();var i=window.localStorage.getItem("pe-settings-inputmode");r.api.SetTextBoxInputMode(i!==null&&parseInt(i)==1),i=window.localStorage.getItem("pe-settings-showchanges"),r.api.SetCollaborativeMarksShowType(i!==null&&parseInt(i)==0?c_oAscCollaborativeMarksShowType.All:c_oAscCollaborativeMarksShowType.LastChanges),r.getController("PE.controller.Search").init(),r.getController("PE.controller.Search").setApi(r.api),r.getController("PE.controller.Search").setMode({isEdit:r.modeEdit}),r.getController("Common.controller.Chat").init(),r.getController("Common.controller.Chat").setApi(r.api).loadConfig({config:r.editorConfig}),r.getController("RecentFiles").init(),r.getController("RecentFiles").loadConfig({config:r.editorConfig}),r.getController("CreateFile").init(),r.getController("CreateFile").setApi(r.api).applyConfig(r.editorConfig),r.getController("DocumentHolder").setApi(r.api),r.getViewport().createDelayedElements(),r.getStatusInfo().createDelayedElements(),r.getMainMenu().createDelayedElements(),r.getChatPanel().createDelayedElements();var s=setInterval(function(){if(window.editor_elements_prepared){clearInterval(s),e&&(r.api.SetDrawingFreeze(!1),r.onDocumentHolderResize(),r.hidePreloader(),r.onLongActionEnd(c_oAscAsyncActionType.BlockInteraction,LoadingDocument));var t={canDownload:r.editorConfig.nativeApp!==!0&&(r.permissions.download!==undefined?r.permissions.download:!0),canEdit:r.permissions.edit===!0,isEdit:r.modeEdit,canBack:r.editorConfig.nativeApp!==!0&&r.editorConfig.canBackToFolder===!0,canOpenRecent:r.editorConfig.nativeApp!==!0&&r.editorConfig.recent!==undefined,canCreateNew:!Ext.isEmpty(r.editorConfig.createUrl),nativeApp:r.editorConfig.nativeApp===!0,canCoAuthoring:r.editorConfig.canCoAuthoring===!0,user:r.editorConfig.user,canAutosave:r.canAutosave};t.isEdit&&(r.getToolbar().createDelayedElements(),r.getController("PE.controller.Toolbar").createDelayedElements(),r.getController("Common.controller.Fonts").loadFonts()),r.getFileMenu().loadConfig({config:r.editorConfig}),r.getFileMenu().loadDocument({doc:r.document}),r.getFileMenu().setMode(t,!0),r.getFileMenu().createDelayedElements(),r.getMainMenu().disableMenu("all",!1),r.getDocumentSettings().setApi(r.api).addListener("editcomplete",r.onEditComplete,r),r.getMainMenu().setApi(r.api).addListener("editcomplete",r.onEditComplete,r),r.isThumbnailsShow&&r.getMainMenu().onThumbnailsShow(r.isThumbnailsShow),r.getDocumentHolder().setApi(r.api).addListener("editcomplete",r.onEditComplete,r),r.getDocumentHolder().changePosition(),r.getViewport().setApi(r.api).addListener("editcomplete",r.onEditComplete,r),r.getDocumentPreview().setApi(r.api).addListener("editcomplete",r.onEditComplete,r),r.getDocumentInfo().loadConfig({config:r.editorConfig}),t.isEdit&&setTimeout(function(){r.getController("Common.controller.CommentsList").onApiAddComments(r.api.asc_getComments()),r.getController("Common.controller.CommentsList").registerCallbacks(),r.getController("Common.controller.CommentsPopover").registerCallbacks(),r.getController("Common.controller.CommentsPopover").onDocumentContentReady(),r.getDocumentHolder().createDelayedElements(),r.getRightMenu().createDelayedElements(),r.getRightPanel().createDelayedElements(),r.bindComponent.call(r,"peimagesettings"),r.bindComponent.call(r,"peparagraphsettings"),r.bindComponent.call(r,"petablesettings"),r.bindComponent.call(r,"peshapesettings"),r.bindComponent.call(r,"peslidesettings"),r.api.asc_registerCallback("asc_onFocusObject",Ext.bind(r.onFocusObject,r)),r.api.asc_registerCallback("asc_onUpdateLayout",Ext.bind(r.fillLayoutsStore,r)),r.api.asc_registerCallback("asc_onSendThemeColors",Ext.bind(r._onSendThemeColors,r));var e=r.api.get_PropertyEditorShapes();e&&r.fillAutoShapes(e[0],e[1]),r.api.UpdateInterfaceState()},50)}},50);r.canAutosave>-1&&(i=window.localStorage.getItem("pe-settings-autosave"),i=i!==null?parseInt(i):600,i>0&&r.canAutosave>i&&(i=r.canAutosave,window.localStorage.setItem("pe-settings-autosave",i)),r.api.asc_setAutoSaveGap(i)),Common.Gateway.on("applyeditrights",Ext.bind(r.onApplyEditRights,r)),Common.Gateway.on("processsaveresult",Ext.bind(r.onProcessSaveResult,r)),Common.Gateway.on("processrightschange",Ext.bind(r.onProcessRightsChange,r)),Common.Gateway.on("processmouse",Ext.bind(r.onProcessMouse,r)),Ext.getDoc().on("contextmenu",Ext.bind(r.onContextMenu,r)),Ext.FocusManager.enable(),Ext.FocusManager.addXTypeToWhitelist("button"),Ext.FocusManager.keyNav.disable(),Ext.FocusManager.addListener("componentfocus",function(e,t){var n=t instanceof Ext.form.field.Text;!n&&(n=this.fullscalemenu===!0),!n&&(n=$("body > .x-mask").filter(":visible").length>0),!n&&(n=$("body > .x-boundlist").filter(":visible").length>0);if(!n){var i=$("body > .x-menu").filter(":visible"),s=i.length;i.each(function(e,t){$(t).css("visibility")=="hidden"?s--:(t.style.left==="-10000px"||t.style.top==="-10000px")&&s--}),n=s>0}$("body > .pe-documentpreview").filter(":visible").length>0&&(n=!1),r.api.asc_enableKeyEvents(n==0)},this),Common.component.Analytics.initialize("UA-12442749-13","Presentation Editor")},50)},onDocumentModifiedChanged:function(){this.updateWindowTitle(),Common.Gateway.setDocumentModified(this.api.isDocumentModified())},onContextMenu:function(e,t){if(!(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||(new Boolean(t.getAttribute("data-can-copy"))).valueOf()))return e.stopEvent(),!1},onBeforeUnload:function(){if(this.api.isDocumentModified())return this.leavePageText},requestEditRights:function(){this.getStatusInfo().setCaption(this.requestEditRightsText),Common.Gateway.requestEditRights()},updateWindowTitle:function(){var e=this.defaultTitleText;this.getHeader().getDocumentCaption().length>0&&(e=this.getHeader().getDocumentCaption()+" - "+e),this.api.isDocumentModified()&&(e="* "+e),window.document.title!=e&&(window.document.title=e)},hidePreloader:function(){var e=Ext.fly("loading-mask");e&&(e.hide(),e.dom.parentNode.removeChild(e.dom))},onFocusObject:function(e){if(e.length>0){var t=this.getRightPanel(),n=this.getDocumentPreview();t&&!n.isVisible()&&t.onFocusObject.call(t,e)}},_onChangeObjectLock:function(){var e=this.api.getSelectedElements();this.onFocusObject(e),this.getController("PE.controller.Toolbar")._onFocusObject(e)},onSaveUrl:function(e){Common.Gateway.save(e)},onOpenDocument:function(e){var t=document.getElementById("loadmask-text");t?t.innerHTML=this.textLoadingDocument+": "+Ext.util.Format.round(e,0)+"%":this.loadMask&&this.loadMask.setTitle(this.loadingDocumentTitleText+": "+Ext.util.Format.round(e,0)+"%")},fillUserStore:function(e){if(!Ext.isEmpty(e)){var t=this.getCommonStoreUsersStore();t&&t.add(e)}},getBrowseZoomLevel:function(){if(Common.userAgent.isIE)return screen.logicalXDPI/screen.deviceXDPI;var e=window.outerWidth/document.documentElement.clientWidth;return Ext.isSafari&&(e=Math.floor(e*10)/10),e},showTips:function(e,t,n){function i(){var t=e.shift();if(t){s.update(t);if(r){s.show();var n=s.getEl().getAlignToXY(r,"t-b?");n[1]+=10,s.showAt(n)}}else s.destroy()}if(!e.length)return;typeof e!="object"&&(e=[e]);var r=Ext.ComponentQuery.query("petoolbar");!r.length&&(r=Ext.select(".common-header").first())||(r=r[0].getEl());var s=Ext.create("Ext.tip.ToolTip",{closable:!0,title:Ext.isDefined(n)?n:this.notcriticalErrorTitle,maxWidth:800,minWidth:200,style:"white-space: nowrap;",autoHide:Ext.isDefined(t)?t:!0,listeners:{beforehide:function(e){setTimeout(i,200)},show:function(e){e.getEl().setStyle("z-index","20003")}}});i()},initNames:function(){this.layoutNames=[this.txtSldLtTBlank,this.txtSldLtTChart,this.txtSldLtTChartAndTx,this.txtSldLtTClipArtAndTx,this.txtSldLtTClipArtAndVertTx,this.txtSldLtTCust,this.txtSldLtTDgm,this.txtSldLtTFourObj,this.txtSldLtTMediaAndTx,this.txtSldLtTObj,this.txtSldLtTObjAndTwoObj,this.txtSldLtTObjAndTx,this.txtSldLtTObjOnly,this.txtSldLtTObjOverTx,this.txtSldLtTObjTx,this.txtSldLtTPicTx,this.txtSldLtTSecHead,this.txtSldLtTTbl,this.txtSldLtTTitle,this.txtSldLtTTitleOnly,this.txtSldLtTTwoColTx,this.txtSldLtTTwoObj,this.txtSldLtTTwoObjAndObj,this.txtSldLtTTwoObjAndTx,this.txtSldLtTTwoObjOverTx,this.txtSldLtTTwoTxTwoObj,this.txtSldLtTTx,this.txtSldLtTTxAndChart,this.txtSldLtTTxAndClipArt,this.txtSldLtTTxAndMedia,this.txtSldLtTTxAndObj,this.txtSldLtTTxAndTwoObj,this.txtSldLtTTxOverObj,this.txtSldLtTVertTitleAndTx,this.txtSldLtTVertTitleAndTxOverChart,this.txtSldLtTVertTx],this.shapeGroupNames=[this.txtBasicShapes,this.txtFiguredArrows,this.txtMath,this.txtCharts,this.txtStarsRibbons,this.txtCallouts,this.txtButtons,this.txtRectangles,this.txtLines],this.ThemeValues=[6,15,7,16,0,1,2,3,4,5]},fillLayoutsStore:function(e){var t=this;if(!Ext.isEmpty(e)){var n=this.getStore("SlideLayouts");if(n){n.removeAll();var r=[];Ext.each(e,function(e){var n=e.get_Name();r.push({imageUrl:e.get_Image(),title:n!==""?n:t.layoutNames[e.getType()],itemWidth:e.get_Width(),itemHeight:e.get_Height(),data:{type:e.getType(),idx:e.getIndex()}})}),n.add(r)}}},fillAutoShapes:function(e,t){if(Ext.isEmpty(t)||Ext.isEmpty(e)||t.length!=e.length)return;var n=this,r=[],i=this.getStore("ShapeGroups");i.removeAll();var s=e.length;Ext.each(e,function(e,i){var s=Ext.create("Ext.data.Store",{model:"PE.model.ShapeModel"}),o=t[i].length>18?7:6,u=Math.ceil(t[i].length/o)*35+3,a=30*o;Ext.each(t[i],function(e){s.add({imageUrl:e.Image,data:{shapeType:e.Type}})}),r.push({groupName:n.shapeGroupNames[i],groupStore:s,groupWidth:a,groupHeight:u})});if(s>0){var o=Ext.create("Ext.data.Store",{model:"PE.model.ShapeModel"}),u=t[s-1].length-3>18?7:6,a=Math.ceil((t[s-1].length-3)/u)*35+3,f=30*u;for(var l=0;l<t[s-1].length-3;l++){var c=t[s-1][l];o.add({imageUrl:c.Image,data:{shapeType:c.Type}})}r.push({groupName:n.shapeGroupNames[s-1],groupStore:o,groupWidth:f,groupHeight:a})}i.add(r),setTimeout(Ext.bind(function(){n.getController("PE.controller.Toolbar").FillAutoShapes()},n),50)},onCollaborativeChanges:function(){this.modeEdit&&this.getStatusInfo().setCaption(this.txtNeedSynchronize)},synchronizeChanges:function(){this.getStatusInfo().setCaption(""),this.getDocumentHolder().hideTips(),this.getToolbar().synchronizeChanges()},onInsertTable:function(){var e=this.getRightPanel();e&&e.onInsertTable()},onInsertImage:function(){var e=this.getRightPanel();e&&e.onInsertImage()},onInsertShape:function(){var e=this.getRightPanel();e&&e.onInsertShape()},loadEditorStylesheets:function(e){var t=getEditorStylesheets(),n=this,r=t.length,i=0;if(!Ext.isSafari){function s(){++i<r||setTimeout(function(){n.loadEditorScripts.call(n,e)},10)}for(u=0;u<r;u++)a=document.createElement("link"),a.setAttribute("rel","stylesheet"),a.type="text/css",a.addEventListener?a.addEventListener("load",s,!1):a.onload=s,a.href=t[u],document.head.appendChild(a)}else{var o=document.styleSheets.length;for(var u=0;u<r;u++){var a=document.createElement("link");a.setAttribute("rel","stylesheet"),a.type="text/css",a.href=t[u],document.head.appendChild(a)}var f=setInterval(function(){document.styleSheets.length>=o+r&&(clearInterval(f),n.loadEditorScripts.call(n,e))},30)}},loadEditorScripts:function(e){function s(){i++,i<r||setTimeout(function(){e()},10)}var t=[],n=this;if(typeof getEditorScripts=="undefined"){setTimeout(function(){e()},10);return}t=getEditorScripts();var r=t.length,i=0;for(var o=0;o<r;o++){var u=document.createElement("script");u.type="text/javascript",u.addEventListener?u.addEventListener("load",s,!1):u.onload=s,u.src=t[o],document.body.appendChild(u)}},onThumbnailsShow:function(e){this.isThumbnailsShow=e},_compareActionStrong:function(e,t){return e.id===t.id&&e.type===t.type},_compareActionWeak:function(e,t){return e.type===t.type},recognizeBrowser:function(){var e=/trident\/(\d+)\.(\d+)/i.exec(navigator.userAgent);Common.userAgent={isIE:!!e};if(Common.userAgent.isIE&&e.length>1)switch(e[1]){case"5":Common.userAgent.ieVersion=9;break;case"6":Common.userAgent.ieVersion=10;break;case"7":Common.userAgent.ieVersion=11;break;default:Common.userAgent.ieVersion=0}},getHexColor:function(e,t,n){return e=e.toString(16),t=t.toString(16),n=n.toString(16),e.length==1&&(e="0"+e),t.length==1&&(t="0"+t),n.length==1&&(n="0"+n),e+t+n},_onSendThemeColors:function(e,t){var n=this,r=[];if(t)for(var i=0;i<t.length;i++){var s=this.getHexColor(t[i].get_r(),t[i].get_g(),t[i].get_b());r.push(s)}var o=[];for(i=0;i<6;i++)for(var u=0;u<10;u++){var a=i+u*6,s={color:this.getHexColor(e[a].get_r(),e[a].get_g(),e[a].get_b()),effectId:a,effectValue:this.ThemeValues[u]};o.push(s)}setTimeout(function(){n.getRightPanel().SendThemeColors(o,r)},50),setTimeout(function(){n.getToolbar()._onSendThemeColors(e,t)},50)},leavePageText:"You have unsaved changes in this document. Click 'Stay on this Page' then 'Save' to save them. Click 'Leave this Page' to discard all the unsaved changes.",defaultTitleText:"ONLYOFFICE Presentation Editor",criticalErrorTitle:"Error",notcriticalErrorTitle:"Warning",errorDefaultMessage:"Error code: %1",criticalErrorExtText:'Press "Ok" to to back to document list.',openTitleText:"Opening Document",openTextText:"Opening document...",saveTitleText:"Saving Document",saveTextText:"Saving document...",loadFontsTitleText:"Loading Data",loadFontsTextText:"Loading data...",loadImagesTitleText:"Loading Images",loadImagesTextText:"Loading images...",loadFontTitleText:"Loading Data",loadFontTextText:"Loading data...",loadImageTitleText:"Loading Image",loadImageTextText:"Loading image...",downloadTitleText:"Downloading Document",downloadTextText:"Downloading document...",printTitleText:"Printing Document",printTextText:"Printing document...",uploadImageTitleText:"Uploading Image",uploadImageTextText:"Uploading image...",uploadImageSizeMessage:"Maximium image size limit exceeded.",uploadImageExtMessage:"Unknown image format.",uploadImageFileCountMessage:"No images uploaded.",reloadButtonText:"Reload Page",unknownErrorText:"Unknown error.",convertationTimeoutText:"Convertation timeout exceeded.",convertationErrorText:"Convertation failed.",downloadErrorText:"Download failed.",unsupportedBrowserErrorText:"Your browser is not supported.",splitMaxRowsErrorText:"The number of rows must be less than %1",splitMaxColsErrorText:"The number of columns must be less than %1",splitDividerErrorText:"The number of rows must be a divisor of %1",requestEditRightsText:"Requesting editing rights...",requestEditFailedTitleText:"Access denied",requestEditFailedMessageText:"Someone is editing this document right now. Please try again later.",txtSldLtTBlank:"Blank",txtSldLtTChart:"Chart",txtSldLtTChartAndTx:"Chart and Text",txtSldLtTClipArtAndTx:"Clip Art and Text",txtSldLtTClipArtAndVertTx:"Clip Art and Vertical Text",txtSldLtTCust:"Custom",txtSldLtTDgm:"Diagram",txtSldLtTFourObj:"Four Objects",txtSldLtTMediaAndTx:"Media and Text",txtSldLtTObj:"Title and Object",txtSldLtTObjAndTwoObj:"Object and Two Object",txtSldLtTObjAndTx:"Object and Text",txtSldLtTObjOnly:"Object",txtSldLtTObjOverTx:"Object over Text",txtSldLtTObjTx:"Title, Object, and Caption",txtSldLtTPicTx:"Picture and Caption",txtSldLtTSecHead:"Section Header",txtSldLtTTbl:"Table",txtSldLtTTitle:"Title",txtSldLtTTitleOnly:"Title Only",txtSldLtTTwoColTx:"Two Column Text",txtSldLtTTwoObj:"Two Objects",txtSldLtTTwoObjAndObj:"Two Objects and Object",txtSldLtTTwoObjAndTx:"Two Objects and Text",txtSldLtTTwoObjOverTx:"Two Objects over Text",txtSldLtTTwoTxTwoObj:"Two Text and Two Objects",txtSldLtTTx:"Text",txtSldLtTTxAndChart:"Text and Chart",txtSldLtTTxAndClipArt:"Text and Clip Art",txtSldLtTTxAndMedia:"Text and Media",txtSldLtTTxAndObj:"Text and Object",txtSldLtTTxAndTwoObj:"Text and Two Objects",txtSldLtTTxOverObj:"Text over Object",txtSldLtTVertTitleAndTx:"Vertical Title and Text",txtSldLtTVertTitleAndTxOverChart:"Vertical Title and Text Over Chart",txtSldLtTVertTx:"Vertical Text",textLoadingDocument:"LOADING DOCUMENT",warnBrowserZoom:"Your browser's current zoom setting is not fully supported. Please reset to the default zoom by pressing Ctrl+0.",warnBrowserIE9:"The application has low capabilities on IE9. Use IE10 or higher",loadThemeTitleText:"Loading Theme",loadThemeTextText:"Loading theme...",txtBasicShapes:"Basic Shapes",txtFiguredArrows:"Figured Arrows",txtMath:"Math",txtCharts:"Charts",txtStarsRibbons:"Stars & Ribbons",txtCallouts:"Callouts",txtButtons:"Buttons",txtRectangles:"Rectangles",txtLines:"Lines",errorKeyEncrypt:"Unknown key descriptor",errorKeyExpire:"Key descriptor expired",errorUsersExceed:"Count of users was exceed",txtEditingMode:"Set editing mode...",errorCoAuthoringDisconnect:"Server connection lost. You can't edit anymore.",errorFilePassProtect:"The document is password protected.",textAnonymous:"Anonymous",txtNeedSynchronize:"You have an updates",applyChangesTitleText:"Loading Data",applyChangesTextText:"Loading data...",savePreparingText:"Preparing to save",savePreparingTitle:"Preparing to save. Please wait...",loadingDocumentTitleText:"Loading Document",loadingDocumentTextText:"Loading document...",warnProcessRightsChange:"You have been denied the right to edit the file.",errorProcessSaveResult:"Saving is failed."});if(Common===undefined)var Common={};Common.Locale=new function(){var l10n={},_createXMLHTTPObject=function(){var e;try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){e=!1}}return!e&&typeof XMLHttpRequest!="undefined"&&(e=new XMLHttpRequest),e},_applyLocalization=function(){try{for(var e in l10n){var t=e.split(".");if(t&&t.length>2){var n=window;for(var r=0;r<t.length-1;++r){n=n[t[r]];if(n==undefined)break}n&&(n.prototype[t[t.length-1]]=l10n[e])}}}catch(i){}};try{var urlParams=Ext.urlDecode(location.search.substring(1)),xhrObj=_createXMLHTTPObject();if(xhrObj&&urlParams&&urlParams.lang){var lang=urlParams.lang.split("-")[0];xhrObj.open("GET","locale/"+lang+".json",!1),xhrObj.send(""),l10n=eval("("+xhrObj.responseText+")"),_applyLocalization()}}catch(e){}return{apply:_applyLocalization}},Ext.application({name:"PE",autoCreateViewport:!0,controllers:["Main"]});var isBrowserSupported=function(){return!(Ext.ieVersion!=0&&Ext.ieVersion<9||Ext.safariVersion!=0&&Ext.safariVersion<5||Ext.firefoxVersion!=0&&Ext.firefoxVersion<4||Ext.chromeVersion!=0&&Ext.chromeVersion<7||Ext.operaVersion!=0&&Ext.operaVersion<10.5)};isBrowserSupported()||document.write('<div class="application-error-panel"><div class="application-error-message-block"><div class="application-error-message-inner"><div class="application-error-message-title">Your browser is not supported.</div><div class="application-error-message-text">Sorry, Presentation Editor is currently only supported in the latest versions of the Chrome, Firefox, Safari or Internet Explorer web browsers.</div></div></div><div class="application-error-message-auxiliary"></div></div>');var getEditorStylesheets=function(){return["../../../apps/presentationeditor/main/resources/css/app-edit.css"]},getEditorScripts=function(){return["../../../apps/presentationeditor/main/app-edit.js"]};