/*
 * Copyright (c) Ascensio System SIA 2014. All rights reserved
 *
 * http://www.onlyoffice.com
 *
 * Version: 1.0 (build:1)
 */
if(Common===undefined)var Common={};Common.Gateway=new function(){var e=this,t=$(e),n={init:function(e){t.trigger("init",e)},openDocument:function(e){t.trigger("opendocument",e)},showMessage:function(e){t.trigger("showmessage",e)},applyEditRights:function(e){t.trigger("applyeditrights",e)},processSaveResult:function(e){t.trigger("processsaveresult",e)},processRightsChange:function(e){t.trigger("processrightschange",e)},processMouse:function(e){t.trigger("processmouse",e)},internalCommand:function(e){t.trigger("internalcommand",e)},resetFocus:function(e){t.trigger("resetfocus",e)}},r=function(e){window.parent&&window.JSON&&window.parent.postMessage(window.JSON.stringify(e),"*")},i=function(e){var t=e.data;if(Object.prototype.toString.apply(t)!=="[object String]"||!window.JSON)return;var r,i;try{r=window.JSON.parse(t)}catch(s){r=""}r&&(i=n[r.command],i&&i.call(this,r.data))},s=function(e){i(e)};return window.attachEvent?window.attachEvent("onmessage",s):window.addEventListener("message",s,!1),{ready:function(){r({event:"onReady"})},goBack:function(){r({event:"onBack"})},save:function(e){r({event:"onSave",data:e})},requestEditRights:function(){r({event:"onRequestEditRights"})},reportError:function(e,t){r({event:"onError",data:{errorCode:e,errorDescription:t}})},setDocumentModified:function(e){r({event:"onDocumentStateChange",data:e})},internalMessage:function(e,t){r({event:"onInternalMessage",data:{type:e,data:t}})},on:function(n,r){var i=function(t,n){r.call(e,n)};t.on(n,i)}}};if(Common===undefined)var Common={};Common.component=Common.component||{},Common.Analytics=Common.component.Analytics=new function(){var e;return{initialize:function(t,n){if(typeof t=="undefined")throw"Analytics: invalid id.";if(typeof n=="undefined"||Object.prototype.toString.apply(n)!=="[object String]")throw"Analytics: invalid category type.";e=n,$("head").append('<script type="text/javascript">var _gaq = _gaq || [];_gaq.push(["_setAccount", "'+t+'"]);'+'_gaq.push(["_trackPageview"]);'+"(function() {"+'var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;'+'ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";'+'var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);'+"})();"+"</script>")},trackEvent:function(t,n,r){if(typeof t!="undefined"&&Object.prototype.toString.apply(t)!=="[object String]")throw"Analytics: invalid action type.";if(typeof n!="undefined"&&Object.prototype.toString.apply(n)!=="[object String]")throw"Analytics: invalid label type.";if(typeof r!="undefined"&&(Object.prototype.toString.apply(r)!=="[object Number]"||!isFinite(r)))throw"Analytics: invalid value type.";if(typeof _gaq=="undefined")return;if(e==="undefined")throw"Analytics is not initialized.";_gaq.push(["_trackEvent",e,t,n,r])}}},Ext.Loader.setConfig({enabled:!0,disableCaching:!1,paths:{Common:"../../common/mobile/lib"}}),Ext.define("PE.view.Main",{extend:"Ext.Container",initialize:function(){this.callParent(arguments)}}),Ext.define("PE.view.phone.toolbar.View",{extend:"Ext.Toolbar",xtype:"viewtoolbar",config:{docked:"top",minHeight:44,ui:"edit"},initialize:function(){this.add([{id:"id-tb-btn-view-done",ui:"base-blue",cls:"text-offset-12",hidden:!0,text:this.doneText},{xtype:"spacer"},{id:"id-tb-btn-prev-slide",ui:"base",iconCls:"left"},{id:"id-tb-btn-play",ui:"base",iconCls:"play"},{id:"id-tb-btn-next-slide",ui:"base",iconCls:"right"},{xtype:"spacer"},{id:"id-tb-btn-view-share",ui:"base",iconCls:"share"},{id:"id-tb-btn-fullscreen",ui:"base",iconCls:"fullscreen"}]),this.callParent(arguments)},doneText:"Done"}),Ext.define("PE.view.phone.Main",{extend:"PE.view.Main",alias:"widget.pephonemain",requires:["PE.view.phone.toolbar.View"],config:{cls:"pe-phone-main",fullscreen:!0,layout:{type:"vbox",pack:"center"}},initialize:function(){var e=this;this.add(Ext.create("PE.view.phone.toolbar.View",{hidden:!0})),this.add({xtype:"container",layout:"vbox",id:"id-conteiner-document",flex:1,items:[{xtype:"container",height:0,id:"id-sdkeditor"},{xtype:"container",flex:1,id:"id-presentation-preview"},{xtype:"panel",cls:"pnl-overlay",id:"id-preview-overlay-container",style:"position:absolute; left:0; top:0; width:100%; height:100%; z-index:4;"}]}),this.callParent(arguments)}}),Ext.define("PE.view.tablet.toolbar.View",{extend:"Ext.Toolbar",xtype:"viewtoolbar",config:{docked:"top",minHeight:44,ui:"edit"},initialize:function(){this.add([{id:"id-tb-btn-view-done",ui:"base-blue",cls:"text-offset-12",hidden:!0,text:this.doneText},{xtype:"spacer"},{id:"id-tb-btn-prev-slide",ui:"base",iconCls:"left"},{id:"id-tb-btn-play",ui:"base",iconCls:"play"},{id:"id-tb-btn-next-slide",ui:"base",iconCls:"right"},{xtype:"spacer"},{id:"id-tb-btn-view-share",ui:"base",iconCls:"share"},{id:"id-tb-btn-fullscreen",ui:"base",iconCls:"fullscreen"}]),this.callParent(arguments)},doneText:"Done"}),Ext.define("PE.view.tablet.Main",{extend:"PE.view.Main",alias:"widget.petabletmain",requires:["PE.view.tablet.toolbar.View"],config:{cls:"pe-tablet-main",fullscreen:!0,layout:{type:"vbox",pack:"center"}},initialize:function(){var e=this;this.add(Ext.create("PE.view.tablet.toolbar.View",{hidden:!0})),this.add({xtype:"container",layout:"vbox",id:"id-conteiner-document",flex:1,items:[{xtype:"container",height:0,id:"id-sdkeditor"},{xtype:"container",flex:1,id:"id-presentation-preview"},{xtype:"panel",cls:"pnl-overlay",id:"id-preview-overlay-container",style:"position:absolute; left:0; top:0; width:100%; height:100%; z-index:4;"}]}),this.callParent(arguments)}}),Ext.define("PE.controller.Presentation",{extend:"Ext.app.Controller",config:{refs:{},control:{}},init:function(){},launch:function(){Ext.getCmp("id-conteiner-document").on("resize",this.onEditorResize,this)},setApi:function(e){this.api=e},onEditorResize:function(e){this.api&&(this.api.Resize(),this.api.zoomFitToWidth())}}),Ext.define("PE.controller.Main",{extend:"Ext.app.Controller",editMode:!1,requires:["Ext.Anim","Ext.LoadMask","Ext.MessageBox"],launch:function(){if(!this._isSupport()){Common.Gateway.reportError(undefined,this.unsupportedBrowserErrorText);return}this.initControl(),Common.component.Analytics.initialize("UA-12442749-13","Presentation Editor Mobile");var e=this.api,t=this.getApplication(),n=t.getCurrentProfile();e=new asc_docs_api("id-sdkeditor"),e.SetMobileVersion(!0),e.CreateComponents(),e.SetFontsPath("../../../sdk/Fonts/"),e.Init(),e.initEvents2MobileAdvances(),e.asc_registerCallback("asc_onStartAction",Ext.bind(this.onLongActionBegin,this)),e.asc_registerCallback("asc_onError",Ext.bind(this.onError,this)),e.asc_registerCallback("asc_onEndAction",Ext.bind(this.onLongActionEnd,this)),e.asc_registerCallback("asc_onDocumentContentReady",Ext.bind(this.onDocumentContentReady,this)),e.asc_registerCallback("asc_onOpenDocumentProgress2",Ext.bind(this.onOpenDocument,this)),e.asc_registerCallback("asc_onSaveUrl",Ext.bind(this.onSaveUrl,this)),e.asc_registerCallback("asc_onGetEditorPermissions",Ext.bind(this.onEditorPermissions,this)),Ext.each(t.getControllers(),function(t){var n=this.getApplication().getController(t);n&&Ext.isFunction(n.setApi)&&n.setApi(e)},this),this.initApi(),this.editorConfig={},Common.Gateway.on("init",Ext.bind(this.loadConfig,this)),Common.Gateway.on("opendocument",Ext.bind(this.loadDocument,this)),Common.Gateway.on("showmessage",Ext.bind(this.onExternalMessage,this)),Common.Gateway.on("resetfocus",Ext.bind(this.onResetFocus,this)),Common.Gateway.on("processsaveresult",Ext.bind(this.onProcessSaveResult,this)),Common.Gateway.ready()},initControl:function(){},initApi:function(){},loadConfig:function(e){this.editorConfig=Ext.merge(this.editorConfig,e.config);if(this.editorConfig.user===undefined||this.editorConfig.user===null){this.editorConfig.user={};if(this.editorConfig.users){this.editorConfig.userId=this.editorConfig.userId||0;for(var t=0;t<this.editorConfig.users.length;t++)if(this.editorConfig.users[t].id===this.editorConfig.userId){this.editorConfig.user={id:this.editorConfig.users[t].id,name:this.editorConfig.users[t].username};break}}}this.editorConfig.user.id=this.editorConfig.user.id||"uid-"+Ext.Date.now(),this.editorConfig.user.name=this.editorConfig.user.name||this.textAnonymous},loadDocument:function(e){if(e.doc){var t=new CDocInfo;t.put_Id(e.doc.key),t.put_Url(e.doc.url),t.put_Title(e.doc.title),t.put_Format(e.doc.fileType),t.put_Options(e.doc.options),t.put_VKey(e.doc.vkey),t.put_UserId(this.editorConfig.user.id),t.put_UserName(this.editorConfig.user.name);var n=this.getApplication().getCurrentProfile().getName();this.getApplication().getController(n+".Main").setPresentationName(e.doc.title||"Unnamed Presentation"),this.api.asc_setDocInfo(t),this.api.asc_getEditorPermissions(),Common.component.Analytics.trackEvent("Load","Start")}},onEditorPermissions:function(e){this.api.LoadDocument(),this.api.Resize()},goBack:function(){Common.Gateway.goBack()},onDocumentContentReady:function(){this.api&&this.api.StartDemonstration("id-presentation-preview",0),this._hideLoadSplash(),Common.component.Analytics.trackEvent("Load","Complete")},onOpenDocument:function(e){var t=document.getElementById("loadmask-text");t&&(t.innerHTML=this.textLoadingDocument+": "+Math.round(e)+"%")},onSaveUrl:function(e){Common.Gateway.save(e)},onLongActionBegin:function(e,t){var n="";switch(t){case c_oAscAsyncAction.Print:n=this.printText}e==c_oAscAsyncActionType["BlockInteraction"]&&Ext.Viewport.setMasked({xtype:"loadmask",message:n})},onLongActionEnd:function(e){Ext.Viewport.unmask()},onError:function(e,t,n){this._hideLoadSplash();var r={closable:!1};switch(e){case c_oAscError.ID.Unknown:r.message=this.unknownErrorText;break;case c_oAscError.ID.ConvertationTimeout:r.message=this.convertationTimeoutText;break;case c_oAscError.ID.ConvertationError:r.message=this.convertationErrorText;break;case c_oAscError.ID.DownloadError:r.message=this.downloadErrorText;break;case c_oAscError.ID.UplImageSize:r.message=this.uploadImageSizeMessage;break;case c_oAscError.ID.UplImageExt:r.message=this.uploadImageExtMessage;break;case c_oAscError.ID.UplImageFileCount:r.message=this.uploadImageFileCountMessage;break;case c_oAscError.ID.SplitCellMaxRows:r.message=this.splitMaxRowsErrorText.replace("%1",n.get_Value());break;case c_oAscError.ID.SplitCellMaxCols:r.message=this.splitMaxColsErrorText.replace("%1",n.get_Value());break;case c_oAscError.ID.SplitCellRowsDivider:r.message=this.splitDividerErrorText.replace("%1",n.get_Value());break;case c_oAscError.ID.VKeyEncrypt:r.msg=this.errorKeyEncrypt;break;case c_oAscError.ID.KeyExpire:r.msg=this.errorKeyExpire;break;case c_oAscError.ID.UserCountExceed:r.msg=this.errorUsersExceed;break;default:r.message=this.errorDefaultMessage.replace("%1",e)}t==c_oAscError.Level.Critical?(Common.Gateway.reportError(e,r.message),r.title=this.criticalErrorTitle,r.message+="<br/>"+this.criticalErrorExtText,r.buttons=Ext.Msg.OK,r.fn=function(e){e=="ok"&&window.location.reload()}):(r.title=this.notcriticalErrorTitle,r.buttons=Ext.Msg.OK,r.fn=Ext.emptyFn),Ext.Msg.show(r),Common.component.Analytics.trackEvent("Internal Error",e.toString())},onExternalMessage:function(e){e&&(this._hideLoadSplash(),Ext.Msg.show({title:e.title,msg:"<br/>"+e.msg,icon:Ext.Msg[e.severity.toUpperCase()],buttons:Ext.Msg.OK}),Common.component.Analytics.trackEvent("External Error",e.title))},onResetFocus:function(e){var t=document.activeElement;t.focus()},onProcessSaveResult:function(e){this.api&&this.api.asc_OnSaveEnd(e.result)},_hideLoadSplash:function(){var e=Ext.get("loading-mask");e&&Ext.Anim.run(e,"fade",{out:!0,duration:250,after:function(){e.destroy()}})},_isSupport:function(){return Ext.browser.is.WebKit&&(Ext.os.is.iOS||Ext.os.is.Android||Ext.os.is.Desktop)},printText:"Printing...",criticalErrorTitle:"Error",notcriticalErrorTitle:"Warning",errorDefaultMessage:"Error code: %1",criticalErrorExtText:'Press "Ok" to reload view page.',uploadImageSizeMessage:"Maximium image size limit exceeded.",uploadImageExtMessage:"Unknown image format.",uploadImageFileCountMessage:"No images uploaded.",reloadButtonText:"Reload Page",unknownErrorText:"Unknown error.",convertationTimeoutText:"Convertation timeout exceeded.",convertationErrorText:"Convertation failed.",downloadErrorText:"Download failed.",unsupportedBrowserErrorText:"Your browser is not supported.",splitMaxRowsErrorText:"The number of rows must be less than %1",splitMaxColsErrorText:"The number of columns must be less than %1",splitDividerErrorText:"The number of rows must be a divisor of %1",requestEditRightsText:"Requesting editing rights...",requestEditFailedTitleText:"Access denied",requestEditFailedMessageText:"Someone is editing this document right now. Please try again later.",errorKeyEncrypt:"Unknown key descriptor",errorKeyExpire:"Key descriptor expired",errorUsersExceed:"Count of users was exceed",textAnonymous:"Anonymous",textLoadingDocument:"LOADING DOCUMENT"}),Ext.define("PE.controller.phone.Main",{extend:"PE.controller.Main",requires:["Ext.Anim"],config:{refs:{viewToolbar:"viewtoolbar"},control:{}},launch:function(){this.callParent(arguments)},initControl:function(){this.callParent(arguments)},initApi:function(){this.callParent(arguments)},setApi:function(e){this.api=e;var t=this.getViewToolbar();t&&t.show(),this.api&&this.api.asc_enableKeyEvents(!1)},setPresentationName:function(e){}}),Ext.define("PE.controller.tablet.Main",{extend:"PE.controller.Main",requires:["Ext.Anim"],config:{refs:{viewToolbar:"viewtoolbar"},control:{}},launch:function(){this.callParent(arguments)},initControl:function(){this.callParent(arguments)},initApi:function(){this.callParent(arguments)},setApi:function(e){this.api=e;var t=this.getViewToolbar();t&&t.show(),this.api&&this.api.asc_enableKeyEvents(!1)},setPresentationName:function(e){}}),Ext.define("PE.controller.toolbar.View",{extend:"Ext.app.Controller",config:{refs:{viewToolbar:"viewtoolbar",fullscreenButton:"#id-tb-btn-fullscreen",shareButton:"#id-tb-btn-view-share",btnPrevSlide:"#id-tb-btn-prev-slide",btnNextSlide:"#id-tb-btn-next-slide",btnPlaySlide:"#id-tb-btn-play",overlayContainer:"#id-preview-overlay-container",doneButton:"#id-tb-btn-view-done"},control:{fullscreenButton:{tap:"onTapFullscreenButton"},shareButton:{tap:"onTapShareButton"},btnPrevSlide:{tap:"onPrevSlide"},btnNextSlide:{tap:"onNextSlide"},btnPlaySlide:{tap:"onPlaySlide"},doneButton:{tap:"onTapDoneButton"}},isFullscreen:!1},launch:function(){this.callParent(arguments);var e=this.getOverlayContainer();e&&(e.element.on("singletap",this.onSingleTapDocument,this),e.element.on("touchstart",this.onTouchStartDocument,this),e.element.on("touchend",this.onTouchEndDocument,this)),Common.Gateway.on("init",Ext.bind(this.loadConfig,this))},initControl:function(){this._startX=0,this.callParent(arguments)},initApi:function(){},setApi:function(e){this.api=e,this.api&&(this.api.asc_registerCallback("asc_onEndDemonstration",Ext.bind(this.onApiEndDemonstration,this)),this.api.asc_registerCallback("asc_onDemonstrationSlideChanged",Ext.bind(this.onApiDemonstrationSlideChanged,this)),this.api.DemonstrationEndShowMessage(this.txtFinalMessage))},loadConfig:function(e){var t=this.getDoneButton();t&&e&&e.config&&e.config.canBackToFolder===!0&&t.show()},onTapDoneButton:function(){Common.Gateway.goBack()},onTapFullscreenButton:function(e){var t=this.getViewToolbar();t&&(this.setIsFullscreen(!this.getIsFullscreen()),this.getIsFullscreen()?(e.addCls("x-button-pressing"),t.setStyle({position:"absolute",left:0,top:0,right:0,opacity:.9,"z-index":7}),this.onSingleTapDocument()):(t.setStyle({position:"initial",opacity:1}),t.setDocked("top")))},onTapShareButton:function(){this.api&&this.api.asc_Print(),Common.component.Analytics.trackEvent("ToolBar View","Share")},onSingleTapDocument:function(){if(this.getIsFullscreen()){var e=this.getViewToolbar();e&&(e.isHidden()?e.show({preserveEndState:!0,easing:"ease-in",from:{opacity:0},to:{opacity:.9}}):e.hide({easing:"ease-out",from:{opacity:.9},to:{opacity:0}}))}},onTouchStartDocument:function(e,t,n,r){this._startX=e.pageX},onTouchEndDocument:function(e,t,n,r){e.pageX-this._startX<-50?this.api.DemonstrationNextSlide():e.pageX-this._startX>50&&this.api.DemonstrationPrevSlide()},onPrevSlide:function(){this.api&&this.api.DemonstrationPrevSlide()},onNextSlide:function(){this.api&&this.api.DemonstrationNextSlide()},onPlaySlide:function(){var e=this.getBtnPlaySlide();this.api&&e&&(e.getIconCls()=="play"?(this.api.DemonstrationPlay(),e.setIconCls("pause")):(this.api.DemonstrationPause(),e.setIconCls("play")))},onApiEndDemonstration:function(){this.api&&this.api.StartDemonstration("id-presentation-preview",0)},onApiDemonstrationSlideChanged:function(e){if(this.api&&Ext.isNumber(e)){var t=this.api.getCountPages(),n=this.getBtnNextSlide(),r=this.getBtnPrevSlide();r&&r.setDisabled(e<=0),n&&n.setDisabled(e>=t-1)}},txtFinalMessage:"The end of slide preview"}),Ext.define("PE.profile.Phone",{extend:"Ext.app.Profile",config:{name:"phone",namespace:"phone",controllers:["Main","PE.controller.Presentation","PE.controller.toolbar.View"],views:["Main"]},isActive:function(){return Ext.os.is.Phone&&(Ext.os.is.iOS||Ext.os.is.Android)},launch:function(){Ext.widget("pephonemain")}}),Ext.define("PE.profile.Tablet",{extend:"Ext.app.Profile",config:{name:"tablet",namespace:"tablet",controllers:["Main","PE.controller.Presentation","PE.controller.toolbar.View"],views:["Main"]},isActive:function(){return Ext.browser.is.WebKit&&(Ext.os.is.Tablet&&(Ext.os.is.iOS||Ext.os.is.Android)||Ext.os.is.Desktop)},launch:function(){Ext.widget("petabletmain")}});if(Common===undefined)var Common={};Common.Locale=new function(){var l10n={},_createXMLHTTPObject=function(){var e;try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){e=!1}}return!e&&typeof XMLHttpRequest!="undefined"&&(e=new XMLHttpRequest),e},_applyLocalization=function(){try{for(var e in l10n){var t=e.split(".");if(t&&t.length>2){var n=window;for(var r=0;r<t.length-1;++r){n=n[t[r]];if(n==undefined)break}n&&(n.prototype[t[t.length-1]]=l10n[e])}}}catch(i){}};try{var urlParams=Ext.urlDecode(location.search.substring(1)),xhrObj=_createXMLHTTPObject();if(xhrObj&&urlParams&&urlParams.lang){var lang=urlParams.lang.split("-")[0];xhrObj.open("GET","locale/"+lang+".json",!1),xhrObj.send(""),l10n=eval("("+xhrObj.responseText+")"),_applyLocalization()}}catch(e){}return{apply:_applyLocalization}},Ext.application({name:"PE",icon:"resources/img/icon.png",tabletStartupScreen:"resources/img/tablet_startup.png",phoneStartupScreen:"resources/img/phone_startup.png",viewport:{autoMaximize:!1},profiles:["Tablet","Phone"]});