/*
 * Copyright (c) Ascensio System SIA 2014. All rights reserved
 *
 * http://www.onlyoffice.com
 *
 * Version: 1.0 (build:1)
 */
if(Common===undefined)var Common={};Common.Gateway=new function(){var e=this,t=$(e),n={init:function(e){t.trigger("init",e)},openDocument:function(e){t.trigger("opendocument",e)},showMessage:function(e){t.trigger("showmessage",e)},applyEditRights:function(e){t.trigger("applyeditrights",e)},processSaveResult:function(e){t.trigger("processsaveresult",e)},processRightsChange:function(e){t.trigger("processrightschange",e)},processMouse:function(e){t.trigger("processmouse",e)},internalCommand:function(e){t.trigger("internalcommand",e)},resetFocus:function(e){t.trigger("resetfocus",e)}},r=function(e){window.parent&&window.JSON&&window.parent.postMessage(window.JSON.stringify(e),"*")},i=function(e){var t=e.data;if(Object.prototype.toString.apply(t)!=="[object String]"||!window.JSON)return;var r,i;try{r=window.JSON.parse(t)}catch(s){r=""}r&&(i=n[r.command],i&&i.call(this,r.data))},s=function(e){i(e)};return window.attachEvent?window.attachEvent("onmessage",s):window.addEventListener("message",s,!1),{ready:function(){r({event:"onReady"})},goBack:function(){r({event:"onBack"})},save:function(e){r({event:"onSave",data:e})},requestEditRights:function(){r({event:"onRequestEditRights"})},reportError:function(e,t){r({event:"onError",data:{errorCode:e,errorDescription:t}})},setDocumentModified:function(e){r({event:"onDocumentStateChange",data:e})},internalMessage:function(e,t){r({event:"onInternalMessage",data:{type:e,data:t}})},on:function(n,r){var i=function(t,n){r.call(e,n)};t.on(n,i)}}};if(Common===undefined)var Common={};Common.component=Common.component||{},Common.Analytics=Common.component.Analytics=new function(){var e;return{initialize:function(t,n){if(typeof t=="undefined")throw"Analytics: invalid id.";if(typeof n=="undefined"||Object.prototype.toString.apply(n)!=="[object String]")throw"Analytics: invalid category type.";e=n,$("head").append('<script type="text/javascript">var _gaq = _gaq || [];_gaq.push(["_setAccount", "'+t+'"]);'+'_gaq.push(["_trackPageview"]);'+"(function() {"+'var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;'+'ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";'+'var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);'+"})();"+"</script>")},trackEvent:function(t,n,r){if(typeof t!="undefined"&&Object.prototype.toString.apply(t)!=="[object String]")throw"Analytics: invalid action type.";if(typeof n!="undefined"&&Object.prototype.toString.apply(n)!=="[object String]")throw"Analytics: invalid label type.";if(typeof r!="undefined"&&(Object.prototype.toString.apply(r)!=="[object Number]"||!isFinite(r)))throw"Analytics: invalid value type.";if(typeof _gaq=="undefined")return;if(e==="undefined")throw"Analytics is not initialized.";_gaq.push(["_trackEvent",e,t,n,r])}}},Ext.Loader.setConfig({enabled:!0,disableCaching:!1,paths:{Common:"../../common/mobile/lib"}}),Ext.define("SSE.model.Worksheet",{extend:"Ext.data.Model",config:{fields:[{name:"index",type:"int"},{name:"text",type:"string"}]}}),Ext.define("SSE.store.Worksheets",{extend:"Ext.data.Store",config:{model:"SSE.model.Worksheet"}}),Ext.define("SSE.view.OpenCsvPanel",{extend:"Ext.form.Panel",alias:"widget.seopencsvpanel",requires:["Ext.form.Panel","Ext.form.FieldSet","Ext.field.Select"],config:{style:"padding: 0;"},initialize:function(){var e=this;this.add({xtype:"fieldset",title:this.txtTitle,instructions:this.txtHint,defaults:{labelWidth:"36%"},items:[{xtype:"selectfield",name:"encoding",label:this.txtEncoding,options:[{value:37,text:"IBM EBCDIC (US-Canada)"},{value:437,text:"OEM United States"},{value:500,text:"IBM EBCDIC (International)"},{value:708,text:"Arabic (ASMO 708)"},{value:720,text:"Arabic (DOS)"},{value:737,text:"Greek (DOS)"},{value:775,text:"Baltic (DOS)"},{value:850,text:"Western European (DOS)"},{value:852,text:"Central European (DOS)"},{value:855,text:"OEM Cyrillic"},{value:857,text:"Turkish (DOS)"},{value:858,text:"OEM Multilingual Latin I"},{value:860,text:"Portuguese (DOS)"},{value:861,text:"Icelandic (DOS)"},{value:862,text:"Hebrew (DOS)"},{value:863,text:"French Canadian (DOS)"},{value:864,text:"Arabic (864) "},{value:865,text:"Nordic (DOS)"},{value:866,text:"Cyrillic (DOS)"},{value:869,text:"Greek, Modern (DOS)"},{value:870,text:"IBM EBCDIC (Multilingual Latin-2)"},{value:874,text:"Thai (Windows)"},{value:875,text:"IBM EBCDIC (Greek Modern)"},{value:932,text:"Japanese (Shift-JIS)"},{value:936,text:"Chinese Simplified (GB2312)"},{value:949,text:"Korean"},{value:950,text:"Chinese Traditional (Big5)"},{value:1026,text:"IBM EBCDIC (Turkish Latin-5)"},{value:1047,text:"IBM Latin-1"},{value:1140,text:"IBM EBCDIC (US-Canada-Euro)"},{value:1141,text:"IBM EBCDIC (Germany-Euro)"},{value:1142,text:"IBM EBCDIC (Denmark-Norway-Euro)"},{value:1143,text:"IBM EBCDIC (Finland-Sweden-Euro)"},{value:1144,text:"IBM EBCDIC (Italy-Euro)"},{value:1145,text:"IBM EBCDIC (Spain-Euro)"},{value:1146,text:"IBM EBCDIC (UK-Euro)"},{value:1147,text:"IBM EBCDIC (France-Euro)"},{value:1148,text:"IBM EBCDIC (International-Euro)"},{value:1149,text:"IBM EBCDIC (Icelandic-Euro)"},{value:1200,text:"Unicode"},{value:1201,text:"Unicode (Big-Endian)"},{value:1250,text:"Central European (Windows)"},{value:1251,text:"Cyrillic (Windows)"},{value:1252,text:"Western European (Windows)"},{value:1253,text:"Greek (Windows)"},{value:1254,text:"Turkish (Windows)"},{value:1255,text:"Hebrew (Windows) "},{value:1256,text:"Arabic (Windows) "},{value:1257,text:"Baltic (Windows)"},{value:1258,text:"Vietnamese (Windows)"},{value:1361,text:"Korean (Johab)"},{value:1e4,text:"Western European (Mac)"},{value:10001,text:"Japanese (Mac)"},{value:10002,text:"Chinese Traditional (Mac)"},{value:10003,text:"Korean (Mac)"},{value:10004,text:"Arabic (Mac) "},{value:10005,text:"Hebrew (Mac)"},{value:10006,text:"Greek (Mac) "},{value:10007,text:"Cyrillic (Mac)"},{value:10008,text:"Chinese Simplified (Mac)"},{value:10010,text:"Romanian (Mac)"},{value:10017,text:"Ukrainian (Mac)"},{value:10021,text:"Thai (Mac)"},{value:10029,text:"Central European (Mac) "},{value:10079,text:"Icelandic (Mac)"},{value:10081,text:"Turkish (Mac)"},{value:10082,text:"Croatian (Mac)"},{value:12e3,text:"Unicode (UTF-32)"},{value:12001,text:"Unicode (UTF-32 Big-Endian)"},{value:2e4,text:"Chinese Traditional (CNS)"},{value:20001,text:"TCA Taiwan"},{value:20002,text:"Chinese Traditional (Eten)"},{value:20003,text:"IBM5550 Taiwan"},{value:20004,text:"TeleText Taiwan"},{value:20005,text:"Wang Taiwan"},{value:20105,text:"Western European (IA5)"},{value:20106,text:"German (IA5)"},{value:20107,text:"Swedish (IA5) "},{value:20108,text:"Norwegian (IA5) "},{value:20127,text:"US-ASCII"},{value:20261,text:"T.61 "},{value:20269,text:"ISO-6937"},{value:20273,text:"IBM EBCDIC (Germany)"},{value:20277,text:"IBM EBCDIC (Denmark-Norway) "},{value:20278,text:"IBM EBCDIC (Finland-Sweden)"},{value:20280,text:"IBM EBCDIC (Italy)"},{value:20284,text:"IBM EBCDIC (Spain)"},{value:20285,text:"IBM EBCDIC (UK)"},{value:20290,text:"IBM EBCDIC (Japanese katakana)"},{value:20297,text:"IBM EBCDIC (France)"},{value:20420,text:"IBM EBCDIC (Arabic)"},{value:20423,text:"IBM EBCDIC (Greek)"},{value:20424,text:"IBM EBCDIC (Hebrew)"},{value:20833,text:"IBM EBCDIC (Korean Extended)"},{value:20838,text:"IBM EBCDIC (Thai)"},{value:20866,text:"Cyrillic (KOI8-R)"},{value:20871,text:"IBM EBCDIC (Icelandic) "},{value:20880,text:"IBM EBCDIC (Cyrillic Russian)"},{value:20905,text:"IBM EBCDIC (Turkish)"},{value:20924,text:"IBM Latin-1 "},{value:20932,text:"Japanese (JIS 0208-1990 and 0212-1990)"},{value:20936,text:"Chinese Simplified (GB2312-80) "},{value:20949,text:"Korean Wansung "},{value:21025,text:"IBM EBCDIC (Cyrillic Serbian-Bulgarian)"},{value:21866,text:"Cyrillic (KOI8-U)"},{value:28591,text:"Western European (ISO) "},{value:28592,text:"Central European (ISO)"},{value:28593,text:"Latin 3 (ISO)"},{value:28594,text:"Baltic (ISO)"},{value:28595,text:"Cyrillic (ISO) "},{value:28596,text:"Arabic (ISO)"},{value:28597,text:"Greek (ISO) "},{value:28598,text:"Hebrew (ISO-Visual)"},{value:28599,text:"Turkish (ISO)"},{value:28603,text:"Estonian (ISO)"},{value:28605,text:"Latin 9 (ISO)"},{value:29001,text:"Europa"},{value:38598,text:"Hebrew (ISO-Logical)"},{value:50220,text:"Japanese (JIS)"},{value:50221,text:"Japanese (JIS-Allow 1 byte Kana) "},{value:50222,text:"Japanese (JIS-Allow 1 byte Kana - SO/SI)"},{value:50225,text:"Korean (ISO)"},{value:50227,text:"Chinese Simplified (ISO-2022)"},{value:51932,text:"Japanese (EUC)"},{value:51936,text:"Chinese Simplified (EUC) "},{value:51949,text:"Korean (EUC)"},{value:52936,text:"Chinese Simplified (HZ)"},{value:54936,text:"Chinese Simplified (GB18030)"},{value:57002,text:"ISCII Devanagari "},{value:57003,text:"ISCII Bengali "},{value:57004,text:"ISCII Tamil"},{value:57005,text:"ISCII Telugu "},{value:57006,text:"ISCII Assamese "},{value:57007,text:"ISCII Oriya"},{value:57008,text:"ISCII Kannada"},{value:57009,text:"ISCII Malayalam "},{value:57010,text:"ISCII Gujarati"},{value:57011,text:"ISCII Punjabi"},{value:65e3,text:"Unicode (UTF-7)"},{value:65001,text:"Unicode (UTF-8)"}]},{xtype:"selectfield",name:"delimiter",label:this.txtDelimiter,options:[{value:4,text:","},{value:2,text:";"},{value:3,text:":"},{value:1,text:this.txtTab},{value:5,text:this.txtSpace}]}]}),this.add({xtype:"button",text:"OK",handler:function(){e.fireEvent("close",this,{encoding:e.getValues().encoding,delimiter:e.getValues().delimiter})}})},txtEncoding:"Encoding ",txtDelimiter:"Delimiter",txtTab:"Tab",txtSpace:"Space",txtTitle:"Choose CSV opening options",txtHint:"Please enter the information above."}),Ext.define("SSE.view.WorksheetList",{extend:"Ext.Container",requires:["Ext.dataview.List","Ext.XTemplate"],alias:["widget.seworksheetlist"],config:{layout:{type:"fit"}},initialize:function(){var e=Ext.create("Ext.XTemplate",'<tpl for="."><div class="worksheet-item">{text:htmlEncode}</div></tpl>');this.add({xtype:"list",store:"Worksheets",itemTpl:e,singleSelect:!0,itemSelector:"div.worksheet-item",emptyText:"",cls:"x-worksheet-item x-select-overlay"}),this.callParent(arguments)}}),Ext.define("SSE.view.Main",{extend:"Ext.Container",alias:"widget.semainview",initialize:function(){this.callParent(arguments)}}),Ext.define("SSE.view.phone.toolbar.Search",{extend:"Ext.Toolbar",xtype:"searchtoolbar",requires:["Ext.Label","Ext.field.Search"],config:{docked:"top",minHeight:52,ui:"search"},initialize:function(){this.add([{xtype:"searchfield",id:"id-field-search",placeHolder:this.searchText,flex:1},{xtype:"segmentedbutton",allowToggle:!1,ui:"base",items:[{id:"id-btn-search-prev",ui:"base",iconCls:"search-prev",disabled:!0},{id:"id-btn-search-next",ui:"base",iconCls:"search-next",disabled:!0}]}]),this.callParent(arguments)},searchText:"Search"}),Ext.define("SSE.view.phone.toolbar.View",{extend:"Ext.Toolbar",xtype:"viewtoolbar",config:{docked:"top",minHeight:44,ui:"edit"},initialize:function(){this.add([{id:"id-tb-btn-view-done",ui:"base-blue",cls:"text-offset-12",hidden:!0,text:this.doneText},{xtype:"spacer"},{id:"id-tb-btn-search",ui:"base",iconCls:"search"},{id:"id-tb-btn-pages",ui:"base",iconCls:"pages"},{id:"id-tb-btn-fullscreen",ui:"base",iconCls:"fullscreen"},{xtype:"spacer"},{id:"id-tb-btn-view-share",ui:"base",iconCls:"share"}]),this.callParent(arguments)},doneText:"Done",editText:"Edit"}),Ext.define("SSE.view.phone.Main",{extend:"SSE.view.Main",alias:"widget.sephonemain",requires:["Ext.field.Search"],config:{cls:"de-phone-main",fullscreen:!0,layout:{type:"vbox",pack:"center"}},initialize:function(){var e=this;this.add(Ext.create("SSE.view.phone.toolbar.View",{hidden:!0})),this.add(Ext.create("SSE.view.phone.toolbar.Search",{hidden:!0})),this.add({xtype:"container",id:"id-pnl-top-fixed",docked:"top",style:"opacity: 0;"}),this.add({xtype:"container",layout:"vbox",id:"id-container-document",flex:1,items:[{xtype:"container",flex:1,id:"id-sdkeditor"}]}),this.add({xtype:"panel",layout:"fit",width:200,height:200,id:"id-worksheets-panel",top:0,left:0,modal:!0,hidden:!0,hideOnMaskTap:!0,items:[{xtype:"seworksheetlist"}]}),this.callParent(arguments)}}),Ext.define("SSE.view.tablet.toolbar.Search",{extend:"Ext.Toolbar",xtype:"searchtoolbar",requires:["Ext.Label","Ext.field.Search"],config:{docked:"top",minHeight:52,ui:"search"},initialize:function(){this.add([{xtype:"searchfield",id:"id-field-search",placeHolder:this.searchText,flex:1},{xtype:"segmentedbutton",allowToggle:!1,ui:"base",items:[{id:"id-btn-search-prev",ui:"base",iconCls:"search-prev",disabled:!0},{id:"id-btn-search-next",ui:"base",iconCls:"search-next",disabled:!0}]}]),this.callParent(arguments)},searchText:"Search"}),Ext.define("SSE.view.tablet.toolbar.View",{extend:"Ext.Toolbar",xtype:"viewtoolbar",config:{docked:"top",minHeight:44,ui:"edit"},initialize:function(){this.add([{id:"id-tb-btn-view-done",ui:"base-blue",cls:"text-offset-12",hidden:!0,text:this.doneText},{xtype:"spacer"},{id:"id-tb-btn-search",ui:"base",iconCls:"search"},{id:"id-tb-btn-pages",ui:"base",iconCls:"pages"},{id:"id-tb-btn-fullscreen",ui:"base",iconCls:"fullscreen"},{xtype:"spacer"},{id:"id-tb-btn-view-share",ui:"base",iconCls:"share"}]),this.callParent(arguments)},doneText:"Done",editText:"Edit"}),Ext.define("SSE.view.tablet.Main",{extend:"SSE.view.Main",alias:"widget.setabletmain",requires:["SSE.view.tablet.toolbar.Search","SSE.view.tablet.toolbar.View","SSE.view.WorksheetList"],config:{fullscreen:!0,layout:{type:"vbox",pack:"center"}},initialize:function(){this.add(Ext.create("SSE.view.tablet.toolbar.View",{hidden:!0})),this.add(Ext.create("SSE.view.tablet.toolbar.Search",{hidden:!0})),this.add({xtype:"container",layout:"vbox",id:"id-container-document",flex:1,items:[{xtype:"container",flex:1,id:"id-sdkeditor"}]}),this.add({xtype:"panel",layout:"fit",width:200,height:200,id:"id-worksheets-panel",top:0,left:0,modal:!0,hidden:!0,hideOnMaskTap:!0,items:[{xtype:"seworksheetlist"}]}),this.callParent(arguments)}}),Ext.define("SSE.controller.ApiEvents",{mixins:{observable:"Ext.mixin.Observable"},view:undefined,widget:undefined,element:undefined,handlers:undefined,settings:undefined,enableKeyEvents:!1,isSelectMode:!1,hasCursor:!1,constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},init:function(e,t,n,r,i){return this.view=e,this.widget=t,this.element=n,this.handlers=new window.Asc.asc_CHandlersList(r),this.settings=$.extend(!0,{},this.defaults,i),this},destroy:function(){return $(window).off("."+this.namespace),this},enableKeyEventsHandler:function(e){this.enableKeyEvents=!!e}}),Ext.define("SSE.controller.Document",{extend:"Ext.app.Controller",config:{refs:{},control:{"#id-btn-zoom-in":{tap:"onZoomIn"},"#id-btn-zoom-out":{tap:"onZoomOut"}}},_currZoom:1,_baseZoom:1,_maxZoom:2,_incrementZoom:.05,init:function(){},launch:function(){},setApi:function(e){this.api=e,this.api&&(this.api.asc_registerCallback("asc_onDoubleTapEvent",Ext.bind(this._onDoubleTapDocument,this)),this.api.asc_registerCallback("asc_onStartAction",Ext.bind(this._onLongActionBegin,this)),this.api.asc_registerCallback("asc_onEndAction",Ext.bind(this._onLongActionEnd,this)))},_onLongActionBegin:function(e,t){},_onLongActionEnd:function(e,t){if(e===c_oAscAsyncActionType.BlockInteraction)switch(t){case c_oAscAsyncAction.Open:var n=this.api.asc_getActiveWorksheetIndex();this.api.asc_showWorksheet(n)}},_onDoubleTapDocument:function(){this.api&&(this._currZoom!=this._baseZoom?this._currZoom=this._baseZoom:this._currZoom=this._maxZoom,this.api.asc_setZoom(this._currZoom))},onZoomIn:function(e,t,n){this._currZoom+=this._incrementZoom,this._currZoom>this._maxZoom&&(this._currZoom=this._maxZoom),this.api.asc_setZoom(this._currZoom)},onZoomOut:function(e,t,n){this._currZoom-=this._incrementZoom,this._currZoom<this._baseZoom&&(this._currZoom=this._baseZoom),this.api.asc_setZoom(this._currZoom)}}),Ext.define("SSE.controller.Search",{extend:"Ext.app.Controller",config:{refs:{nextResult:"#id-btn-search-prev",previousResult:"#id-btn-search-next",searchField:"#id-field-search"},control:{"#id-btn-search-prev":{tap:"onPreviousResult"},"#id-btn-search-next":{tap:"onNextResult"},"#id-field-search":{keyup:"onSearchKeyUp",change:"onSearchChange",clearicontap:"onSearchClear"}}},_step:-1,init:function(){},setApi:function(e){this.api=e},onNextResult:function(){var e=this.getSearchField();this.api&&e&&this.api.asc_findText(e.getValue(),!0,!0)},onPreviousResult:function(){var e=this.getSearchField();this.api&&e&&this.api.asc_findText(e.getValue(),!0,!1)},onSearchKeyUp:function(e,t){var n=t.event.keyCode,r=this.getSearchField();n==13&&this.api&&this.api.asc_findText(r.getValue(),!0,!0),this.updateNavigation()},onSearchChange:function(e,t,n){this.updateNavigation()},onSearchClear:function(e,t){this.updateNavigation(),window.focus(),document.activeElement.blur()},updateNavigation:function(){var e=this.getSearchField(),t=this.getNextResult(),n=this.getPreviousResult();e&&t&&n&&(t.setDisabled(e.getValue()==""),n.setDisabled(e.getValue()==""))}}),Ext.define("SSE.controller.WorksheetList",{extend:"Ext.app.Controller",config:{refs:{worksheetList:{selector:"seworksheetlist list"}}},init:function(){this.control({"seworksheetlist list":{itemtap:this._worksheetSelect}})},setApi:function(e){this.api=e,this.api&&this.api.asc_registerCallback("asc_onEndAction",Ext.bind(this.onLongActionEnd,this))},_worksheetSelect:function(e,t,n,r,i,s){if(this.api){var o=r.data.index;o>-1&&this.api.asc_getActiveWorksheetIndex()!=o&&this.api.asc_showWorksheet(o)}},_loadWorksheets:function(){if(this.api){var e=Ext.getStore("Worksheets"),t=this.getWorksheetList();if(e&&t){e.removeAll(!1);var n=this.api.asc_getWorksheetsCount();if(n){for(var r=0;r<n;r++){var i={text:this.api.asc_getWorksheetName(r),index:r};e.add(i)}var s=e.findRecord("index",this.api.asc_getActiveWorksheetIndex());s?t.select(s):t.select(e.getAt(0))}}}},onLongActionEnd:function(e,t){if(e===c_oAscAsyncActionType.BlockInteraction)switch(t){case c_oAscAsyncAction.Open:this._loadWorksheets()}}}),Ext.define("SSE.controller.Main",{extend:"Ext.app.Controller",editMode:!1,requires:["Ext.Anim","Ext.MessageBox","SSE.controller.ApiEvents","SSE.view.OpenCsvPanel"],config:{refs:{mainView:"semainview"}},launch:function(){if(!this._isSupport()){Common.Gateway.reportError(undefined,this.unsupportedBrowserErrorText);return}this.initControl(),Common.component.Analytics.initialize("UA-12442749-13","Spreadsheet Mobile");var e=this.getApplication();this.api=new Asc.spreadsheet_api("id-sdkeditor","",SSE.controller.ApiEvents,{},{}),this.api.asc_Init("../../../sdk/Fonts/"),this.api.asc_setMobileVersion(!0),this.api.asc_registerCallback("asc_onAdvancedOptions",Ext.bind(this.onAdvancedOptions,this)),this.api.asc_registerCallback("asc_onOpenDocumentProgress",Ext.bind(this.onOpenDocumentProgress,this)),this.api.asc_registerCallback("asc_onEndAction",Ext.bind(this.onLongActionEnd,this)),this.api.asc_registerCallback("asc_onError",Ext.bind(this.onError,this)),this.api.asc_registerCallback("asc_onSaveUrl",Ext.bind(this.onSaveUrl,this)),this.api.asc_registerCallback("asc_onGetEditorPermissions",Ext.bind(this.onEditorPermissions,this)),Ext.each(e.getControllers(),function(t){var n=e.getController(t);n&&Ext.isFunction(n.setApi)&&n.setApi(this.api)},this),this.initApi(),this.editorConfig={},Common.Gateway.on("init",Ext.bind(this.loadConfig,this)),Common.Gateway.on("opendocument",Ext.bind(this.loadDocument,this)),Common.Gateway.on("showmessage",Ext.bind(this.onExternalMessage,this)),Common.Gateway.on("processsaveresult",Ext.bind(this.onProcessSaveResult,this)),Common.Gateway.ready()},initControl:function(){},initApi:function(){},loadConfig:function(e){this.editorConfig=Ext.merge(this.editorConfig,e.config);if(this.editorConfig.user===undefined||this.editorConfig.user===null){this.editorConfig.user={};if(this.editorConfig.users){this.editorConfig.userId=this.editorConfig.userId||0;for(var t=0;t<this.editorConfig.users.length;t++)if(this.editorConfig.users[t].id===this.editorConfig.userId){this.editorConfig.user={id:this.editorConfig.users[t].id,name:this.editorConfig.users[t].username};break}}}this.editorConfig.user.id=this.editorConfig.user.id||"uid-"+Ext.Date.now(),this.editorConfig.user.name=this.editorConfig.user.name||this.textAnonymous},loadDocument:function(e){if(e.doc){this.permissions=e.doc.permissions;var t={Id:e.doc.key,Url:e.doc.url,Title:e.doc.title,Format:e.doc.fileType,Options:e.doc.options,VKey:e.doc.vkey,Origin:e.doc.origin,UserId:this.editorConfig.user.id,UserName:this.editorConfig.user.name};this.api.asc_setDocInfo(t),this.api.asc_getEditorPermissions(),Common.component.Analytics.trackEvent("Load","Start")}},onEditorPermissions:function(e){this.permissions.edit!==!1&&(this.permissions.edit=e.asc_getCanEdit());var t=this.permissions.edit===!0&&this.editorConfig.mode!=="view";this.api.asc_setViewerMode(t),this.api.asc_LoadDocument();var n=this.getApplication().getCurrentProfile().getName();this.getApplication().getController(n+".Main").setMode(t)},goBack:function(){Common.Gateway.goBack()},onError:function(e,t){this._hideLoadSplash();var n={closable:!1};switch(e){case c_oAscError.ID.Unknown:n.message=this.unknownErrorText;break;case c_oAscError.ID.ConvertationTimeout:n.message=this.convertationTimeoutText;break;case c_oAscError.ID.ConvertationError:n.message=this.convertationErrorText;break;case c_oAscError.ID.DownloadError:n.message=this.downloadErrorText;break;case c_oAscError.ID.UplImageSize:n.message=this.uploadImageSizeMessage;break;case c_oAscError.ID.UplImageExt:n.message=this.uploadImageExtMessage;break;case c_oAscError.ID.UplImageFileCount:n.message=this.uploadImageFileCountMessage;break;case c_oAscError.ID.VKeyEncrypt:n.msg=this.errorKeyEncrypt;break;case c_oAscError.ID.KeyExpire:n.msg=this.errorKeyExpire;break;case c_oAscError.ID.UserCountExceed:n.msg=this.errorUsersExceed;break;default:n.message=this.errorDefaultMessage.replace("%1",e)}t==c_oAscError.Level.Critical?(Common.Gateway.reportError(e,n.message),n.title=this.criticalErrorTitle,n.message+="<br/>"+this.criticalErrorExtText,n.buttons=Ext.Msg.OK,n.fn=function(e){e=="ok"&&window.location.reload()}):(n.title=this.notcriticalErrorTitle,n.buttons=Ext.Msg.OK,n.fn=Ext.emptyFn),Ext.Msg.show(n)},onSaveUrl:function(e){Common.Gateway.save(e)},onExternalMessage:function(e){e&&(this._hideLoadSplash(),Ext.Msg.show({title:e.title,msg:"<br/>"+e.msg,icon:Ext.Msg[e.severity.toUpperCase()],buttons:Ext.Msg.OK}),Common.component.Analytics.trackEvent("External Error",e.title))},onAdvancedOptions:function(e){if(e.asc_getOptionId()==c_oAscAdvancedOptionsID["CSV"]){var t=Ext.get("loading-mask"),n=this;Ext.Anim.run(t,"slide",{out:!0,direction:"up",duration:250,after:function(){t.hide()}});var r=Ext.Viewport.add({xtype:"seopencsvpanel",left:0,top:0,width:"100%",height:"100%"});Ext.Anim.run(r,"slide",{out:!1,direction:"up",duration:1e3}),r.on("close",Ext.bind(function(e,i){t.show(),Ext.Anim.run(t,"slide",{out:!1,direction:"down",duration:1e3}),Ext.Anim.run(r,"slide",{out:!0,direction:"down",duration:1e3,after:function(){Ext.Viewport.remove(r),n.api&&n.api.asc_setAdvancedOptions(c_oAscAdvancedOptionsID.CSV,new Asc.asc_CCSVAdvancedOptions(i.encoding,i.delimiter))}})},this))}},onOpenDocumentProgress:function(e){var t=document.getElementById("loadmask-text");if(t){var n=(e.CurrentFont+e.CurrentImage)/(e.FontsCount+e.ImagesCount);t.innerHTML=this.textLoadingDocument+": "+Math.round(n*100)+"%"}},onOpenDocument:function(){this._hideLoadSplash(),this.api&&this.api.asc_cleanSelection()},onLongActionEnd:function(e,t){if(e===c_oAscAsyncActionType.BlockInteraction)switch(t){case c_oAscAsyncAction.Open:this.onOpenDocument()}},_hideLoadSplash:function(){var e=Ext.get("loading-mask");e&&Ext.Anim.run(e,"fade",{out:!0,duration:1e3,after:function(){e.destroy()}})},_isSupport:function(){return Ext.browser.is.WebKit&&(Ext.os.is.iOS||Ext.os.is.Android||Ext.os.is.Desktop)},printText:"Printing...",criticalErrorTitle:"Error",notcriticalErrorTitle:"Warning",errorDefaultMessage:"Error code: %1",criticalErrorExtText:'Press "Ok" to reload view page.',uploadImageSizeMessage:"Maximium image size limit exceeded.",uploadImageExtMessage:"Unknown image format.",uploadImageFileCountMessage:"No images uploaded.",unknownErrorText:"Unknown error.",convertationTimeoutText:"Convertation timeout exceeded.",convertationErrorText:"Convertation failed.",downloadErrorText:"Download failed.",unsupportedBrowserErrorText:"Your browser is not supported.",errorKeyEncrypt:"Unknown key descriptor",errorKeyExpire:"Key descriptor expired",errorUsersExceed:"Count of users was exceed",textAnonymous:"Anonymous",textLoadingDocument:"LOADING DOCUMENT"}),Ext.define("SSE.controller.phone.Main",{extend:"SSE.controller.Main",requires:["Ext.Anim"],config:{refs:{viewToolbar:"viewtoolbar",searchToolbar:"searchtoolbar"},control:{}},launch:function(){this.callParent(arguments)},initControl:function(){this.callParent(arguments)},initApi:function(){this.callParent(arguments)},setApi:function(e){this.api=e,this.api.asc_enableKeyEvents(!0)},setDocumentName:function(e){var t=this.getDocumentNameLabel();t&&t.setHtml(Ext.String.htmlEncode(e))},onTapBack:function(){Common.Gateway.goBack()},setMode:function(e){var t=this.getViewToolbar(),n=this.getSearchToolbar();e=="edit"?(t&&t.hide(),n&&n.hide(),this.api&&this.api.asc_enableKeyEvents(!0)):(t&&t.show(),this.api&&this.api.asc_enableKeyEvents(!1))}}),Ext.define("SSE.controller.tablet.Main",{extend:"SSE.controller.Main",requires:["Ext.Anim"],config:{refs:{viewToolbar:"viewtoolbar",searchToolbar:"searchtoolbar"},control:{}},launch:function(){this.callParent(arguments)},initControl:function(){this.callParent(arguments)},initApi:function(){this.callParent(arguments)},setApi:function(e){this.api=e,this.api.asc_enableKeyEvents(!0)},setDocumentName:function(e){var t=this.getDocumentNameLabel();t&&t.setHtml(Ext.String.htmlEncode(e))},setMode:function(e){var t=this.getViewToolbar(),n=this.getSearchToolbar();e=="edit"?(t&&t.hide(),n&&n.hide(),this.api&&this.api.asc_enableKeyEvents(!0)):(t&&t.show(),this.api&&this.api.asc_enableKeyEvents(!1))}}),Ext.define("SSE.controller.toolbar.View",{extend:"Ext.app.Controller",config:{refs:{viewToolbar:"viewtoolbar",searchToolbar:"searchtoolbar",worksheetPanel:"#id-worksheets-panel",doneButton:"#id-tb-btn-view-done",searchButton:"#id-tb-btn-search",fullscreenButton:"#id-tb-btn-fullscreen",shareButton:"#id-tb-btn-view-share",worksheetsButton:"#id-tb-btn-pages"},control:{doneButton:{tap:"onTapDoneButton"},searchButton:{tap:"onTapSearchButton"},fullscreenButton:{tap:"onTapFullscreenButton"},shareButton:{tap:"onTapShareButton"},worksheetsButton:{tap:"onTapWorksheets"},"#id-worksheets-panel seworksheetlist list":{itemtap:"onSelectWorksheet"}},searchMode:!1,fullscreenMode:!1},launch:function(){this.callParent(arguments),Common.Gateway.on("init",Ext.bind(this.loadConfig,this))},initControl:function(){this.callParent(arguments)},initApi:function(){},setApi:function(e){this.api=e,this.api&&this.api.asc_registerCallback("asc_onTapEvent",Ext.bind(this.onSingleTapDocument,this))},loadConfig:function(e){var t=this.getDoneButton();t&&e&&e.config&&e.config.canBackToFolder===!0&&t.show()},applySearchMode:function(e){if(!!Ext.isBoolean(e)){var t=this,n=t.getSearchToolbar(),r=t.getSearchButton();return n&&(e?(r&&r.addCls("x-button-pressing"),t.getFullscreenMode()?n.show({easing:"ease-out",preserveEndState:!0,autoClear:!1,from:{top:"22px",opacity:.3},to:{top:"44px",opacity:.9}}):n.show()):t.getFullscreenMode()?n.hide({easing:"ease-in",to:{top:"22px",opacity:.3}}):n.hide()),e}Ext.Logger.error("Invalid parameters.")},applyFullscreenMode:function(e){if(!!Ext.isBoolean(e)){var t=this.getViewToolbar(),n=this.getSearchToolbar(),r=this.getFullscreenButton(),i=Ext.ComponentQuery.query("popclip");return i.length>0&&i[0].hide(),t&&n&&(e?(r&&r.addCls("x-button-pressing"),t.setStyle({position:"absolute",left:0,top:0,right:0,opacity:.9,"z-index":17}),n.setStyle({position:"absolute",left:0,top:"44px",right:0,opacity:.9,"z-index":16}),this.setHiddenToolbars(!0)):(t.setStyle({position:"initial",opacity:1}),n.setStyle({position:"initial",opacity:1}),t.setDocked("top"),n.setDocked("top"))),e}Ext.Logger.error("Invalid parameters.")},setHiddenToolbars:function(e){var t=this.getViewToolbar(),n=this.getSearchToolbar();t&&n&&(e?(t.hide({easing:"ease-out",from:{opacity:.9},to:{opacity:0}}),n.hide({easing:"ease-out",from:{opacity:.9},to:{opacity:0}})):(t.show({preserveEndState:!0,easing:"ease-in",from:{opacity:0},to:{opacity:.9}}),this.getSearchMode()&&n.show({preserveEndState:!0,easing:"ease-in",from:{opacity:0},to:{opacity:.9}})))},onTapDoneButton:function(){Common.Gateway.goBack()},onTapSearchButton:function(e){this.setSearchMode(!this.getSearchMode())},onTapFullscreenButton:function(e){this.setFullscreenMode(!this.getFullscreenMode()),this.api&&this.api.asc_Resize()},onTapShareButton:function(){this.api&&this.api.asc_Print(),Common.component.Analytics.trackEvent("ToolBar View","Share")},onSingleTapDocument:function(){var e=this.getViewToolbar();e&&this.getFullscreenMode()&&this.setHiddenToolbars(!e.isHidden())},onTapWorksheets:function(){var e=this.getWorksheetPanel(),t=this.getWorksheetsButton();e&&e.showBy(t)},onSelectWorksheet:function(e,t,n,r,i,s){var o=this.getWorksheetPanel();o&&o.hide()}}),Ext.define("SSE.profile.Phone",{extend:"Ext.app.Profile",config:{name:"phone",namespace:"phone",controllers:["Main","SSE.controller.Document","SSE.controller.Search","SSE.controller.WorksheetList","SSE.controller.toolbar.View"],views:["Main"],models:["SSE.model.Worksheet"],stores:["SSE.store.Worksheets"]},isActive:function(){return Ext.os.is.Phone&&(Ext.os.is.iOS||Ext.os.is.Android)},launch:function(){Ext.widget("sephonemain")}}),Ext.define("SSE.profile.Tablet",{extend:"Ext.app.Profile",config:{name:"tablet",namespace:"tablet",controllers:["Main","SSE.controller.Document","SSE.controller.Search","SSE.controller.WorksheetList","SSE.controller.toolbar.View"],views:["Main"],models:["SSE.model.Worksheet"],stores:["SSE.store.Worksheets"]},isActive:function(){return Ext.browser.is.WebKit&&(Ext.os.is.Tablet&&(Ext.os.is.iOS||Ext.os.is.Android)||Ext.os.is.Desktop)},launch:function(){Ext.widget("setabletmain")}});if(Common===undefined)var Common={};Common.Locale=new function(){var l10n={},_createXMLHTTPObject=function(){var e;try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){e=!1}}return!e&&typeof XMLHttpRequest!="undefined"&&(e=new XMLHttpRequest),e},_applyLocalization=function(){try{for(var e in l10n){var t=e.split(".");if(t&&t.length>2){var n=window;for(var r=0;r<t.length-1;++r){n=n[t[r]];if(n==undefined)break}n&&(n.prototype[t[t.length-1]]=l10n[e])}}}catch(i){}};try{var urlParams=Ext.urlDecode(location.search.substring(1)),xhrObj=_createXMLHTTPObject();if(xhrObj&&urlParams&&urlParams.lang){var lang=urlParams.lang.split("-")[0];xhrObj.open("GET","locale/"+lang+".json",!1),xhrObj.send(""),l10n=eval("("+xhrObj.responseText+")"),_applyLocalization()}}catch(e){}return{apply:_applyLocalization}},Ext.application({name:"SSE",icon:"resources/img/icon.png",tabletStartupScreen:"resources/img/tablet_startup.png",phoneStartupScreen:"resources/img/phone_startup.png",viewport:{autoMaximize:!1},profiles:["Tablet","Phone"]});