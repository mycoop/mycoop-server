/*
 * (c) Copyright Ascensio System SIA 2010-2014
 *
 * This program is a free software product. You can redistribute it and/or 
 * modify it under the terms of the GNU Affero General Public License (AGPL) 
 * version 3 as published by the Free Software Foundation. In accordance with 
 * Section 7(a) of the GNU AGPL its Section 15 shall be amended to the effect 
 * that Ascensio System SIA expressly excludes the warranty of non-infringement
 * of any third-party rights.
 *
 * This program is distributed WITHOUT ANY WARRANTY; without even the implied 
 * warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR  PURPOSE. For 
 * details, see the GNU AGPL at: http://www.gnu.org/licenses/agpl-3.0.html
 *
 * You can contact Ascensio System SIA at Lubanas st. 125a-25, Riga, Latvia,
 * EU, LV-1021.
 *
 * The  interactive user interfaces in modified source and object code versions
 * of the Program must display Appropriate Legal Notices, as required under 
 * Section 5 of the GNU AGPL version 3.
 *
 * Pursuant to Section 7(b) of the License you must retain the original Product
 * logo when distributing the program. Pursuant to Section 7(e) we decline to
 * grant you any rights under trademark law for use of our trademarks.
 *
 * All the Product's GUI elements, including illustrations and icon sets, as
 * well as technical writing content are licensed under the terms of the
 * Creative Commons Attribution-ShareAlike 4.0 International. See the License
 * terms at http://creativecommons.org/licenses/by-sa/4.0/legalcode
 *
 * Version: 1.0 (build:1)
 */
if(Common===undefined)var Common={};Common.Gateway=new function(){var e=this,t=$(e),n={init:function(e){t.trigger("init",e)},openDocument:function(e){t.trigger("opendocument",e)},showMessage:function(e){t.trigger("showmessage",e)},applyEditRights:function(e){t.trigger("applyeditrights",e)},processSaveResult:function(e){t.trigger("processsaveresult",e)},processRightsChange:function(e){t.trigger("processrightschange",e)},processMouse:function(e){t.trigger("processmouse",e)},internalCommand:function(e){t.trigger("internalcommand",e)},resetFocus:function(e){t.trigger("resetfocus",e)}},r=function(e){window.parent&&window.JSON&&window.parent.postMessage(window.JSON.stringify(e),"*")},i=function(e){var t=e.data;if(Object.prototype.toString.apply(t)!=="[object String]"||!window.JSON)return;var r,i;try{r=window.JSON.parse(t)}catch(s){r=""}r&&(i=n[r.command],i&&i.call(this,r.data))},s=function(e){i(e)};return window.attachEvent?window.attachEvent("onmessage",s):window.addEventListener("message",s,!1),{ready:function(){r({event:"onReady"})},goBack:function(){r({event:"onBack"})},save:function(e){r({event:"onSave",data:e})},requestEditRights:function(){r({event:"onRequestEditRights"})},reportError:function(e,t){r({event:"onError",data:{errorCode:e,errorDescription:t}})},setDocumentModified:function(e){r({event:"onDocumentStateChange",data:e})},internalMessage:function(e,t){r({event:"onInternalMessage",data:{type:e,data:t}})},on:function(n,r){var i=function(t,n){r.call(e,n)};t.on(n,i)}}};if(Common===undefined)var Common={};Common.component=Common.component||{},Common.Analytics=Common.component.Analytics=new function(){var e;return{initialize:function(t,n){if(typeof t=="undefined")throw"Analytics: invalid id.";if(typeof n=="undefined"||Object.prototype.toString.apply(n)!=="[object String]")throw"Analytics: invalid category type.";e=n,$("head").append('<script type="text/javascript">var _gaq = _gaq || [];_gaq.push(["_setAccount", "'+t+'"]);'+'_gaq.push(["_trackPageview"]);'+"(function() {"+'var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;'+'ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";'+'var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);'+"})();"+"</script>")},trackEvent:function(t,n,r){if(typeof t!="undefined"&&Object.prototype.toString.apply(t)!=="[object String]")throw"Analytics: invalid action type.";if(typeof n!="undefined"&&Object.prototype.toString.apply(n)!=="[object String]")throw"Analytics: invalid label type.";if(typeof r!="undefined"&&(Object.prototype.toString.apply(r)!=="[object Number]"||!isFinite(r)))throw"Analytics: invalid value type.";if(typeof _gaq=="undefined")return;if(e==="undefined")throw"Analytics is not initialized.";_gaq.push(["_trackEvent",e,t,n,r])}}};if(Common===undefined)var Common={};Common.IrregularStack=function(e){var t=[],n=function(e,t){return typeof e=="object"&&typeof t=="object"&&window.JSON?window.JSON.stringify(e)===window.JSON.stringify(t):e===t};e=e||{};var r=e.strongCompare||n,i=e.weakCompare||n,s=function(e,n){for(var r=t.length-1;r>=0;r--)if(n(t[r],e))return r;return-1},o=function(e){t.push(e)},u=function(e){var n=s(e,r);if(n!=-1){var i=t.splice(n,1);return i[0]}return undefined},a=function(e){var n=s(e,i);return n!=-1?t[n]:undefined},f=function(e){return!(s(e,r)<0)};return{push:o,pop:u,get:a,exist:f}},Ext.Loader.setConfig({enabled:!0,disableCaching:!1,paths:{Common:"../../common/main/lib"}}),Ext.define("Common.plugin.ScrollPane",{extend:"Ext.AbstractPlugin",alias:"plugin.scrollpane",areaSelector:".x-panel-body",settings:{},init:function(e){var t=this,n;t.settings=$.extend({enableKeyboardNavigation:!0,verticalDragMinHeight:16,horizontalDragMinWidth:16},t.settings),n=e.afterComponentLayout,e.afterComponentLayout=function(r,i){n.apply(e,arguments),r>0&&i>0&&t.initScrollPane()},t.callParent(arguments)},initScrollPane:function(e){var t=this,n,r,i;if(t.initializing)return;t.initializing=!0;if(!t.area||!t.area.length)i=e||t.cmp.getEl().dom,t.area=$(i).find("*").andSelf().filter(t.areaSelector).first();n=t.area.children(),r=n.filter("div.jspContainer"),n.length>1&&r.length>0&&(r.replaceWith($(".jspPane",r).children()),r=$()),t.jspApi&&r.length===0&&t.area.removeData("jsp"),t.area.jScrollPane(t.settings),t.jspApi=t.area.data("jsp"),t.doLayout(),delete t.initializing,i=e||t.cmp.getEl().dom,this._initSelectingScroll(i);if(r.length){var s=r.find(">.jspVerticalBar").find(">.jspTrack").find(">.jspDrag");s.on("mousedown.asc",function(e){return s[0].setCapture&&s[0].setCapture(),t.cmp.scrolllocked=!0,$("html").bind("mouseup.asc",function(e){s[0].releaseCapture&&s[0].releaseCapture(),t.cmp.scrolllocked=!1,$("html").unbind("mouseup.asc")}),!1})}},_initSelectingScroll:function(e){var t=this;$(e).off("mousedown.jsp"),$(e).on("mousedown.jsp",function(e){$(document).on("mousemove.jsp",i),$(document).on("mouseup.jsp",function(e){$(document).off("mousemove.jsp").off("mouseup.jsp"),s()})});var n=function(e,t){var n=t=="X"?"Left":"Top";return e["page"+t]||e["client"+t]+(document.documentElement["scroll"+n]||document.body["scroll"+n])||0},r,i=function(i){var o=$(e).offset().top,u=o+$(e).innerHeight(),a=n(i,"Y"),f=a<o?a-o:a>u?a-u:0;f==0?s():r||(r=setInterval(function(){t.jspApi.scrollByY(f)},10))},s=function(){r&&(clearInterval(r),r=undefined)}},updateScrollPane:function(e){this.initScrollPane(e),this.area&&this.area.attr("tabindex","-1")},scrollToElement:function(e,t,n){var r=this;r.jspApi&&r.jspApi.scrollToElement(e,t,n)},doLayout:function(){var e=this,t=e.cmp.items;t&&typeof t.each=="function"&&t.each(function(e){e.doComponentLayout()})}}),Ext.define("Common.plugin.DataViewScrollPane",{extend:"Common.plugin.ScrollPane",alias:"plugin.dataviewscrollpane",areaSelector:".x-component",init:function(e){var t=this,n;t.callParent(arguments),n=t.cmp.getStore(),n&&n.on("datachanged",function(){t.cmp&&t.cmp.rendered&&t.cmp.getWidth()>0&&t.cmp.getHeight()>0&&t.updateScrollPane()},t,{buffer:10}),t.cmp.on("viewready",t.onViewReady,t,{single:!0})},onKeyDown:function(e,t){var n=this,r=n.cmp.getStore(),i=function(e){var t=n.cmp.getNode(r.getAt(e)),i=Ext.create("Ext.Element",t);if(t){var s=Ext.getDom(n.cmp.getTargetEl())||Ext.getBody().dom,o=i.getOffsetsTo(s),u=o[1]+s.scrollTop,a=u+t.offsetHeight,f=s.clientHeight,l=parseInt(s.scrollTop,10),c=l+f;t.offsetHeight>f||u<l?n.jspApi&&n.jspApi.scrollByY(u,!1):a>c&&n.jspApi&&n.jspApi.scrollByY(a-f,!1)}};switch(e.getKey()){case e.UP:case e.DOWN:var s=n.cmp.getSelectionModel().getLastSelected(),o=s?r.indexOf(s):-1;i(o);break;case e.PAGE_UP:case e.PAGE_DOWN:break;case e.HOME:n.cmp.select(0),i(0);break;case e.END:n.cmp.select(r.count()-1),i(r.count()-1)}},onViewReady:function(){var e=this;e.cmp.getEl().on("keydown",e.onKeyDown,e)}}),Ext.define("Common.plugin.ComboBoxScrollPane",{extend:"Common.plugin.ScrollPane",alias:"plugin.comboboxscrollpane",areaSelector:".list-ct",init:function(e){e.on("expand",this.onExpand,this)},onExpand:function(e){var t=this;if(!t.picker){t.picker=e.getPicker(),t.picker.on({viewready:t.onViewReady,resize:function(){t.updateScrollPane()},beforecontainerclick:function(){return!1},beforeitemmouseenter:function(t,n,r,i,s,o){if(e.scrolllocked)return!1},scope:t}),t.cmp.on("afterlayout",t.onViewReady,t,{single:!0}),e.on("keydown",t.onKeyDown,t);var n=e.getStore();n.on("datachanged",t.onDataChanged,t,{buffer:10})}},onKeyDown:function(e,t,n){var r=this,i=function(e){var t=r.picker,n=t.all.item(e);if(n){var i=Ext.getDom(t.getTargetEl())||Ext.getBody().dom,s=n.dom,o=n.getOffsetsTo(i),u=o[1]+i.scrollTop,a=u+s.offsetHeight,f=i.clientHeight,l=parseInt(i.scrollTop,10),c=l+f;s.offsetHeight>f||u<l?r.jspApi&&r.jspApi.scrollByY(u,!1):a>c&&r.jspApi&&r.jspApi.scrollByY(a-f,!1)}};switch(t.getKey()){case t.UP:var s=r.picker,o=s.all,u=s.highlightedItem,a=u?s.indexOf(u):-1,f=a>0?a-1:o.getCount()-1;i(f);break;case t.DOWN:var s=r.picker,o=s.all,u=s.highlightedItem,a=u?s.indexOf(u):-1,f=a<o.getCount()-1?a+1:0;i(f);break;case t.PAGE_UP:case t.PAGE_DOWN:break;case t.HOME:i(0);break;case t.END:i(r.picker.all.getCount()-1)}},onViewReady:function(){var e=this;e.initScrollPane(e.picker.getEl().dom)},onDataChanged:function(){var e=this;e.picker.getWidth()&&e.picker.getHeight()&&e.initScrollPane(e.picker.getEl().dom)}}),Ext.define("Common.plugin.TextAreaAutoHeight",{extend:"Ext.AbstractPlugin",alias:"plugin.textareaautoheight",settings:{minHeight:32,maxHeight:120,growStep:17},init:function(e){this.callParent(arguments),e.addEvents("elastic"),e.on("afterrender",this.onAfterRender,this),e.on("change",this.onChange,this)},onAfterRender:function(e){var t=e.getEl().down("textarea");t&&(this.initHelper(t.id),this.elasticTextArea(t.id))},onChange:function(e){this.textareaElId||(this.textareaElId=e.getEl().down("textarea").id),this.elasticTextArea(this.textareaElId)},initHelper:function(e){var t=function(e,t){var n={},r=t.length;for(var i=0;i<r;i++)n[t[i]]=e.getStyle(t[i]);return n},n=function(e,t){if(t){var n=0,r;e=Ext.fly(e),Ext.isFunction(t)&&(t=t.call());if(typeof t=="string"){t=t.split(/:|;/g);for(r=t.length;n<r;)e.setStyle(t[n++],t[n++])}else Ext.isObject(t)&&e.setStyle(t)}};this.domEl=Ext.get(e),this.textareaElId=e;var r=t(this.domEl,["font-size","font-family","font-weight","font-style","line-height","letter-spacing","padding-left","padding-top","padding-right","padding-bottom"]);this.domEl.setStyle("overflow","hidden"),this.helperEl||(this.helperEl=Ext.DomHelper.append(this.domEl.parent(),{id:e+"-textarea-elastic-helper",tag:"div",style:"position: absolute; top: 0; left: 0; visibility: hidden; white-space: pre-wrap; word-wrap: break-word;"},!0),n(this.helperEl,r))},elasticTextArea:function(e){var t=this,n=this.domEl.dom.value||"&nbsp;";this.helperEl.setWidth(this.domEl.getWidth()),this.helperEl.update(n.replace(/<br \/>&nbsp;/,"<br />").replace(/<|>/g," ").replace(/&/g,"&amp;").replace(/\n/g,"<br />"));var r=this.helperEl.getHeight();r>t.settings.maxHeight&&t.settings.maxHeight>0&&(r=t.settings.maxHeight,this.domEl.setStyle("overflow","auto")),r<t.settings.minHeight&&t.settings.minHeight>0&&(r=t.settings.minHeight);var i=r+t.settings.growStep;t.cmp.getHeight()!=i&&(t.cmp.setHeight(i),t.cmp.fireEvent("elastic",t.cmp,this.domEl.getWidth(),i))}}),Ext.define("Common.plugin.MenuExpand",{extend:"Ext.AbstractPlugin",alias:"plugin.menuexpand",init:function(e){var t=this,n=e.onMouseLeave;e.onMouseLeave=function(t){n.apply(e,arguments),e.parentItem&&(e.parentItem.menuEntered=!1)},e.onMouseOver=t.onMouseOver,e.checkItemMenuEntered=t.checkItemMenuEntered,t.callParent(arguments)},checkItemMenuEntered:function(){var e=this;e.activeItem&&e.activeItem.menuEntered&&e.MouseOverInterval&&(clearInterval(e.MouseOverInterval),e.MouseOverInterval=undefined,e.activeItem.menuEntered=!1,e.checkeditem&&e.checkeditem.el.removeCls(e.checkeditem.activeCls),e.activeItem.el.addCls(e.activeItem.activeCls))},onMouseOver:function(e){var t=this,n=e.getRelatedTarget(),r=!t.el.contains(n),i=t.getItemFromEvent(e);r&&t.parentMenu&&(t.parentMenu.setActiveItem(t.parentItem),t.parentMenu.mouseMonitor.mouseenter());if(t.disabled)return;t.checkeditem&&i!=t.checkeditem&&t.checkeditem.el.removeCls(t.checkeditem.activeCls),(t.checkeditem=i)&&t.checkeditem.el.addCls(t.checkeditem.activeCls);if(t.activeItem&&t.activeItem.menu){if(i&&i!=t.activeItem&&i!=t.focusedItem&&t.MouseOverInterval===undefined){var s=0;t.activeItem.menuEntered=!1,t.MouseOverInterval=setInterval(function(){t.checkItemMenuEntered(),s++>8&&(clearInterval(t.MouseOverInterval),t.MouseOverInterval=undefined,t.checkeditem&&(t.setActiveItem(t.checkeditem),t.checkeditem.activated&&t.checkeditem.expandMenu&&t.checkeditem.expandMenu()))},20)}}else i&&(t.setActiveItem(i),i.activated&&i.expandMenu&&i.expandMenu());r&&(t.parentItem&&(t.parentItem.menuEntered=!0),t.fireEvent("mouseenter",t,e)),t.fireEvent("mouseover",t,i,e)}}),Ext.define("Common.component.LoadMask",{extend:"Ext.Component",alias:"widget.cmdloadmask",mixins:{floating:"Ext.util.Floating"},useMsg:!0,disabled:!1,baseCls:"cmd-loadmask",config:{title:""},renderTpl:['<div style="position:relative" class="{baseCls}-body">',"<div>",'<div class="{baseCls}-image"></div>','<div class="{baseCls}-title"></div>',"</div>",'<div class="{baseCls}-pwd-ct">','<div class="{baseCls}-pwd-by">POWERED BY</div>','<div class="{baseCls}-pwd-tm">ONLYOFFICE</div>',"</div>","</div>"],modal:!0,width:"auto",floating:{shadow:!1},focusOnToFront:!1,constructor:function(e,t){var n=this;e.isComponent?(n.ownerCt=e,n.bindComponent(e)):(n.ownerCt=new Ext.Component({el:Ext.get(e),rendered:!0,componentLayoutCounter:1}),n.container=e),n.callParent([t]),n.renderSelectors={titleEl:"."+n.baseCls+"-title"}},bindComponent:function(e){this.mon(e,{resize:this.onComponentResize,scope:this})},applyTitle:function(e){var t=this;t.title=e;if(t.rendered){t.titleEl.update(t.title);var n=t.floatParent?t.floatParent.getTargetEl():t.container,r=t.getEl().getAlignToXY(n,"c-c"),i=n.translatePoints(r[0],r[1]);(Ext.isDefined(i.left)||Ext.isDefined(i.top))&&t.setPosition(i.left,i.top)}},afterRender:function(){this.callParent(arguments),this.container=this.floatParent.getContentTarget()},onComponentResize:function(){var e=this;e.rendered&&e.isVisible()&&(e.toFront(),e.center())},onDisable:function(){this.callParent(arguments),this.loading&&this.onLoad()},onBeforeLoad:function(){var e=this,t=e.ownerCt||e.floatParent,n;this.disabled||(t.componentLayoutCounter?Ext.Component.prototype.show.call(e):(n=t.afterComponentLayout,t.afterComponentLayout=function(){t.afterComponentLayout=n,n.apply(t,arguments),e.loading&&Ext.Component.prototype.show.call(e)}))},onHide:function(){var e=this;e.callParent(arguments),e.showOnParentShow=!0},onShow:function(){var e=this;e.callParent(arguments),e.loading=!0,e.setTitle(e.title)},afterShow:function(){this.callParent(arguments),this.center()},onLoad:function(){this.loading=!1,Ext.Component.prototype.hide.call(this)}}),Ext.define("Common.component.MetricSpinner",{extend:"Ext.form.field.Spinner",alias:"widget.commonmetricspinner",defaultUnit:"px",minValue:0,maxValue:100,step:1,textAlign:"right",allowAuto:!1,autoText:"Auto",mouseWheelEnabled:!1,constructor:function(e){var t=function(e,t,n){var r=Math.pow(10,n||2);return(Math.round(e*r)+Math.round(t*r))/r},n=this.minValue;this.setValue=function(e,r){if(!Ext.isDefined(e)||e==="")this.value="";else if(this.allowAuto&&(Math.abs(parseFloat(e)+1)<1e-4||e==this.autoText))this.value=this.autoText;else{var i=t(parseFloat(e),0,3);if(!Ext.isDefined(i)||isNaN(i))i=n;var s=this.defaultUnit;if(Ext.isDefined(e.match)){var o=e.match(/(px|em|%|en|ex|pt|in|cm|mm|pc|s|ms)$/i);null!==o&&Ext.isDefined(o[0])&&(s=o[0].toLowerCase())}this.defaultUnit!==s&&(i=this._recalcUnits(i,s)),i>this.maxValue&&(i=this.maxValue),i<this.minValue&&(i=this.minValue),this.value=(i+" "+this.defaultUnit).trim(),n=i}r!==!0&&this.checkChange();var u=function(e){this.setRawValue(e)};this.rendered?u.call(this,this.value):this.on("afterrender",Ext.bind(u,this,[this.value]),{single:!0})},this.onSpinUp=function(){var e=this;if(!e.readOnly){var r=e.step;e.getValue()!==""?(e.allowAuto&&e.getValue()==e.autoText?r=e.minValue-e.step:r=parseFloat(e.getValue()),isNaN(r)&&(r=n)):r=e.minValue-e.step,e.setValue((t(r,e.step,3)+" "+this.defaultUnit).trim(),!0)}},this.onSpinDown=function(){var e=this;if(!e.readOnly){var r=e.step;if(e.getValue()!==""){e.allowAuto&&e.getValue()==e.autoText?r=e.minValue:r=parseFloat(e.getValue()),isNaN(r)&&(r=n);if(e.allowAuto&&t(r,-e.step,3)<e.minValue){e.setValue(e.autoText,!0);return}}else r=e.minValue;e.setValue((t(r,-e.step,3)+" "+this.defaultUnit).trim(),!0)}},this.callParent(arguments)},initComponent:function(){Ext.isDefined(this.value)||(this.value=(this.minValue+" "+this.defaultUnit).trim()),this.on("specialkey",function(e,t){t.getKey()==t.ENTER&&(this.onEnterValue(),t.stopEvent())},this),this.callParent(arguments)},setDefaultUnit:function(e){if(this.defaultUnit!=e){var t=this.defaultUnit;this.defaultUnit=e,this.setMinValue(this._recalcUnits(this.minValue,t)),this.setMaxValue(this._recalcUnits(this.maxValue,t)),this.setValue(this._recalcUnits(this.getNumberValue(),t),!0)}},setMinValue:function(e){this.minValue=e},setMaxValue:function(e){this.maxValue=e},setStep:function(e){this.step=e},getNumberValue:function(){return this.allowAuto&&this.value==this.autoText?-1:parseFloat(this.value)},getUnitValue:function(){return this.defaultUnit},getValue:function(){return this.value},onEnterValue:function(){if(Ext.isDefined(this.inputEl)){var e=this.inputEl.getValue();this.setValue(e===""?this.value:e)}},afterRender:function(){var e=this;this.callParent(arguments),this.inputEl&&Ext.DomHelper.applyStyles(this.inputEl,Ext.String.format("text-align:{0}",this.textAlign)),this.triggerRepeater&&this.triggerRepeater.on("mouseup",function(){e.checkChange()},this)},onBlur:function(e,t){if(Ext.isDefined(this.inputEl)){var n=this.inputEl.getValue();this.setValue(n===""?this.value:n)}},_recalcUnits:function(e,t){if(t.match(/(s|ms)$/i)&&this.defaultUnit.match(/(s|ms)$/i)){var n=e;return t=="ms"&&(n/=1e3),this.defaultUnit=="ms"&&(n*=1e3),n}if(t.match(/(pt|in|cm|mm|pc)$/i)===null||this.defaultUnit.match(/(pt|in|cm|mm|pc)$/i)===null)return e;var n=e;return t=="cm"?n*=10:t=="pt"?n=n*25.4/72:t=="in"?n*=25.4:t=="pc"&&(n=n*25.4/6),this.defaultUnit=="cm"?n/=10:this.defaultUnit=="pt"?n=parseFloat(Ext.Number.toFixed(n*72/25.4,3)):this.defaultUnit=="in"?n/=25.4:this.defaultUnit=="pc"&&(n=n*6/25.4),n}}),Ext.define("Common.component.IndeterminateCheckBox",{extend:"Ext.form.field.Checkbox",alias:"widget.cmdindeterminatecheckbox",value:"unchecked",indeterminate:!1,indeterminateCls:Ext.baseCSSPrefix+"form-cb-indeterminate",onBoxClick:function(e){var t=this;!t.disabled&&!t.readOnly&&(this.indeterminate?(this.indeterminate=!1,this.setValue(!1)):this.setValue(!this.checked))},getRawValue:function(){return this.value},getValue:function(){return this.value},setRawValue:function(e){var t=this,n=t.inputEl,r=t.inputValue,i=e===!0||e==="true"||e==="1"||e===1||((Ext.isString(e)||Ext.isNumber(e))&&r?e==r:t.onRe.test(e)),s=e==="indeterminate";return n&&(n.dom.setAttribute("aria-checked",i),n.dom.setAttribute("aria-indeterminate",s),t[s?"addCls":"removeCls"](t.indeterminateCls),t[i?"addCls":"removeCls"](t.checkedCls)),t.checked=t.rawValue=i,t.indeterminate=s,t.value=s?"indeterminate":i?"checked":"unchecked",i},setValue:function(e){var t=this,n=function(e,n){return Ext.isArray(e)?t.getManager().getByName(t.name).each(function(t){t.setValue(Ext.Array.contains(e,t.inputValue))}):(t.setRawValue(e),(!Ext.isDefined(n)||!n)&&t.checkChange()),t};this.rendered?n.call(this,e):this.on("afterrender",Ext.bind(n,this,[e,!0]),{single:!0})}}),Ext.define("Common.component.SearchField",{extend:"Ext.container.Container",alias:"widget.commonsearchfield",height:22,layout:{type:"hbox",align:"stretch"},cls:"common-searchfield",require:["Ext.data.Store","Ext.button.Button","Ext.container.Container"],initComponent:function(){var e=this;e.searching=!1,e.txtSearchQuery=Ext.create("Ext.form.field.Text",{flex:1,emptyText:this.emptyText,tabIndex:this.tabIndex||-1,listeners:{specialkey:function(t,n){n.getKey()==n.ENTER?(e.stopSearch(),e.startSearch()):n.getKey()==n.TAB&&(e.stopSearch(),e.focus(),e.blur())},change:function(t,n){e.btnClear.setVisible(!e.isValueEmpty())},blur:function(t,n){e.isValueValid()||e.clear()}}}),e.btnClear=Ext.create("Ext.button.Button",{iconCls:"search-btn-clear-icon",hidden:!0,listeners:{click:function(){e.searching?e.stopSearch():e.clear()}}}),e.items=[e.txtSearchQuery,e.btnClear],e.relayEvents(e.txtSearchQuery,["change"]),e.addEvents("searchstart","searchstop","searchclear"),e.callParent(arguments)},startSearch:function(e){var t=this;!t.searching&&t.isValueValid()&&(t.searching=!0,t.btnClear.setIconCls("search-btn-start-icon").toggle(!0).disable(),e||t.fireEvent("searchstart",t,t.getText()))},stopSearch:function(e){var t=this;t.searching&&(t.searching=!1,t.btnClear.setIconCls("search-btn-clear-icon").toggle(!1).enable(),e||t.fireEvent("searchstop",t))},clear:function(e){var t=this;t.searching||(t.txtSearchQuery.reset(),e||t.fireEvent("searchclear",t))},isValueValid:function(){var e=this.txtSearchQuery.getValue();return!Ext.isEmpty(e)},isValueEmpty:function(){return this.txtSearchQuery.getValue().length==0},setText:function(e){this.txtSearchQuery.setValue(e)},getText:function(){return this.txtSearchQuery.getValue()},setValue:function(e){this.txtSearchQuery.setValue(e)},getValue:function(){return this.txtSearchQuery.getValue()},focus:function(e,t){this.txtSearchQuery.focus(e,t)}});if(Common===undefined)var Common={};Common.MetricSettings=new function(){var e=this;return e.c_MetricUnits={cm:0,pt:1},e.currentMetric=e.c_MetricUnits.pt,e.metricName=["cm","pt"],{c_MetricUnits:e.c_MetricUnits,metricName:e.metricName,setCurrentMetric:function(t){e.currentMetric=t},getCurrentMetric:function(){return e.currentMetric},fnRecalcToMM:function(t){if(t!==null&&t!==undefined)switch(e.currentMetric){case e.c_MetricUnits.cm:return t*10;case e.c_MetricUnits.pt:return t*25.4/72}return t},fnRecalcFromMM:function(t){switch(e.currentMetric){case e.c_MetricUnits.cm:return parseFloat(Ext.Number.toFixed(t/10,4));case e.c_MetricUnits.pt:return parseFloat(Ext.Number.toFixed(t*72/25.4,3))}return t}}},Ext.define("Common.model.User",{extend:"Ext.data.Model",fields:[{type:"string",name:"id",defaultValue:""},{type:"string",name:"username",defaultValue:"Guest"},{type:"string",name:"color"},{type:"boolean",name:"online",defaultValue:!1}]}),Ext.define("Common.model.ChatMessage",{extend:"Ext.data.Model",fields:[{type:"int",name:"type"},{type:"string",name:"userid"},{type:"string",name:"message"}]}),Ext.define("Common.model.Comment",{extend:"Ext.data.Model",fields:[{type:"string",name:"id"},{type:"string",name:"userid"},{type:"string",name:"username",defaultValue:"Guest"},{type:"int",name:"date"},{type:"string",name:"quote"},{type:"string",name:"comment"},{type:"boolean",name:"resolved",defaultValue:!1},{type:"boolean",name:"lock",defaultValue:!1},{type:"string",name:"lockuserid"}],proxy:{type:"memory"},hasMany:{model:"Common.model.Reply",name:"replys"}}),Ext.define("Common.model.Reply",{extend:"Ext.data.Model",fields:[{type:"int",name:"id"},{type:"string",name:"userid"},{type:"string",name:"username",defaultValue:""},{type:"int",name:"date"},{type:"string",name:"reply"}],proxy:{type:"memory"},belongsTo:{model:"Common.model.Comment",name:"comment"}}),Ext.define("Common.store.ChatMessages",{extend:"Ext.data.Store",model:"Common.model.ChatMessage"}),Ext.define("Common.store.Comments",{extend:"Ext.data.Store",model:"Common.model.Comment",sorters:[{property:"date",direction:"DESC"}]}),Ext.define("Common.store.Users",{extend:"Ext.data.Store",model:"Common.model.User",getOnlineUserCount:function(){var e=this.getCount(),t,n=0;while(e>0)t=this.getAt(--e),t.data.online&&n++;return n}}),Ext.define("Common.view.About",{extend:"Ext.container.Container",alias:"widget.commonabout",cls:"common-about-body",requires:["Ext.container.Container","Ext.form.Label"],constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){var e="2.5",t="support@onlyoffice.com",n="+371 660-16425",r="www.onlyoffice.com",i="Ascensio System SIA";this.items=[{xtype:"container",layout:{type:"table",columns:1,tableAttrs:{style:"width: 100%;"},tdAttrs:{align:"center"}},items:[{xtype:"container",cls:"asc-about-office"},{xtype:"tbspacer",height:5},{xtype:"label",cls:"asc-about-version",text:this.txtVersion+e},{xtype:"tbspacer",height:40}]},{xtype:"container",layout:{type:"table",columns:3,tableAttrs:{style:"width: 100%;"}},items:[{cellCls:"about-separator-cell",xtype:"tbspacer",width:"100%",html:'<div style="width: 100%; height: 3px !important; background-color: #e1e1e1"></div>'},{xtype:"label",cls:"asc-about-header",text:this.txtLicensor},{cellCls:"about-separator-cell",xtype:"tbspacer",width:"100%",html:'<div style="width: 100%; height: 3px !important; background-color: #e1e1e1"></div>'}]},{xtype:"container",layout:{type:"table",columns:1,tableAttrs:{style:"width: 100%;"},tdAttrs:{align:"center"}},items:[{xtype:"tbspacer",height:20},{xtype:"label",cls:"asc-about-companyname",text:i},{xtype:"tbspacer",height:10},{xtype:"container",items:[{xtype:"label",cls:"asc-about-desc-name",text:this.txtAddress},{xtype:"label",cls:"asc-about-desc",text:this.txtAscAddress}]},{xtype:"tbspacer",height:10},{xtype:"container",items:[{xtype:"label",cls:"asc-about-desc-name",text:this.txtMail},{xtype:"label",cls:"asc-about-desc",html:Ext.String.format('<a href="mailto:{0}">{0}</a>',t)}]},{xtype:"tbspacer",height:10},{xtype:"container",items:[{xtype:"label",cls:"asc-about-desc-name",text:this.txtTel},{xtype:"label",cls:"asc-about-desc",text:n}]},{xtype:"tbspacer",height:10},{xtype:"label",cls:"asc-about-desc",html:Ext.String.format('<a href="http://{0}" target="_blank">{0}</a>',r)},{xtype:"tbspacer",height:40}]},{xtype:"container",layout:{type:"table",columns:3,tableAttrs:{style:"width: 100%;"}},items:[{cellCls:"about-separator-cell",xtype:"tbspacer",width:"100%",html:'<div style="width: 100%; height: 3px !important; background-color: #e1e1e1"></div>'},{xtype:"label",cls:"asc-about-header",text:this.txtLicensee},{cellCls:"about-separator-cell",xtype:"tbspacer",width:"100%",html:'<div style="width: 100%; height: 3px !important; background-color: #e1e1e1"></div>'}]},this.cntLicenseeInfo=Ext.create("Ext.Container",{layout:{type:"table",columns:1,tableAttrs:{style:"width: 100%;"},tdAttrs:{align:"center"}},items:[{xtype:"tbspacer",height:20},this.imgCompanyLogo=Ext.create("Ext.Container",{html:'<img src="" />'}),{xtype:"tbspacer",height:10},this.lblCompanyName=Ext.create("Ext.form.Label",{cls:"asc-about-companyname",text:""}),{xtype:"tbspacer",height:10},{xtype:"container",items:[{xtype:"label",cls:"asc-about-desc-name",text:this.txtAddress},this.lblCompanyAddress=Ext.create("Ext.form.Label",{cls:"asc-about-desc",text:""})]},{xtype:"tbspacer",height:10},{xtype:"container",items:[{xtype:"label",cls:"asc-about-desc-name",text:this.txtMail},this.lblCompanyMail=Ext.create("Ext.form.Label",{cls:"asc-about-desc",text:""})]},{xtype:"tbspacer",height:10},this.lblCompanyUrl=Ext.create("Ext.form.Label",{cls:"asc-about-desc",text:""}),{xtype:"tbspacer",height:10},this.lblCompanyLic=Ext.create("Ext.form.Label",{cls:"asc-about-lic",text:""})]})],this.callParent(arguments),this.items.items[3].hide(),this.cntLicenseeInfo.hide()},setLicInfo:function(e){if(e&&typeof e=="object"){this.items.items[3].show(),this.cntLicenseeInfo.show(),this.lblCompanyName.setText(e.asc_getCustomer());var t=e.asc_getCustomerAddr();t&&t.length?this.lblCompanyAddress.setText(t):(this.cntLicenseeInfo.items.getAt(5).hide(),this.cntLicenseeInfo.items.getAt(6).hide()),t=e.asc_getCustomerMail(),t&&t.length?this.lblCompanyMail.update(Ext.String.format('<a href="mailto:{0}">{0}</a>',t)):(this.cntLicenseeInfo.items.getAt(7).hide(),this.cntLicenseeInfo.items.getAt(8).hide()),t=e.asc_getCustomerWww();if(t&&t.length){var n=/^label:(.+);url:(.+)/.exec(t);if(n)r=n[2],t=n[1];else var r=/^https?:\/\//.test(t)?t:"http://"+t;this.lblCompanyUrl.update(Ext.String.format('<a href="{0}" target="_blank">{1}</a>',r,t))}else this.cntLicenseeInfo.items.getAt(9).hide(),this.cntLicenseeInfo.items.getAt(10).hide();(t=e.asc_getCustomerInfo())&&t.length?this.lblCompanyLic.setText(t):this.cntLicenseeInfo.items.getAt(11).hide(),(t=e.asc_getCustomerLogo())&&t.length?this.imgCompanyLogo.html='<img src="'+t+'" />':(this.imgCompanyLogo.hide(),this.cntLicenseeInfo.items.getAt(2).hide())}else this.items.items[3].hide(),this.cntLicenseeInfo.hide()},txtVersion:"Version ",txtLicensor:"LICENSOR",txtLicensee:"LICENSEE",txtAddress:"address: ",txtAscAddress:"Lubanas st. 125a-25, Riga, Latvia, EU, LV-1021",txtMail:"email: ",txtTel:"tel.: "}),Ext.define("Common.view.Header",{extend:"Ext.container.Container",alias:"widget.commonheader",cls:"common-header",config:{headerCaption:"Default Caption",documentCaption:"",canBack:!1},constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){this.html='<div id="header-logo"></div><span id="header-caption"></span><span id="header-delimiter">-</span><span id="header-documentcaption"></span><span id="header-back">'+this.textBack+"</span>",this.callParent(arguments)},afterRender:function(e){this.callParent(arguments),$("#header-logo").on("click",function(e){var t=window.open("http://www.onlyoffice.com");t&&t.focus()})},applyHeaderCaption:function(e){var t=Ext.fly("header-caption");return t&&Ext.DomHelper.overwrite(t,e),e},applyDocumentCaption:function(e){e||(e="");var t=Ext.fly("header-delimiter");t&&t.setVisible(e.length>0);var n=Ext.fly("header-documentcaption");return n&&Ext.DomHelper.overwrite(n,Ext.htmlEncode(e)),e},applyCanBack:function(e){var t=Ext.fly("header-back");t&&(t.un("click"),t.setVisible(e),e&&t.on("click",Ext.bind(this.onBackClick,this)))},onBackClick:function(e){Common.Gateway.goBack(),Common.component.Analytics.trackEvent("Back to Folder")},textBack:"Go to Documents"}),Ext.define("Common.view.ChatPanel",{extend:"Ext.container.Container",alias:"widget.commonchatpanel",cls:"common-chatpanel",requires:["Common.plugin.DataViewScrollPane","Ext.XTemplate","Ext.view.View","Ext.form.Label","Ext.util.TextMetrics"],layout:{type:"vbox",align:"stretch"},createDelayedElements:function(){var e=this,t=Ext.getStore("Common.store.Users");e.add([{xtype:"label",cls:"chat-header",text:this.textChat,width:"100%"},{xtype:"dataview",height:65,width:"100%",id:"id-chat-users",cls:"chat-users-view",group:"scrollable",store:"Common.store.Users",blockRefresh:!0,disableSelection:!0,tpl:new Ext.XTemplate('<tpl for=".">','<tpl if="online">','<div class="chat-user-wrap">','<div class="color" style="background-color: {[this.getUserColor(values.id)]};"></div>','<label class="name">{[this.getUserName(values.id)]}</label>',"</div>","</tpl>",'<tpl if="!online">','<div class="chat-user-wrap hidden"></div>',"</tpl>","</tpl>",{compiled:!0,getUserColor:function(e){if(t){var n=t.findRecord("id",e);if(n)return n.data.color}return"#000"},getUserName:function(e){if(t){var n=t.findRecord("id",e);if(n)return Ext.String.ellipsis(Ext.String.htmlEncode(n.get("username")),23,!0)}return this.textAnonymous}}),itemSelector:"div.chat-user-wrap",overItemCls:"x-item-over",emptyText:"There is no authorized users",autoScroll:!0,plugins:[{ptype:"dataviewscrollpane",pluginId:"scrollpane",areaSelector:".chat-users-view",settings:{enableKeyboardNavigation:!0,verticalGutter:1}}]},{xtype:"dataview",flex:1,id:"id-chat-msg",cls:"chat-msg-view",group:"scrollable",store:"Common.store.ChatMessages",blockRefresh:!0,disableSelection:!0,tpl:new Ext.XTemplate('<tpl for=".">','<div class="chat-msg-wrap">','<tpl if="type == 1">','<div class="message service">{[this.fixMessage(values.message)]}</div>',"</tpl>",'<tpl if="type != 1">','<label class="user" data-can-copy="true" style="color: {[this.getUserColor(values.userid)]};">{username}:&nbsp</label>','<label class="message" data-can-copy="true">{[this.fixMessage(values.message)]}</label>',"</tpl>","</div>","</tpl>",{compiled:!0,getUserColor:function(e){if(t){var n=t.findRecord("id",e);if(n)return n.data.color}return"#000"},getUserName:function(n){if(t){var r=t.findRecord("id",n);if(r)return Ext.String.ellipsis(Ext.String.htmlEncode(r.get("username")),23,!0)}return e.textAnonymous},fixMessage:function(e){var t=function(e){var t=/[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}/i.exec(e);if(t)e=e.replace(t[0],'<a href="mailto:'+t[0]+">"+t[0]+"</a>");else{t=e.match(/((https?|ftps?):\/\/)(www.)?([a-z0-9-]+)(\.[a-z]{2,6})?(\/\S*)?/ig),!t&&(t=e.match(/((https?|ftps?):\/\/)?(www.)?([a-z0-9-]+)(\.[a-z]{2,6})(\/\S*)?/ig));for(var n in t)e=e.replace(t[n],'<a href="'+(t[n].search(/((https?|ftps?):\/\/)/g)<0?"http://":"")+t[n]+'" target="_blank">'+t[n]+"</a>")}return e},n=function(e){return Ext.String.htmlEncode(e)};return t(n(e)).replace(/\n/g,"<br/>")}}),itemSelector:"div.chat-msg-wrap",emptyText:"",autoScroll:!0,plugins:[{ptype:"scrollpane",pluginId:"scrollpane",areaSelector:".chat-msg-view",settings:{enableKeyboardNavigation:!0,verticalGutter:1}}]},{xtype:"tbspacer",height:10},{xtype:"container",layout:{type:"vbox",align:"stretch"},cls:"add-msg-container",height:100,items:[{xtype:"textarea",id:"id-chat-textarea",height:62,enableKeyEvents:!0},{xtype:"container",layout:"hbox",items:[{xtype:"tbspacer",flex:1},{xtype:"button",id:"id-btn-send-msg",cls:"btn-send-msg asc-blue-button",text:this.textSend}]}]}])},textChat:"Chat",textSend:"Send",textAnonymous:"Guest"}),Ext.define("Common.view.CommentsEditForm",{extend:"Ext.container.Container",alias:"widget.commoncommentseditform",cls:"common-commentseditform",requires:["Common.plugin.TextAreaAutoHeight","Ext.form.TextArea","Ext.Button"],layout:{type:"vbox",align:"stretch"},constructor:function(e){this.initConfig(e);if(!e||!e.scope||!e.editId||!e.renderTo||!e.onEditHandler||!e.onCancelHandler)throw Error("Common.view.CommentsEditForm creation failed: required parameters are missing.");return this.callParent(arguments),this},initComponent:function(){var e=this;e.id="controls-edit-msg-"+e.editId,e.cls="controls-edit-msg-container",e.height=80,e.items=[{xtype:"textarea",height:20,value:e.msgValue,enableKeyEvents:!0,listeners:{elastic:Ext.bind(this.elasticTextArea,this),keydown:Ext.bind(this.keyDownTextArea,this)},plugins:[{ptype:"textareaautoheight",pluginId:"elastic-helper"}]},{xtype:"container",layout:"hbox",height:26,id:"controls-edit-msg-"+e.editId+"-buttons",items:[{xtype:"button",text:e.textEdit,cls:"asc-blue-button",action:"edit",handler:Ext.bind(function(t,n){e.onEditHandler.call(e.scope,t)},e.scope)},{xtype:"tbspacer",width:10},{xtype:"button",text:e.textCancel,handler:Ext.bind(function(t,n){e.onCancelHandler.call(e.scope,t)},e.scope)}]}],e.on("afterrender",Ext.bind(this.onAfterRender,this)),e.callParent(arguments)},onAfterRender:function(e){var t=e.down("textarea");t&&t.fireEvent("change")},elasticTextArea:function(e,t,n){var r=e.ownerCt;if(r){var i=r.down("container");if(i){var s=parseInt(r.getEl().getStyle("padding-top")),o=parseInt(r.getEl().getStyle("padding-bottom")),u=i.rendered?i.getHeight():i.height||0;r.setHeight(n+u+s+o+5)}}},keyDownTextArea:function(e,t){if(t.getKey()==t.ENTER&&(t.ctrlKey||t.metaKey)&&!t.shiftKey){var n=this;e.getValue().length>0&&(t.stopEvent(),n.onEditHandler.call(n.scope,n.down("button[action=edit]")))}},textEdit:"Edit",textCancel:"Cancel"}),Ext.define("Common.view.CommentsPanel",{extend:"Ext.container.Container",alias:"widget.commoncommentspanel",cls:"common-commentspanel",requires:["Common.plugin.DataViewScrollPane","Ext.Date","Ext.XTemplate","Ext.form.Label"],uses:["Common.plugin.TextAreaAutoHeight","Ext.util.TextMetrics"],layout:{type:"vbox",align:"stretch"},config:{currentUserId:-1},constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){var e=this,t=Ext.getStore("Common.store.Users");e.items=[{xtype:"label",cls:"comments-header",text:e.textComments,width:"100%"},{xtype:"dataview",flex:1,id:"id-comments",cls:"comments-view",group:"scrollable",store:Ext.getStore("Common.store.Comments")||Ext.create("Common.store.Comments",{storeId:"Common.store.Comments"}),blockRefresh:!0,disableSelection:!0,tpl:new Ext.XTemplate('<tpl for=".">','<tpl if="lock">','<div class="comment-wrap lock" id="comment-{id}">',"</tpl>",'<tpl if="!lock">','<div class="comment-wrap" id="comment-{id}">',"</tpl>",'<div class="header">','<div class="user-info" >','<div class="user">{[this.getUserName(values.userid, values.username)]}</div>','<div class="date">{[this.getLocaleDate(values.date)]}</div>',"</div>",'<div class="edit-info">','<tpl if="this.canEditReply(userid)">','<div class="btn-header comment edit"></div>','<div class="btn-header comment delete"></div>',"</tpl>",'<tpl if="resolved">','<label class="resolve resolved">',e.textResolved,"</label>","</tpl>",'<tpl if="!resolved">','<label class="resolve">',e.textResolve,"</label>","</tpl>","</div>","</div>",e.noQuotes?"":'<div class="quote">{[this.getFixedQuote(values.quote)]}</div>','<div class="comment-message">','<div class="comment" data-can-copy="true">{[this.fixMessage(values.comment)]}</div>',"</div>",'<div class="replys">','<tpl for="replys">','<div class="reply" id="reply-{id}">','<div class="header">','<div class="user-info" >','<div class="user">{[this.getUserName(values.userid, values.username)]}</div>','<div class="date">{[this.getLocaleDate(values.date)]}</div>',"</div>",'<div class="edit-info">','<tpl if="this.canEditReply(userid)">','<div class="btn-header reply edit"></div>','<div class="btn-header reply delete"></div>',"</tpl>","</div>","</div>",'<div class="reply-message">','<div class="message" data-can-copy="true">{[this.fixMessage(values.reply)]}</div>',"</div>","</div>","</tpl>","</div>",'<div id="comment-{id}-add-reply-container" class="add-reply-container"></div>','<div class="separator"></div>','<div class="lock-area"></div>','<div class="lock-author">{[this.getLockUserName(values.lockuserid)]}</div>',"</div>","</tpl>",'<div class="last-clear"></div>','<div class="x-clear"></div>',{compiled:!0,canEditReply:function(e){return!0},getFixedQuote:function(e){return Ext.String.ellipsis(Ext.String.htmlEncode(e),120,!0)},getLocaleDate:function(e){if(!e)return Ext.String.format("{0} {1}","--/--/--","--:-- AM");var t=new Date(e);return Ext.String.format("{0} {1}",Ext.Date.format(t,"n/j/Y"),Ext.Date.format(t,"g:i A"))},getUserName:function(n,r){if(t){var i=t.findRecord("id",n);if(i)return Ext.String.ellipsis(Ext.String.htmlEncode(i.get("username")),15,!0);if(Ext.isString(r)&&r.length>0)return r}return e.textAnonym},getLockUserName:function(n){if(t){var r=t.findRecord("id",n);if(r)return Ext.String.ellipsis(Ext.String.htmlEncode(r.get("username")),15,!0)}return e.textAnonym},fixMessage:function(e){var t=function(e){var t=/[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}/i.exec(e);if(t)e=e.replace(t[0],'<a href="mailto:'+t[0]+">"+t[0]+"</a>");else{t=e.match(/((https?|ftps?):\/\/)(www.)?([a-z0-9-]+)(\.[a-z]{2,6})?(\/\S*)?/ig),!t&&(t=e.match(/((https?|ftps?):\/\/)?(www.)?([a-z0-9-]+)(\.[a-z]{2,6})(\/\S*)?/ig));for(var n in t)e=e.replace(t[n],'<a href="'+(t[n].search(/((https?|ftps?):\/\/)/g)<0?"http://":"")+t[n]+'" target="_blank">'+t[n]+"</a>")}return e},n=function(e){return Ext.String.htmlEncode(e)};return t(n(e)).replace(/\n/g,"<br/>")}}),itemSelector:"div.comment-wrap",emptyText:"",autoScroll:!0,plugins:[{ptype:"dataviewscrollpane",pluginId:"scrollpane",areaSelector:".comments-view",settings:{enableKeyboardNavigation:!0,verticalGutter:1}}]},{xtype:"container",id:"id-add-comment-link",cls:"add-comment-container add-link",html:"<label>"+e.textAddCommentToDoc+"</label>",height:45},{xtype:"container",layout:{type:"vbox",align:"stretch"},id:"id-add-comment-container",cls:"add-comment-container",height:115,hidden:!0,items:[{xtype:"textarea",id:"id-comment-textarea",height:62,enableKeyEvents:!0},{xtype:"container",layout:"hbox",items:[{xtype:"button",id:"id-btn-send-comment",cls:"btn-send-comment asc-blue-button",text:e.textAddComment},{xtype:"tbspacer",flex:1},{xtype:"button",id:"id-btn-cancel-comment",text:e.textCancel}]}]}],this.getAddReplyForm=function(t){var n=t.scope,r=t.commentId,i=t.textAreaHandlers,s=t.onReplyHandler,o=t.onCloseHandler;return Ext.widget("container",{id:"controls-reply-"+r,cls:"controls-reply-container",layout:{type:"vbox",align:"stretch"},hidden:!0,height:80,items:[{xtype:"textarea",flex:1,emptyText:e.textAddReply,enableKeyEvents:!0,listeners:{focus:Ext.bind(i.onFocus,n),blur:Ext.bind(i.onBlur,n),keydown:Ext.bind(i.onKeyDown,n),elastic:Ext.bind(i.onElastic,n)},plugins:[{ptype:"textareaautoheight",pluginId:"elastic-helper"}]},{xtype:"container",layout:"hbox",height:26,id:"controls-reply-"+r+"-buttons",items:[{xtype:"button",text:e.textReply,cls:"asc-blue-button",action:"reply",handler:Ext.bind(function(e,t){s.call(n,e)},n)},{xtype:"tbspacer",width:10},{xtype:"button",text:e.textClose,handler:Ext.bind(function(e,t){o.call(n,e)},n)}]}]})},e.callParent(arguments)},textComments:"Comments",textAnonym:"Guest",textAddCommentToDoc:"Add Comment to Document",textAddComment:"Add Comment",textCancel:"Cancel",textAddReply:"Add Reply",textReply:"Reply",textClose:"Close",textResolved:"Resolved",textResolve:"Resolve"}),Ext.define("Common.view.CommentsPopover",{extend:"Ext.container.Container",alias:"widget.commoncommentspopover",cls:"common-commentspopover",requires:["Common.plugin.DataViewScrollPane","Common.plugin.TextAreaAutoHeight","Ext.XTemplate","Ext.view.View"],layout:{type:"vbox",align:"stretch"},width:250,height:300,minHeight:50,maxHeight:300,hideMode:"display",config:{commentId:0,userId:0},constructor:function(e){if(!e||!e.commentId||!e.userId)throw Error("Common.view.CommentsPopover creation failed: required parameters are missing.");return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){var e=this,t=Ext.getStore("Common.store.Users");e.id="id-popover-comments-"+e.commentId,e.items=[{xtype:"container",html:'<div class="popover-arrow"></div>'},{xtype:"dataview",flex:1,id:"id-popover-comments-view-"+e.commentId,cls:"comments-view popover",store:"Common.store.Comments",blockRefresh:!0,disableSelection:!0,tpl:new Ext.XTemplate('<tpl for=".">','<tpl if="this.canDisplay(values.id)">','<div class="comment-wrap" id="id-popover-comment-{id}">','<div class="header">','<div class="user-info" >','<div class="user">{[this.getUserName(values.userid, values.username)]}</div>','<div class="date">{[this.getLocaleDate(values.date)]}</div>',"</div>",'<div class="edit-info" <tpl if="!this.hideControls()">style="display:none;"</tpl> >','<tpl if="this.canEditReply(userid)">','<div class="btn-header comment edit"></div>','<div class="btn-header comment delete"></div>',"</tpl>",'<tpl if="resolved">','<label class="resolve resolved">',e.textResolved,"</label>","</tpl>",'<tpl if="!resolved">','<label class="resolve">',e.textResolve,"</label>","</tpl>","</div>","</div>",'<div class="comment-message">','<div class="comment" data-can-copy="true">{[this.fixMessage(values.comment)]}</div>',"</div>",'<div class="replys">','<tpl for="replys">','<div class="reply" id="reply-{id}">','<div class="header">','<div class="user-info" >','<div class="user">{[this.getUserName(values.userid, values.username)]}</div>','<div class="date">{[this.getLocaleDate(values.date)]}</div>',"</div>",'<div class="edit-info" <tpl if="!this.hideControls()">style="display:none;"</tpl> >','<tpl if="this.canEditReply(userid)">','<div class="btn-header reply edit"></div>','<div class="btn-header reply delete"></div>',"</tpl>","</div>","</div>",'<div class="reply-message">','<div class="message" data-can-copy="true">{[this.fixMessage(values.reply)]}</div>',"</div>","</div>","</tpl>","</div>","</div>","</tpl>",'<tpl if="!this.canDisplay(values.id)">','<div class="comment-wrap hidden"></div>',"</tpl>","</tpl>",'<div class="x-clear"></div>',{compiled:!0,canDisplay:function(t){return t==e.commentId},canEditReply:function(e){return!0},getFixedQuote:function(e){return Ext.String.ellipsis(Ext.String.htmlEncode(e),120,!0)},getLocaleDate:function(e){if(!e)return Ext.String.format("{0} {1}","--/--/--","--:-- AM");var t=new Date(e);return Ext.String.format("{0} {1}",Ext.Date.format(t,"n/j/Y"),Ext.Date.format(t,"g:i A"))},getUserColor:function(e){if(t){var n=t.findRecord("id",e);if(n)return n.data.color}return"#000"},getUserName:function(n,r){if(t){var i=t.findRecord("id",n);if(i)return Ext.String.ellipsis(Ext.String.htmlEncode(i.get("username")),15,!0);if(Ext.isString(r)&&r.length>0)return r}return e.textAnonym},fixMessage:function(e){var t=function(e){var t=/[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}/i.exec(e);if(t)e=e.replace(t[0],'<a href="mailto:'+t[0]+">"+t[0]+"</a>");else{t=e.match(/((https?|ftps?):\/\/)(www.)?([a-z0-9-]+)(\.[a-z]{2,6})?(\/\S*)?/ig),!t&&(t=e.match(/((https?|ftps?):\/\/)?(www.)?([a-z0-9-]+)(\.[a-z]{2,6})(\/\S*)?/ig));for(var n in t)e=e.replace(t[n],'<a href="'+(t[n].search(/((https?|ftps?):\/\/)/g)<0?"http://":"")+t[n]+'" target="_blank">'+t[n]+"</a>")}return e},n=function(e){return Ext.String.htmlEncode(e)};return t(n(e)).replace(/\n/g,"<br/>")},hideControls:function(){return e.editable!==!1}}),itemSelector:"div.comment-wrap",emptyText:"",autoScroll:!0,plugins:[{ptype:"dataviewscrollpane",pluginId:"scrollpane",areaSelector:".comments-view",settings:{enableKeyboardNavigation:!0,verticalGutter:1}}]},{xtype:"container",id:"id-popover-add-reply-link-"+e.commentId,cls:"reply-link-container add-link",action:"add-reply-link-container",hidden:e.editable===!1,items:[{xtype:"label",text:e.textAddReply,action:"link"}]},{xtype:"container",id:"id-popover-controls-reply-"+e.commentId,cls:"controls-reply-container",action:"add-reply-form-container",layout:{type:"vbox",align:"stretch"},height:100,hidden:!0,items:[{xtype:"textarea",emptyText:e.textAddReply,action:"add-reply-textarea",enableKeyEvents:!0,plugins:[{ptype:"textareaautoheight",pluginId:"elastic-helper"}]},{xtype:"container",layout:"hbox",height:26,id:"id-popover-controls-reply-"+e.commentId+"-buttons",items:[{xtype:"button",text:e.textReply,cls:"asc-blue-button",action:"reply"},{xtype:"tbspacer",width:10},{xtype:"button",text:e.textClose,action:"close"}]}]}],e.callParent(arguments)},afterRender:function(){this.callParent(arguments);var e=this.getEl();e&&Ext.DomHelper.append(e,'<div class="lock-area"></div><div class="lock-author"></div>')},fireTransformToAdd:function(){this.fireEvent("transformToAdd",this)},textAnonym:"Guest",textResolved:"Resolved",textResolve:"Resolve",textAddReply:"Add Reply",textReply:"Reply",textClose:"Close"}),Ext.define("Common.view.SearchDialog",{extend:"Ext.window.Window",alias:"widget.commonsearchdialog",requires:["Ext.window.Window","Ext.form.field.Checkbox"],closable:!0,resizable:!1,height:120,width:550,padding:"12px 20px 0 20px",constrain:!0,layout:{type:"vbox",align:"stretch"},listeners:{show:function(){this.txtSearchQuery.focus(!1,100)}},initComponent:function(){var e=this;this.isSearchMode=!0,this.isViewMode=Ext.isDefined(this.initialConfig.isViewMode)?this.initialConfig.isViewMode:!1,this.btnSearchPrev=Ext.create("Ext.Button",{cls:"dlg-search",width:45,iconCls:"asc-btn-search previous",style:"margin: 0 6px 0 8px",group:"search-text",direction:"prev"}),this.btnSearchNext=Ext.create("Ext.Button",{cls:"dlg-search",width:45,iconCls:"asc-btn-search next",group:"search-text",direction:"next"}),this.btnReplace=Ext.create("Ext.Button",{text:this.txtBtnReplace,height:22,width:96,group:"replace-text",style:"margin: 0 0 0 8px",type:"single"}),this.btnReplaceAll=Ext.create("Ext.Button",{text:this.txtBtnReplaceAll,height:22,width:96,group:"replace-text",hidden:!0,type:"all"}),this.btnOpenReplace=Ext.create("Ext.Button",{text:this.txtBtnReplace,height:22,width:96,hidden:this.isViewMode,handler:function(){e.replaceMode()}}),this.chCaseSensitive=Ext.widget("checkbox",{boxLabel:this.textMatchCase,style:"margin: 0 20px 0 0",checked:this.matchcase&&this.matchcase.checked===!0,hidden:this.matchcase===!1||typeof this.matchcase=="object"&&this.matchcase.visible===!1}),this.chWholeWords=Ext.widget("checkbox",{boxLabel:this.textWholeWords,style:"margin: 0 20px 0 0",checked:this.wholewords&&this.wholewords.checked===!0,hidden:this.wholewords===!1||typeof this.wholewords=="object"&&this.wholewords.visible===!1}),this.chHighlight=Ext.widget("checkbox",{boxLabel:this.textHighlight,style:"margin: 0 20px 0 0",action:"highlight",checked:this.highlight&&this.highlight.checked===!0,hidden:this.highlight===!1||typeof this.highlight=="object"&&this.highlight.visible===!1}),this.txtSearchQuery=Ext.create("Common.component.SearchField",{id:"search-dialog-text-search",flex:1,emptyText:this.textSearchStart,tabIndex:1,style:"border-radius: 2px;"}),this.txtReplaceQuery=Ext.create("Common.component.SearchField",{id:"search-dialog-text-replace",flex:1,style:"border-radius: 2px;",emptyText:this.textSearchStart,tabIndex:2,listeners:{searchstart:function(e,t){e.stopSearch(!0)}}}),this.items=[{xtype:"container",width:310,height:22,layout:{type:"hbox",align:"stretch"},items:[this.txtSearchQuery,this.btnSearchPrev,this.btnSearchNext]},{xtype:"container",width:310,height:22,style:"margin: 10px 0 0 0",hidden:!0,layout:{type:"hbox"},items:[this.txtReplaceQuery,this.btnReplace]},{xtype:"container",width:310,height:22,style:"margin: 10px 0 0 0",layout:{type:"hbox"},items:[this.chCaseSensitive,this.chWholeWords,this.chHighlight,{xtype:"box",flex:1},this.btnReplaceAll,this.btnOpenReplace]}],this.simplesearch&&(this.items[2].hidden=!0,this.minHeight=86,this.height=86),this.callParent(arguments),this.setTitle(this.isViewMode?this.textTitle2:this.textTitle)},replaceMode:function(){this.isSearchMode=!1,this.setSize({height:150}),this.items.getAt(1).show(),this.btnReplaceAll.show(),this.btnOpenReplace.hide()},searchMode:function(){this.isSearchMode=!0,this.setSize({height:120}),this.items.getAt(1).hide(),this.btnReplaceAll.hide(),this.isViewMode||this.btnOpenReplace.show()},getSettings:function(){var e={textsearch:this.txtSearchQuery.getText(),casesensitive:this.chCaseSensitive.getValue(),wholewords:this.chWholeWords.getValue(),highlight:this.chHighlight.getValue()};return!this.isSearchMode&&(e.textreplace=this.txtReplaceQuery.getText()),e},selectSearch:function(){this.txtSearchQuery.getText().length>0&&this.txtSearchQuery.focus(100,!0)},setViewMode:function(e){this.isViewMode!==e&&(this.isViewMode=e,this.setTitle(this.isViewMode?this.textTitle2:this.textTitle),this.btnOpenReplace.setVisible(!e))},textTitle:"Search & Replace",textTitle2:"Search",txtBtnReplace:"Replace",txtBtnReplaceAll:"Replace All",textMatchCase:"Case sensitive",textWholeWords:"Whole words only",textHighlight:"Highlight results",textSearchStart:"Enter text here"}),Ext.define("Common.view.Participants",{extend:"Ext.container.Container",alias:"widget.statusinfoparticipants",requires:["Ext.form.Label","Ext.toolbar.Spacer","Ext.Img"],layout:{type:"hbox",align:"middle"},height:27,width:80,hidden:!0,config:{pack:"start"},constructor:function(e){return this.layout&&e&&(this.layout.pack=e.pack),this.initConfig(e),this.callParent(arguments),this},initComponent:function(){var e=this;this.btnUsers=Ext.widget("button",{text:"1",cls:"asc-statusinfo-text-btn",iconCls:Ext.isDefined(this.userIconCls)?this.userIconCls:"icon-statusinfo-users",listeners:{click:function(){var e=Ext.getCmp("view-main-menu"),t=Ext.getCmp("id-menu-chat");e&&t&&(t.pressed?t.toggle(!1):e.selectMenu("menuChat"))},render:function(t){t.getEl().set({"data-qtip":e.tipUsers,"data-qalign":"bl-tl?"})}}}),this.items=[{xtype:"tbseparator",width:2,height:27,style:"padding-top:2px;",html:'<div style="width: 100%; height: 100%; border-left: 1px solid rgba(0, 0, 0, 0.1); border-right: 1px solid rgba(255, 255, 255, 0.5);"></div>'},{xtype:"tbspacer",width:12},this.btnUsers,{xtype:"tbspacer",width:10},{xtype:"tbseparator",width:2,height:27,style:"padding-top:2px;",html:'<div style="width: 100%; height: 100%; border-left: 1px solid rgba(0, 0, 0, 0.1); border-right: 1px solid rgba(255, 255, 255, 0.5);"></div>'}],this.callParent(arguments)},setApi:function(e){return this.api=e,this.api.asc_registerCallback("asc_onParticipantsChanged",Ext.bind(this._onParticipantsChanged,this)),this.api.asc_registerCallback("asc_onAuthParticipantsChanged",Ext.bind(this._onParticipantsChanged,this)),this},_onParticipantsChanged:function(e){e.length>1&&this.setVisible(!0),this.btnUsers.setText(e.length);if(this.btnUsers.getEl()){var t=this.tipUsers+"<br/><br/>";for(var n=0;n<e.length&&n<4;n++)t+="<br/>"+e[n].asc_getUserName();e.length>4&&(t+="<br/>"+this.tipMoreUsers.replace("%1",e.length-4),t+="<br/><br/>"+this.tipShowUsers),this.btnUsers.getEl().set({"data-qtip":t,"data-qalign":"bl-tl?","data-qwidth":"250"})}},setMode:function(e){this.editorConfig={user:e.user}},tipUsers:"Document is in the collaborative editing mode.",tipMoreUsers:"and %1 users.",tipShowUsers:"To see all users click the icon below."}),Ext.define("Common.view.DocumentAccessDialog",{extend:"Ext.window.Window",alias:"widget.commondocumentaccessdialog",uses:["Common.component.LoadMask"],modal:!0,resizable:!1,plain:!0,constrain:!0,height:534,width:850,layout:"fit",closable:!0,style:"background-color:white;",initComponent:function(){this.items=[{xtype:"container",flex:1,html:'<div id="id-sharing-placeholder"></div>'}],this.title=this.textTitle,this.addEvents("accessrights"),this.callParent(arguments)},afterRender:function(e){this.callParent(arguments);var t=document.createElement("iframe");t.src=this.settingsurl,t.width=850,t.height=500,t.align="top",t.frameBorder=0,t.scrolling="no",t.onload=Ext.bind(this._onLoad,this);var n=e.down("#id-sharing-placeholder",!0);n.parentNode.replaceChild(t,n),this.loadMask=Ext.widget("cmdloadmask",this),this.loadMask.setTitle(this.textLoading),this.loadMask.show(),this._bindWindowEvents.call(this)},_bindWindowEvents:function(){var e=this;window.addEventListener?window.addEventListener("message",function(t){e._onWindowMessage(t)},!1):window.attachEvent&&window.attachEvent("onmessage",function(t){e._onWindowMessage(t)})},_onWindowMessage:function(e){if(e&&window.JSON)try{this._onMessage.call(this,window.JSON.parse(e.data))}catch(t){}},_onMessage:function(e){e&&e.needUpdate&&this.fireEvent("accessrights",this,e.sharingSettings),this.close()},_onLoad:function(){this.loadMask.hide()},textTitle:"Sharing Settings",textLoading:"Loading"}),Ext.define("Common.controller.Chat",{extend:"Ext.app.Controller",views:["ChatPanel"],refs:[{ref:"chatPanel",selector:"commonchatpanel"},{ref:"messageList",selector:"#id-chat-msg"},{ref:"userList",selector:"#id-chat-users"},{ref:"messageTextArea",selector:"#id-chat-textarea"},{ref:"btnSend",selector:"#id-btn-send-msg"}],stores:["Common.store.ChatMessages","Common.store.Users"],init:function(){this.control({"#id-btn-send-msg":{afterrender:this.onBtnSendAfterRender,click:this.onBtnSendClick},"#id-chat-msg":{itemadd:this.onAddMessage},"#id-chat-textarea":{keydown:this.onTextAreaKeyDown,keyup:this.onTextAreaKeyUp},"#id-chat-users":{viewready:function(){this.onUpdateUser()},itemclick:this.onUserListItemClick,itemupdate:this.onUpdateUser},"#view-main-menu":{panelshow:this.onShowPanel}})},setApi:function(e){return this.api=e,this.api.asc_registerCallback("asc_onParticipantsChanged",Ext.bind(this.onParticipantsChanged,this)),this.api.asc_registerCallback("asc_onCoAuthoringChatReceiveMessage",Ext.bind(this.onCoAuthoringChatReceiveMessage,this)),this.api.asc_registerCallback("asc_onAuthParticipantsChanged",Ext.bind(this.onAuthParticipantsChanged,this)),this.api.asc_registerCallback("asc_onConnectionStateChanged",Ext.bind(this.onConnectionStateChanged,this)),this.api.asc_coAuthoringGetUsers(),this.api.asc_coAuthoringChatGetMessages(),this},onLaunch:function(){Common.Gateway.on("init",Ext.bind(this.loadConfig,this))},loadConfig:function(e){},_sendMessage:function(){var e=this.getMessageTextArea(),t=this;if(e){var n=Ext.String.trim(e.getValue());if(n.length>0&&this.api){var r=function(e,t){var n=[];while(e){if(e.length<t){n.push(e);break}n.push(e.substr(0,t)),e=e.substr(t)}return n},i=r(n,2048);Ext.each(i,function(e){t.api.asc_coAuthoringChatSendMessage(e)}),e.setValue("")}}},_updateUserOnline:function(e,t){e&&(e.beginEdit(),e.set("online",t),e.get("color").length<1&&e.set("color","#"+("000000"+Math.floor(Math.random()*16777215).toString(16)).substr(-6)),e.endEdit(),e.commit())},onBtnSendClick:function(e,t){this._sendMessage();var n=Ext.getCmp("id-chat-textarea");if(n){var r=new Ext.util.DelayedTask(function(){this.api.asc_enableKeyEvents(!1),n.focus()},this);r.delay(100)}},onBtnSendAfterRender:function(e){var t=e.getEl(),n=this.getMessageTextArea();Ext.supports.Placeholder&&(t.on("mousedown",function(){n.emptyText=this.textEnterMessage,n.applyEmptyText()},this),t.on("mouseup",function(){n.emptyText=" ",n.applyEmptyText()},this))},onAddMessage:function(e,t,n){var r=this.getMessageList();if(r){var i=r.getPlugin("scrollpane");if(i&&i.jspApi){var s=i.jspApi.getPercentScrolledY()>.999;r.getWidth()>0&&i.updateScrollPane(),s&&Ext.defer(function(){var e=r.getNode(t);e&&i.scrollToElement(e,!1,!0)},100,this)}}},onUpdateUser:function(e,t,n){var r=this.getUserList();if(r){var i=r.getStore().getOnlineUserCount();i>10&&(i=10),r.setHeight(i<4?70:i*18+12);var s=r.getPlugin("scrollpane");s&&r.getEl().dom.clientWidth>0&&s.updateScrollPane()}},onTextAreaKeyUp:function(e,t){t.getKey()==t.ENTER&&(e.emptyText=" ",e.applyEmptyText())},onTextAreaKeyDown:function(e,t){t.getKey()==t.ENTER&&(t.ctrlKey||t.metaKey)&&!t.shiftKey&&(e.getValue().length<1?(e.emptyText=this.textEnterMessage,e.applyEmptyText()):this._sendMessage(),t.stopEvent())},onUserListItemClick:function(e,t,n,r,i){},onParticipantsChanged:function(e){},onCoAuthoringChatReceiveMessage:function(e){var t=this.getCommonStoreChatMessagesStore();t&&Ext.each(e,function(e){t.add({type:0,userid:e.user,message:e.message,username:e.username})})},onAuthParticipantsChanged:function(e){var t=this.getCommonStoreUsersStore();if(t){var n,r=this;Ext.each(e,function(e){n=t.add({id:e.asc_getId(),username:e.asc_getUserName()})[0],this._updateUserOnline(n,!0)},this)}},onConnectionStateChanged:function(e){var t=this.getCommonStoreUsersStore();if(t){var n=t.findRecord("id",e.asc_getId());n||(n=t.add({id:e.asc_getId(),username:e.asc_getUserName()})[0]),this._updateUserOnline(t.findRecord("id",e.asc_getId()),e.asc_getState())}},onShowPanel:function(e,t){var n=e.down("container");if(n&&n.isXType("commonchatpanel")){var r=this.getMessageList(),i=this.getUserList(),s;r&&(s=r.getPlugin("scrollpane"),s&&(s.updateScrollPane(),s.jspApi.scrollToPercentY(100,!0))),i&&(s=i.getPlugin("scrollpane"),s&&s.updateScrollPane())}},textEnterMessage:"Enter your message here",capGuest:"Guest"}),Ext.define("Common.controller.CommentsBase",{extend:"Ext.app.Controller",models:["Common.model.Reply","Common.model.Comment"],stores:["Common.store.Comments","Common.store.Users"],config:{currentUserId:undefined,currentUserName:undefined},timeZoneOffsetInMs:(new Date).getTimezoneOffset()*6e4,init:function(){},loadConfig:function(e){this.setCurrentUserId(e.config.user.id),this.setCurrentUserName(e.config.user.name)},setApi:function(e){this.api=e},utcDateToString:function(e){return Object.prototype.toString.call(e)==="[object Date]"?(e.getTime()-this.timeZoneOffsetInMs).toString():""},addComment:function(e){if(this.api){var t=Ext.String.trim(e);if(t.length>0){var n=new asc_CCommentData;n&&(n.asc_putText(t),n.asc_putTime(this.utcDateToString(new Date)),n.asc_putUserId(this.getCurrentUserId()),n.asc_putUserName(this.getCurrentUserName()),n.asc_putSolved(!1),this.api.asc_addComment(n))}}},resolveComment:function(e,t){if(this.api){var n=this.getCommonStoreCommentsStore(),r=new asc_CCommentData,i=this;if(n&&r){var s=n.findRecord("id",e);s&&(r.asc_putText(s.get("comment")),r.asc_putQuoteText(s.get("quote")),r.asc_putTime(this.utcDateToString(new Date(s.get("date")))),r.asc_putUserId(s.get("userid")),r.asc_putUserName(s.get("username")),r.asc_putSolved(t),s.replys().each(function(e){var t=new asc_CCommentData;t.asc_putText(e.get("reply")),t.asc_putTime(i.utcDateToString(new Date(e.get("date")))),t.asc_putUserId(e.get("userid")),t.asc_putUserName(e.get("username")),r.asc_addReply(t)}),this.api.asc_changeComment(e,r))}}},editComment:function(e,t){if(this.api){var n=Ext.String.trim(t),r=this.getCommonStoreCommentsStore(),i=this;if(n.length>0){var s=new asc_CCommentData,o=r.findRecord("id",e);s&&(s.asc_putText(n),s.asc_putQuoteText(o.get("quote")),s.asc_putTime(this.utcDateToString(new Date(o.get("date")))),s.asc_putUserId(this.getCurrentUserId()),s.asc_putUserName(this.getCurrentUserName()),s.asc_putSolved(o.get("resolved")),o.replys().each(function(e){var t=new asc_CCommentData;t.asc_putText(e.get("reply")),t.asc_putTime(i.utcDateToString(new Date(e.get("date")))),t.asc_putUserId(e.get("userid")),t.asc_putUserName(e.get("username")),s.asc_addReply(t)}),this.api.asc_changeComment(e,s))}}},deleteComment:function(e){this.api&&this.api.asc_removeComment(e)},selectComment:function(e){this.api&&(this.api.asc_selectComment(e),this.api.asc_showComment(e))},addReply:function(e,t){if(this.api){var n=Ext.String.trim(t),r=this.getCommonStoreCommentsStore(),i=this;if(r&&t.length>0){var s=new asc_CCommentData,o=r.findRecord("id",e);if(s&&o){s.asc_putText(o.get("comment")),s.asc_putQuoteText(o.get("quote")),s.asc_putTime(this.utcDateToString(new Date(o.get("date")))),s.asc_putUserId(o.get("userid")),s.asc_putUserName(o.get("username")),s.asc_putSolved(o.get("resolved"));var u=function(e){var t=new asc_CCommentData;t.asc_putText(e.reply),t.asc_putTime(e.date),t.asc_putUserId(e.userid),t.asc_putUserName(e.username),s.asc_addReply(t)};return u({reply:n,date:this.utcDateToString(new Date),userid:this.getCurrentUserId(),username:this.getCurrentUserName()}),o.replys().each(function(e){u({reply:e.get("reply"),date:i.utcDateToString(new Date(e.get("date"))),userid:e.get("userid"),username:e.get("username")})}),this.api.asc_changeComment(e,s),!0}}}return!1},editReply:function(e,t,n){if(this.api){var r=Ext.String.trim(n),i=this,s=this.getCommonStoreCommentsStore();if(s&&r.length>0){var o=new asc_CCommentData,u=s.findRecord("id",e);if(o){o.asc_putText(u.get("comment")),o.asc_putQuoteText(u.get("quote")),o.asc_putTime(this.utcDateToString(new Date(u.get("date")))),o.asc_putUserId(u.get("userid")),o.asc_putUserName(u.get("username")),o.asc_putSolved(u.get("resolved"));var a=function(e){var t=new asc_CCommentData;t.asc_putText(e.reply),t.asc_putTime(e.date),t.asc_putUserId(e.userid),t.asc_putUserName(e.username),o.asc_addReply(t)};u.replys().each(function(e){var n=e.get("id");a({reply:n==t?r:e.get("reply"),date:i.utcDateToString(new Date(e.get("date"))),userid:n==t?i.getCurrentUserId():e.get("userid"),username:n==t?i.getCurrentUserName():e.get("username")})}),this.api.asc_changeComment(e,o)}}}},deleteReply:function(e,t){if(this.api){var n=this.getCommonStoreCommentsStore(),r=this.getCommonStoreCommentsStore(),i=new asc_CCommentData,s=this;if(n&&r&&i){var o=n.findRecord("id",e),u=r.findRecord("id",o.get("userid"));i.asc_putText(o.get("comment")),i.asc_putQuoteText(o.get("quote")),i.asc_putTime(this.utcDateToString(new Date(o.get("date")))),i.asc_putUserId(o.get("userid")),i.asc_putUserName(u?u.get("username"):""),i.asc_putSolved(o.get("resolved"));var a=function(e){var t=new asc_CCommentData;t.asc_putText(e.reply),t.asc_putTime(e.date),t.asc_putUserId(e.userid),t.asc_putUserName(e.username),i.asc_addReply(t)};o.replys().each(function(e){if(t!=e.get("id")){var n=new asc_CCommentData;n.asc_putText(e.get("reply")),n.asc_putTime(s.utcDateToString(new Date(e.get("date")))),n.asc_putUserId(e.get("userid")),n.asc_putUserName(e.get("username")),i.asc_addReply(n)}}),this.api.asc_changeComment(e,i)}}},updateHandlers:function(e,t,n){var r=this,i=e.get("id"),s=Ext.get(t);if(Ext.isDefined(s)){var o=function(e,t){var n=s.down(e);if(n){var o=Ext.bind(function(e,n){t.call(n,i)},r);n.un("click"),n.on("click",o)}},u=function(e,t){var n=s.down(".replys");if(n){var o=n.query(e);Ext.each(o,function(e){var n=Ext.get(e),s=n.up(".reply");if(s){var o=s.id.match(/\d+/g);if(o!=null&&o.length>0){var u=Ext.bind(function(e,n){t.call(n,i,o)},r);n.un("click"),n.on("click",u)}}})}},a=function(e,t){var n=s.down(".replys");if(n){var o=n.query(e);Ext.each(o,function(e){var n=Ext.get(e);if(n){var s=Ext.bind(function(e,n){t.call(n,i)},r);n.un("click"),n.on("click",s)}})}};o(".resolve",function(e){n&&n.onResolveComment&&n.onResolveComment.call(r,e)}),o(".comment.edit",function(e){n&&n.showEditCommentControls&&n.showEditCommentControls.call(r,e)}),o(".comment.delete",function(e){r.deleteComment(e)}),o(".quote",function(e){r.selectComment(e)}),o(".comment-message",function(e){r.selectComment(e)}),a(".reply-message",function(e){r.selectComment(e)}),u(".edit",function(e,t){n&&n.showEditReplyControls&&n.showEditReplyControls.call(r,e,t)}),u(".delete",function(e,t){r.deleteReply(e,t[0])})}}}),Ext.define("Common.controller.CommentsList",{extend:"Common.controller.CommentsBase",requires:["Common.view.CommentsEditForm"],views:["CommentsPanel"],stores:["Common.store.Comments","Common.store.Users"],refs:[{ref:"commentsPanel",selector:"commoncommentspanel"},{ref:"commentsList",selector:"#id-comments"},{ref:"commentTextArea",selector:"#id-comment-textarea"},{ref:"btnAddComment",selector:"#id-btn-send-comment"},{ref:"linkAddComment",selector:"#id-add-comment-link"},{ref:"containerAddComment",selector:"#id-add-comment-container"}],init:function(){this.control({"#id-btn-send-comment":{afterrender:this.onBtnAddAfterRender,click:this.onBtnAddCommentClick},"#id-btn-cancel-comment":{click:this.hideAddCommentControls},"#id-comments":{afterrender:this.onAfterRenderComments,itemadd:this.onAddComment,itemremove:this.onRemoveComment,itemupdate:this.onUpdateComment,viewready:this.onViewReadyComments,refresh:this.onRefreshComments},"#id-comment-textarea":{keydown:this.onTextAreaKeyDown,keyup:this.onTextAreaKeyUp},"#id-add-comment-link":{afterrender:this.onAfterRenderAddCommentLink},"#view-main-menu":{panelshow:this.onShowPanel}})},setConfig:function(e,t){this.loadConfig(e),this.setApi(t)},loadConfig:function(e){var t=this.getCommentsPanel(),n=this.getCommentsList(),r=this;t?(t.setCurrentUserId(e.config.user.id),n.refresh()):this.control({commoncommentspanel:{beforerender:function(){var t=r.getCommentsPanel();t&&(t.setCurrentUserId(e.config.user.id),r.getCommentsList().refresh())}}}),this.callParent(arguments)},setApi:function(e){this.callParent(arguments)},registerCallbacks:function(){this.api.asc_registerCallback("asc_onAddComment",Ext.bind(this.onApiAddComment,this)),this.api.asc_registerCallback("asc_onAddComments",Ext.bind(this.onApiAddComments,this)),this.api.asc_registerCallback("asc_onRemoveComment",Ext.bind(this.onApiRemoveComment,this)),this.api.asc_registerCallback("asc_onChangeCommentData",Ext.bind(this.onApiChangeCommentData,this)),this.api.asc_registerCallback("asc_onLockComment",Ext.bind(this.onApiLockComment,this)),this.api.asc_registerCallback("asc_onUnLockComment",Ext.bind(this.onApiUnLockComment,this))},onApiAddComment:function(e,t){var n=this.getCommonStoreCommentsStore(),r=this;if(n){var i=n.findRecord("id",e);if(i){i.beginEdit(),i.set("comment",t.asc_getText()),i.set("date",t.asc_getTime()==""?undefined:this.stringUtcToLocalDate(t.asc_getTime())),i.set("userid",t.asc_getUserId()),i.set("username",t.asc_getUserName()),i.set("resolved",t.asc_getSolved()),i.set("quote",t.asc_getQuoteText()),i.replys().removeAll();var s=t.asc_getRepliesCount();for(var o=0;o<s;o++){var u=++Ext.idSeed;i.replys().add({id:u,userid:t.asc_getReply(o).asc_getUserId(),username:t.asc_getReply(o).asc_getUserName(),date:this.stringUtcToLocalDate(t.asc_getReply(o).asc_getTime()),reply:t.asc_getReply(o).asc_getText()})}i.replys().sort("date","DESC"),i.endEdit(),i.commit(),i.replys().each(function(t){r.hideEditReplyControls(e,t.get("id"))})}else{var a=n.add({id:e,userid:t.asc_getUserId(),username:t.asc_getUserName(),date:t.asc_getTime()==""?undefined:this.stringUtcToLocalDate(t.asc_getTime()),quote:t.asc_getQuoteText(),comment:t.asc_getText(),resolved:t.asc_getSolved()});if(a&&a.length>0){var f=a[0];f.beginEdit();var s=t.asc_getRepliesCount();for(var o=0;o<s;o++){var u=++Ext.idSeed;f.replys().add({id:u,userid:t.asc_getReply(o).asc_getUserId(),username:t.asc_getReply(o).asc_getUserName(),date:this.stringUtcToLocalDate(t.asc_getReply(o).asc_getTime()),reply:t.asc_getReply(o).asc_getText()})}f.replys().sort("date","DESC"),f.endEdit(),f.commit()}}this.commentsFilter&&!this.commentsFilter[0].value.test(e)&&n.filter(this.commentsFilter),this.applySort()}this.hideAddCommentControls()},onApiAddComments:function(e){var t=this.getCommonStoreCommentsStore();if(t){var n=[];for(var r=0;r<e.length;r++){if(t.findRecord("id",e[r].Id))continue;n.push({id:e[r].Id,userid:e[r].Comment.asc_getUserId(),username:e[r].Comment.asc_getUserName(),date:e[r].Comment.asc_getTime()==""?undefined:this.stringUtcToLocalDate(e[r].Comment.asc_getTime()),quote:e[r].Comment.asc_getQuoteText(),comment:e[r].Comment.asc_getText(),resolved:e[r].Comment.asc_getSolved()})}var i=t.add(n),s,o,u;for(var a=0;a<i.length;a++){s=i[a],s.beginEdit(),o=e[a].Comment.asc_getRepliesCount();for(var r=0;r<o;r++)u=++Ext.idSeed,s.replys().add({id:u,userid:e[a].Comment.asc_getReply(r).asc_getUserId(),username:e[a].Comment.asc_getReply(r).asc_getUserName(),date:this.stringUtcToLocalDate(e[a].Comment.asc_getReply(r).asc_getTime()),reply:e[a].Comment.asc_getReply(r).asc_getText()});s.replys().sort("date","DESC"),s.endEdit(),s.commit()}this.commentsFilter&&t.filter(this.commentsFilter),this.applySort()}this.hideAddCommentControls()},onApiRemoveComment:function(e){var t=this.getCommonStoreCommentsStore();if(t){var n=t.findRecord("id",e);n?t.remove(n):this.commentsFilter&&(t.clearFilter(),n=t.findRecord("id",e),t.remove(n),t.filter(this.commentsFilter))}},onApiChangeCommentData:function(e,t){var n=this.getCommonStoreCommentsStore(),r=this;if(n){var i=n.findRecord("id",e);if(!i&&r.commentsFilter){var s=!0;n.clearFilter(),i=n.findRecord("id",e)}if(i){i.beginEdit(),i.set("comment",t.asc_getText()),i.set("date",this.stringUtcToLocalDate(t.asc_getTime())),i.set("userid",t.asc_getUserId()),i.set("username",t.asc_getUserName()),i.set("resolved",t.asc_getSolved()),i.set("quote",t.asc_getQuoteText()),i.replys().removeAll();var o=t.asc_getRepliesCount();for(var u=0;u<o;u++){var a=++Ext.idSeed;i.replys().add({id:a,userid:t.asc_getReply(u).asc_getUserId(),username:t.asc_getReply(u).asc_getUserName(),date:this.stringUtcToLocalDate(t.asc_getReply(u).asc_getTime()),reply:t.asc_getReply(u).asc_getText()})}i.replys().sort("date","DESC"),i.endEdit(),i.commit(),i.replys().each(function(t){r.hideEditReplyControls(e,t.get("id"))})}r.commentsFilter&&s&&n.filter(r.commentsFilter)}this.applySort(),this.editControls=undefined},onApiLockComment:function(e,t){var n=this.getCommonStoreCommentsStore();if(n){var r=n.findRecord("id",e);if(!r&&this.commentsFilter){var i=!0;n.clearFilter(),r=n.findRecord("id",e)}r&&!r.get("lock")&&(r.beginEdit(),r.set("lock",!0),r.set("lockuserid",t),r.endEdit(),r.commit()),this.commentsFilter&&i&&n.filter(this.commentsFilter)}},onApiUnLockComment:function(e){var t=this.getCommonStoreCommentsStore();if(t){var n=t.findRecord("id",e);if(!n&&this.commentsFilter){var r=!0;t.clearFilter(),n=t.findRecord("id",e)}n&&n.get("lock")&&(n.beginEdit(),n.set("lock",!1),n.endEdit(),n.commit()),this.commentsFilter&&r&&t.filter(this.commentsFilter)}},stringUtcToLocalDate:function(e){return typeof e=="string"?parseInt(e)+this.timeZoneOffsetInMs:0},applySort:function(){var e=this.getCommentsList(),t=this.getCommonStoreCommentsStore();t&&t.sort(),e&&e.refresh()},updateCommentsScrollView:function(e){var t=this.getCommentsList();if(t){var n=t.getPlugin("scrollpane");if(n){var r=new Ext.util.DelayedTask(function(){n.scrollToElement(e,!1,!0)});Ext.isDefined(e)&&r.delay(100),t.getWidth()>0&&n.updateScrollPane()}}},scrollViewToEnd:function(e){if(e){var t=e.getPlugin("scrollpane");if(t){var n=new Ext.util.DelayedTask(function(){t.jspApi.scrollToPercentY(100,!0)});n.delay(100)}}},scrollViewToNode:function(e,t){if(e&&t){var n=e.getPlugin("scrollpane");if(n){var r=new Ext.util.DelayedTask(function(){n.scrollToElement(t,!1,!0)});r.delay(100)}}},createAddReplyControls:function(e){var t=this,n=e.get("id"),r=this.getCommentsPanel();Ext.widget("container",{renderTo:"comment-"+n+"-add-reply-container",layout:{type:"vbox",align:"stretch"},height:16,id:"root-add-reply-"+n,cls:"root-add-reply",items:[{xtype:"container",id:"add-reply-link-"+n,cls:"reply-link-container add-link",action:"comments-list-add-reply-link-container",height:16,items:[{xtype:"label",text:t.textAddReply,listeners:{afterrender:function(e){e.getEl().on("click",Ext.bind(function(n,r){t.showAddReplyControls(e)}),this)}}}]},r.getAddReplyForm({scope:t,commentId:n,textAreaHandlers:{onFocus:t.onFocusRetryTextArea,onBlur:Ext.emptyFn,onKeyDown:t.onKeyDownRetryTextArea,onElastic:t.onElasticReplyTextArea},onReplyHandler:t.onBtnAddReply,onCloseHandler:t.onBtnCloseReply})],listeners:{afterrender:Ext.bind(function(e){e.setHeight(16);var t=this.getCommentsList();t&&t.on("resize",function(){e.doLayout()},this,{delay:300})},this)}})},showEditCommentControls:function(e){var t=this.getCommentsList(),n=this.getCommentsPanel();if(t&&n){var r=t.getEl().down("#comment-"+e),i=r.down(".comment-message");if(i){var s=i.down(".comment"),o=r.down(".edit-info"),u=Ext.getCmp("controls-edit-msg-list-"+e),a=this.getCommonStoreCommentsStore();if(a){var f=a.findRecord("id",e);if(f){u&&u.destroy(),o&&o.hide(),s&&(s.setVisibilityMode(Ext.Element.DISPLAY),s.hide()),this.hideEditControls(),this.editControls={action:"edit-comment",comment:e};var l=Ext.widget("commoncommentseditform",{scope:this,editId:"list-"+e,renderTo:i,msgValue:f.get("comment"),onEditHandler:this.onBtnEditComment,onCancelHandler:this.onBtnCancelEditComment});if(l){t.on("resize",function(){l.doLayout()},this,{delay:100}),this.updateCommentsScrollView();var c=Ext.get("controls-edit-msg-list-"+e);c&&this.scrollViewToNode(t,c.dom);var h=l.down("textarea");h&&(h.focus(),h.getValue()&&h.selectText(h.getValue().length))}}}}}},hideEditCommentControls:function(e){var t=this.getCommentsList(),n=this.getCommentsPanel();if(t&&n){var r=t.getEl().down("#comment-"+e),i=r.down(".comment-message");if(i){var s=i.down(".comment"),o=r.down(".edit-info"),u=Ext.getCmp("controls-edit-msg-list-"+e);o&&o.show(),u&&u.hide(),s&&(s.setVisibilityMode(Ext.Element.DISPLAY),s.show()),this.editControls=undefined}}},showEditReplyControls:function(e,t){var n=this.getCommentsList(),r=this.getCommentsPanel();if(n&&r){var i=n.getEl().down("#reply-"+t),s=i.down(".reply-message");if(s){var o=s.down(".message"),u=i.down(".edit-info"),a=Ext.getCmp("controls-edit-msg-list-"+t),f=this.getCommonStoreCommentsStore();if(f){var l=f.findRecord("id",e);if(l){var c=l.replys().findRecord("id",t);if(c){a&&a.destroy(),u&&u.hide(),o&&(o.setVisibilityMode(Ext.Element.DISPLAY),o.hide()),this.hideEditControls(),this.editControls={action:"edit-reply",comment:e,reply:t};var h=Ext.widget("commoncommentseditform",{scope:this,editId:"list-"+t,renderTo:s,msgValue:c.get("reply"),onEditHandler:this.onBtnEditReply,onCancelHandler:this.onBtnCancelEditReply});if(h){n.on("resize",function(){h.doLayout()},this,{delay:100}),this.updateCommentsScrollView();var p=Ext.get("controls-edit-msg-list-"+t);p&&this.scrollViewToNode(n,p.dom);var d=h.down("textarea");d&&(d.focus(),d.getValue()&&d.selectText(d.getValue().length))}}}}}}},hideEditReplyControls:function(e,t){var n=this.getCommentsList(),r=this.getCommentsPanel();if(n&&r){var i=n.getEl().down("#reply-"+t),s=i.down(".reply-message");if(s){var o=s.down(".message"),u=i.down(".edit-info"),a=Ext.getCmp("controls-edit-msg-list-"+t);u&&u.show(),a&&a.hide(),o&&(o.setVisibilityMode(Ext.Element.DISPLAY),o.show()),this.editControls=undefined}}},showAddCommentControls:function(){var e=this.getLinkAddComment(),t=this.getContainerAddComment();if(e&&t){e.hide(),t.show(),this.hideEditControls(),this.editControls={action:"add-comment"};var n=Ext.getCmp("id-comment-textarea");if(n){var r=new Ext.util.DelayedTask(function(){this.api.asc_enableKeyEvents(!1),n.focus()},this);r.delay(100)}}},hideAddCommentControls:function(){var e=this.getLinkAddComment(),t=this.getContainerAddComment(),n=this.getCommentTextArea();e&&t&&n&&(n.setValue(""),t.hide(),e.show(),this.editControls=undefined)},showAddReplyControls:function(e){var t=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("root-add-reply"))return!0});if(t){var n=t.getId().match(/root-add-reply-(.+)/)[1];if(n!=null&&n.length>0){var r=t.down("#add-reply-link-"+n),i=t.down("#controls-reply-"+n),s=t.down("textarea");if(r&&i&&s){this.hideEditControls(),this.editControls={action:"add-reply",component:e},r.setVisible(!1),i.setVisible(!0),t.setHeight(80),(new Ext.util.DelayedTask(function(){this.api.asc_enableKeyEvents(!1),s.focus()},this)).delay(100);var o=this.getCommentsList();if(o){var u=Ext.get("controls-reply-"+n);u&&(this.updateCommentsScrollView(),this.scrollViewToNode(o,u.dom))}}}}},hideAddReplyControls:function(e){var t=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("root-add-reply"))return!0});if(t){var n=t.getId().match(/root-add-reply-(.+)/)[1];if(n!=null&&n.length>0){var r=t.down("#add-reply-link-"+n),i=t.down("#controls-reply-"+n);r&&i&&(r.setVisible(!0),i.setVisible(!1),t.setHeight(16),this.editControls=undefined)}}},doDelayedTask:function(){this.onAfterRenderAddCommentLink()},applyCommentsFilter:function(e){this.commentsFilter=e;var t=this.getCommonStoreCommentsStore();t.clearFilter(),this.commentsFilter&&t.filter(this.commentsFilter);var n=this;if(!n.getCommentsList()||!n.getCommentsList().viewReady)var r=setInterval(function(){n.getCommentsList()&&n.getCommentsList().viewReady&&(clearInterval(r),n.applySort())},100);else n.applySort()},hideEditControls:function(){if(this.editControls)switch(this.editControls.action){case"add-comment":this.hideAddCommentControls();break;case"edit-comment":this.hideEditCommentControls(this.editControls.comment);break;case"add-reply":this.hideAddReplyControls(this.editControls.component);break;case"edit-reply":this.hideEditReplyControls(this.editControls.comment,this.editControls.reply)}},onBtnAddReply:function(e){var t=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("root-add-reply"))return!0});if(t){var n=t.down("textarea");if(n){if(n.getValue()<1)return;var r=Ext.String.trim(n.getValue()),i=t.getId().match(/root-add-reply-(.+)/)[1];i!=null&&i.length>0&&this.addReply(i,r)}}},onBtnCloseReply:function(e){var t=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("root-add-reply"))return!0});if(t){var n=t.down("textarea");n&&(n.setValue(""),this.hideAddReplyControls(e))}},onFocusRetryTextArea:function(e){this.showAddReplyControls(e)},onBtnEditReply:function(e){var t=e.getEl().up(".reply"),n=e.getEl().up(".comment-wrap");if(t&&n){var r=n.id.match(/comment-(.+)/)[1],i=t.id.match(/\d+/g),s=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("controls-edit-msg-container"))return!0});if(s){var o=s.down("textarea");o&&this.editReply(r,i,o.getValue())}}},onBtnCancelEditReply:function(e){var t=e.getEl().up(".reply"),n=e.getEl().up(".comment-wrap");t&&n&&this.hideEditReplyControls(n.id.match(/comment-(.+)/)[1],t.id.match(/\d+/g))},onKeyDownRetryTextArea:function(e,t){if(t.getKey()==t.ENTER&&(t.ctrlKey||t.metaKey)&&!t.shiftKey){var n=this,r=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("root-add-reply"))return!0});if(r){var i=Ext.String.trim(e.getValue()),s=r.getId().match(/root-add-reply-(.+)/)[1];s!=null&&s.length>0&&i.length>0&&(t.stopEvent(),this.addReply(s,i))}}},onElasticReplyTextArea:function(e,t,n){var r=e.ownerCt,i=this;if(r){var s=r.down("container");if(s){var o=function(){r.setHeight(n+s.getHeight()+5);var e=r.ownerCt;e&&e.setHeight(n+s.getHeight()+5),i.updateCommentsScrollView()};s.rendered?o():s.on("afterrender",function(e){o()},i,{single:!0})}}},onBtnEditComment:function(e){var t=e.getEl().up(".comment-wrap");if(t){var n=t.id.match(/comment-(.+)/)[1],r=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("controls-edit-msg-container"))return!0});if(r){var i=r.down("textarea");i&&this.editComment(n,i.getValue())}this.hideEditCommentControls(n)}},onBtnCancelEditComment:function(e){var t=e.getEl().up(".comment-wrap");t&&this.hideEditCommentControls(t.id.match(/comment-(.+)/)[1])},onResolveComment:function(e){var t=this,n=this.getCommentsList(),r=Ext.getCmp("comments-list-menu-resolve-"+e);if(n){var i=n.getEl().down("#comment-"+e),s=i.down(".resolve");if(s){var o=this.getCommonStoreCommentsStore();if(o){var u=o.findRecord("id",e);if(u){var a=u.get("resolved");a?(r||(r=Ext.widget("menu",{id:"comments-list-menu-resolve-"+e,renderTo:Ext.getBody(),plain:!0,minWidth:50,bodyCls:"menu-resolve-comment",items:[{text:t.textOpenAgain,listeners:{click:function(n,r){n.ownerCt.hide(),t.resolveComment(e,!1)}}}]})),r.show(),r.showBy(s,"tr-br",[0,5])):this.resolveComment(e,!a)}}}}},onBtnAddCommentClick:function(e,t){var n=this.getCommentTextArea();n&&this.addComment(n.getValue())&&n.setValue("")},onBtnAddAfterRender:function(e){var t=e.getEl(),n=this.getCommentTextArea();t.on("mousedown",function(){n.emptyText=this.textEnterCommentHint,n.applyEmptyText()},this),t.on("mouseup",function(){n.emptyText=" ",n.applyEmptyText()},this)},onTextAreaKeyUp:function(e,t){t.getKey()==t.ENTER&&(e.emptyText=" ",e.applyEmptyText())},onTextAreaKeyDown:function(e,t){if(t.getKey()==t.ENTER){var n=this.getCommentTextArea();(t.ctrlKey||t.metaKey)&&!t.shiftKey&&(e.getValue().length<1?(e.emptyText=this.textEnterCommentHint,e.applyEmptyText()):n&&this.addComment(n.getValue())&&n.setValue(""),t.stopEvent())}},onAfterRenderComments:function(e){e.getSelectionModel().keyNav.disable()},onAfterRenderAddCommentLink:function(e){var t=this,n=this.getLinkAddComment();if(n&&n.getEl()){var r=n.getEl().down("label");r&&r.on("click",function(e,n){t.showAddCommentControls()})}},onAddComment:function(e,t,n){var r=this,i=this.getCommentsList();Ext.each(e,function(e){r.createAddReplyControls(e),r.updateHandlers(e,"comment-"+e.get("id"),{onResolveComment:r.onResolveComment,showEditCommentControls:r.showEditCommentControls,showEditReplyControls:r.showEditReplyControls})}),i&&this.updateCommentsScrollView(i.getNode(t)),i&&i.fireEvent("resize")},onRemoveComment:function(e,t){var n=Ext.getCmp("root-add-reply-"+e.get("id"));n&&n.destroy()},onUpdateComment:function(e,t,n){var r=this,i=this.getCommentsList(),s=e.get("id"),o=Ext.getCmp("root-add-reply-"+s);Ext.isDefined(o)&&o.destroy(),r.createAddReplyControls(e),i.doComponentLayout(),r.updateHandlers(e,"comment-"+s,{onResolveComment:r.onResolveComment,showEditCommentControls:r.showEditCommentControls,showEditReplyControls:r.showEditReplyControls}),i&&this.updateCommentsScrollView(i.getNode(t))},onViewReadyComments:function(e){var t=this,n=e.getStore();n.each(function(e){t.createAddReplyControls(e),t.updateHandlers(e,"comment-"+e.get("id"),{onResolveComment:t.onResolveComment,showEditCommentControls:t.showEditCommentControls,showEditReplyControls:t.showEditReplyControls})})},onRefreshComments:function(e){if(e.viewReady){var t=this,n=e.getStore(),r=0;n.each(function(e){t.onUpdateComment(e,r)});var i=e.getNodes(),s=e.getWidth();s=s?s+"px":"100%";for(var o in i)i[o].style.width=s}},onShowPanel:function(e,t){var n=e.down("container");if(n&&n.isXType("commoncommentspanel")){var r=Ext.ComponentQuery.query("container[action=comments-list-add-reply-link-container]");r&&Ext.each(r,function(e){var t=e.ownerCt;t&&t.doLayout()})}},textAddReply:"Add Reply",textOpenAgain:"Open Again",textEnterCommentHint:"Enter your comment here"}),Ext.define("Common.controller.CommentsPopover",{extend:"Common.controller.CommentsBase",requires:["Common.view.CommentsEditForm"],views:["Common.view.CommentsPopover"],init:function(){this.visiblePopovers=new Ext.util.MixedCollection,this.isDocumentContentReady=!1,this.control({commoncommentspopover:{afterrender:this.onAfterRenderPopover,transformToAdd:this.onTransformToAdd},"commoncommentspopover > dataview":{afterrender:this.onAfterRenderComment,itemupdate:this.onUpdateComment,viewready:this.onViewReadyComments},"commoncommentspopover textarea[action=add-reply-textarea]":{elastic:this.onElasticAddReply,keydown:this.onKeyDownTextArea},"commoncommentspopover label[action=link]":{afterrender:this.onAfterRenderAddReply},"commoncommentspopover button[action=reply]":{click:this.onBtnAddReply},"commoncommentspopover button[action=close]":{click:this.onBtnCloseReply}})},config:{movingTopLimit:-32,movingBottomLimit:-6,autoPopup:!0,lastPosition:{x:0,y:0}},sdkViewName:"#id_main",setConfig:function(e,t){this.superclass.loadConfig.call(this,e),this.setApi(t),this.sdkViewName=e.sdkviewname||this.sdkViewName,this.setMovingTopLimit(e.movingtoplimit||-32),this.setMovingBottomLimit(e.movingbottomlimit||-6),this.setAutoPopup(e.autopopup||!0)},setApi:function(e){this.callParent(arguments)},registerCallbacks:function(){this.api.asc_registerCallback("asc_onAddComment",Ext.bind(this.onApiAddComment,this)),this.api.asc_registerCallback("asc_onShowComment",Ext.bind(this.onApiShowComment,this)),this.api.asc_registerCallback("asc_onHideComment",Ext.bind(this.onApiHideComment,this)),this.api.asc_registerCallback("asc_onUpdateCommentPosition",Ext.bind(this.onApiUpdateCommentPosition,this)),this.api.asc_registerCallback("asc_onRemoveComment",Ext.bind(this.onApiRemoveComment,this))},onApiAddComment:function(e,t){this.isDocumentContentReady&&this.getAutoPopup()&&(this.api.asc_selectComment(e),this.api.asc_showComment(e,!0))},onApiShowComment:function(e,t,n,r,i){e=e[e.length-1];if(!Ext.isEmpty(Ext.get("id-doc-comment-"+e)))return;this.setLastPosition({x:t,y:n,lx:r}),this.onApiHideComment();var s=Ext.getCmp("editor_sdk");if(s){var o=s.getEl().down(this.sdkViewName);if(o){var u=o.createChild({tag:"div",id:"id-doc-comment-"+e,cls:"comment-popover-root",style:"top: "+n+"px; left: "+t+"px;"});if(u){var a=Ext.widget("commoncommentspopover",{commentId:e,userId:this.getCurrentUserId(),editable:i!==!1,renderTo:u,maxHeight:o.getHeight()+this.getMovingTopLimit()+this.getMovingBottomLimit()});if(a){if(t+a.getWidth()>o.getWidth())if(r)u.addCls("left-sided").setLeft(r-a.getWidth()-parseInt(u.getStyle("margin-right")));else{var f=parseInt(u.getStyle("margin-left"));f&&u.setLeft(o.getWidth()-a.getWidth()-f*2)}n+a.getHeight()>o.getHeight()&&u.setTop(o.getHeight()-a.getHeight()),a.getEl().alignTo(u,"tl"),a.show(),this.visiblePopovers.add(e,a)}}}}},onApiHideComment:function(){this.visiblePopovers.length&&(this.keepIncompleteComments(),this.visiblePopovers.eachKey(function(e,t){var n=Ext.get("id-doc-comment-"+e);n&&(t.destroy(),n.remove())}),this.visiblePopovers.clear(),this.editControls=undefined)},onApiRemoveComment:function(e){this.clearIncompleteComments(e);var t=Ext.get("id-doc-comment-"+e);if(t){var n=this.visiblePopovers.get(e);n&&(n.destroy(),t.remove(),this.visiblePopovers.removeAtKey(e),!this.visiblePopovers.length&&(this.editControls=undefined))}},onApiUpdateCommentPosition:function(e,t,n,r){var i=Ext.get("id-doc-comment-"+e),s=this.getViewByCommentId(e),o=Ext.getCmp("editor_sdk"),u=this;if(o&&i&&s){var a=o.getEl().down(this.sdkViewName);if(a){var f=parseInt(i.getStyle("margin-left")),l=parseInt(i.getStyle("margin-top"));this.setLastPosition({x:t,y:n,lx:r});if(n>0&&n<a.getHeight()){if(!s.isVisible()){s.show();var c=this.getDataViewInView(s);c&&(c.doComponentLayout(),u.updateCommentsScrollView(c,!0)),this.fixViewSize(s)}}else s.hide();if(s.isVisible()){t+s.getWidth()>a.getWidth()?r?i.addCls("left-sided").setLeft(r-s.getWidth()-parseInt(i.getStyle("margin-right"))):i.setLeft(a.getWidth()-s.getWidth()-f*2):i.removeCls("left-sided").setLeft(t);var h=s.getEl().down(".popover-arrow"),p=h.up(".x-container");if(n+s.getHeight()+l-this.getMovingBottomLimit()>a.getHeight()&&n<a.getHeight()){var d=a.getHeight()-s.getHeight()-l+this.getMovingBottomLimit();n-d+h.getHeight()+5+(h.getTop()-p.getTop())<s.getHeight()&&p.setStyle("margin-top",n-d+"px"),i.setTop(a.getHeight()-s.getHeight()-l+this.getMovingBottomLimit())}else n<Math.abs(l+this.getMovingTopLimit())?i.setTop(Math.abs(l+this.getMovingTopLimit())):(/^0/.test(p.getStyle("margin-top"))||p.setStyle("margin-top",0),i.setTop(n))}var v=this.visiblePopovers.get(e);v&&v.getEl().alignTo(i,"tl-tl")}}},onDocumentContentReady:function(){this.isDocumentContentReady=!0},getViewByCommentId:function(e){return Ext.getCmp("id-popover-comments-"+e)},getViewByCmp:function(e){return e?e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("common-commentspopover"))return!0}):null},getDataViewInView:function(e){return e?e.down("dataview"):null},fixViewSize:function(e){var t=e.down("dataview"),n=e.down("container[action=add-reply-link-container]"),r=e.down("container[action=add-reply-form-container]");if(t){var i=t.getEl(),s=i.getHeight(),o=t.getPlugin("scrollpane");if(o){var u=i.down(".jspPane");u&&(s=u.getHeight())}s<e.minHeight&&(s=e.minHeight),r&&!r.isHidden()?s+=r.getHeight():n&&(s+=n.getHeight()),s>e.maxHeight&&(s=e.maxHeight),e.setHeight(s),this.onApiUpdateCommentPosition(e.getCommentId(),this.getLastPosition().x,this.getLastPosition().y,this.getLastPosition().lx)}},onAfterRenderPopover:function(e){this.fixViewSize(e)},onTransformToAdd:function(e){var t=this;this.showEditCommentControls(e.commentId);var n=e.down("#id-popover-add-reply-link-"+e.commentId),r=Ext.getCmp("controls-edit-msg-popover-"+e.commentId);n&&n.hide();if(r){var i=r.query("button"),s=r.query("textarea");s&&s[0].focus(!1,100),Ext.each(i,function(e){e.action=="edit"&&e.setText(t.textAdd),e.on("click",function(r){Ext.each(i,function(e){e.un("click")}),n&&n.show(),t.hideEditCommentControls(r),e.action!="edit"&&t.onApiHideComment()},{single:!0})})}e.doLayout(),e.doComponentLayout(),t.fixViewSize(e)},onAfterRenderAddReply:function(e){var t=this;e.getEl().on("click",function(n,r){t.showAddReplyControls(e)})},onAfterRenderComment:function(e){e.getSelectionModel().keyNav.disable()},onUpdateComment:function(e,t,n){var r=this,i=e.get("id"),s=this.getViewByCommentId(i);if(s){var o=this.getDataViewInView(s);if(o){o.doComponentLayout(),r.updateHandlers(e,"id-popover-comment-"+i,{onResolveComment:r.onResolveComment,showEditCommentControls:r.showEditCommentControls,showEditReplyControls:r.showEditReplyControls});var u=e.get("replays");u&&u.each(function(e){r.hideEditReplyControls(i,e.get("id"))}),o&&this.updateCommentsScrollView(o,!0)}this.fixViewSize(s);var a=s.getEl();if(e.get("lock")){a.addCls("lock");var f=this.getCommonStoreUsersStore(),l=r.textAnonym;if(f){var c=f.findRecord("id",e.get("lockuserid"));c&&(l=c.get("username"))}var h=a.down(".lock-author");h&&(h.dom.innerHTML=l)}else a.removeCls("lock")}},onViewReadyComments:function(e){var t=this,n=this.getViewByCmp(e),r=this.getDataViewInView(n),i=e.getStore(),s=i.findRecord("id",n.getCommentId());s&&t.updateHandlers(s,"id-popover-comment-"+n.getCommentId(),{onResolveComment:t.onResolveComment,showEditCommentControls:t.showEditCommentControls,showEditReplyControls:t.showEditReplyControls});if(r){n.editable&&this.showIncompleteCommentEditControls(n.getCommentId()),this.updateCommentsScrollView(r),this.fixViewSize(n);var o=n.getEl();if(s&&s.get("lock")){o.addCls("lock");var u=this.getCommonStoreUsersStore(),a=t.textAnonym;if(u){var f=u.findRecord("id",s.get("lockuserid"));f&&(a=f.get("username"))}var l=o.down(".lock-author");l&&(l.dom.innerHTML=a)}else o.removeCls("lock")}},updateCommentsScrollView:function(e,t){if(e){var n=e.getPlugin("scrollpane");if(n){var r=this.getViewByCmp(e);r&&r.doLayout(),n.updateScrollPane(),e.fireEvent("resize"),t&&this.scrollViewToBegin(e)}}},scrollViewToBegin:function(e){if(e){var t=e.getPlugin("scrollpane");if(t){var n=new Ext.util.DelayedTask(function(){t.jspApi.scrollToPercentY(0,!0)});n.delay(100)}}},scrollViewToNode:function(e,t){if(e&&t){var n=e.getPlugin("scrollpane");if(n){var r=new Ext.util.DelayedTask(function(){n.scrollToElement(t,!1,!0)});r.delay(100)}}},showAddReplyControls:function(e,t){var n=this.getViewByCmp(e),r=e.up("#id-popover-comments-"+n.getCommentId()),i=r.down("#id-popover-controls-reply-"+n.getCommentId()),s=r.down("#id-popover-add-reply-link-"+n.getCommentId()),o=r.down("textarea");i&&s&&(this.hideEditControls(),this.editControls={action:"add-reply",component:e},i.show(),s.hide(),o&&(t&&o.setValue(t),(new Ext.util.DelayedTask(function(){o.focus()},this)).delay(100))),this.fixViewSize(n)},hideAddReplyControls:function(e){var t=this.getViewByCmp(e),n=e.up("#id-popover-comments-"+t.getCommentId()),r=n.down("#id-popover-controls-reply-"+t.getCommentId()),i=n.down("#id-popover-add-reply-link-"+t.getCommentId());r&&i&&(i.show(),r.hide()),t.doLayout(),t.doComponentLayout(),this.fixViewSize(t),this.editControls=undefined},onResolveComment:function(e){var t=this,n=this.getViewByCommentId(e),r=Ext.getCmp("comments-popover-menu-resolve-"+e);if(n){var i=n.getEl().down(".resolve");if(i){var s=this.getCommonStoreCommentsStore();if(s){var o=s.findRecord("id",e);if(o){var u=o.get("resolved");u?(r||(r=Ext.widget("menu",{id:"comments-popover-menu-resolve-"+e,renderTo:Ext.getBody(),plain:!0,minWidth:50,bodyCls:"menu-resolve-comment",items:[{text:t.textOpenAgain,listeners:{click:function(n,r){n.ownerCt.hide(),t.resolveComment(e,!1)}}}]})),r.show(),r.showBy(i,"tr-br",[0,5])):this.resolveComment(e,!u)}}}}},showEditCommentControls:function(e,t){var n=this,r=this.getViewByCommentId(e);if(r){var i=this.getDataViewInView(r);if(i){var s=i.getEl().down("#id-popover-comment-"+e);if(s){var o=s.down(".comment-message");if(o){var u=o.down(".comment"),a=s.down(".edit-info"),f=Ext.getCmp("controls-edit-msg-popover-"+e),l=i.getStore();if(l){var c=l.findRecord("id",e);if(c){f&&f.destroy(),a&&a.hide(),u&&(u.setVisibilityMode(Ext.Element.DISPLAY),u.hide()),this.hideEditControls(),this.editControls={action:"comment",comment:e};var h=Ext.widget("commoncommentseditform",{scope:this,editId:"popover-"+e,renderTo:o,msgValue:t||c.get("comment"),onEditHandler:this.onBtnEditComment,onCancelHandler:this.onBtnCancelEditComment});i.on("resize",function(){h.doLayout()},this,{delay:100});var p=function(){n.fixViewSize(r),n.updateCommentsScrollView(i)};if(h){var d=h.down("textarea");d&&(d.on("elastic",p),(new Ext.util.DelayedTask(function(){d.focus(),d.getValue()&&d.selectText(d.getValue().length)},this)).delay(100))}p()}}}}}}},hideEditCommentControls:function(e){var t=this.getViewByCommentId(e);if(t){var n=this.getDataViewInView(t);if(n){var r=n.getEl().down("#id-popover-comment-"+e),i=r.down(".comment-message");if(i){var s=i.down(".comment"),o=r.down(".edit-info"),u=Ext.getCmp("controls-edit-msg-popover-"+e);o&&o.show(),u&&u.hide(),s&&(s.setVisibilityMode(Ext.Element.DISPLAY),s.show()),this.fixViewSize(t),this.updateCommentsScrollView(n),this.editControls=undefined}}}},showEditReplyControls:function(e,t,n){var r=this,i=this.getViewByCommentId(e);if(i){var s=this.getDataViewInView(i);if(s){var o=s.getEl().down("#reply-"+t),u=o.down(".reply-message");if(u){var a=u.down(".message"),f=o.down(".edit-info"),l=Ext.getCmp("controls-edit-msg-popover-"+t),c=Ext.getStore("Common.store.Comments");if(c){var h=c.findRecord("id",e);if(h){var p=h.replys().findRecord("id",t);if(p){l&&l.destroy(),f&&f.hide(),a&&(a.setVisibilityMode(Ext.Element.DISPLAY),a.hide()),this.hideEditControls(),this.editControls={action:"edit-reply",comment:e,reply:t};var d=Ext.widget("commoncommentseditform",{scope:this,editId:"popover-"+t,renderTo:u,msgValue:n||p.get("reply"),onEditHandler:this.onBtnEditReply,onCancelHandler:this.onBtnCancelEditReply});s.on("resize",function(){d.doLayout()},this,{delay:100});var v=function(){r.fixViewSize(i),r.updateCommentsScrollView(s);var e=Ext.get("controls-edit-msg-popover-"+t);e&&r.scrollViewToNode(s,e.dom)};if(d){var m=d.down("textarea");m&&(m.on("elastic",v),(new Ext.util.DelayedTask(function(){m.focus(),m.getValue()&&m.selectText(m.getValue().length)},this)).delay(100))}v()}}}}}}},hideEditReplyControls:function(e,t){var n=this.getViewByCommentId(e);if(n){var r=this.getDataViewInView(n);if(r){var i=r.getEl().down("#reply-"+t),s=i.down(".reply-message");if(s){var o=s.down(".message"),u=i.down(".edit-info"),a=Ext.getCmp("controls-edit-msg-popover-"+t);u&&u.show(),a&&a.hide(),o&&(o.setVisibilityMode(Ext.Element.DISPLAY),o.show()),this.fixViewSize(n),this.updateCommentsScrollView(r),this.editControls=undefined}}}},makeCommentEditable:function(e){var t=Ext.ComponentQuery.query("commoncommentspopover")[0];$("#"+t.id).find(".edit-info").show();var n=t.down("#id-popover-add-reply-link-"+e);n&&n.show(),t.editable=!0,t.doLayout(),t.doComponentLayout(),this.fixViewSize(t)},onBtnEditComment:function(e){var t=e.getEl().up(".comment-wrap");if(t){var n=t.id.match(/id-popover-comment-(.+)/)[1],r=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("controls-edit-msg-container"))return!0});if(r){var i=r.down("textarea");i&&this.editComment(n,i.getValue())}var s=Ext.getCmp("id-popover-add-reply-link-"+n);s&&s.show(),this.hideEditCommentControls(n)}},onBtnCancelEditComment:function(e){var t=e.getEl().up(".comment-wrap");t&&this.hideEditCommentControls(t.id.match(/id-popover-comment-(.+)/)[1])},onBtnEditReply:function(e){var t=e.getEl().up(".reply"),n=e.getEl().up(".comment-wrap");if(t&&n){var r=n.id.match(/id-popover-comment-(.+)/)[1],i=t.id.match(/\d+/g),s=e.findParentBy(function(e){if(e.getEl()&&e.getEl().hasCls("controls-edit-msg-container"))return!0});if(s){var o=s.down("textarea");o&&this.editReply(r,i,o.getValue())}this.editControls=undefined}},onBtnCancelEditReply:function(e){var t=e.getEl().up(".reply"),n=e.getEl().up(".comment-wrap");t&&n&&this.hideEditReplyControls(n.id.match(/id-popover-comment-(.+)/)[1],t.id.match(/\d+/g))},onBtnAddReply:function(e){var t=this.getViewByCmp(e),n=this.getDataViewInView(t),r=e.up("#id-popover-comments-"+t.getCommentId());if(r){var i=r.down("textarea");if(i){if(i.getValue().length<1)return;var s=Ext.String.trim(i.getValue());this.addReply(t.getCommentId(),s)&&(i.setValue(""),this.hideAddReplyControls(e),this.updateCommentsScrollView(n,!0))}}},onBtnCloseReply:function(e){var t=this.getViewByCmp(e),n=e.up("#id-popover-comments-"+t.getCommentId());if(n){var r=n.down("textarea");r&&(r.setValue(""),this.hideAddReplyControls(e))}},onElasticAddReply:function(e,t,n){var r=e.ownerCt;if(r){var i=r.down("container");if(i&&i.rendered){var s=parseInt(r.getEl().getStyle("padding-top")),o=parseInt(r.getEl().getStyle("padding-bottom"));r.setHeight(n+i.getHeight()+s+o+5);var u=r.ownerCt;u&&this.fixViewSize(u)}}},onKeyDownTextArea:function(e,t){if(t.getKey()==t.ENTER&&(t.ctrlKey||t.metaKey)&&!t.shiftKey){var n=this.getViewByCmp(e),r=this.getDataViewInView(n),i=e.up("#id-popover-comments-"+n.getCommentId());if(i){if(e.getValue().length<1)return;var s=Ext.String.trim(e.getValue());this.addReply(n.getCommentId(),s)&&(e.setValue(""),this.hideAddReplyControls(e),this.updateCommentsScrollView(r,!0))}}},keepIncompleteComments:function(){var e,t,n=this,r;n.visiblePopovers.eachKey(function(i,s){s.editable&&(n.clearIncompleteComments(i),e=[],n.editControls&&(n.editControls.action=="comment"?(r="self",t=$("#controls-edit-msg-popover-"+i+" textarea").filter(":visible")):n.editControls.action=="add-reply"?(r="reply",t=$("#id-popover-controls-reply-"+i+" textarea").filter(":visible")):(r=n.editControls.reply,t=$("#controls-edit-msg-popover-"+r+" textarea").filter(":visible")),t&&t[0]&&t[0].value.length&&(e.push(r),window.sessionStorage.setItem(r,t[0].value))),e.length&&window.sessionStorage.setItem(i,e))})},clearIncompleteComments:function(e){var t=window.sessionStorage.getItem(e);t&&(t=t.match(/[a-zA-Z0-9-_]+/),t.forEach(function(e){window.sessionStorage.removeItem(e)}),window.sessionStorage.removeItem(e))},showIncompleteCommentEditControls:function(e){var t=this,n=window.sessionStorage.getItem(e),r;n&&(n=n.match(/[a-zA-Z0-9-_]+/ig),n.forEach(function(n){r=window.sessionStorage.getItem(n);if(n=="self")t.showEditCommentControls(e,r);else if(n=="reply"){var i=Ext.getCmp("id-popover-add-reply-link-"+e);t.showAddReplyControls(i,r)}else t.showEditReplyControls(e,n,r)}))},hideEditControls:function(){if(this.editControls)switch(this.editControls.action){case"comment":this.hideEditCommentControls(this.editControls.comment);break;case"add-reply":this.hideAddReplyControls(this.editControls.component);break;case"edit-reply":this.hideEditReplyControls(this.editControls.comment,this.editControls.reply)}},textAnonym:"Guest",textOpenAgain:"Open Again",textAdd:"Add"}),Ext.define("SSE.ux.BoxReorderer",{mixins:{observable:"Ext.util.Observable"},itemSelector:".x-box-item",animate:100,constructor:function(){this.addEvents("startdrag","drag","changeindex","drop"),this.mixins.observable.constructor.apply(this,arguments)},init:function(e){this.container=e,this.container.afterLayout=Ext.Function.createSequence(this.container.afterLayout,this.afterFirstLayout,this),e.destroy=Ext.Function.createSequence(e.destroy,this.onContainerDestroy,this)},onContainerDestroy:function(){this.dd&&this.dd.unreg()},afterFirstLayout:function(){var e=this,t=e.container.getLayout();delete e.container.afterLayout,e.dd=Ext.create("Ext.dd.DD",t.innerCt,e.container.id+"-reorderer"),Ext.apply(e.dd,{animate:e.animate,reorderer:e,container:e.container,getDragCmp:this.getDragCmp,clickValidator:Ext.Function.createInterceptor(e.dd.clickValidator,e.clickValidator,e,!1),onMouseDown:e.onMouseDown,startDrag:e.startDrag,onDrag:e.onDrag,endDrag:e.endDrag,getNewIndex:e.getNewIndex,doSwap:e.doSwap,findReorderable:e.findReorderable}),e.dd.dim=t.parallelPrefix,e.dd.startAttr=t.parallelBefore,e.dd.endAttr=t.parallelAfter},getDragCmp:function(e){return this.container.getChildByElement(e.getTarget(this.itemSelector,10))},clickValidator:function(e){var t=this.getDragCmp(e);return!!t&&t.reorderable!==!1},onMouseDown:function(e){var t=this,n=t.container,r,i,s;t.dragCmp=t.getDragCmp(e),t.dragCmp&&(i=t.dragCmp.getEl(),t.startIndex=t.curIndex=n.items.indexOf(t.dragCmp),s=i.getPageBox(),t.lastPos=s[this.startAttr],r=n.el.getPageBox(),t.dim==="width"?(t.minX=r.left,t.maxX=r.right-s.width,t.minY=t.maxY=s.top,t.deltaX=e.getPageX()-s.left):(t.minY=r.top,t.maxY=r.bottom-s.height,t.minX=t.maxX=s.left,t.deltaY=e.getPageY()-s.top),t.constrainY=t.constrainX=!0)},startDrag:function(){var e=this;e.dragCmp?(e.dragCmp.setPosition=Ext.emptyFn,!e.container.layout.animate&&e.animate&&(e.container.layout.animate=e.animate,e.removeAnimate=!0),e.dragElId=e.dragCmp.getEl().id,e.reorderer.fireEvent("StartDrag",e,e.container,e.dragCmp,e.curIndex),e.dragCmp.suspendEvents(),e.dragCmp.disabled=!0,e.dragCmp.el.setStyle("zIndex",100)):e.dragElId=null},findReorderable:function(e){var t=this,n=t.container.items,r;if(n.getAt(e).reorderable===!1){r=n.getAt(e);if(e>t.startIndex)while(r&&r.reorderable===!1)e++,r=n.getAt(e);else while(r&&r.reorderable===!1)e--,r=n.getAt(e)}return e=Math.min(Math.max(e,0),n.getCount()-1),n.getAt(e).reorderable===!1?-1:e},doSwap:function(e){var t=this,n=t.container.items,r,i,s;e=t.findReorderable(e);if(e===-1)return;t.reorderer.fireEvent("ChangeIndex",t,t.container,t.dragCmp,t.startIndex,e),r=n.getAt(t.curIndex),i=n.getAt(e),n.remove(r),s=Math.min(Math.max(e,0),n.getCount()-1),n.insert(s,r),n.remove(i),n.insert(t.curIndex,i),t.container.layout.layout(),t.curIndex=e},onDrag:function(e){var t=this,n;n=t.getNewIndex(e.getPoint()),n!==undefined&&(t.reorderer.fireEvent("Drag",t,t.container,t.dragCmp,t.startIndex,t.curIndex),t.doSwap(n))},endDrag:function(e){e.stopEvent();var t=this;t.dragCmp&&(delete t.dragElId,t.animate&&(t.container.layout.animate={callback:Ext.Function.bind(t.reorderer.afterBoxReflow,t)}),delete t.dragCmp.setPosition,t.container.layout.layout(),t.removeAnimate?(delete t.removeAnimate,delete t.container.layout.animate):t.reorderer.afterBoxReflow.call(t),t.reorderer.fireEvent("drop",t,t.container,t.dragCmp,t.startIndex,t.curIndex))},afterBoxReflow:function(){var e=this;e.dragCmp.el.setStyle("zIndex",""),e.dragCmp.disabled=!1,e.dragCmp.resumeEvents()},getNewIndex:function(e){var t=this,n=t.getDragEl(),r=Ext.fly(n).getPageBox(),i,s,o,u=0,a=t.container.items.items,f=a.length,l=t.lastPos;t.lastPos=r[t.startAttr];for(;u<f;u++){i=a[u].getEl();if(i.is(t.reorderer.itemSelector)){s=i.getPageBox(),o=s[t.startAttr]+(s[t.dim]>>1);if(u<t.curIndex){if(r[t.startAttr]<l&&r[t.startAttr]<o-5)return u}else if(u>t.curIndex&&r[t.startAttr]>l&&r[t.endAttr]>o+5)return u}}}}),Ext.define("SSE.plugin.TabBarScroller",{alias:"plugin.tabbarscroller",constructor:function(e){e=e||{},Ext.apply(this,e)},init:function(e){var t=this;Ext.apply(e,t.parentOverrides),t.tabBar=e,e.on({render:function(){t.layout=t.tabBar.layout,t.lastButton&&t.lastButton.on("click",t.scrollToLast,t),t.firstButton&&t.firstButton.on("click",t.scrollToFirst,t),t.prevButton&&(t.beforeRepeater=Ext.create("Ext.util.ClickRepeater",t.prevButton.getEl(),{interval:t.layout.overflowHandler.scrollRepeatInterval,handler:t.layout.overflowHandler.scrollLeft,scope:t.layout.overflowHandler})),t.nextButton&&(t.afterRepeater=Ext.create("Ext.util.ClickRepeater",t.nextButton.getEl(),{interval:t.layout.overflowHandler.scrollRepeatInterval,handler:t.layout.overflowHandler.scrollRight,scope:t.layout.overflowHandler})),t.tabBar.addCls("asc-page-scroller"),t.layout.overflowHandler.updateScrollButtons=Ext.Function.createSequence(t.layout.overflowHandler.updateScrollButtons,t.updateButtons,t),t.layout.overflowHandler.handleOverflow=Ext.Function.createSequence(t.layout.overflowHandler.handleOverflow,t.updateButtons,t),t.layout.overflowHandler.clearOverflow=Ext.Function.createSequence(t.layout.overflowHandler.clearOverflow,t.disableButtons,t)},single:!0})},disableButtons:function(){var e=this;e.lastButton&&(e.lastButton.addClsWithUI("disabled"),e.lastButton.addCls("x-item-disabled"),e.lastButton.disabled=!0),e.firstButton&&(e.firstButton.addClsWithUI("disabled"),e.firstButton.addCls("x-item-disabled"),e.firstButton.disabled=!0),e.prevButton&&(e.prevButton.addClsWithUI("disabled"),e.prevButton.addCls("x-item-disabled"),e.prevButton.disabled=!0),e.nextButton&&(e.nextButton.addClsWithUI("disabled"),e.nextButton.addCls("x-item-disabled"),e.nextButton.disabled=!0)},scrollToFirst:function(e){var t=this;t.layout.overflowHandler.scrollTo(0)},scrollToLast:function(e){var t=this;t.layout.overflowHandler.scrollTo(t.layout.overflowHandler.getMaxScrollPosition())},updateButtons:function(){var e=this,t=e.layout.overflowHandler.atExtremeBefore()?"addClsWithUI":"removeClsWithUI",n=e.layout.overflowHandler.atExtremeAfter()?"addClsWithUI":"removeClsWithUI",r=e.layout.overflowHandler.atExtremeBefore()?"addCls":"removeCls",i=e.layout.overflowHandler.atExtremeAfter()?"addCls":"removeCls",s=r=="addCls",o=i=="addCls";e.lastButton&&(e.lastButton[n]("disabled"),e.lastButton[i]("x-item-disabled"),e.lastButton.disabled=o),e.nextButton&&(e.nextButton[n]("disabled"),e.nextButton[i]("x-item-disabled"),e.nextButton.disabled=o),e.firstButton&&(e.firstButton[t]("disabled"),e.firstButton[r]("x-item-disabled"),e.firstButton.disabled=s),e.prevButton&&(e.prevButton[t]("disabled"),e.prevButton[r]("x-item-disabled"),e.prevButton.disabled=s)}}),Ext.define("SSE.plugin.TabReorderer",{extend:"SSE.ux.BoxReorderer",alias:"plugin.tabreorderer",itemSelector:".x-tab",config:{disabled:!1},init:function(e){this.callParent(arguments)},clickValidator:function(e){return this.getDisabled()?!1:this.callParent(arguments)},afterBoxReflow:function(){var e=this;SSE.ux.BoxReorderer.prototype.afterBoxReflow.apply(e,arguments),e.dragCmp&&e.container.setActiveTab(e.dragCmp)}}),Ext.define("SSE.view.OpenDialog",{extend:"Ext.window.Window",alias:"widget.sseopendialog",requires:["Ext.window.Window","Common.plugin.ComboBoxScrollPane"],modal:!0,closable:!1,resizable:!1,height:218,width:250,padding:"15px 0 0 0",layout:{type:"vbox",align:"stretch"},cls:"csv-open-dialog",initComponent:function(){this.title=this.title||this.txtTitle;var e=[];if(this.codepages){e=[];for(var t=0;t<this.codepages.length;t++){var n=this.codepages[t],r=[];r[0]=n.asc_getCodePage(),r[1]=n.asc_getCodePageName(),e.push(r)}}else e=[[37,"IBM EBCDIC (US-Canada)"],[437,"OEM United States"],[500,"IBM EBCDIC (International)"],[708,"Arabic (ASMO 708)"],[720,"Arabic (DOS)"],[737,"Greek (DOS)"],[775,"Baltic (DOS)"],[850,"Western European (DOS)"],[852,"Central European (DOS)"],[855,"OEM Cyrillic"],[857,"Turkish (DOS)"],[858,"OEM Multilingual Latin I"],[860,"Portuguese (DOS)"],[861,"Icelandic (DOS)"],[862,"Hebrew (DOS)"],[863,"French Canadian (DOS)"],[864,"Arabic (864) "],[865,"Nordic (DOS)"],[866,"Cyrillic (DOS)"],[869,"Greek, Modern (DOS)"],[870,"IBM EBCDIC (Multilingual Latin-2)"],[874,"Thai (Windows)"],[875,"IBM EBCDIC (Greek Modern)"],[932,"Japanese (Shift-JIS)"],[936,"Chinese Simplified (GB2312)"],[949,"Korean"],[950,"Chinese Traditional (Big5)"],[1026,"IBM EBCDIC (Turkish Latin-5)"],[1047,"IBM Latin-1"],[1140,"IBM EBCDIC (US-Canada-Euro)"],[1141,"IBM EBCDIC (Germany-Euro)"],[1142,"IBM EBCDIC (Denmark-Norway-Euro)"],[1143,"IBM EBCDIC (Finland-Sweden-Euro)"],[1144,"IBM EBCDIC (Italy-Euro)"],[1145,"IBM EBCDIC (Spain-Euro)"],[1146,"IBM EBCDIC (UK-Euro)"],[1147,"IBM EBCDIC (France-Euro)"],[1148,"IBM EBCDIC (International-Euro)"],[1149,"IBM EBCDIC (Icelandic-Euro)"],[1200,"Unicode"],[1201,"Unicode (Big-Endian)"],[1250,"Central European (Windows)"],[1251,"Cyrillic (Windows)"],[1252,"Western European (Windows)"],[1253,"Greek (Windows)"],[1254,"Turkish (Windows)"],[1255,"Hebrew (Windows) "],[1256,"Arabic (Windows) "],[1257,"Baltic (Windows)"],[1258,"Vietnamese (Windows)"],[1361,"Korean (Johab)"],[1e4,"Western European (Mac)"],[10001,"Japanese (Mac)"],[10002,"Chinese Traditional (Mac)"],[10003,"Korean (Mac)"],[10004,"Arabic (Mac) "],[10005,"Hebrew (Mac)"],[10006,"Greek (Mac) "],[10007,"Cyrillic (Mac)"],[10008,"Chinese Simplified (Mac)"],[10010,"Romanian (Mac)"],[10017,"Ukrainian (Mac)"],[10021,"Thai (Mac)"],[10029,"Central European (Mac) "],[10079,"Icelandic (Mac)"],[10081,"Turkish (Mac)"],[10082,"Croatian (Mac)"],[12e3,"Unicode (UTF-32)"],[12001,"Unicode (UTF-32 Big-Endian)"],[2e4,"Chinese Traditional (CNS)"],[20001,"TCA Taiwan"],[20002,"Chinese Traditional (Eten)"],[20003,"IBM5550 Taiwan"],[20004,"TeleText Taiwan"],[20005,"Wang Taiwan"],[20105,"Western European (IA5)"],[20106,"German (IA5)"],[20107,"Swedish (IA5) "],[20108,"Norwegian (IA5) "],[20127,"US-ASCII"],[20261,"T.61 "],[20269,"ISO-6937"],[20273,"IBM EBCDIC (Germany)"],[20277,"IBM EBCDIC (Denmark-Norway) "],[20278,"IBM EBCDIC (Finland-Sweden)"],[20280,"IBM EBCDIC (Italy)"],[20284,"IBM EBCDIC (Spain)"],[20285,"IBM EBCDIC (UK)"],[20290,"IBM EBCDIC (Japanese katakana)"],[20297,"IBM EBCDIC (France)"],[20420,"IBM EBCDIC (Arabic)"],[20423,"IBM EBCDIC (Greek)"],[20424,"IBM EBCDIC (Hebrew)"],[20833,"IBM EBCDIC (Korean Extended)"],[20838,"IBM EBCDIC (Thai)"],[20866,"Cyrillic (KOI8-R)"],[20871,"IBM EBCDIC (Icelandic) "],[20880,"IBM EBCDIC (Cyrillic Russian)"],[20905,"IBM EBCDIC (Turkish)"],[20924,"IBM Latin-1 "],[20932,"Japanese (JIS 0208-1990 and 0212-1990)"],[20936,"Chinese Simplified (GB2312-80) "],[20949,"Korean Wansung "],[21025,"IBM EBCDIC (Cyrillic Serbian-Bulgarian)"],[21866,"Cyrillic (KOI8-U)"],[28591,"Western European (ISO) "],[28592,"Central European (ISO)"],[28593,"Latin 3 (ISO)"],[28594,"Baltic (ISO)"],[28595,"Cyrillic (ISO) "],[28596,"Arabic (ISO)"],[28597,"Greek (ISO) "],[28598,"Hebrew (ISO-Visual)"],[28599,"Turkish (ISO)"],[28603,"Estonian (ISO)"],[28605,"Latin 9 (ISO)"],[29001,"Europa"],[38598,"Hebrew (ISO-Logical)"],[50220,"Japanese (JIS)"],[50221,"Japanese (JIS-Allow 1 byte Kana) "],[50222,"Japanese (JIS-Allow 1 byte Kana - SO/SI)"],[50225,"Korean (ISO)"],[50227,"Chinese Simplified (ISO-2022)"],[51932,"Japanese (EUC)"],[51936,"Chinese Simplified (EUC) "],[51949,"Korean (EUC)"],[52936,"Chinese Simplified (HZ)"],[54936,"Chinese Simplified (GB18030)"],[57002,"ISCII Devanagari "],[57003,"ISCII Bengali "],[57004,"ISCII Tamil"],[57005,"ISCII Telugu "],[57006,"ISCII Assamese "],[57007,"ISCII Oriya"],[57008,"ISCII Kannada"],[57009,"ISCII Malayalam "],[57010,"ISCII Gujarati"],[57011,"ISCII Punjabi"],[65e3,"Unicode (UTF-7)"],[65001,"Unicode (UTF-8)"]];var i=Ext.create("Ext.data.ArrayStore",{autoDestroy:!0,storeId:"encodeStore",idIndex:0,fields:[{name:"value",type:"int"},{name:"name",type:"string"}],data:e});this.cmbEncoding=Ext.create("Ext.form.field.ComboBox",{store:i,displayField:"name",queryMode:"local",typeAhead:!1,editable:!1,listeners:{keydown:this._handleKeyDown,select:function(e,t,n){this.encoding=t[0].data.value},scope:this},enableKeyEvents:!0,plugins:[{pluginId:"scrollpane",ptype:"comboboxscrollpane",settings:{enableKeyboardNavigation:!0}}]}),this.cmbEncoding.select(i.getAt(0)),this.encoding=i.getAt(0).data.value;var s=Ext.create("Ext.data.ArrayStore",{autoDestroy:!0,storeId:"delimiterStore",idIndex:0,fields:[{name:"value",type:"int"},{name:"description",type:"string"}],data:[[4,","],[2,";"],[3,":"],[1,this.txtTab],[5,this.txtSpace]]});this.cmbDelimiter=Ext.create("Ext.form.field.ComboBox",{width:70,store:s,displayField:"description",queryMode:"local",typeAhead:!1,editable:!1,listeners:{select:function(e,t,n){this.delimiter=t[0].data.value},scope:this}}),this.cmbDelimiter.select(s.getAt(0)),this.delimiter=s.getAt(0).data.value,this.items=[{xtype:"container",layout:{type:"vbox",align:"stretch"},padding:"0 20px 0 20px",height:46,width:210,items:[{xtype:"label",text:this.txtEncoding,style:"font-weight: bold;margin:0 0 4px 0;"},this.cmbEncoding]},{xtype:"tbspacer",height:10},{xtype:"container",layout:{type:"vbox",align:"left"},padding:"0 20px 0 20px",height:46,width:210,items:[{xtype:"label",text:this.txtDelimiter,style:"font-weight: bold;margin:0 0 4px 0;"},this.cmbDelimiter]},{xtype:"tbspacer",height:10},{xtype:"tbspacer",height:8,html:'<div style="width: 100%; height: 40%; border-bottom: 1px solid #C7C7C7"></div>'},{xtype:"container",height:40,layout:{type:"vbox",align:"center",pack:"center"},items:[{xtype:"container",width:86,height:24,layout:{type:"hbox",align:"middle"},items:[this.btnOk=Ext.widget("button",{cls:"asc-blue-button",width:86,height:22,margin:"0 5px 0 0",text:this.okButtonText,listeners:{click:function(e){this.fireEvent("onmodalresult",this,1,{encoding:this.encoding,delimiter:this.delimiter}),this.close()},scope:this}})]}]}],this.callParent(arguments)},setSettings:function(e){var t=this.cmbEncoding.getStore().find("value",e.asc_getCodePage?e.asc_getCodePage():e.encoding);t<0||(this.cmbEncoding.select(this.cmbEncoding.getStore().getAt(t)),this.encoding=e.asc_getCodePage()),t=this.cmbDelimiter.getStore().find("value",e.asc_getDelimiter?e.asc_getDelimiter():e.delimiter),t<0||(this.cmbDelimiter.select(this.cmbDelimiter.getStore().getAt(t)),this.delimiter=e.asc_getDelimiter())},scrollViewToNode:function(e,t){if(e&&t){var n=e.getPlugin("scrollpane");if(n){var r=new Ext.util.DelayedTask(function(){n.scrollToElement(t,!1,!0)});r.delay(100)}}},_handleKeyDown:function(e,t){if(t.ctrlKey||t.altKey)return;var n=String.fromCharCode(t.getCharCode());if(/[A-Z0-9]/.test(n)){(new Date).getTime()-e.lastsearchtime>3e3&&(e.lastsearchquery="");var r=e.lastsearchquery+n,i=e.getStore().find("name",r,e.lastsearchindex);i<0&&(r=n,i=e.getStore().find("name",r,e.lastsearchindex),i<0&&(i=e.getStore().find("name",r,0))),e.lastsearchtime=(new Date).getTime();if(i<0)e.lastsearchquery="",e.lastsearchindex=0;else{var s=e.getStore().getAt(i),o=e.getPicker().getNode(s);e.select(s),this.scrollViewToNode(e,o),e.lastsearchquery=r,e.lastsearchindex=++i<e.getStore().getCount()?i:0}}},cancelButtonText:"Cancel",okButtonText:"Ok",txtEncoding:"Encoding ",txtDelimiter:"Delimiter",txtTab:"Tab",txtSpace:"Space",txtTitle:"Choose CSV options"}),Ext.define("SSE.view.CreateFile",{extend:"Ext.panel.Panel",alias:"widget.ssecreatenew",cls:"sse-file-createnew",layout:{type:"vbox",align:"stretch"},requires:["Ext.container.Container","Ext.data.Model","Ext.data.Store","Ext.view.View","Ext.XTemplate","Common.plugin.DataViewScrollPane"],constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){this.callParent(arguments);var e=this;e.add({xtype:"container",html:"<h3>"+e.fromBlankText+"</h3>"+"<hr noshade>"+'<div class="blank-document">'+'<div id="id-create-blank-document" class="btn-blank-document"></div>'+'<div class="blank-document-info">'+"<h3>"+e.newDocumentText+"</h3>"+e.newDescriptionText+"</div>"+"</div>"+'<div style="clear: both;"></div>'+"<h3>"+e.fromTemplateText+"</h3>"+"<hr noshade>"},{xtype:"container",flex:1,layout:"fit",cls:"container-template-list",items:[{xtype:"dataview",store:"FileTemplates",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="thumb-wrap">','<tpl if="this.isEmptyIcon(icon)">','<div class="thumb"></div>',"</tpl>",'<tpl if="this.isEmptyIcon(icon) == false">','<div class="thumb" style="background-image: url(\'{icon}\');"></div>',"</tpl>",'<div class="title">{name:htmlEncode}</div>',"</div>","</tpl>",{isEmptyIcon:function(e){return e==""}}),singleSelect:!0,trackOver:!0,autoScroll:!0,overItemCls:"x-item-over",itemSelector:"div.thumb-wrap",cls:"x-view-context",plugins:[{ptype:"dataviewscrollpane",pluginId:"scrollpane",areaSelector:".x-view-context",settings:{enableKeyboardNavigation:!0}}]}]})},fromBlankText:"From Blank",newDocumentText:"New Text Document",newDescriptionText:"Create a new blank text document which you will be able to style and format after it is created during the editing. Or choose one of the templates to start a document of a certain type or purpose where some styles have already been pre-applied.",fromTemplateText:"From Template"}),Ext.define("SSE.view.RecentFiles",{extend:"Ext.panel.Panel",alias:"widget.sserecentfiles",cls:"sse-recentfiles",layout:{type:"vbox",align:"stretch"},requires:["Ext.container.Container","Ext.data.Model","Ext.data.Store","Ext.view.View","Ext.XTemplate","Common.plugin.DataViewScrollPane"],constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){this.callParent(arguments);var e=this;e.add({xtype:"container",flex:1,layout:"fit",cls:"container-recent-file-list",items:[{xtype:"dataview",store:"RecentFiles",tpl:Ext.create("Ext.XTemplate",'<tpl for=".">','<div class="thumb-wrap">','<div class="thumb"></div>','<div class="file-name">{title:htmlEncode}</div>','<div class="file-info">{folder:htmlEncode}</div>',"</div>","</tpl>"),singleSelect:!0,trackOver:!0,style:"overflow:auto",overItemCls:"x-item-over",itemSelector:"div.thumb-wrap",cls:"x-view-context",plugins:[{ptype:"dataviewscrollpane",pluginId:"scrollpane",areaSelector:".x-view-context",settings:{enableKeyboardNavigation:!0}}]}]})}}),Ext.define("SSE.view.DocumentInfo",{extend:"Ext.container.Container",alias:"widget.ssedocumentinfo",cls:"sse-documentinfo-body",autoScroll:!0,requires:["Ext.button.Button","Ext.container.Container","Common.plugin.ScrollPane","Ext.form.Label","Ext.XTemplate","Ext.Date"],uses:["Common.view.DocumentAccessDialog"],listeners:{afterrender:function(e,t){e.updateInfo(e.doc)}},constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){this.infoObj={PageCount:0,WordsCount:0,ParagraphCount:0,SymbolsCount:0,SymbolsWSCount:0},this.inProgress=!1,this.lblTitle=Ext.create("Ext.form.Label",{text:"-",height:14}),this.lblPlacement=Ext.create("Ext.form.Label",{text:"-",width:150,height:14,style:"text-align:left",hideId:"element-to-hide"}),this.lblDate=Ext.create("Ext.form.Label",{text:"-",width:150,height:14,style:"text-align:left",hideId:"element-to-hide"});var e=Ext.create("Ext.XTemplate",'<span class="userLink">{text:htmlEncode}</span>');this.cntAuthor=Ext.create("Ext.container.Container",{tpl:e,data:{text:"-"},hideId:"element-to-hide"});var t=Ext.create("Ext.XTemplate","<table>",'<tpl for=".">',"<tr>",'<td style="padding: 0 20px 5px 0;"><span class="userLink">{user:htmlEncode}</span></td>','<td style="padding: 0 20px 5px 0;">{permissions:htmlEncode}</td>',"</tr>","</tpl>","</table>");this.cntRights=Ext.create("Ext.container.Container",{tpl:t,hideId:"element-to-hide"}),this.items=[{xtype:"tbspacer",height:30},{xtype:"container",layout:{type:"table",columns:2,tableAttrs:{style:"width: 100%;"},tdAttrs:{style:"padding: 5px 10px;vertical-align: top;"}},items:[{xtype:"label",cellCls:"doc-info-label-cell",text:this.txtTitle,style:"display: block;text-align: right;",width:"100%"},this.lblTitle,{xtype:"label",cellCls:"doc-info-label-cell",text:this.txtAuthor,style:"display: block;text-align: right;",width:"100%"},this.cntAuthor,{xtype:"label",cellCls:"doc-info-label-cell",text:this.txtPlacement,style:"display: block;text-align: right;",width:"100%"},this.lblPlacement,{xtype:"label",cellCls:"doc-info-label-cell",text:this.txtDate,style:"display: block;text-align: right;",width:"100%"},this.lblDate,{xtype:"tbspacer",colspan:2,height:5},{xtype:"label",cellCls:"doc-info-label-cell",text:this.txtRights,style:"display: block;text-align: right;",width:"100%"},this.cntRights,this.tbsRights=Ext.create("Ext.toolbar.Spacer",{colspan:2,height:5,hideId:"element-to-hide"}),{xtype:"box"},this.btnEditRights=Ext.widget("button",{id:"doc-info-set-rights",cls:"asc-blue-button",text:this.txtBtnAccessRights,hideId:"element-to-hide",listeners:{click:Ext.bind(this._changeAccessRights,this)}})]}],Ext.apply(this,{plugins:[{ptype:"scrollpane",areaSelector:".x-container",pluginId:"docInfoPluginId",settings:{enableKeyboardNavigation:!0}}]}),this.callParent(arguments)},updateInfo:function(e){this.doc=e;if(!this.rendered)return;e=e||{},this.lblTitle.setText(e.title?e.title:"-"),e.info?(e.info.author&&this.cntAuthor.update({text:e.info.author}),this._ShowHideInfoItem(this.cntAuthor,e.info.author!==undefined&&e.info.author!==null),e.info.created&&this.lblDate.setText(e.info.created),this._ShowHideInfoItem(this.lblDate,e.info.created!==undefined&&e.info.created!==null),e.info.folder&&this.lblPlacement.setText(e.info.folder),this._ShowHideInfoItem(this.lblPlacement,e.info.folder!==undefined&&e.info.folder!==null),e.info.sharingSettings&&this.cntRights.update(e.info.sharingSettings),this._ShowHideInfoItem(this.cntRights,e.info.sharingSettings!==undefined&&e.info.sharingSettings!==null&&this._readonlyRights!==!0),this._ShowHideInfoItem(this.tbsRights,e.info.sharingSettings!==undefined&&e.info.sharingSettings!==null&&this._readonlyRights!==!0),this._ShowHideInfoItem(this.btnEditRights,!!this.sharingSettingsUrl&&this.sharingSettingsUrl.length&&this._readonlyRights!==!0)):this._ShowHideDocInfo(!1)},_ShowHideInfoItem:function(e,t){var n=e.getEl().up("tr");n&&n.setDisplayed(t)},_ShowHideDocInfo:function(e){var t=Ext.ComponentQuery.query('[hideId="element-to-hide"]',this);for(var n=0;n<t.length;n++)this._ShowHideInfoItem(t[n],e)},stopUpdatingStatisticInfo:function(){},setApi:function(e){},loadConfig:function(e){return this.sharingSettingsUrl=e.config.sharingSettingsUrl,this},_changeAccessRights:function(e,t,n){var r=Ext.widget("commondocumentaccessdialog",{settingsurl:this.sharingSettingsUrl}),i=this;r.on("accessrights",function(e,t){i.doc.info.sharingSettings=t,i.cntRights.update(t)}),r.show()},onLostEditRights:function(){this._readonlyRights=!0;if(!this.rendered)return;this._ShowHideInfoItem(this.cntRights,!1),this._ShowHideInfoItem(this.tbsRights,!1),this._ShowHideInfoItem(this.btnEditRights,!1)},txtTitle:"Document Title",txtAuthor:"Author",txtPlacement:"Placement",txtDate:"Creation Date",txtRights:"Persons who have rights",txtBtnAccessRights:"Change access rights"}),Ext.define("SSE.model.ModelHelpMenu",{extend:"Ext.data.Model",fields:[{type:"string",name:"name"},{type:"string",name:"src"},{type:"string",name:"headername"}]}),Ext.define("SSE.view.DocumentHelp",{extend:"Ext.container.Container",alias:"widget.ssedocumenthelp",cls:"sse-documenthelp-body",autoScroll:!0,requires:["Ext.container.Container","Ext.XTemplate","Ext.view.View","Ext.data.Model","Ext.data.Store","Common.plugin.DataViewScrollPane"],constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){var e=this;this.urlPref="resources/help/en/";var t=[{src:"UsageInstructions/OpenCreateNew.htm",name:"Create a new spreadsheet or open an existing one",headername:"Usage Instructions"},{src:"UsageInstructions/ManageSheets.htm",name:"Manage sheets"},{src:"UsageInstructions/InsertDeleteCells.htm",name:"Insert or delete cells, rows, and columns"},{src:"UsageInstructions/CopyPasteData.htm",name:"Copy and paste data"},{src:"UsageInstructions/FontTypeSizeStyle.htm",name:"Set font type, size, style, and colors"},{src:"UsageInstructions/AlignText.htm",name:"Align data in cells"},{src:"UsageInstructions/AddBorders.htm",name:"Add borders"},{src:"UsageInstructions/MergeCells.htm",name:"Merge cells"},{src:"UsageInstructions/ClearFormatting.htm",name:"Clear text, format in a cell"},{src:"UsageInstructions/SortData.htm",name:"Sort data"},{src:"UsageInstructions/InsertFunction.htm",name:"Insert function"},{src:"UsageInstructions/ChangeNumberFormat.htm",name:"Change number format"},{src:"UsageInstructions/UndoRedo.htm",name:"Undo/redo your actions"},{src:"UsageInstructions/ViewDocInfo.htm",name:"View file information"},{src:"UsageInstructions/SavePrintDownload.htm",name:"Save/print/download your spreadsheet"},{src:"HelpfulHints/About.htm",name:"About ONLYOFFICE Spreadsheet Editor",headername:"Helpful Hints"},{src:"HelpfulHints/SupportedFormats.htm",name:"Supported Formats of Spreadsheets"},{src:"HelpfulHints/Navigation.htm",name:"Navigation through Your Spreadsheet"},{src:"HelpfulHints/Search.htm",name:"Search Function"},{src:"HelpfulHints/KeyboardShortcuts.htm",name:"Keyboard Shortcuts"}];this.menuStore=Ext.create("Ext.data.Store",{model:"SSE.model.ModelHelpMenu",proxy:{type:"ajax",url:"help/Contents.json",noCache:!1},listeners:{load:function(n,r,i){i||(e.urlPref.indexOf("resources/help/en/")<0?(e.urlPref="resources/help/en/",n.getProxy().url="resources/help/en/Contents.json",n.load()):(e.urlPref="resources/help/en/",n.loadData(t)))}}});var n=new Ext.XTemplate('<tpl for=".">','<tpl if="headername">','<div class="header-wrap">','<span class="header">{headername}</span>',"</div>","</tpl>",'<div class="thumb-wrap">','<span class="caption">{name}</span>',"</div>","</tpl>",'<div class="x-clear"></div>');this.cntMenu=Ext.create("Ext.container.Container",{layout:"fit",cls:"help-menu-container",width:200,items:[this.menuView=Ext.create("Ext.view.View",{store:this.menuStore,tpl:n,singleSelect:!0,trackOver:!0,style:"overflow:visible;",width:"100%",overItemCls:"x-item-over",itemSelector:"div.thumb-wrap",cls:"help-menu-view",listeners:{afterrender:function(t){t.getSelectionModel().deselectOnContainerClick=!1,t.getStore().getCount()&&(t.select(0),e.iFrame.src=e.urlPref+t.getStore().getAt(0).data.src)},selectionchange:function(t,n){var r=t.getLastSelected();r&&(e.iFrame.src=e.urlPref+r.data.src)}},plugins:[{ptype:"dataviewscrollpane",areaSelector:".help-menu-view",pluginId:"docHelpPluginId",settings:{enableKeyboardNavigation:!0,keyboardSpeed:.001}}]})]}),this.iFrame=document.createElement("iframe"),this.iFrame.src="",this.iFrame.align="top",this.iFrame.frameBorder="0",this.iFrame.width="100%",this.iFrame.height="100%",this.iFrame.onload=Ext.bind(function(){var e=arguments[0].currentTarget.contentDocument.URL;Ext.each(this.menuStore.data.items,function(t,n){var r=e.indexOf(t.data.src);if(r>0){this.menuView.select(n);var i=this.menuView.getNode(n),s=this.menuView.getPlugin("docHelpPluginId");return s&&s.scrollToElement(i),!1}},this)},this),this.items=[{xtype:"container",layout:{type:"hbox",align:"stretch"},height:"100%",items:[this.cntMenu,{xtype:"tbspacer",width:2,style:"border-left: 1px solid #C7C7C7"},{xtype:"container",flex:1,layout:"fit",listeners:{afterrender:function(t){t.getEl().appendChild(e.iFrame)}}}]}],this.callParent(arguments)},setApi:function(e){e&&(this.api=e)},setLangConfig:function(e){e&&(e=e.split("-")[0],this.menuStore.getProxy().url="resources/help/"+e+"/Contents.json",this.menuStore.load(),this.urlPref="resources/help/"+e+"/")}}),Ext.define("SSE.view.DocumentHolder",{extend:"Ext.container.Container",alias:"widget.ssedocumentholder",cls:"sse-documentholder",uses:["Ext.menu.Menu","Ext.menu.Manager","SSE.view.FormulaDialog","Common.plugin.MenuExpand"],config:{},constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},layout:"fit",initComponent:function(){var e=this;this.setApi=function(t){return e.api=t,e};var t=window.localStorage.getItem("sse-settings-livecomment");e.isLiveCommenting=t===null||parseInt(t)!=0,e.addEvents("editcomplete"),e.callParent(arguments)},createDelayedElements:function(){function t(e){if(!e.getPosition()[0]&&e.floatParent){var t=e.el.getAlignToXY(e.parentItem.getEl(),"tl-tr?"),n=e.floatParent.getTargetEl().getViewRegion();e.setPosition([t[0]-n.x,t[1]-n.y])}}var e=this;this.pmiInsertEntire=Ext.widget("menuitem",{action:"insert-entire",text:e.txtInsert}),this.pmiInsertCells=Ext.widget("menuitem",{text:e.txtInsert,hideOnClick:!1,menu:{action:"insert-cells",showSeparator:!1,bodyCls:"no-icons",items:[{text:e.txtShiftRight,kind:c_oAscInsertOptions.InsertCellsAndShiftRight},{text:e.txtShiftDown,kind:c_oAscInsertOptions.InsertCellsAndShiftDown},{text:e.txtRow,kind:c_oAscInsertOptions.InsertRows},{text:e.txtColumn,kind:c_oAscInsertOptions.InsertColumns}],plugins:[{ptype:"menuexpand"}],listeners:{show:t}}}),this.pmiDeleteEntire=Ext.widget("menuitem",{action:"delete-entire",text:e.txtDelete}),this.pmiDeleteCells=Ext.widget("menuitem",{text:e.txtDelete,hideOnClick:!1,menu:{action:"delete-cells",showSeparator:!1,bodyCls:"no-icons",items:[{text:e.txtShiftLeft,kind:c_oAscDeleteOptions.DeleteCellsAndShiftLeft},{text:e.txtShiftUp,kind:c_oAscDeleteOptions.DeleteCellsAndShiftTop},{text:e.txtRow,kind:c_oAscDeleteOptions.DeleteRows},{text:e.txtColumn,kind:c_oAscDeleteOptions.DeleteColumns}],plugins:[{ptype:"menuexpand"}],listeners:{show:t}}}),this.pmiSortCells=Ext.widget("menuitem",{text:e.txtSort,hideOnClick:!1,menu:{id:"cmi-sort-cells",bodyCls:"no-icons",showSeparator:!1,items:[{text:e.txtAscending,direction:"descending"},{text:e.txtDescending,direction:"ascending"}],plugins:[{ptype:"menuexpand"}],listeners:{show:t}}}),this.pmiInsFunction=Ext.widget("menuitem",{text:e.txtFormula,listeners:{click:function(t){dlgFormulas.addListener("onmodalresult",function(t,n,r){e.fireEvent("editcomplete",e)},e,{single:!0}),dlgFormulas.show()}}}),this.pmiInsHyperlink=Ext.widget("menuitem",{action:"insert-hyperlink",text:e.txtInsHyperlink}),this.pmiDelHyperlink=Ext.widget("menuitem",{action:"remove-hyperlink",text:e.removeHyperlinkText}),this.pmiRowHeight=Ext.widget("menuitem",{action:"row-height",text:this.txtRowHeight}),this.pmiColumnWidth=Ext.widget("menuitem",{action:"column-width",text:this.txtColumnWidth}),this.pmiEntireHide=Ext.widget("menuitem",{text:this.txtHide,handler:function(t,n){e.api[t.isrowmenu?"asc_hideRows":"asc_hideColumns"]()}}),this.pmiEntireShow=Ext.widget("menuitem",{text:this.txtShow,handler:function(t,n){e.api[t.isrowmenu?"asc_showRows":"asc_showColumns"]()}}),this.pmiAddComment=Ext.widget("menuitem",{id:"cmi-add-comment",text:this.txtAddComment}),this.pmiCellMenuSeparator=Ext.widget("menuseparator"),this.ssMenu=Ext.widget("menu",{id:"context-menu-cell",showSeparator:!1,bodyCls:"no-icons",group:"menu-document",items:[{text:this.txtCut,group:"copy-paste",action:"cut"},{text:this.txtCopy,group:"copy-paste",action:"copy"},{text:this.txtPaste,group:"copy-paste",action:"paste"},{xtype:"menuseparator"},this.pmiInsertEntire,this.pmiInsertCells,this.pmiDeleteEntire,this.pmiDeleteCells,{action:"clear-all",text:e.txtClear},this.pmiSortCells,{xtype:"menuseparator"},this.pmiAddComment,this.pmiCellMenuSeparator,this.pmiInsFunction,this.pmiInsHyperlink,this.pmiDelHyperlink,this.pmiRowHeight,this.pmiColumnWidth,this.pmiEntireHide,this.pmiEntireShow],plugins:[{ptype:"menuexpand"}]}),this.mnuGroupImg=Ext.create("Ext.menu.Item",{iconCls:"mnu-icon-item mnu-group",text:this.txtGroup,action:"image-grouping",grouping:!0}),this.mnuUnGroupImg=Ext.create("Ext.menu.Item",{iconCls:"mnu-icon-item mnu-ungroup",text:this.txtUngroup,action:"image-grouping",grouping:!1}),this.imgMenu=Ext.widget("menu",{showSeparator:!1,group:"menu-document",listeners:{click:function(t,n){n&&e.api.asc_setSelectedDrawingObjectLayer(n.arrange),e.fireEvent("editcomplete",e)}},items:[{iconCls:"mnu-icon-item mnu-arrange-front",text:this.textArrangeFront,arrange:c_oAscDrawingLayerType.BringToFront},{iconCls:"mnu-icon-item mnu-arrange-back",text:this.textArrangeBack,arrange:c_oAscDrawingLayerType.SendToBack},{iconCls:"mnu-icon-item mnu-arrange-forward",text:this.textArrangeForward,arrange:c_oAscDrawingLayerType.BringForward},{iconCls:"mnu-icon-item mnu-arrange-backward",text:this.textArrangeBackward,arrange:c_oAscDrawingLayerType.SendBackward},{xtype:"menuseparator"},this.mnuGroupImg,this.mnuUnGroupImg]}),this.menuParagraphVAlign=Ext.widget("menuitem",{text:this.vertAlignText,hideOnClick:!1,menu:{showSeparator:!1,bodyCls:"no-icons",items:[this.menuParagraphTop=Ext.widget("menucheckitem",{text:this.topCellText,checked:!1,group:"popupparagraphvalign",valign:c_oAscVerticalTextAlign.TEXT_ALIGN_TOP}),this.menuParagraphCenter=Ext.widget("menucheckitem",{text:this.centerCellText,checked:!1,group:"popupparagraphvalign",valign:c_oAscVerticalTextAlign.TEXT_ALIGN_CTR}),this.menuParagraphBottom=Ext.widget("menucheckitem",{text:this.bottomCellText,checked:!1,group:"popupparagraphvalign",valign:c_oAscVerticalTextAlign.TEXT_ALIGN_BOTTOM})],plugins:[{ptype:"menuexpand"}]}}),this.pmiInsHyperlinkShape=Ext.widget("menuitem",{text:e.txtInsHyperlink,action:"add-hyperlink-shape"}),this.pmiRemoveHyperlinkShape=Ext.widget("menuitem",{text:e.removeHyperlinkText,action:"remove-hyperlink-shape"}),this.pmiTextAdvanced=Ext.widget("menuitem",{text:e.txtTextAdvanced,action:"text-advanced"}),this.textInShapeMenu=Ext.widget("menu",{showSeparator:!1,bodyCls:"no-icons",group:"menu-document",items:[this.menuParagraphVAlign,this.pmiInsHyperlinkShape,this.pmiRemoveHyperlinkShape,{xtype:"menuseparator"},this.pmiTextAdvanced]}),this.funcMenu=Ext.widget("menu",{showSeparator:!1,bodyCls:"no-icons",group:"menu-document",items:[{text:"item 1"},{text:"item 2"},{text:"item 3"},{text:"item 4"},{text:"item 5"}]})},setLiveCommenting:function(e){this.isLiveCommenting=e},txtSort:"Sort",txtAscending:"Ascending",txtDescending:"Descending",txtFormula:"Insert Function",txtInsHyperlink:"Add Hyperlink",txtCut:"Cut",txtCopy:"Copy",txtPaste:"Paste",txtInsert:"Insert",txtDelete:"Delete",txtFilter:"Filter",txtClear:"Clear All",txtShiftRight:"Shift cells right",txtShiftLeft:"Shift cells left",txtShiftUp:"Shift cells up",txtShiftDown:"Shift cells down",txtRow:"Entire Row",txtColumn:"Entire Column",txtColumnWidth:"Column Width",txtRowHeight:"Row Height",txtWidth:"Width",txtHide:"Hide",txtShow:"Show",textArrangeFront:"Bring To Front",textArrangeBack:"Send To Back",textArrangeForward:"Bring Forward",textArrangeBackward:"Send Backward",txtArrange:"Arrange",txtAddComment:"Add Comment",txtUngroup:"Ungroup",txtGroup:"Group",topCellText:"Align Top",centerCellText:"Align Center",bottomCellText:"Align Bottom",vertAlignText:"Vertical Alignment",txtTextAdvanced:"Text Advanced Settings",editHyperlinkText:"Edit Hyperlink",removeHyperlinkText:"Remove Hyperlink"});var ACTIVE_TAB_NEXT=-255,ACTIVE_TAB_PREV=-254;Ext.define("SSE.view.DocumentStatusInfo",{extend:"Ext.container.Container",alias:"widget.documentstatusinfo",requires:["Ext.form.field.Number","Ext.button.Button","Ext.form.Label","Ext.toolbar.Spacer","SSE.plugin.TabBarScroller","SSE.plugin.TabReorderer"],uses:["Ext.tip.ToolTip","Ext.menu.Menu","SSE.view.SheetRenameDialog","SSE.view.SheetCopyDialog","Common.view.Participants"],cls:"sse-documentstatusinfo",height:27,layout:{type:"hbox",align:"middle"},style:"padding-left:5px;padding-right:40px;",initComponent:function(){var e=this;this.permissions={},this.txtZoom=Ext.widget("label",{id:"status-label-zoom",text:Ext.String.format(e.zoomText,0),cls:"statusinfo-pages",style:"cursor: pointer; white-space:nowrap; text-align: center;",listeners:{afterrender:function(n){n.getEl().on("mousedown",t,e),n.getEl().set({"data-qtip":e.tipZoomFactor,"data-qalign":"bl-tl?"}),n.setWidth(Ext.util.TextMetrics.measure(n.getEl(),Ext.String.format(e.zoomText,999)).width)}}}),this.btnZoomIn=Ext.widget("button",{id:"status-button-zoom-in",cls:"asc-btn-zoom asc-statusbar-icon-btn",iconCls:"asc-statusbar-btn btn-zoomin",style:"margin-left:5px;"}),this.btnZoomOut=Ext.widget("button",{id:"status-button-zoom-out",cls:"asc-btn-zoom asc-statusbar-icon-btn",iconCls:"asc-statusbar-btn btn-zoomout",style:"margin:0 5px 0 40px;"}),this.userPanel=Ext.widget("statusinfoparticipants",{pack:"end",userIconCls:"sse-icon-statusinfo-users"});var t=function(t,n){n.disabled||(this.menuZoomTo.show(),this.menuZoomTo.showBy(e.txtZoom,"b-t",[0,-10]))};this.setApi=function(t){return this.api=t,this.api.asc_registerCallback("asc_onZoomChanged",Ext.bind(e.onZoomChange,e)),this.api.asc_registerCallback("asc_onSheetsChanged",Ext.bind(e.updateInfo,e)),this.api.asc_registerCallback("asc_onEditCell",Ext.bind(e._onStartEditCell,e)),this.api.asc_registerCallback("asc_onActiveSheetChanged",Ext.bind(e._onActiveSheetChanged,e)),this.api.asc_registerCallback("asc_onoAuthoringDisconnect",Ext.bind(e.onCoAuthoringDisconnect,e)),this.api.asc_registerCallback("asc_onWorkbookLocked",Ext.bind(e.onWorkbookLocked,e)),this.api.asc_registerCallback("asc_onWorksheetLocked",Ext.bind(e.onWorksheetLocked,e)),this.userPanel.setApi(this.api),this};var n=Ext.widget("button",{cls:"asc-btn-zoom asc-statusbar-icon-btn",iconCls:"asc-page-scroller-btn btn-scroll-first"}),r=Ext.widget("button",{cls:"asc-btn-zoom asc-statusbar-icon-btn",iconCls:"asc-page-scroller-btn btn-scroll-last"}),i=Ext.widget("button",{cls:"asc-btn-zoom asc-statusbar-icon-btn",iconCls:"asc-page-scroller-btn btn-scroll-prev"}),s=Ext.widget("button",{cls:"asc-btn-zoom asc-statusbar-icon-btn",iconCls:"asc-page-scroller-btn btn-scroll-next"});this.barWorksheets=Ext.widget("tabbar",{dock:"bottom",plain:!0,width:"100%",style:"margin:-2px 0 0 5px;",plugins:[{ptype:"tabbarscroller",pluginId:"tabbarscroller",firstButton:n,lastButton:r,prevButton:i,nextButton:s},{ptype:"tabreorderer",pluginId:"scheetreorderer"}]}),e.items=[n,i,s,r,{xtype:"container",flex:1,height:"100%",items:[this.barWorksheets]},this.userPanel,this.btnZoomOut,this.txtZoom,this.btnZoomIn],e.callParent(arguments)},onZoomChange:function(e,t){switch(t){case 1:case 2:case 0:default:this.txtZoom.setText(Ext.String.format(this.zoomText,Math.floor((e+.005)*100)))}this.doLayout()},updateInfo:function(){this.fireEvent("updatesheetsinfo",this),this.barWorksheets.removeAll(),this.ssMenu.items.items[6].menu.removeAll(),this.ssMenu.items.items[6].setVisible(!1);if(this.api){var e=this,t=this.api.asc_getWorksheetsCount(),n=-1,r=[],i=[],s,o,u=this.api.asc_getActiveWorksheetIndex();while(++n<t)o=e.api.asc_isWorksheetLockedOrDeleted(n),s={sheetindex:n,text:e.api.asc_getWorksheetName(n).replace(/\s/g,"&nbsp;"),reorderable:!o,closable:!1,cls:o?"coauth-locked":undefined},this.api.asc_isWorksheetHidden(n)?r.push(s):i.push(s),u==n&&(u=i.length-1);var a=i.length;this.permissions.isEdit&&i.push({iconCls:"asc-add-page-icon",width:36,closable:!1,reorderable:!1,disabled:e.api.asc_isWorkbookLocked(),listeners:{afterrender:function(t){t.getEl().on("click",e._onAddTabClick,e,{preventDefault:!0,tabid:"tab-add-new"})}}}),r.length&&(this.ssMenu.items.items[6].setVisible(!0),this.ssMenu.items.items[6].menu.add(r)),a&&(this.barWorksheets.add(i),!(u<0)&&u<a&&(this.barWorksheets.suspendEvents(),this.barWorksheets.setActiveTab(this.barWorksheets.items.items[u]),this.barWorksheets.resumeEvents()),this.barWorksheets.getPlugin("tabbarscroller").scrollToLast(),this.barWorksheets.getPlugin("scheetreorderer").dd.unlock()),this.barWorksheets.enable(!0),this.txtZoom.setText(Ext.String.format(this.zoomText,this.api.asc_getZoom()*100))}},setMode:function(e){this.permissions=e,this.userPanel.setMode(e);var t=this.barWorksheets.getPlugin("scheetreorderer");t&&t.setDisabled(!this.permissions.isEdit)},setActiveWorksheet:function(e,t){if(!e){var n=this.barWorksheets.activeTab?this.barWorksheets.items.items.indexOf(this.barWorksheets.activeTab):0;t==ACTIVE_TAB_NEXT?++n<this.barWorksheets.items.items.length-1||(n=0):t==ACTIVE_TAB_PREV&&--n<0&&(n=this.barWorksheets.items.items.length-2),this.barWorksheets.setActiveTab(this.barWorksheets.items.items[n])}},_onTabClick:function(e,t,n,r){if(!(t.sheetindex<0)){this.api.asc_showWorksheet(t.sheetindex);if(t.newindex!=undefined){var i=t.newindex+1;i<this.barWorksheets.items.length-1?i=this.barWorksheets.items.getAt(i).sheetindex:i=this.api.asc_getWorksheetsCount(),this.api.asc_moveWorksheet(i),t.newindex=undefined}}this.fireEvent("editcomplete",this)},_onAddTabClick:function(e,t,n){e.stopEvent(),!e.target.parentNode.disabled&&this.permissions.isEdit&&this.api.asc_addWorksheet()},_onTabContextMenu:function(e,t,n){if(this.api&&this.permissions.isEdit){var r=Ext.getCmp(n.tabid);if(r&&r.sheetindex>=0){(!this.barWorksheets.activeTab||r.id!=this.barWorksheets.activeTab.id)&&this.barWorksheets.setActiveTab(r);var i=this.api.asc_isWorksheetLockedOrDeleted(r.sheetindex),s=this.api.asc_isWorkbookLocked();this.ssMenu.items.items[0].setDisabled(s),this.ssMenu.items.items[1].setDisabled(i),this.ssMenu.items.items[2].setDisabled(i),this.ssMenu.items.items[3].setDisabled(i),this.ssMenu.items.items[4].setDisabled(i),this.ssMenu.items.items[5].setDisabled(i),this.ssMenu.items.items[6].setDisabled(s),this.api.asc_closeCellEditor(),this._showPopupMenu(this.ssMenu,{},e,r.getEl(),n)}}},_onTabDblClick:function(e,t,n){if(this.api&&this.permissions.isEdit){var r=Ext.getCmp(n.tabid);r&&r.sheetindex>=0&&!this.api.asc_isWorksheetLockedOrDeleted(r.sheetindex)&&this.api.asc_getActiveWorksheetIndex()==r.sheetindex&&this._renameWorksheet()}},_showPopupMenu:function(e,t,n,r,i){if(Ext.isDefined(e)){Ext.menu.Manager.hideAll();var s=n.getXY();s[1]+=10,Ext.isFunction(e.initMenu)&&e.initMenu(t),e.show(),e.showBy(r,"bl-tl")}},_getNewSheetName:function(e){var t=1,n=this.strSheet,r=this.api.asc_getWorksheetsCount(),i=-1,s=[];while(++i<r)s.push(this.api.asc_getWorksheetName(i));for(;;){if(!Ext.Array.contains(s,n+t))break;t++;if(t>100)return""}return n+t},_insertWorksheet:function(){var e=this._getNewSheetName();this.api.asc_insertWorksheet(e)},_deleteWorksheet:function(){var e=this;this.barWorksheets.items.items.length==2?Ext.Msg.show({title:this.textWarning,msg:this.errorLastSheet,icon:Ext.Msg.WARNING,buttons:Ext.Msg.OK}):Ext.create("Ext.window.MessageBox",{buttonText:{ok:"OK",yes:"Yes",no:"No",cancel:e.textCancel}}).show({title:this.textWarning,msg:this.warnDeleteSheet,icon:Ext.Msg.WARNING,buttons:Ext.Msg.OKCANCEL,fn:function(t){if(t=="ok"){var n=e.api.asc_getActiveWorksheetIndex(),r=e.api.asc_getActiveWorksheetId();e.api.asc_deleteWorksheet()?e.fireEvent("removeworksheet",n,r):Ext.Msg.show({title:e.textError,msg:e.msgDelSheetError,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK})}}})},_renameWorksheet:function(){var e=this,t=e.api.asc_getWorksheetsCount(),n=[],r=-1;while(++r<t)n.push(e.api.asc_getWorksheetName(r));var i=Ext.create("SSE.view.SheetRenameDialog",{title:"Rename",renameindex:e.api.asc_getActiveWorksheetIndex(),names:n});i.addListener("onmodalresult",function(t,n,r){n&&(e.api.asc_renameWorksheet(r),e.barWorksheets.activeTab.setText(r.replace(/\s/g,"&nbsp;"))),e.fireEvent("editcomplete",e)},!1),i.show();var s=i.getEl().getAlignToXY(e.barWorksheets.activeTab.getEl(),"bl-tl");i.showAt(s[0],s[1]-4)},_getSheetCopyName:function(e){var t=/^(.*)\((\d)\)$/.exec(e),n=2,r=t?t[1]:e+" ",i=r+"("+n+")",s=this.api.asc_getWorksheetsCount(),o=-1,u=[];while(++o<s)u.push(this.api.asc_getWorksheetName(o));for(;;){if(!Ext.Array.contains(u,i))break;n++;if(n>100)return"";i=r+"("+n+")"}return i},_copyWorksheet:function(e){var t=this,n=t.api.asc_getWorksheetsCount(),r=-1,i=[];while(++r<n)this.api.asc_isWorksheetHidden(r)||i.push({name:t.api.asc_getWorksheetName(r).replace(/\s/g,"&nbsp;"),sheetindex:r});i.length&&i.push({name:e?t.itemMoveToEnd:t.itemCopyToEnd,sheetindex:-255});var s=Ext.create("SSE.view.SheetCopyDialog",{title:e?t.itemMoveWS:t.itemCopyWS,listtitle:e?this.textMoveBefore:undefined,names:i});s.addListener("onmodalresult",function(r,i,s){if(i&&t.api)if(e)t.api.asc_moveWorksheet(s==-255?n:s);else{var o=t._getSheetCopyName(t.api.asc_getWorksheetName(t.api.asc_getActiveWorksheetIndex()));t.api.asc_copyWorksheet(s==-255?n:s,o)}t.fireEvent("editcomplete",t)},!1),s.show()},_showWorksheet:function(e,t){Ext.menu.Manager.hideAll();if(!e&&this.barWorksheets.items.items.length==2){Ext.Msg.show({title:this.textWarning,msg:this.errorLastSheet,icon:Ext.Msg.WARNING,buttons:Ext.Msg.OK});return}this.api[e?"asc_showWorksheet":"asc_hideWorksheet"](t)},_onStartEditCell:function(e){this.txtZoom.setDisabled(e),this.btnZoomIn.setDisabled(e),this.btnZoomOut.setDisabled(e)},_onActiveSheetChanged:function(e){var t,n,r=this.barWorksheets.items.items.length;while(!(--r<0)){n=this.barWorksheets.items.items[r];if(n.sheetindex==e){t=n;break}}t&&this.barWorksheets.setActiveTab(t)},createDelayedElements:function(){var e=this;this.btnZoomIn.getEl().set({"data-qtip":e.tipZoomIn,"data-qalign":"bl-tl?"}),this.btnZoomOut.getEl().set({"data-qtip":e.tipZoomOut,"data-qalign":"bl-tl?"}),this.btnZoomIn.on("click",function(){var t=e.api.asc_getZoom()+.1;t>0&&!(t>2)&&e.api.asc_setZoom(t)}),this.btnZoomOut.on("click",function(){var t=e.api.asc_getZoom()-.1;t<.5||e.api.asc_setZoom(t)}),this.barWorksheets.on("change",this._onTabClick,this),this.barWorksheets.getEl().on({contextmenu:{fn:function(t,n,r){var i=/x-tab(?!\S)/.test(n.className)?n:Ext.fly(n).up(".x-tab");i&&e._onTabContextMenu(t,n,{tabid:i.id})},preventDefault:!0},dblclick:{fn:function(t,n,r){var i=/x-tab(?!\S)/.test(n.className)?n:Ext.fly(n).up(".x-tab");i&&e._onTabDblClick(t,n,{tabid:i.id})},preventDefault:!0}}),this.barWorksheets.getPlugin("scheetreorderer").on({drop:function(e,t,n,r,i,s){i!=r&&(e.lock(),n.newindex=i,n.reorderable=!1)}}),this.menuZoomTo=Ext.widget("menu",{plain:!0,bodyCls:"status-zoom-menu",minWidth:100,listeners:{click:function(t,n){e.api&&e.api.asc_setZoom(n.fz),e.onZoomChange(n.fz),e.fireEvent("editcomplete",e)}},items:[{text:"50%",fz:.5},{text:"75%",fz:.75},{text:"100%",fz:1},{text:"125%",fz:1.25},{text:"150%",fz:1.5},{text:"175%",fz:1.75},{text:"200%",fz:2}]}),this.ssMenu=Ext.widget("menu",{showSeparator:!1,bodyCls:"no-icons",listeners:{hide:function(t,n){e.fireEvent("editcomplete",e)},click:function(t,n){n.isDisabled()||(n.action=="ins"?e._insertWorksheet():n.action=="del"?e._deleteWorksheet():n.action=="ren"?e._renameWorksheet():n.action=="copy"?e._copyWorksheet(!1):n.action=="move"?e._copyWorksheet(!0):n.action=="hide"&&e._showWorksheet(!1))}},items:[{text:this.itemInsertWS,action:"ins"},{text:this.itemDeleteWS,action:"del"},{text:this.itemRenameWS,action:"ren"},{text:this.itemCopyWS,action:"copy"},{text:this.itemMoveWS,action:"move"},{text:this.itemHideWS,action:"hide"},{text:this.itemHidenWS,hideOnClick:!1,menu:{showSeparator:!1,items:[],listeners:{click:function(t,n){e._showWorksheet(!0,n.sheetindex)}}}}]})},onCoAuthoringDisconnect:function(){this.permissions.isEdit=!1,this.barWorksheets.getPlugin("scheetreorderer").setDisabled(!0),this.updateInfo()},onWorkbookLocked:function(e){this.barWorksheets[e?"addCls":"removeCls"]("coauth-locked");var t,n=this.barWorksheets.items.items.length;while(!(--n<0))t=this.barWorksheets.items.items[n],t.sheetindex>=0?e?t.reorderable=!1:t.reorderable=!this.api.asc_isWorksheetLockedOrDeleted(t.sheetindex):t.setDisabled(e)},onWorksheetLocked:function(e,t){var n=this.barWorksheets.items.items;for(var r=0;r<n.length;r++)if(e==n[r].sheetindex){n[r][t?"addCls":"removeCls"]("coauth-locked"),n[r].reorderable=!t;break}},zoomText:"Zoom {0}%",tipZoomIn:"Zoom In",tipZoomOut:"Zoom Out",tipZoomFactor:"Magnification",txtFirst:"First Sheet",txtLast:"Last Sheet",txtPrev:"Previous Sheet",txtNext:"Next Sheet",itemInsertWS:"Insert",itemDeleteWS:"Delete",itemRenameWS:"Rename",itemCopyWS:"Copy",itemMoveWS:"Move",itemHideWS:"Hide",itemHidenWS:"Hiden",itemCopyToEnd:"(Copy to end)",itemMoveToEnd:"(Move to end)",msgDelSheetError:"Can't delete the worksheet.",textMoveBefore:"Move before sheet",warnDeleteSheet:"The worksheet maybe has data. Proceed operation?",errorLastSheet:"Workbook must have at least one visible worksheet.",strSheet:"Sheet",textError:"Error",textWarning:"Warning",textCancel:"Cancel"});var SCALE_MIN=40,SCALE_FULL="100%",SCALE_PART=300,MAINMENU_TOOLBAR_ID="mainmenu-toolbar-id",MAINMENU_PANEL_ID="mainmenu-panel-id",MAINMENU_FULL_PANEL_ID="mainmenu-full-panel-id";Ext.define("SSE.view.MainMenu",{extend:"Ext.panel.Panel",alias:"widget.ssemainmenu",requires:["Ext.toolbar.Toolbar","Ext.button.Button","Ext.container.Container","Ext.toolbar.Spacer"],cls:"lm-style",id:MAINMENU_PANEL_ID,bodyCls:"lm-body",width:SCALE_MIN,layout:"card",currentFullScaleMenuBtn:undefined,fullScaledItemCnt:undefined,buttonCollection:[],constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},listeners:{afterrender:function(){var e=this.ownerCt;Ext.isDefined(e)&&e.addListener("resize",Ext.bind(this.resizeMenu,this))}},initComponent:function(){this.items=[],this.dockedItems=this.buildDockedItems(),this.addEvents("panelshow","panelhide"),this.callParent(arguments)},buildDockedItems:function(){var e=[],t,n,r,i=this;for(var s=0;s<this.buttonCollection.length;s++)t=this.buttonCollection[s],n=-1,r={xtype:"button",id:t.id,itemScale:t.scale,tooltip:t.tooltip,disabled:t.disabled===!0,cls:"asc-main-menu-buttons",iconCls:"asc-main-menu-btn "+t.cls,style:"margin-bottom: 8px;"},t.scale=="modal"?(r.enableToggle=!0,r.listeners=t.listeners,r.getApi=function(){return i.api}):(r.isFullScale=t.scale=="full",r.bodyItems=t.items,r.toggleGroup="tbMainMenu",r.listeners={click:function(e){e.pressed&&i.openButtonMenu(e)},toggle:function(e,t){e[t?"addCls":"removeCls"]("asc-main-menu-btn-selected");if(!t){i.fireEvent("panelbeforehide");if(e.isFullScale){Ext.isDefined(i.fullScaledItemCnt)&&i.fullScaledItemCnt.isVisible()&&(i.fullScaledItemCnt.hide(),i.currentFullScaleMenuBtn=undefined);var n=i.fullScaledItemCnt}else window.localStorage.setItem("sse-mainmenu-width",i.getWidth()),n=Ext.getCmp(e.bodyCardId),i.setWidth(SCALE_MIN);i.fireEvent("panelhide",n,e.isFullScale)}}}),e.push(r);return this.mainToolbar=Ext.create("Ext.toolbar.Toolbar",{cls:"lm-default-toolbar",width:this.width||SCALE_MIN,vertical:!0,dock:"left",defaultType:"button",items:e,style:"padding-top:15px;",listeners:{afterrender:function(e){e.getEl().on("keydown",i._onMenuKeyDown,i,{button:undefined})}}}),this.mainToolbar},closeFullScaleMenu:function(){Ext.isDefined(this.currentFullScaleMenuBtn)&&this.currentFullScaleMenuBtn.toggle(!1)},openButtonMenu:function(e){this.fireEvent("panelbeforeshow",e.isFullScale);if(Ext.isNumber(e.itemScale)){var t=window.localStorage.getItem("sse-mainmenu-width");t=t?parseInt(t):e.itemScale,this.setSize({width:t})}else this.setWidth(e.isFullScale?SCALE_MIN:SCALE_PART);if(e.isFullScale){var n=this.ownerCt.el,r=n.getXY(),i=this.fullScaledItemCnt;this.currentFullScaleMenuBtn=e,this.fullScaledItemCnt.setSize(n.getWidth()-SCALE_MIN,n.getHeight()),this.fullScaledItemCnt.setPosition(r[0]+this.width,r[1]),this.fullScaledItemCnt.show(),this.fullScaledItemCnt.getLayout().setActiveItem(Ext.getCmp(e.bodyCardId))}else i=Ext.getCmp(e.bodyCardId),this.getLayout().setActiveItem(e.bodyCardId);e.removeCls("notify"),this.fireEvent("panelshow",i,e.isFullScale),this.doComponentLayout(),Common.component.Analytics.trackEvent("Main Menu",e.tooltip)},resizeMenu:function(e,t,n,r){if(Ext.isDefined(this.fullScaledItemCnt)&&this.fullScaledItemCnt.isVisible()){var i=this.ownerCt.el,s=i.getXY();this.fullScaledItemCnt.setSize(t-SCALE_MIN,n),this.fullScaledItemCnt.setPosition(s[0]+this.width,s[1])}else for(var o=0;o<this.items.length;o++){var u=this.items.items[o].getHeight();n!=u&&this.items.items[o].setHeight(n)}this.doComponentLayout()},setApi:function(e){return this.api=e,this.api.asc_registerCallback("asc_onCoAuthoringChatReceiveMessage",Ext.bind(this.onCoAuthoringChatReceiveMessage,this)),this.api.asc_registerCallback("asc_onoAuthoringDisconnect",Ext.bind(this.onCoAuthoringDisconnect,this)),this.api.asc_registerCallback("asc_onGetLicense",Ext.bind(this.onGetLicense,this)),this},selectMenu:function(e){var t,n,r,i,s=this.mainToolbar;for(r=s.items.length;r>0;r--){t=s.items.items[r-1];if(!(!t.iconCls||t.iconCls.search(e)<0))break;t=undefined}if(t&&!t.pressed){if(Ext.isDefined(s))for(r=0;r<s.items.length;r++)n=s.items.items[r],Ext.isDefined(n)&&n.componentCls==="x-btn"&&n.id!=t.id&&n.pressed&&n.toggle(!1);t.toggle(!0),t.itemScale!="modal"&&this.openButtonMenu(t)}},clearSelection:function(e){var t,n,r=this.mainToolbar;if(Ext.isDefined(r))for(n=0;n<r.items.length;n++){t=r.items.items[n];if(Ext.isDefined(t)&&t.componentCls==="x-btn"&&t.pressed){if(e)if(typeof e=="object"){if(e.id==t.id)continue}else if(t.iconCls&&!(t.iconCls.search(e)<0))continue;t.toggle(!1)}}},disableMenu:function(e,t){var n,r,i=this.mainToolbar;if(Ext.isDefined(i)){var s=!1;typeof e=="string"&&(e=="all"?s=!0:e=[e]);for(r=0;r<i.items.length;r++)n=i.items.items[r],Ext.isDefined(n)&&n.componentCls==="x-btn"&&(s||!(e.indexOf(n.id)<0))&&(n.pressed&&n.toggle(!1),n.setDisabled(t))}},onCoAuthoringChatReceiveMessage:function(e){var t=Ext.getCmp("view-main-menu");if(t){var n;t.getLayout().getActiveItem()&&(n=t.getLayout().getActiveItem().down("container"));var r=Ext.getCmp("id-menu-chat");r&&(!n||!n.isXType("commonchatpanel")||n.getWidth()<1)&&r.addCls("notify")}},onCoAuthoringDisconnect:function(){this.disableMenu(["id-menu-comments","id-menu-chat"],!0)},onGetLicense:function(e){var t=Ext.getCmp("main-menu-about");t&&t.setLicInfo(e)},createDelayedElements:function(){var e=this;this.hkEsc=new Ext.util.KeyMap(document,[{key:Ext.EventObject.ESC,fn:function(t,n){Ext.isDefined(e.currentFullScaleMenuBtn)&&(n.stopPropagation(),n.preventDefault(),e.currentFullScaleMenuBtn.toggle(!1))}}]);var t=[],n=this.mainToolbar.items.items,r;for(var i=0;i<this.buttonCollection.length;i++){r=this.buttonCollection[i];if(r.scale!="modal")if(r.scale!="full"){var s=Ext.create("Ext.container.Container",{items:r.items,menubutton:n[i],listeners:{afterrender:function(t){t.getEl().on("keydown",e._onMenuKeyDown,e,{button:t.menubutton})}}});n[i].bodyCardId=s.getId(),t.push(s)}else this.fullScaledItemCnt===undefined&&(this.fullScaledItemCnt=Ext.create("Ext.container.Container",{id:MAINMENU_FULL_PANEL_ID,layout:"card",shadow:!1,floating:!0,toFrontOnShow:!0,closeMenu:function(){e.closeFullScaleMenu()},getApi:function(){return e.api}})),n[i].bodyCardId=r.items[0].id,this.fullScaledItemCnt.add(r.items)}e.api.asc_getLicense(),this.add(t)},_onMenuKeyDown:function(e,t,n){e.getKey()==e.ESC&&(n.button?n.button.toggle(!1):this.clearSelection())}}),Ext.define("SSE.view.MainSettingsGeneral",{extend:"Ext.container.Container",alias:"widget.ssemainsettingsgeneral",cls:"sse-documentsettings-body",requires:["Ext.button.Button","Ext.container.Container","Ext.form.Label","Ext.form.field.Checkbox","Ext.util.Cookies"],constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){this._changedProps={zoomIdx:5,showchangesIdx:1,fontrenderIdx:0,unitIdx:0,saveVal:600},this._oldUnit=undefined,this.chLiveComment=Ext.create("Ext.form.field.Checkbox",{id:"docsettings-live-comment",checked:!0,boxLabel:this.strLiveComment,width:500}),this._arrZoom=[[50,"50%"],[60,"60%"],[70,"70%"],[80,"80%"],[90,"90%"],[100,"100%"],[110,"110%"],[120,"120%"],[150,"150%"],[175,"175%"],[200,"200%"]],this.cmbZoom=Ext.create("Ext.form.field.ComboBox",{width:90,editable:!1,store:this._arrZoom,mode:"local",triggerAction:"all",value:this._arrZoom[5][1],listeners:{select:Ext.bind(function(e,t,n){this._changedProps.zoomIdx=t[0].index,e.blur()},this)}}),this._arrFontRender=[[c_oAscFontRenderingModeType.hintingAndSubpixeling,this.txtWin],[c_oAscFontRenderingModeType.noHinting,this.txtMac],[c_oAscFontRenderingModeType.hinting,this.txtNative]],this.cmbFontRender=Ext.create("Ext.form.field.ComboBox",{id:"docsettings-font-render",width:150,editable:!1,store:this._arrFontRender,mode:"local",triggerAction:"all",value:this._arrFontRender[0][1],listeners:{select:Ext.bind(function(e,t,n){this._changedProps.fontrenderIdx=t[0].index,e.blur()},this)}}),this._arrUnit=[[Common.MetricSettings.c_MetricUnits.cm,this.txtCm],[Common.MetricSettings.c_MetricUnits.pt,this.txtPt]],this.cmbUnit=Ext.create("Ext.form.field.ComboBox",{id:"docsettings-combo-unit",width:150,editable:!1,store:this._arrUnit,mode:"local",triggerAction:"all",value:this._arrUnit[0][1],listeners:{select:Ext.bind(function(e,t,n){this._changedProps.unitIdx=t[0].index,e.blur()},this)}}),this._arrAutoSave=[[0,this.textDisabled],[60,this.textMinute],[300,this.text5Minutes],[600,this.text10Minutes],[1800,this.text30Minutes],[3600,this.text60Minutes]],this.cmbAutoSave=Ext.create("Ext.form.field.ComboBox",{id:"docsettings-combo-save",width:150,editable:!1,store:this._arrAutoSave,mode:"local",triggerAction:"all",value:this._arrAutoSave[3][1],listeners:{select:Ext.bind(function(e,t,n){this._changedProps.saveVal=t[0].data.field1,e.blur()},this)}}),this.btnOk=Ext.widget("button",{cls:"asc-blue-button",width:90,height:22,text:this.okButtonText,listeners:{click:function(e){this.applySettings()},scope:this}}),this.items=[{xtype:"container",layout:{type:"table",columns:2,tableAttrs:{style:"width: 100%;"},tdAttrs:{style:"padding: 5px 10px;"}},height:"100%",items:[{xtype:"label",cellCls:"doc-info-label-cell",text:this.txtLiveComment,style:"display: block;text-align: right; margin-bottom: 1px;",width:"100%",hideId:"element-coauthoring"},this.chLiveComment,{xtype:"tbspacer",hideId:"element-coauthoring"},{xtype:"tbspacer"},{xtype:"label",cellCls:"doc-info-label-cell",text:this.strZoom,style:"display: block;text-align: right; margin-bottom: 5px;",width:"100%"},this.cmbZoom,{xtype:"tbspacer"},{xtype:"tbspacer"},{xtype:"label",cellCls:"doc-info-label-cell",text:this.strFontRender,style:"display: block;text-align: right; margin-bottom: 5px;",width:"100%"},this.cmbFontRender,{xtype:"tbspacer",hideId:"element-edit-mode"},{xtype:"tbspacer"},{xtype:"label",cellCls:"doc-info-label-cell",text:this.textAutoSave,style:"display: block;text-align: right; margin-bottom: 5px;",width:"100%",hideId:"element-autosave"},this.cmbAutoSave,{xtype:"tbspacer",hideId:"element-autosave"},{xtype:"tbspacer"},{xtype:"label",cellCls:"doc-info-label-cell",text:this.strUnit,style:"display: block;text-align: right; margin-bottom: 5px;",width:"100%",hideId:"element-edit-mode"},this.cmbUnit,{xtype:"tbspacer",height:10},{xtype:"tbspacer",height:10},{xtype:"tbspacer"},this.btnOk]}],this.addEvents("savedocsettings"),this.addEvents("changemeasureunit"),this.callParent(arguments)},setApi:function(e){this.api=e},applySettings:function(){window.localStorage.setItem("sse-settings-livecomment",this.chLiveComment.getValue()?1:0),window.localStorage.setItem("sse-settings-zoom",this._arrZoom[this._changedProps.zoomIdx][0]),window.localStorage.setItem("sse-settings-fontrender",this._arrFontRender[this._changedProps.fontrenderIdx][0]),window.localStorage.setItem("sse-settings-unit",this._arrUnit[this._changedProps.unitIdx][0]),window.localStorage.setItem("sse-settings-autosave",this._changedProps.saveVal),Common.component.Analytics.trackEvent("File Menu","SaveSettings"),this.fireEvent("savedocsettings",this),this._oldUnit!==this._arrUnit[this._changedProps.unitIdx][0]&&this.fireEvent("changemeasureunit",this)},updateSettings:function(){e=window.localStorage.getItem("sse-settings-livecomment"),this.chLiveComment.setValue(e===null||parseInt(e)!=0);var e=window.localStorage.getItem("sse-settings-zoom");this._changedProps.zoomIdx=5;if(e!==null)for(var t=0;t<this._arrZoom.length;t++)if(this._arrZoom[t][0]==parseInt(e)){this._changedProps.zoomIdx=t;break}this.cmbZoom.setValue(this._arrZoom[this._changedProps.zoomIdx][1]),e=window.localStorage.getItem("sse-settings-fontrender"),e!==null?e=parseInt(e):e=window.devicePixelRatio>1?c_oAscFontRenderingModeType.noHinting:c_oAscFontRenderingModeType.hintingAndSubpixeling;for(t=0;t<this._arrFontRender.length;t++)if(this._arrFontRender[t][0]==e){this._changedProps.fontrenderIdx=t;break}this.cmbFontRender.setValue(this._arrFontRender[this._changedProps.fontrenderIdx][1]),e=window.localStorage.getItem("sse-settings-unit"),this._changedProps.unitIdx=0;if(e!==null)for(t=0;t<this._arrUnit.length;t++)if(this._arrUnit[t][0]==parseInt(e)){this._changedProps.unitIdx=t;break}this.cmbUnit.setValue(this._arrUnit[this._changedProps.unitIdx][1]),this._oldUnit=this._arrUnit[this._changedProps.unitIdx][0],e=window.localStorage.getItem("sse-settings-autosave"),e=e!==null?parseInt(e):600,this._changedProps.saveVal=600;var n=3;for(t=0;t<this._arrAutoSave.length;t++)if(this._arrAutoSave[t][0]==e){this._changedProps.saveVal=e,n=t;break}this.cmbAutoSave.setValue(this._arrAutoSave[n][1]),this._ShowHideDocSettings("element-autosave",this.mode.isEdit&&this.mode.canAutosave>-1)},_ShowHideSettingsItem:function(e,t){var n=e.getEl().up("tr");n&&n.setDisplayed(t)},_ShowHideDocSettings:function(e,t){if(!this.rendered)return;var n=Ext.ComponentQuery.query('[hideId="'+e+'"]',this);for(var r=0;r<n.length;r++)this._ShowHideSettingsItem(n[r],t)},setMode:function(e){this.mode=e;if(this.mode.canAutosave>-1){var t=0;for(t=1;t<this._arrAutoSave.length;t++)if(this.mode.canAutosave<this._arrAutoSave[t][0])break}var n=[];n=this._arrAutoSave.slice(t,this._arrAutoSave.length),n.unshift(this._arrAutoSave[0]),n.length>0&&this.cmbAutoSave.getStore().loadData(n)},strLiveComment:"Turn on live commenting option",txtLiveComment:"Live Commenting",strInputMode:"Turn on hieroglyphs",strZoom:"Default Zoom Value",strShowChanges:"Realtime Collaboration Changes",txtAll:"View All",txtLast:"View Last",okButtonText:"Apply",txtWin:"as Windows",txtMac:"as OS X",txtNative:"Native",strFontRender:"Font Hinting",strUnit:"Unit of Measurement",txtCm:"Centimeter",txtPt:"Point",textDisabled:"Disabled",textMinute:"Every Minute",text5Minutes:"Every 5 Minutes",text10Minutes:"Every 10 Minutes",text30Minutes:"Every 30 Minutes",text60Minutes:"Every Hour",textAutoSave:"Autosave"}),Ext.define("SSE.view.MainSettingsPrint",{extend:"Ext.container.Container",alias:"widget.ssemainsettingsprint",cls:"sse-documentsettings-body",requires:["Ext.button.Button","Ext.container.Container","Ext.form.Label","Common.component.IndeterminateCheckBox"],listeners:{show:function(e,t){}},height:"100%",initComponent:function(){var e=this;this.cmbSheet=Ext.create("Ext.form.field.ComboBox",{id:"advsettings-print-combo-sheets",width:260,editable:!1,store:Ext.create("Ext.data.Store",{fields:["sheetname",{type:"int",name:"sheetindex"}],data:[{sheetname:e.strAllSheets,sheetindex:-255}]}),queryMode:"local",displayField:"sheetname",valueField:"sheetindex",triggerAction:"all"}),this.cmbPaperSize=Ext.widget("combo",{width:260,store:Ext.create("Ext.data.Store",{fields:["description","size"],data:[{size:"215.9|279.4",description:"US Letter (21,59cm x 27,94cm)"},{size:"215.9|355.6",description:"US Legal (21,59cm x 35,56cm)"},{size:"210|297",description:"A4 (21cm x 29,7cm)"},{size:"148.1|209.9",description:"A5 (14,81cm x 20,99cm)"},{size:"176|250.1",description:"B5 (17,6cm x 25,01cm)"},{size:"104.8|241.3",description:"Envelope #10 (10,48cm x 24,13cm)"},{size:"110.1|220.1",description:"Envelope DL (11,01cm x 22,01cm)"},{size:"279.4|431.7",description:"Tabloid (27,94cm x 43,17cm)"},{size:"297|420.1",description:"A3 (29,7cm x 42,01cm)"},{size:"304.8|457.1",description:"Tabloid Oversize (30,48cm x 45,71cm)"},{size:"196.8|273",description:"ROC 16K (19,68cm x 27,3cm)"},{size:"119.9|234.9",description:"Envelope Choukei 3 (11,99cm x 23,49cm)"},{size:"330.2|482.5",description:"Super B/A3 (33,02cm x 48,25cm)"}]}),displayField:"description",valueField:"size",queryMode:"local",editable:!1}),this.cmbPaperOrientation=Ext.widget("combo",{store:Ext.create("Ext.data.Store",{fields:["description","orient"],data:[{description:e.strPortrait,orient:c_oAscPageOrientation.PagePortrait},{description:e.strLandscape,orient:c_oAscPageOrientation.PageLandscape}]}),displayField:"description",valueField:"orient",queryMode:"local",editable:!1,width:200}),this.chPrintGrid=Ext.widget("cmdindeterminatecheckbox",{boxLabel:this.textPrintGrid,width:500}),this.chPrintRows=Ext.widget("cmdindeterminatecheckbox",{boxLabel:this.textPrintHeadings,width:500}),this.spnMarginLeft=Ext.create("Common.component.MetricSpinner",{readOnly:!1,maxValue:48.25,minValue:0,step:.1,defaultUnit:"cm",value:"0.19 cm",listeners:{}}),this.spnMarginRight=Ext.create("Common.component.MetricSpinner",{readOnly:!1,maxValue:48.25,minValue:0,step:.1,defaultUnit:"cm",value:"0.19 cm",listeners:{}}),this.spnMarginTop=Ext.create("Common.component.MetricSpinner",{readOnly:!1,maxValue:48.25,minValue:0,step:.1,defaultUnit:"cm",value:"0 cm",listeners:{}}),this.spnMarginBottom=Ext.create("Common.component.MetricSpinner",{readOnly:!1,maxValue:48.25,minValue:0,step:.1,defaultUnit:"cm",value:"0 cm",listeners:{}}),this.btnOk=Ext.widget("button",{id:"advsettings-print-button-save",cls:"asc-blue-button",width:90,height:22,text:this.okButtonText}),this.items=[{xtype:"container",layout:{type:"table",columns:2,tableAttrs:{style:"width: 100%;"},tdAttrs:{style:"padding: 10px 10px;"}},items:[{xtype:"label",cellCls:"doc-info-label-cell",text:e.textSettings,style:"display: block;text-align: right; margin-bottom: 5px;",width:"100%"},this.cmbSheet,{xtype:"tbspacer",height:5},{xtype:"tbspacer",height:5},{xtype:"label",cellCls:"doc-info-label-cell",text:e.textPageSize,style:"display: block;text-align: right; margin-bottom: 5px;",width:"100%"},this.cmbPaperSize,{xtype:"label",cellCls:"doc-info-label-cell",text:e.textPageOrientation,style:"display: block;text-align: right; margin-bottom: 5px;",width:"100%"},this.cmbPaperOrientation,{xtype:"label",cellCls:"doc-info-label-cell label-align-top",text:e.strMargins,style:"display: block;text-align: right;",width:"100%"},this.cntMargins=Ext.widget("container",{height:100,width:200,layout:{type:"hbox"},defaults:{xtype:"container",layout:{type:"vbox",align:"stretch"},height:100},items:[{flex:1,items:[{xtype:"label",width:"100%",text:e.strTop},{xtype:"tbspacer",height:3},this.spnMarginTop,{xtype:"tbspacer",height:12},{xtype:"label",width:"100%",text:e.strLeft},{xtype:"tbspacer",height:3},this.spnMarginLeft]},{xtype:"tbspacer",width:20},{flex:1,items:[{xtype:"label",text:e.strBottom,width:"100%"},{xtype:"tbspacer",height:3},this.spnMarginBottom,{xtype:"tbspacer",height:12},{xtype:"label",text:e.strRight,width:"100%"},{xtype:"tbspacer",height:3},this.spnMarginRight]}]}),{xtype:"label",cellCls:"doc-info-label-cell label-align-top",text:e.strPrint,style:"display: block;text-align: right; margin-top: 4px;",width:"100%"},this.cntAdditional=Ext.widget("container",{height:45,width:500,layout:{type:"vbox",align:"stretch"},items:[this.chPrintGrid,this.chPrintRows]}),{xtype:"tbspacer"},{xtype:"tbspacer"},{xtype:"tbspacer"},this.btnOk]}],this.addEvents("savedocsettings"),this.callParent(arguments)},applySettings:function(){},setMode:function(e){},updateMetricUnit:function(){var e=this.query("commonmetricspinner");if(e)for(var t=0;t<e.length;t++){var n=e[t];n.setDefaultUnit(Common.MetricSettings.metricName[Common.MetricSettings.getCurrentMetric()]),n.setStep(Common.MetricSettings.getCurrentMetric()==Common.MetricSettings.c_MetricUnits.cm?.1:1)}},okButtonText:"Save",strPortrait:"Portrait",strLandscape:"Landscape",textPrintGrid:"Print Gridlines",textPrintHeadings:"Print Rows and Columns Headings",strLeft:"Left",strRight:"Right",strTop:"Top",strBottom:"Bottom",strMargins:"Margins",textPageSize:"Page Size",textPageOrientation:"Page Orientation",strPrint:"Print",textSettings:"Settings for"}),Ext.define("SSE.view.DocumentSettings",{extend:"Ext.container.Container",alias:"widget.ssedocumentsettings",cls:"sse-documentsettings-panel",autoScroll:!0,requires:["Ext.container.Container","Ext.XTemplate","Ext.view.View","Ext.data.Model","Ext.data.Store","Common.plugin.DataViewScrollPane","SSE.view.MainSettingsGeneral","SSE.view.MainSettingsPrint"],listeners:{show:function(e,t){e.updateSettings()}},constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){var e=this;e.addEvents("savedocsettings"),this.addEvents("changemeasureunit"),e.generalSettings=Ext.widget("ssemainsettingsgeneral"),e.printSettings=Ext.widget("ssemainsettingsprint"),e.printSettings.updateMetricUnit();var t=[e.generalSettings,e.printSettings,1];e.generalSettings.addListener("savedocsettings",function(){e.fireEvent("savedocsettings",e)}),e.generalSettings.addListener("changemeasureunit",function(){var t=window.localStorage.getItem("sse-settings-unit");Common.MetricSettings.setCurrentMetric(t!==null?parseInt(t):Common.MetricSettings.c_MetricUnits.cm),e.printSettings.updateMetricUnit(),e.fireEvent("changemeasureunit",e)}),this.menuStore=Ext.create("Ext.data.Store",{fields:["name",{type:"int",name:"panelindex"},"iconCls"],data:[{name:e.txtGeneral,panelindex:0,iconCls:"mnu-settings-general"},{name:e.txtPrint,panelindex:1,iconCls:"mnu-print"}]});var n=new Ext.XTemplate('<tpl for=".">','<div class="thumb-wrap">','<img class="icon {iconCls}" src="'+Ext.BLANK_IMAGE_URL+'" />','<span class="caption">{name}</span>',"</div>","</tpl>",'<div class="x-clear"></div>');this.cntMenu=Ext.create("Ext.container.Container",{layout:"fit",cls:"help-menu-container",width:200,items:[this.menuView=Ext.create("Ext.view.View",{store:this.menuStore,tpl:n,singleSelect:!0,trackOver:!0,style:"overflow:visible;",width:"100%",overItemCls:"x-item-over",itemSelector:"div.thumb-wrap",cls:"help-menu-view",listeners:{afterrender:function(e){e.getSelectionModel().deselectOnContainerClick=!1,e.select(0)},selectionchange:function(e,n){var r=e.getLastSelected();r&&(t[r.data.panelindex].updateSettings&&t[r.data.panelindex].updateSettings(),t[r.data.panelindex].setVisible(!0),t[t[t.length-1]].setVisible(!1),t[t.length-1]=r.data.panelindex)}},plugins:[{ptype:"dataviewscrollpane",areaSelector:".help-menu-view",pluginId:"docHelpPluginId",settings:{enableKeyboardNavigation:!0,keyboardSpeed:.001}}]})]}),this.items=[{xtype:"container",layout:{type:"hbox",align:"stretch"},height:"100%",items:[this.cntMenu,{xtype:"tbspacer",width:2,style:"border-left: 1px solid #C7C7C7"},{xtype:"container",flex:1,layout:"fit",items:[e.generalSettings,e.printSettings],listeners:{}}]}],this.callParent(arguments)},setApi:function(e){e&&(this.api=e)},updateSettings:function(){this.generalSettings&&this.generalSettings.updateSettings()},setMode:function(e){this.mode=e,this.generalSettings&&this.generalSettings.setMode(this.mode)},txtGeneral:"General",txtPrint:"Print"}),Ext.define("SSE.view.File",{extend:"Ext.panel.Panel",alias:"widget.ssefile",cls:"sse-file-body",layout:"card",btnSaveCaption:"Save",btnDownloadCaption:"Download as...",btnInfoCaption:"Document Info...",btnCreateNewCaption:"Create New...",btnRecentFilesCaption:"Open Recent...",btnPrintCaption:"Print",btnHelpCaption:"Help...",btnReturnCaption:"Back to Document",btnToEditCaption:"Edit Document",btnBackCaption:"Go to Documents",btnSettingsCaption:"Advanced Settings...",toolbarWidth:260,activeBtn:undefined,uses:["Ext.container.Container","Ext.toolbar.Toolbar","Ext.button.Button","SSE.view.DocumentInfo","SSE.view.RecentFiles","SSE.view.CreateFile","SSE.view.DocumentHelp","SSE.view.DocumentSettings"],listeners:{afterrender:function(e,t){var n=this.ownerCt;Ext.isDefined(n)&&n.addListener("show",Ext.Function.bind(this._onShow,this))}},constructor:function(e){return this.initConfig(e),this.callParent(arguments),this},initComponent:function(){var e=this;this.addEvents("editdocument","downloadas"),this.callParent(arguments)},loadConfig:function(e){this.editorConfig=e.config},_onShow:function(){this.activeBtn===undefined&&(this.activeBtn=this.btnDownloadAs.isVisible()?this.btnCreateNew:this.btnDocumentInfo),this.activeBtn==this.btnDocumentInfo?this.getLayout().setActiveItem(this.cardDocumentInfo):this.activeBtn==this.btnDocumentSettings?(this.getLayout().setActiveItem(this.cardDocumentSettings),this.cardDocumentSettings.updateSettings()):this.activeBtn==this.btnCreateNew&&(this.btnDownloadAs.isVisible()?(this.getLayout().setActiveItem(this.cardDownloadAs),this.activeBtn=this.btnDownloadAs):(this.getLayout().setActiveItem(this.cardDocumentInfo),this.activeBtn=this.btnDocumentInfo)),this.redrawButton(this.activeBtn)},buildDockedItems:function(){return this.btnSave=Ext.create("Ext.button.Button",{id:"file-button-save",text:this.btnSaveCaption,textAlign:"left",enableToggle:!0,cls:"asc-filemenu-btn",padding:"0 27px",height:27,listeners:{click:Ext.bind(function(e){e.pressed&&(this.api=this.ownerCt.getApi(),this.api&&(this.redrawButton(e),this.api.asc_Save(),this.closeMenu()),Common.component.Analytics.trackEvent("Save"),Common.component.Analytics.trackEvent("File Menu","Save"))},this)}}),this.btnPrint=this.btnSave.cloneConfig({id:"file-button-print",text:this.btnPrintCaption,listeners:{click:Ext.bind(function(e){e.pressed&&(this.api=this.ownerCt.getApi(),this.api&&(this.api.asc_Print(),this.closeMenu()),Common.component.Analytics.trackEvent("Print"),Common.component.Analytics.trackEvent("File Menu","Print"))},this)}}),this.btnToEdit=this.btnSave.cloneConfig({id:"file-button-edit",text:this.btnToEditCaption,listeners:{click:Ext.bind(function(e){this.redrawButton(e),e.pressed&&(this.closeMenu(),this.fireEvent("editdocument"),Common.component.Analytics.trackEvent("Edit"),Common.component.Analytics.trackEvent("File Menu","Edit"))},this)}}),this.btnDownloadAs=Ext.create("Ext.button.Button",Ext.applyIf(this.getFileMenuButton(this.btnDownloadCaption,this.cardDownloadAs),{id:"file-button-download"})),this.btnDocumentInfo=Ext.create("Ext.button.Button",Ext.applyIf(this.getFileMenuButton(this.btnInfoCaption,this.cardDocumentInfo),{id:"file-button-info"})),this.btnDocumentSettings=Ext.create("Ext.button.Button",Ext.applyIf(this.getFileMenuButton(this.btnSettingsCaption,this.cardDocumentSettings),{id:"file-button-settings"})),this.btnBack=this.btnPrint.cloneConfig({id:"file-button-back",text:this.btnBackCaption,listeners:{click:Ext.bind(function(e){this.redrawButton(e),e.pressed&&(Common.Gateway.goBack(),this.closeMenu())},this)}}),this.btnHelp=Ext.create("Ext.button.Button",this.getFileMenuButton(this.btnHelpCaption,this.cardHelp)),this.btnReturn=Ext.create("Ext.button.Button",{id:"file-button-return",text:this.btnReturnCaption,textAlign:"left",enableToggle:!0,cls:"asc-filemenu-btn",padding:"0 27px",height:27,listeners:{click:Ext.bind(function(e){e.pressed&&(this.closeMenu(),Common.component.Analytics.trackEvent("File Menu","Return"))},this)}}),this.btnCreateNew=Ext.create("Ext.button.Button",Ext.apply(this.getFileMenuButton(this.btnCreateNewCaption,this.cardCreateNew),{id:"file-button-createnew",label:"Create",listeners:{},enableToggle:!1})),this.btnOpenRecent=Ext.create("Ext.button.Button",Ext.applyIf(this.getFileMenuButton(this.btnRecentFilesCaption,this.cardRecentFiles),{id:"file-button-recentfiles",label:"Recent"})),this.tbFileMenu=Ext.create("Ext.toolbar.Toolbar",{dock:"left",layout:{type:"vbox",align:"stretch"},cls:"sse-file-toolbar",vertical:!0,width:this.toolbarWidth,defaults:{height:22,width:"100%"},items:[{xtype:"container",height:15},this.btnReturn,this.getSeparator(),this.btnSave,this.btnToEdit,this.btnDownloadAs,this.btnPrint,this.getSeparator(),this.btnOpenRecent,this.btnCreateNew,this.getSeparator(),this.btnDocumentInfo,this.getSeparator(),this.btnDocumentSettings,this.getSeparator(),this.btnHelp,this.getSeparator(),this.btnBack]}),this.tbFileMenu},setApi:function(e){this.api=e},getSeparator:function(){return{xtype:"container",html:'<hr class="sse-file-separator" />'}},getFileMenuButton:function(e,t){return{text:e,textAlign:"left",enableToggle:!0,cls:"asc-filemenu-btn",padding:"0 27px",height:27,listeners:{click:Ext.Function.bind(this._itemClick,this,[t],!0),toggle:Ext.Function.bind(this._itemTogglge,this)}}},redrawButton:function(e){var t=this.tbFileMenu;for(var n=0;n<t.items.length;n++){var r=t.items.items[n];r.componentCls==="x-btn"&&r.id!=e.id&&r.pressed&&r.toggle(!1,!0)}e.toggle(!0,!0)},closeMenu:function(){this.ownerCt.closeMenu()},_itemClick:function(e,t,n,r){e.pressed&&(this.activeBtn!=e&&(this.getLayout().setActiveItem(r),this.activeBtn=e),Common.component.Analytics.trackEvent("File Menu",e.label))},_itemTogglge:function(e){this.redrawButton(e)},applyMode:function(){this.btnDownloadAs.setVisible(this.mode.canDownload),this.hkSaveAs[this.mode.canDownload?"enable":"disable"](),this.hkSave[this.mode.isEdit?"enable":"disable"](),this.hkHelp.enable(),this.btnSave.setVisible(this.mode.isEdit),this.btnToEdit.setVisible(this.mode.canEdit&&this.mode.isEdit===!1),this.btnDocumentSettings.setVisible(this.mode.isEdit),this.tbFileMenu.items.items[14].setVisible(this.mode.isEdit),this.btnBack.setVisible(this.mode.canBack),this.tbFileMenu.items.items[16].setVisible(this.mode.canBack),this.btnOpenRecent.setVisible(this.mode.canOpenRecent),this.btnCreateNew.setVisible(this.mode.canCreateNew),this.tbFileMenu.items.items[10].setVisible(this.mode.canCreateNew||this.mode.canOpenRecent),this.cardDocumentSettings.setMode(this.mode)},setMode:function(e,t){e.isDisconnected?(this.mode.canEdit=this.mode.isEdit=!1,this.mode.canOpenRecent=this.mode.canCreateNew=!1):this.mode=e,t||this.applyMode()},createDelayedElements:function(){var e=this;this.hkSaveAs=new Ext.util.KeyMap(document,[{key:"s",ctrl:!0,shift:!0,defaultEventAction:"stopEvent",fn:function(){e.ownerCt&&e.ownerCt.isVisible()&&(e.btnDownloadAs.toggle(!0),e.btnDownloadAs.fireEvent("click",e.btnDownloadAs))}}]),this.hkSave=new Ext.util.KeyMap(document,[{key:"s",ctrl:!0,shift:!1,defaultEventAction:"stopEvent",fn:function(){if(canHotKey()){var t=e.ownerCt.getApi();t&&t.asc_Save()}}}]),this.hkHelp=new Ext.util.KeyMap(document,{key:Ext.EventObject.F1,ctrl:!1,shift:!1,defaultEventAction:"stopEvent",fn:function(){e.ownerCt&&e.ownerCt.isVisible()&&(e.btnHelp.toggle(!0),e.btnHelp.fireEvent("click",e.btnHelp,[e.cardHelp]))}});var t=[{name:"XLSX",imgCls:"tabular-format btn-xlsx",type:c_oAscFileType.XLSX}];this.cardDownloadAs=Ext.widget("container",{cls:"sse-file-table",layout:{type:"table",columns:2}}),Ext.each(t,function(e){this.cardDownloadAs.add({xtype:"container",items:[{xtype:"button",id:"file-format-"+e.name,cls:e.imgCls+" download-button-style",docType:e.type,width:102,height:129,margin:"65px 25px 0 25px"}]})},this),this.cardDocumentInfo=Ext.widget("ssedocumentinfo"),this.cardCreateNew=Ext.widget("ssecreatenew"),this.cardRecentFiles=Ext.widget("sserecentfiles"),this.cardHelp=Ext.widget("ssedocumenthelp"),this.cardDocumentSettings=Ext.widget("ssedocumentsettings"),this.cardDocumentSettings.addListener("savedocsettings",Ext.bind(this.closeMenu,this)),this.add([this.cardDownloadAs,this.cardHelp,this.cardDocumentInfo,this.cardRecentFiles,this.cardDocumentSettings]),this.addDocked(this.buildDockedItems()),this.setConfig(),this.applyMode()},setConfig:function(){this.cardHelp.setLangConfig(this.editorConfig.lang),this.editorConfig.templates&&this.editorConfig.templates.length>0&&(this.btnCreateNew.enableToggle=!0,this.btnCreateNew.on("click",Ext.bind(this._itemClick,this,[this.cardCreateNew],!0)),this.btnCreateNew.on("toggle",Ext.bind(this._itemTogglge,this)))}}),Ext.define("SSE.view.CellInfo",{extend:"Ext.container.Container",alias:"widget.ssecellinfo",cls:"sse-cellinfo",uses:["SSE.view.FormulaDialog"],height:23,initComponent:function(){var e=this;this.addEvents("editcomplete"),this.txtName=Ext.widget("textfield",{id:"infobox-cell-name",width:70,height:this.height,cls:"asc-input-aslabel",fieldStyle:"border-radius:0;"}),this._cellInput=Ext.widget("textarea",{id:"infobox-cell-edit",inputId:"infobox-cell-input",flex:1,style:"margin:0;opacity:1;",fieldStyle:"border-radius:0;font-size:14px;padding:0 3px;line-height:21px;",enableKeyEvents:!0,enterIsSpecial:!0});var t="padding:4px 0 0 4px;border-bottom:solid 1px #AFAFAF; background:#E9E9E9 url(resources/img/toolbar-menu.png) no-repeat 0 -1416px;";t+='background-image: -webkit-image-set(url("resources/img/toolbar-menu.png") 1x, url("resources/img/toolbar-menu@2x.png") 2x);',this._lblFunct=Ext.widget("box",{width:20,height:this.height,id:"func-label-box",style:t,listeners:{afterrender:function(t){$("#func-label-box").hover(function(){this.style.backgroundPosition=this.mdown?"-40px -1416px":"-20px -1416px"},function(){this.style.backgroundPosition="0 -1416px"}),$("#func-label-box").mousedown(function(){this.style.backgroundPosition="-40px -1416px";var e=this;e.mdown=!0;var t=function(){e.mdown=!1,$(document).unbind("mouseup",t)};$(document).mouseup(t)}),$("#func-label-box").click(function(t){e.permissions.isEdit&&(dlgFormulas.addListener("onmodalresult",function(t,n,r){e.fireEvent("editcomplete",e)},e,{single:!0}),dlgFormulas.show())})}}}),this.keep_height=180;var n=Ext.widget("button",{width:16,height:this.height,id:"infobox-cell-multiline-button",style:"border-radius: 0;",iconCls:"infobox-cell-multiline-button"});Ext.apply(e,{style:"overflow:visible;",layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",cls:"infobox-container-border",id:"infobox-container-cell-name",width:90,layout:{type:"hbox"},items:[this.txtName,this._lblFunct]},this._cellInput,{xtype:"container",items:[n]}]},e.initialConfig),e.callParent(arguments)},updateCellInfo:function(e){e&&this.txtName.setValue(typeof e=="string"?e:e.asc_getName())},setMode:function(e){e.isDisconnected?this.permissions.isEdit=!1:this.permissions=e,$("#"+this._lblFunct.id).css("cursor",e.isEdit?"pointer":"default")}}),window.cancelButtonText="Cancel",Ext.define("SSE.view.Viewport",{extend:"Ext.container.Viewport",alias:"widget.sseviewport",layout:"fit",uses:["SSE.view.DocumentHolder","SSE.view.MainMenu","SSE.view.File","SSE.view.DocumentStatusInfo","SSE.view.CellInfo","Common.view.ChatPanel","Common.view.CommentsPanel","Common.view.Header","SSE.view.Toolbar","Common.view.SearchDialog","Common.view.About","SSE.view.RightMenu"],initComponent:function(){this.header=Ext.widget("commonheader",{config:{headerCaption:"Spreadsheet Editor"}}),this.applicationUI=Ext.widget("container",{layout:{type:"vbox",align:"stretch"},flex:1,hidden:!0,items:[{xtype:"container",flex:1,layout:{type:"hbox",align:"stretch"},items:[{xtype:"ssemainmenu",id:"view-main-menu",maxWidth:600,listeners:{panelshow:function(e,t){if(t){var n=Ext.getCmp("view-main-menu");n.clearSelection({id:n.currentFullScaleMenuBtn.id})}}},buttonCollection:[{cls:"menuFile",tooltip:this.tipFile+" (Alt+F)",id:"id-menu-file",scale:"full",disabled:!0,items:[{xtype:"ssefile",id:"main-menu-file-options",width:"100%",height:"100%"}]},{cls:"menuSearch",scale:"modal",id:"main-menu-search",disabled:!0,tooltip:this.tipSearch+" (Ctrl+F)"},{cls:"menuComments",id:"id-menu-comments",hideMode:"display",scale:300,tooltip:this.tipComments+" (Ctrl+Shift+H)",disabled:!0,items:[{xtype:"commoncommentspanel",height:"100%"}]},{cls:"menuChat",id:"id-menu-chat",scale:300,tooltip:this.tipChat+" (Ctrl+Alt+Q)",disabled:!0,items:[{xtype:"commonchatpanel",height:"100%"}]},{cls:"menuAbout",id:"id-menu-about",tooltip:"About",scale:"full",disabled:!0,items:[{xtype:"commonabout",id:"main-menu-about",width:"100%",height:"100%"}]}]},{xtype:"splitter",id:"main-menu-splitter",cls:"splitter-document-area",defaultSplitMin:300,hidden:!0},{xtype:"container",layout:{type:"vbox",align:"stretch"},maintainFlex:!0,flex:1,items:[{xtype:"ssecellinfo",id:"cell-edit",style:"border-left:solid 1px #afafaf;"},{xtype:"splitter",id:"field-formula-splitter",defaultSplitMin:23,cls:"splitter-document-area"},{id:"editor_sdk",minHeight:70,xtype:"ssedocumentholder",maintainFlex:!0,flex:1}]}]},{xtype:"documentstatusinfo",id:"view-status"}]}),this.items={xtype:"container",layout:{type:"vbox",align:"stretch"},items:[this.header,this.applicationUI]},Ext.tip.QuickTipManager.init(),this.callParent(arguments)},applyMode:function(){this.hkSaveAs[this.mode.canDownload?"enable":"disable"](),this.hkChat[this.mode.canCoAuthoring?"enable":"disable"](),this.hkComments[this.mode.canCoAuthoring&&this.mode.isEdit?"enable":"disable"]()},setMode:function(e,t){e.isDisconnected?this.mode.canDownload=this.mode.canCoAuthoring=!1:this.mode=e,t||this.applyMode()},applyEditorMode:function(){var e=this;e._toolbar=Ext.widget("ssetoolbar",{id:"view-toolbar"}),e._rightMenu=Ext.widget("sserightmenu",{id:"view-right-menu"}),e.applicationUI.insert(0,e._toolbar),e.applicationUI.items.items[1].add(e._rightMenu),e._toolbar.setVisible(!0)},createDelayedElements:function(){var e=this;this.hotKeys=new Ext.util.KeyMap(document,[{key:"f",ctrl:!0,shift:!1,defaultEventAction:"stopEvent",fn:function(){if(canHotKey()){var e=Ext.getCmp("view-main-menu");e&&e.selectMenu("menuSearch")}}},{key:[Ext.EventObject.PAGE_DOWN,Ext.EventObject.PAGE_UP],ctrl:!1,shift:!1,alt:!0,defaultEventAction:"stopEvent",fn:function(e,t){if(canHotKey()){var n=Ext.getCmp("view-status");n&&n.setActiveWorksheet(undefined,e==t.PAGE_DOWN?ACTIVE_TAB_NEXT:ACTIVE_TAB_PREV)}}},{key:"f",alt:!0,defaultEventAction:"stopEvent",fn:function(){if(canHotKey()){Ext.menu.Manager.hideAll();var e=Ext.getCmp("view-main-menu");e&&e.selectMenu("menuFile")}}}]),this.hkSaveAs=new Ext.util.KeyMap(document,{key:"s",ctrl:!0,shift:!0,defaultEventAction:"stopEvent",fn:function(){if(canHotKey()){Ext.menu.Manager.hideAll();var e=Ext.getCmp("view-main-menu");e&&e.selectMenu("menuFile")}}}),this.hkHelp=new Ext.util.KeyMap(document,{key:Ext.EventObject.F1,ctrl:!1,shift:!1,defaultEventAction:"stopEvent",scope:this,fn:function(){if(canHotKey()){Ext.menu.Manager.hideAll();var e=Ext.getCmp("view-main-menu");e&&e.selectMenu("menuFile")}}}),this.hkChat=new Ext.util.KeyMap(document,{key:"q",ctrl:!0,alt:!0,defaultEventAction:"stopEvent",fn:function(){if(canHotKey()){var e=Ext.getCmp("view-main-menu");e&&e.selectMenu("menuChat")}}}),this.hkComments=new Ext.util.KeyMap(document,{key:"H",ctrl:!0,shift:!0,defaultEventAction:"stopEvent",fn:function(){if(canHotKey()){var e=Ext.getCmp("view-main-menu");e&&e.selectMenu("menuComments")}}})},tipChat:"Chat",tipComments:"Comments",tipFile:"File",tipSearch:"Search"}),Ext.define("SSE.model.FileTemplate",{extend:"Ext.data.Model",fields:[{type:"string",name:"name"},{type:"string",name:"icon"},{type:"string",name:"displayName"}]}),Ext.define("SSE.model.RecentFile",{extend:"Ext.data.Model",fields:[{type:"string",name:"title"},{type:"string",name:"url"},{type:"string",name:"folder"}]}),Ext.define("SSE.store.FileTemplates",{extend:"Ext.data.Store",model:"SSE.model.FileTemplate"}),Ext.define("SSE.store.RecentFiles",{extend:"Ext.data.Store",model:"SSE.model.RecentFile"}),Ext.define("SSE.controller.RecentFiles",{extend:"Ext.app.Controller",views:["RecentFiles"],stores:["RecentFiles"],refs:[{ref:"filePanel",selector:"ssefile"}],init:function(){this.control({"sserecentfiles dataview":{itemclick:this.onRecentFileClick}})},loadConfig:function(e){var t=this.getRecentFilesStore();t&&e&&e.config&&e.config.recent&&(t.removeAll(),t.add(e.config.recent))},onRecentFileClick:function(e,t,n,r,i){var s=this.getFilePanel();s&&s.closeMenu();var o=window.open(t.data.url);o&&o.focus()}}),Ext.define("SSE.controller.DocumentHolder",{extend:"Ext.app.Controller",requires:[],views:["DocumentHolder"],uses:["SSE.view.AutoFilterDialog","SSE.view.DigitalFilterDialog","SSE.view.SetValueDialog","SSE.view.ParagraphSettingsAdvanced","SSE.view.HyperlinkSettings"],refs:[{ref:"documentHolder",selector:"ssedocumentholder"},{ref:"splitterMainMenu",selector:"#main-menu-splitter"}],init:function(){this.tooltips={hyperlink:{},comment:{},coauth:{ttHeight:20}},this.mouse={},this.popupmenu=!1,this.control({ssedocumentholder:{resize:this._handleDocumentResize,afterrender:this._onAfterRender},"menu[group=menu-document]":{show:function(){this.popupmenu=!0;if(this.tooltips.comment.editCommentId||this.tooltips.comment.viewCommentId)this.tooltips.comment.viewCommentId=this.tooltips.comment.editCommentId=this.tooltips.comment.moveCommentId=undefined,this.getController("Common.controller.CommentsPopover").onApiHideComment()},hide:function(e,t){this.popupmenu=!1,this.getDocumentHolder().fireEvent("editcomplete",this.getDocumentHolder())}},"#view-main-menu":{panelbeforeshow:function(e){this._isMenuHided=!0,e!==!0&&(this.getSplitterMainMenu().show(),this.getDocumentHolder().addCls("left-border"),Ext.ComponentQuery.query("#infobox-container-cell-name")[0].addCls("left-border"))},panelbeforehide:function(){this._isMenuHided=!0},panelshow:function(e,t){this._isMenuHided=!1,this._isFullscreenMenu=t;if(!t){var n=this;n._handleDocumentResize(n.getDocumentHolder(),n.getDocumentHolder().getWidth(),n.getDocumentHolder().getHeight());if(!e.isSizeInit){e.isSizeInit=!0;var r=e.down("dataview");if(r){var i=r.getNodes(),s=e.getWidth();for(var o in i)i[o].style.width=s+"px"}}}},panelhide:function(e,t){this._isMenuHided=!1,this._isFullscreenMenu=!1;if(!t){var n=this;n._handleDocumentResize(n.getDocumentHolder(),n.getDocumentHolder().getWidth(),n.getDocumentHolder().getHeight()),n.getSplitterMainMenu().hide(),n.getDocumentHolder().removeCls("left-border"),Ext.ComponentQuery.query("#infobox-container-cell-name")[0].removeCls("left-border")}}},"#cmi-add-comment":{click:this._addComment},"menu[action=insert-cells]":{click:this.handleCellInsertMenu},"menu[action=delete-cells]":{click:this.handleCellDeleteMenu},"#cmi-sort-cells":{click:this.handleCellSortMenu},"#context-menu-cell":{click:this.handleCellsMenu},"#main-menu-splitter":{beforedragstart:function(e,t){return!t.currentTarget.disabled},move:function(e,t,n){if(this._isMenuHided)return;var r,i=e.up("container").down("ssemainmenu").getWidth();i>40&&(i-=40,Ext.ComponentQuery.query("dataview[group=scrollable]").forEach(function(e){var t=e.getNodes();for(var n in t)t[n].style.width=i+"px";e.getEl().setWidth(i),r=e.getEl().down(".jspContainer"),r&&(r.setWidth(i),e.getEl().down(".jspPane").setWidth(i))}))}},"menu[action=setting-hide]":{click:function(e,t){var n=this.api.asc_getSheetViewSettings();switch(t.action){case"headers":n.asc_setShowRowColHeaders(t.checked);break;case"lines":n.asc_setShowGridLines(t.checked)}this.api.asc_setSheetViewSettings(n)}},"menuitem[group=popupparagraphvalign]":{click:this._onParagraphVAlign},"menuitem[action=image-grouping]":{click:function(e){this.api[e.grouping?"asc_groupGraphicsObjects":"asc_unGroupGraphicsObjects"](),this.getDocumentHolder().fireEvent("editcomplete",this.getDocumentHolder())}},"menuitem[action=add-hyperlink-shape]":{click:this._handleAddHyperlink},"menuitem[action=remove-hyperlink-shape]":{click:this._handleRemoveHyperlink},"menuitem[action=remove-hyperlink]":{click:this._handleRemoveHyperlink},"menuitem[action=text-advanced]":{click:this._handleTextAdvanced}}),this.wrapEvents={apiShowComment:Ext.bind(this.onApiShowComment,this),apiHideComment:Ext.bind(this.onApiHideComment,this)}},setApi:function(e){return this.api=e,this.api.asc_registerCallback("asc_onMouseMove",Ext.bind(this.onApiMouseMove,this)),this.api.asc_registerCallback("asc_onHideComment",this.wrapEvents.apiHideComment),this.api.asc_registerCallback("asc_onShowComment",this.wrapEvents.apiShowComment),this.api.asc_registerCallback("asc_onHyperlinkClick",Ext.bind(this.onHyperlinkClick,this)),this.api.asc_registerCallback("asc_onSetAFDialog",Ext.bind(this.onAutofilter,this)),this.api.asc_registerCallback("asc_onoAuthoringDisconnect",Ext.bind(this.onCoAuthoringDisconnect,this)),this},resetApi:function(e){this.api.asc_unregisterCallback("asc_onHideComment",this.wrapEvents.apiHideComment),this.api.asc_unregisterCallback("asc_onShowComment",this.wrapEvents.apiShowComment),this.api.asc_registerCallback("asc_onHideComment",this.wrapEvents.apiHideComment),this.api.asc_registerCallback("asc_onShowComment",this.wrapEvents.apiShowComment)},onCoAuthoringDisconnect:function(){this.permissions.isEdit=!1},loadConfig:function(e){this.editorConfig=e.config},setMode:function(e){this.permissions=e},onApiMouseMove:function(e){if(!this._isFullscreenMenu&&e.length){var t,n,r;for(var i=e.length;i>0;i--)switch(e[i-1].asc_getType()){case c_oAscMouseMoveType.Hyperlink:t=i;break;case c_oAscMouseMoveType.Comment:n=i;break;case c_oAscMouseMoveType.LockedObject:r=i}var s=this;if(t){var o=e[t-1],u=o.asc_getHyperlink();if(u.asc_getType()==c_oAscHyperlinkType.WebLink){var a=u.asc_getTooltip();a?a=Ext.String.htmlEncode(a)+"<br><b>"+s.textCtrlClick+"</b>":a=u.asc_getHyperlinkUrl()+"<br><b>"+s.textCtrlClick+"</b>"}else a=u.asc_getTooltip()||u.asc_getSheet()+"!"+u.asc_getRange();s.tooltips.hyperlink.ref&&s.tooltips.hyperlink.ref.isVisible()&&s.tooltips.hyperlink.text!=a&&s.tooltips.hyperlink.ref.close();if(!s.tooltips.hyperlink.ref||!s.tooltips.hyperlink.ref.isVisible()){s.tooltips.hyperlink.text=a,s.tooltips.hyperlink.ref=Ext.create("Ext.tip.ToolTip",{closeAction:"destroy",dismissDelay:2e3,html:a,listeners:{beforeclose:function(){s.tooltips.hyperlink.ref=undefined,s.tooltips.hyperlink.text=""},hide:function(){s.tooltips.hyperlink.ref=undefined,s.tooltips.hyperlink.text=""}}}),s.tooltips.hyperlink.ref.show();var f=s.tooltips.hyperlink.ref.getEl().getAlignToXY("editor_sdk","tl?",[o.asc_getX()+4,o.asc_getY()+6]);s.tooltips.hyperlink.ref.showAt(f)}}if(s.permissions.isEdit){if(n&&!this.popupmenu){o=e[n-1];if(!s.tooltips.comment.editCommentId&&s.tooltips.comment.moveCommentId!=o.asc_getCommentIndexes()[0]){s.tooltips.comment.moveCommentId=o.asc_getCommentIndexes()[0],s.tooltips.comment.moveCommentTimer&&clearTimeout(s.tooltips.comment.moveCommentTimer);var l=o.asc_getCommentIndexes(),c=o.asc_getX(),h=o.asc_getY(),p=o.asc_getReverseX();s.tooltips.comment.moveCommentTimer=setTimeout(function(){s.tooltips.comment.moveCommentId&&!s.tooltips.comment.editCommentId&&(s.tooltips.comment.viewCommentId=s.tooltips.comment.moveCommentId,s.getController("Common.controller.CommentsPopover").onApiShowComment(l,c,h,p,!1))},400)}}else s.tooltips.comment.moveCommentId=undefined,s.tooltips.comment.viewCommentId!=undefined&&(s.tooltips.comment={},this.getController("Common.controller.CommentsPopover").onApiHideComment());if(r){o=e[r-1],s.tooltips.coauth.XY||s._handleDocumentResize(s.getDocumentHolder(),s.getDocumentHolder().getWidth(),s.getDocumentHolder().getHeight());if(s.tooltips.coauth.x_point!=o.asc_getX()||s.tooltips.coauth.y_point!=o.asc_getY()){s.hideTips(),s.tooltips.coauth.x_point=o.asc_getX(),s.tooltips.coauth.y_point=o.asc_getY();var d=Ext.DomHelper.append(Ext.getBody(),{tag:"div",cls:"username-tip"},!0);d.applyStyles({height:s.tooltips.coauth.ttHeight+"px",position:"absolute",zIndex:"19000",visibility:"visible"}),s.tooltips.coauth.ref=d;var v=o.asc_getLockedObjectType()==c_oAscMouseMoveLockedObjectType.Sheet||o.asc_getLockedObjectType()==c_oAscMouseMoveLockedObjectType.TableProperties,m=[s.tooltips.coauth.x_point+s.tooltips.coauth.XY[0],s.tooltips.coauth.y_point+s.tooltips.coauth.XY[1]];!v&&(m[0]=s.tooltips.coauth.bodyWidth-m[0]),m[1]>s.tooltips.coauth.XY[1]&&m[1]+s.tooltips.coauth.ttHeight<s.tooltips.coauth.XY[1]+s.tooltips.coauth.apiHeight&&(Ext.DomHelper.overwrite(d,s._getUserName(o.asc_getUserId())),d.applyStyles({visibility:"visible"}),v&&d.applyStyles({top:m[1]+"px",left:m[0]+"px"})||d.applyStyles({top:m[1]+"px",right:m[0]+"px"}))}}else s.hideTips()}}},onApiHideComment:function(){this.tooltips.comment.viewCommentId=this.tooltips.comment.editCommentId=this.tooltips.comment.moveCommentId=undefined},onApiShowComment:function(e,t,n,r,i){e=e[0];if(this.tooltips.comment.viewCommentId)this.tooltips.comment.viewCommentId=undefined,this.tooltips.comment.editCommentId=e,this.getController("Common.controller.CommentsPopover").makeCommentEditable(e);else if(this.tooltips.comment.editCommentId!=e){this.tooltips.comment.editCommentId=e;if(i){if(!this.getDocumentHolder().isLiveCommenting){var s=Ext.getCmp("view-main-menu");s&&s.selectMenu("menuComments")}var o=Ext.ComponentQuery.query("commoncommentspopover");if(o.length){o=o[0],o.fireTransformToAdd();var u=o.query("dataview")[0];u&&u.on("viewready",function(){o.fireTransformToAdd()},this)}}}},onHyperlinkClick:function(e){var t=window.open(e,"_blank");t&&t.focus()},_getUserName:function(e){var t=Ext.getStore("Common.store.Users");if(t){var n=t.findRecord("id",e);if(n)return Ext.String.ellipsis(Ext.String.htmlEncode(n.get("username")),25,!0)}return this.guestText},hideTips:function(){this.tooltips.coauth.ref&&(Ext.destroy(this.tooltips.coauth.ref),this.tooltips.coauth.ref=undefined,this.tooltips.coauth.x_point=undefined,this.tooltips.coauth.y_point=undefined)},_handleDocumentResize:function(e,t,n){var r=this;setTimeout(function(){r.tooltips.coauth.XY=e.getPosition(),r.tooltips.coauth.apiHeight=n,r.tooltips.coauth.bodyWidth=Ext.getBody().getWidth()},10)},_onAfterRender:function(e){e.addCls("top-border"),document.body.onmousedown=Ext.bind(this._handleRightDown,this),document.body.onmouseup=Ext.bind(this._handleRightUp,this);var t=e.getEl();t.on({contextmenu:{fn:this._showObjectMenu,preventDefault:!0,scope:this},mousewheel:this._handleDocumentWheel,keydown:this._handleKeyDown,click:function(e,t){this.api&&(this.api.isTextAreaBlur=!1,t instanceof HTMLTextAreaElement||t instanceof HTMLInputElement||this.getDocumentHolder().focus(!1))},scope:this}),Ext.getDoc().on("mousewheel",this._handleDocumentWheel,this),Ext.getDoc().on("keydown",this._handleDocumentKeyDown,this)},_handleDocumentWheel:function(e){if(this.api){var t=e.getWheelDelta();if(e.ctrlKey){var n=this.api.asc_getZoom();t<0?(n-=.1,n<.5||this.api.asc_setZoom(n)):t>0&&(n+=.1,n>0&&!(n>2)&&this.api.asc_setZoom(n)),e.stopEvent()}}},_handleDocumentKeyDown:function(e){if(this.api){var t=e.getKey();if((e.ctrlKey||e.metaKey)&&!e.shiftKey)if(t===e.NUM_PLUS||Ext.isOpera&&t==43){if(!this.api.isCellEdited){var n=this.api.asc_getZoom()+.1;return n>0&&!(n>2)&&this.api.asc_setZoom(n),e.stopEvent(),!1}}else if(t===e.NUM_MINUS||Ext.isOpera&&t==45)if(!this.api.isCellEdited)return n=this.api.asc_getZoom()-.1,n<.5||this.api.asc_setZoom(n),e.stopEvent(),!1}},_handleRightDown:function(e,t,n){e.button==0&&(this.mouse.isLeftButtonDown=!0),e.button==2&&(this.mouse.isRightButtonDown=!0)},_handleRightUp:function(e,t,n){e.button==0&&(this.mouse.isLeftButtonDown=!1)},_handleKeyDown:function(e,t,n){e.getKey()==e.F10&&e.shiftKey&&(e.stopEvent(),this._showObjectMenu(e,t,n))},_showObjectMenu:function(e,t,n){if(this.api&&this.permissions.isEdit&&!this.mouse.isLeftButtonDown){var r,i,s,o,u,a,f,l=this.getDocumentHolder(),c=this.api.asc_getCellInfo(),h=c.asc_getFlags().asc_getSelectionType();switch(h){case c_oAscSelectionType.RangeCells:r=!0;break;case c_oAscSelectionType.RangeRow:i=!0;break;case c_oAscSelectionType.RangeCol:s=!0;break;case c_oAscSelectionType.RangeMax:o=!0;break;case c_oAscSelectionType.RangeImage:a=!0;break;case c_oAscSelectionType.RangeShape:a=!0;break;case c_oAscSelectionType.RangeShapeText:f=!0}if(a)l.mnuUnGroupImg.setDisabled(!this.api.asc_canUnGroupGraphicsObjects()),l.mnuGroupImg.setDisabled(!this.api.asc_canGroupGraphicsObjects()),this._showPopupMenu(l.imgMenu,{},e,t,n);else if(f){l.pmiTextAdvanced.textInfo=undefined;var p=this.api.asc_getGraphicObjectProps();for(var d=0;d<p.length;d++){var v=p[d].asc_getObjectType();if(v==c_oAscTypeSelectElement.Image){var m=p[d].asc_getObjectValue(),g=m.asc_getVerticalTextAlign();l.menuParagraphTop.setChecked(g==c_oAscVerticalTextAlign.TEXT_ALIGN_TOP),l.menuParagraphCenter.setChecked(g==c_oAscVerticalTextAlign.TEXT_ALIGN_CTR),l.menuParagraphBottom.setChecked(g==c_oAscVerticalTextAlign.TEXT_ALIGN_BOTTOM)}else v==c_oAscTypeSelectElement.Paragraph&&(l.pmiTextAdvanced.textInfo=p[d].asc_getObjectValue())}var y=c.asc_getHyperlink();l.pmiInsHyperlinkShape.setVisible(this.api.asc_canAddShapeHyperlink()!==!1),l.pmiInsHyperlinkShape.cellInfo=c,l.pmiInsHyperlinkShape.setText(y?l.editHyperlinkText:l.txtInsHyperlink),l.pmiRemoveHyperlinkShape.setVisible(y!==undefined&&y!==null),l.pmiTextAdvanced.setVisible(l.pmiTextAdvanced.textInfo!==undefined),this._showPopupMenu(l.textInShapeMenu,{},e,t,n)}else h!==c_oAscSelectionType.RangeImage&&h!==c_oAscSelectionType.RangeShape&&h!==c_oAscSelectionType.RangeShapeText&&(l.pmiInsertEntire.setVisible(i||s),l.pmiDeleteEntire.setVisible(i||s),l.pmiInsertCells.setVisible(r),l.pmiDeleteCells.setVisible(r),l.pmiSortCells.setVisible(r||o),l.pmiInsFunction.setVisible(r),l.pmiInsHyperlink.setVisible(r),l.pmiDelHyperlink.setVisible(!1),r&&(c.asc_getHyperlink()?(l.pmiInsHyperlink.setText(l.editHyperlinkText),l.pmiDelHyperlink.setVisible(!0)):l.pmiInsHyperlink.setText(l.txtInsHyperlink)),l.pmiRowHeight.setVisible(i||o),l.pmiColumnWidth.setVisible(s||o),l.pmiEntireHide.setVisible(s||i),l.pmiEntireShow.setVisible(s||i),l.ssMenu.items.items[10].setVisible(r&&this.permissions.canCoAuthoring),l.pmiAddComment.setVisible(r&&this.permissions.canCoAuthoring),l.pmiCellMenuSeparator.setVisible(r||i||s||o),l.pmiEntireHide.isrowmenu=i,l.pmiEntireShow.isrowmenu=i,this._showPopupMenu(l.ssMenu,{},e,t,n))}this.mouse.isRightButtonDown=!1},_showPopupMenu:function(e,t,n,r,i){if(Ext.isDefined(e)){Ext.menu.Manager.hideAll();var s=n.getXY();if(!this.mouse.isRightButtonDown){var o=this.api.asc_getActiveCellCoord(),u=$("#"+this.getDocumentHolder().id).offset();s[0]=o.asc_getX()+o.asc_getWidth()+u.left,s[1]=(o.asc_getY()<0?0:o.asc_getY())+o.asc_getHeight()+u.top}Ext.isFunction(e.initMenu)&&e.initMenu(t),e.showAt(n.getXY())}},_addComment:function(e,t,n){var r=new asc_CCommentData,i=new Date,s=i.getTimezoneOffset()*6e4;r&&(r.asc_putText(""),r.asc_putTime((i.getTime()-s).toString()),r.asc_putUserId(this.editorConfig.user.id),r.asc_putUserName(this.editorConfig.user.name),r.asc_putDocumentFlag(!1),r.asc_putSolved(!1),this.api.asc_addComment(r))},handleCellsMenu:function(e,t){if(t)if(t.action=="insert-entire")switch(this.api.asc_getCellInfo().asc_getFlags().asc_getSelectionType()){case c_oAscSelectionType.RangeRow:this.api.asc_insertCells(c_oAscInsertOptions.InsertRows);break;case c_oAscSelectionType.RangeCol:this.api.asc_insertCells(c_oAscInsertOptions.InsertColumns)}else if(t.action=="delete-entire")switch(this.api.asc_getCellInfo().asc_getFlags().asc_getSelectionType()){case c_oAscSelectionType.RangeRow:this.api.asc_deleteCells(c_oAscDeleteOptions.DeleteRows);break;case c_oAscSelectionType.RangeCol:this.api.asc_deleteCells(c_oAscDeleteOptions.DeleteColumns)}else if(t.action=="row-height"||t.action=="column-width"){var n=this,r=Ext.widget("setvaluedialog",{title:t.text,startvalue:t.action=="row-height"?n.api.asc_getRowHeight():n.api.asc_getColumnWidth(),maxvalue:409,valuecaption:t.action=="row-height"?this.txtHeight:this.txtWidth});r.addListener("onmodalresult",function(e,r,i){r&&(t.action=="row-height"?n.api.asc_setRowHeight(i):n.api.asc_setColumnWidth(i)),n.getDocumentHolder().fireEvent("editcomplete",n.getDocumentHolder())},n,{single:!0}),r.show()}else t.action=="clear-all"&&this.api.asc_emptyCells(c_oAscCleanOptions.All)},handleCellInsertMenu:function(e,t){this.api.asc_insertCells(t.kind),this.getDocumentHolder().fireEvent("editcomplete",this.getDocumentHolder())},handleCellDeleteMenu:function(e,t){this.api.asc_deleteCells(t.kind),this.getDocumentHolder().fireEvent("editcomplete",this.getDocumentHolder())},handleCellSortMenu:function(e,t){this.api.asc_sortColFilter(t.direction,"")},onAutofilter:function(e){var t=this,n=Ext.widget("sseautofilterdialog",{});n.addListener("onmodalresult",function(n,i,s){if(i==1){var o=n.getSettings();t.api.asc_applyAutoFilter("mainFilter",o)}else{if(i==2){r.show();return}i==3&&t.api.asc_sortColFilter(s,e.asc_getCellId())}t.mouse.isLeftButtonDown=t.mouse.isRightButtonDown=!1,t.getDocumentHolder().fireEvent("editcomplete",t.getDocumentHolder())},this),n.setSettings(e),n.show();var r=Ext.widget("ssedigitalfilterdialog",{});r.setSettings(e),r.addListener("onmodalresult",function(e,n,r){n==1&&t.api.asc_applyAutoFilter("digitalFilter",e.getSettings()),t.mouse.isLeftButtonDown=t.mouse.isRightButtonDown=!1,t.getDocumentHolder().fireEvent("editcomplete",t.getDocumentHolder())},this)},onCellChanged:function(e,t,n,r,i){if(n&&e.length>1){var s=this.getDocumentHolder().funcMenu,o=dlgFormulas.arrayFormula.filter(function(t){return(new RegExp("^"+e.substr(1),"i")).test(t)});if(o&&o.length){var u=-1;while(++u<5)o[u]?(s.items.getAt(u).setText(o[u]),s.items.getAt(u).show()):s.items.getAt(u).hide();var a=this.api.asc_getActiveCellCoord(),f=s.show().getEl().getAlignToXY("editor_sdk","tl?",[a.asc_getX(),a.asc_getY()+a.asc_getHeight()+4]);s.showAt(f)}}console.log("onCellChanged: "+e+", "+t+", "+n+", "+r+", "+i)},_onParagraphVAlign:function(e,t){var n=new Asc.asc_CImgProperty;n.asc_putVerticalTextAlign(e.valign),this.api.asc_setGraphicObjectProps(n)},_handleAddHyperlink:function(e){var t=this,n,r;if(t.api&&e){var i=t.api.asc_getWorksheetsCount(),s=-1,o=[];while(++s<i)this.api.asc_isWorksheetHidden(s)||o.push([t.api.asc_getWorksheetName(s)]);n=Ext.widget("ssehyperlinksettings",{sheets:o}),n.setSettings(e.cellInfo.asc_getHyperlink(),e.cellInfo.asc_getText(),e.cellInfo.asc_getFlags().asc_getLockText())}n&&(n.addListener("onmodalresult",function(e,i){i==1&&(r=n.getSettings(),t.api.asc_insertHyperlink(r)),t.getDocumentHolder().fireEvent("editcomplete",t.getDocumentHolder())},!1),n.show())},_handleRemoveHyperlink:function(){this.api&&(this.api.asc_removeHyperlink(),this.getDocumentHolder().fireEvent("editcomplete",this.getDocumentHolder()))},_handleTextAdvanced:function(e){var t=this,n;t.api&&e&&(n=Ext.create("SSE.view.ParagraphSettingsAdvanced"),n.updateMetricUnit(),n.setSettings({paragraphProps:e.textInfo,api:t.api})),n&&(n.addListener("onmodalresult",Ext.bind(function(e,n,r){n==1&&r&&t.api.asc_setGraphicObjectProps(r.paragraphProps)},t),!1),n.addListener("close",function(){t.getDocumentHolder().fireEvent("editcomplete",t.getDocumentHolder())},!1),n.show())},guestText:"Guest",textCtrlClick:"Press CTRL and click link",txtRowHeight:"Row Height",txtHeight:"Height",txtWidth:"Width",tipIsLocked:"This element is being edited by another user."});var LoadingDocument=-256,ApplyEditRights=-255,InitApplication=-254;Ext.define("SSE.controller.Main",{extend:"Ext.app.Controller",uses:["Common.component.LoadMask","Ext.window.MessageBox","SSE.view.OpenDialog"],views:["Common.view.Header","DocumentHolder","DocumentInfo"],stores:["Common.store.Users"],refs:[{ref:"header",selector:"commonheader"},{ref:"statusInfo",selector:"documentstatusinfo"},{ref:"mainMenu",selector:"ssemainmenu"},{ref:"documentHolder",selector:"ssedocumentholder"},{ref:"viewport",selector:"sseviewport"},{ref:"documentInfo",selector:"ssedocumentinfo"},{ref:"cellInfo",selector:"ssecellinfo"},{ref:"documentHelp",selector:"ssedocumenthelp"},{ref:"toolbar",selector:"ssetoolbar"},{ref:"formulaInput",selector:"#infobox-cell-edit"},{ref:"fileMenu",selector:"ssefile"},{ref:"chatPanel",selector:"commonchatpanel"},{ref:"rightPanel",selector:"sserightpanel"},{ref:"rightMenu",selector:"sserightmenu"},{ref:"documentAbout",selector:"commonabout"}],init:function(){this.getController("DocumentHolder").init(),Ext.isSafari&&Ext.safariVersion>=7&&Ext.getBody().on("mousewheel",function(e){e.stopEvent()},this),this.control({ssedocumentholder:{resize:this.onDocumentHolderResize},ssefile:{editdocument:this.requestEditRights,downloadas:function(){this.onLongActionBegin(c_oAscAsyncAction.DownloadAs,c_oAscAsyncActionType.BlockInteraction)}},"#view-main-menu":{panelshow:function(e,t){if(t)this.fullscalemenu=!0,this.api.asc_enableKeyEvents(!1);else if(!Ext.isEmpty(e.query("commonchatpanel"))){this.api.asc_Resize(),this.api.asc_enableKeyEvents(!1),Ext.getCmp("id-menu-chat").removeCls("notify");var n=Ext.getCmp("id-chat-textarea");n&&n.focus()}else Ext.isEmpty(e.query("commoncommentspanel"))||this.isLiveCommenting||this.api.asc_showComments()},panelhide:{scope:this,fn:function(e,t){this.api.asc_Resize(),t&&(this.fullscalemenu=!1),this.isLiveCommenting||this.api.asc_hideComments(),this.onEditComplete(this.getMainMenu())}}},"documentstatusinfo tabbar":{change:function(e,t,n,r){this.onActiveSheetChanged(this.api.asc_getActiveWorksheetIndex())}},ssedocumentsettings:{savedocsettings:function(){e=window.localStorage.getItem("sse-settings-livecomment"),this.isLiveCommenting=e===null||parseInt(e)!=0,this.isLiveCommenting?this.api.asc_showComments():this.api.asc_hideComments(),this.api.asc_setFontRenderingMode(parseInt(window.localStorage.getItem("sse-settings-fontrender")));var e=window.localStorage.getItem("sse-settings-autosave");this.appComputedMode.canAutosave>-1&&this.api.asc_setAutoSaveGap(e!==null?parseInt(e):600),this.getDocumentHolder().setLiveCommenting(this.isLiveCommenting)},changemeasureunit:function(){var e=window.localStorage.getItem("sse-settings-unit");Common.MetricSettings.setCurrentMetric(e!==null?parseInt(e):Common.MetricSettings.c_MetricUnits.cm),this.getRightPanel().updateMetricUnit()}}})},onLaunch:function(){window.asc_CCommentData=window.Asc.asc_CCommentData||window.asc_CCommentData,window.storagename="spreadsheet",$(document.body).css("position","absolute");if(typeof isBrowserSupported!="undefined"&&!isBrowserSupported()){Common.Gateway.reportError(undefined,this.unsupportedBrowserErrorText);return}var e=this.getViewport();if(!e)throw Error("SSE.controller.Main failed: could not get Viewport.");this.getViewport().getEl().on("keypress",this.lockEscapeKey,this),e.applicationUI.setVisible(!0);var t=window.localStorage.getItem("sse-settings-fontrender");t===null&&(t=window.devicePixelRatio>1?"1":"3"),this.api=new Asc.spreadsheet_api("editor_sdk","infobox-cell-input"),this.api.asc_setFontRenderingMode(parseInt(t)),this.api.asc_Init("../../../sdk/Fonts/"),this.api.asc_registerCallback("asc_onOpenDocumentProgress",Ext.bind(this.onOpenDocument,this)),this.api.asc_registerCallback("asc_onEndAction",Ext.bind(this.onLongActionEnd,this)),this.api.asc_registerCallback("asc_onError",Ext.bind(this.onError,this)),this.api.asc_registerCallback("asc_onoAuthoringDisconnect",Ext.bind(this.onCoAuthoringDisconnect,this)),this.api.asc_registerCallback("asc_onAdvancedOptions",Ext.bind(this.onAdvancedOptions,this)),this.stackLongActions=new Common.IrregularStack({strongCompare:this._compareActionStrong,weakCompare:this._compareActionWeak}),this.stackLongActions.push({id:InitApplication,type:c_oAscAsyncActionType.BlockInteraction}),this.editorConfig={},Common.Gateway.on("init",Ext.bind(this.loadConfig,this)),Common.Gateway.on("showmessage",Ext.bind(this.onExternalMessage,this)),Common.Gateway.on("opendocument",Ext.bind(this.loadDocument,this)),Common.Gateway.on("internalcommand",Ext.bind(this.onInternalCommand,this)),Common.Gateway.ready(),this.recognizeBrowser(),Ext.isIE=Common.userAgent.isIE,Ext.isIE9=Common.userAgent.ieVersion==9},bindComponent:function(e){var t=Ext.ComponentQuery.query(e);for(var n=0;n<t.length;++n)t[n].setApi(this.api),t[n].addListener("editcomplete",this.onEditComplete,this)},loadConfig:function(e){this.editorConfig=Ext.merge(this.editorConfig,e.config);if(this.editorConfig.user===undefined||this.editorConfig.user===null){this.editorConfig.user={};if(this.editorConfig.users){this.editorConfig.userId=this.editorConfig.userId||0;for(var t=0;t<this.editorConfig.users.length;t++)if(this.editorConfig.users[t].id===this.editorConfig.userId){this.editorConfig.user={id:this.editorConfig.users[t].id,name:this.editorConfig.users[t].username};break}}}this.editorConfig.user.id=this.editorConfig.user.id||"uid-"+Ext.Date.now(),this.editorConfig.user.name=this.editorConfig.user.name||this.textAnonymous,this.editorConfig.lang&&this.api.asc_setLocale(this.editorConfig.lang)},applyModeCommonElements:function(){window.editor_elements_prepared=!0,this.getHeader().setHeaderCaption(this.appComputedMode.isEdit?"Spreadsheet Editor":"Spreadsheet Viewer"),this.getHeader().setCanBack(this.appComputedMode.canBack===!0),(this.appComputedMode.nativeApp===!0||JSON.parse(window.localStorage.getItem("sse-hidden-title")))&&this.getHeader().setVisible(!1),this.getViewport().setMode(this.appComputedMode,!0),this.getStatusInfo().setDisabled(!1),this.getStatusInfo().setMode(this.appComputedMode),this.getCellInfo().setMode(this.appComputedMode),this.getFileMenu()&&this.getFileMenu().setMode(this.appComputedMode),this.getController("DocumentHolder").setMode(this.appComputedMode);var e=this.getMainMenu().down("#id-menu-comments"),t=this.getMainMenu().down("#id-menu-chat");this.appComputedMode.canCoAuthoring?(e[this.appComputedMode.isEdit?"show":"hide"](),t.show()):(t.hide(),e.hide())},applyModeEditorElements:function(e){if(this.appComputedMode.isEdit){var t=this;window.editor_elements_prepared=!1;var n=function(){typeof Common.Locale!="undefined"&&Common.Locale.apply(),t.getController("Common.controller.Fonts").init(),t.getController("Common.controller.Fonts").setApi(t.api),t.getController("Toolbar").init(),t.getController("Toolbar").setApi(t.api),t.getController("Common.controller.CommentsList").init(),t.getController("Common.controller.CommentsList").setConfig({config:t.editorConfig},t.api),t.getController("Common.controller.CommentsList").registerCallbacks(),t.getController("Common.controller.CommentsList").doDelayedTask(),t.getController("Common.controller.CommentsPopover").init(),t.getController("Common.controller.CommentsPopover").setConfig({config:t.editorConfig,sdkviewname:"#ws-canvas-outer",movingtoplimit:-20},t.api),t.getController("Common.controller.CommentsPopover").registerCallbacks(),e=="view"&&(t.getController("Common.controller.CommentsList").onApiAddComments(t.api.asc_getWorkbookComments()),t.getController("Common.controller.CommentsPopover").onDocumentContentReady()),t.initNames(),t.getController("Print").init(),t.getController("Print").setApi(t.api),t.getViewport().applyEditorMode(),t.getRightMenu().setApi(t.api).addListener("editcomplete",t.onEditComplete,t),t.getToolbar().setApi(t.api).addListener("editcomplete",t.onEditComplete,t),t.getToolbar().setMode(t.appComputedMode),t.getRightPanel().setApi(t.api).addListener("editcomplete",t.onEditComplete,t),t.getRightPanel().setMode(t.appComputedMode),window.editor_elements_prepared=!0;var n=window.localStorage.getItem("sse-settings-unit");Common.MetricSettings.setCurrentMetric(n!==null?parseInt(n):Common.MetricSettings.c_MetricUnits.cm);var r={};JSON.parse(window.localStorage.getItem("sse-hidden-title"))&&(r.title=!0),JSON.parse(window.localStorage.getItem("sse-hidden-formula"))&&(r.formula=!0),JSON.parse(window.localStorage.getItem("sse-hidden-headings"))&&(r.headings=!0),t.getController("Toolbar").hideElements(r),t.stackLongActions.exist({id:ApplyEditRights,type:c_oAscAsyncActionType.BlockInteraction})?t.onLongActionEnd(c_oAscAsyncActionType.BlockInteraction,ApplyEditRights):t.stackLongActions.exist({id:InitApplication,type:c_oAscAsyncActionType.BlockInteraction})&&(t.hidePreloader(),t.onLongActionBegin(c_oAscAsyncActionType.BlockInteraction,LoadingDocument)),window.onbeforeunload=Ext.bind(t.onBeforeUnload,t)};this.loadEditorStylesheets(n)}},loadDocument:function(e){this.spreadsheet=e.doc,this.permissions={};var t={};e.doc&&(this.permissions=Ext.merge(this.permissions,e.doc.permissions),t.Id=e.doc.key,t.Url=e.doc.url,t.Title=e.doc.title,t.Format=e.doc.fileType,t.Options=e.doc.options,t.UserId=this.editorConfig.user.id,t.UserName=this.editorConfig.user.name,t.VKey=e.doc.vkey,t.Origin=e.doc.origin,t.OfflineApp=this.editorConfig.nativeApp===!0),this.appComputedMode={canAutosave:-1,canBack:this.editorConfig.nativeApp!==!0&&this.editorConfig.canBackToFolder===!0,canOpenRecent:this.editorConfig.nativeApp!==!0&&this.editorConfig.recent!==undefined,canCreateNew:!Ext.isEmpty(this.editorConfig.createUrl),nativeApp:this.editorConfig.nativeApp===!0,canCoAuthoring:this.editorConfig.canCoAuthoring===!0,user:this.editorConfig.user},this.api.asc_registerCallback("asc_onGetEditorPermissions",Ext.bind(this.onEditorPermissions,this)),this.api.asc_setDocInfo(t),this.api.asc_getEditorPermissions(),e.doc&&this.getHeader().setDocumentCaption(e.doc.title)},onEditorPermissions:function(e){e&&(e.asc_getIsAutosaveEnable()&&(this.appComputedMode.canAutosave=e.asc_getAutosaveMinInterval()),this.permissions.edit!==!1&&(this.permissions.edit=e.asc_getCanEdit()),this.permissions.download!==!1&&(this.permissions.download=e.asc_getCanDownload()),this.appComputedMode.canCoAuthoring!==!1&&(this.appComputedMode.canCoAuthoring=e.asc_getCanCoAuthoring()),this.editorConfig.canAutosave===!1&&(this.appComputedMode.canAutosave=-1,this.api.asc_setAutoSaveGap(0))),this.appComputedMode.canEdit=this.permissions.edit===!0,this.appComputedMode.isEdit=this.permissions.edit===!0&&this.editorConfig.mode!=="view",this.appComputedMode.canDownload=this.editorConfig.nativeApp!==!0&&(this.permissions.download!==undefined?this.permissions.download:!0),this.applyModeCommonElements(),this.applyModeEditorElements(),this.api.asc_setViewerMode(!this.appComputedMode.isEdit),this.api.asc_LoadDocument(),this.appComputedMode.isEdit||(this.hidePreloader(),this.onLongActionBegin(c_oAscAsyncActionType.BlockInteraction,LoadingDocument))},onInternalCommand:function(e){if(e)switch(e.command){case"setAppDisabled":this.isAppDisabled=e.data,this.api.asc_enableKeyEvents(!1)}},onProcessSaveResult:function(e){this.api&&this.api.asc_OnSaveEnd(e.result),e&&e.result===!1&&Ext.Msg.show({title:this.criticalErrorTitle,msg:Ext.isEmpty(e.message)?this.errorProcessSaveResult:e.message,icon:Ext.Msg.ERROR,buttons:Ext.Msg.OK})},onProcessRightsChange:function(e){e&&e.enabled===!1&&(this.api.asc_coAuthoringDisconnect(),this.getDocumentInfo().onLostEditRights(),Ext.Msg.show({title:this.notcriticalErrorTitle,msg:Ext.isEmpty(e.message)?this.warnProcessRightsChange:e.message,icon:Ext.Msg.WARNING,buttons:Ext.Msg.OK}))},goBack:function(){Common.Gateway.goBack()},onDocumentHolderResize:function(){this.api&&(this.api.asc_Resize(),Ext.menu.Manager.hideAll())},onEditComplete:function(e,t){this.getMainMenu().closeFullScaleMenu(),t&&t.checkorder&&this.api.isTextAreaBlur?(this.getFormulaInput().blur(),this.getFormulaInput().focus(!1,10)):(this.getDocumentHolder().blur(),this.getDocumentHolder().focus(!1,50),this.api.isTextAreaBlur=!1)},onLongActionBegin:function(e,t){var n={id:t,type:e};this.stackLongActions.push(n),this.setLongActionView(n)},setLongActionView:function(e){var t="",n="";switch(e.id){case c_oAscAsyncAction.Open:t=this.openTitleText;break;case c_oAscAsyncAction.Save:t=this.saveTitleText;break;case c_oAscAsyncAction.LoadDocumentFonts:t=this.loadFontsTitleText;break;case c_oAscAsyncAction.LoadDocumentImages:t=this.loadImagesTitleText;break;case c_oAscAsyncAction.LoadFont:t=this.loadFontTitleText;break;case c_oAscAsyncAction.LoadImage:t=this.loadImageTitleText;break;case c_oAscAsyncAction.DownloadAs:t=this.downloadTitleText;break;case c_oAscAsyncAction.Print:t=this.printTitleText;break;case c_oAscAsyncAction.UploadImage:t=this.uploadImageTitleText;break;case c_oAscAsyncAction.Recalc:t=this.titleRecalcFormulas;break;case c_oAscAsyncAction.SlowOperation:t=this.textPleaseWait;break;case c_oAscAsyncAction.PrepareToSave:this.getController("Common.controller.CommentsPopover").setAutoPopup(!1),t=this.savePreparingText;break;case ApplyEditRights:t=this.txtEditingMode;break;case LoadingDocument:t=this.loadingDocumentTitleText}e.type==c_oAscAsyncActionType.BlockInteraction&&(!this.loadMask&&(this.loadMask=Ext.widget("cmdloadmask",Ext.getBody())),this.loadMask.setTitle(t),this.loadMask.show())},onDocumentReady:function(){var e=!0;window.editor_elements_prepared&&(this.onDocumentHolderResize(),this.hidePreloader(),this.onLongActionEnd(c_oAscAsyncActionType.BlockInteraction,LoadingDocument),e=!1);var t=window.localStorage.getItem("sse-settings-zoom");this.api.asc_setZoom(t?parseInt(t)/100:1),t=window.localStorage.getItem("sse-settings-livecomment"),this.isLiveCommenting=t===null||parseInt(t)!=0,this.isLiveCommenting?this.api.asc_showComments():this.api.asc_hideComments();var n=this;setTimeout(function(){n.api.asc_setCoAuthoringEnable(n.appComputedMode.canCoAuthoring),n.api.asc_registerCallback("asc_onStartAction",Ext.bind(n.onLongActionBegin,n)),n.api.asc_registerCallback("asc_onConfirmAction",Ext.bind(n.onConfirmAction,n)),n.api.asc_registerCallback("asc_onActiveSheetChanged",Ext.bind(n.onActiveSheetChanged,n)),n.getHeader().setDocumentCaption(n.api.asc_getDocumentName()),Common.Gateway.on("applyeditrights",Ext.bind(n.onApplyEditRights,n)),Common.Gateway.on("processsaveresult",Ext.bind(n.onProcessSaveResult,n)),Common.Gateway.on("processrightschange",Ext.bind(n.onProcessRightsChange,n)),Common.Gateway.on("processmouse",Ext.bind(n.onProcessMouse,n)),n.getController("DocumentHolder").setApi(n.api).loadConfig({config:n.editorConfig}),n.getController("CreateFile").init(),n.getController("CreateFile").setApi(n.api).loadConfig({config:n.editorConfig}),n.getController("RecentFiles").init(),n.getController("RecentFiles").loadConfig({config:n.editorConfig}),n.getController("Search").init(),n.getController("Search").setApi(n.api),n.getController("Search").setMode(n.appComputedMode),n.getController("CellEdit").init(),n.getController("CellEdit").setApi(n.api),n.getController("Common.controller.Chat").init(),n.getController("Common.controller.Chat").setApi(n.api).loadConfig({config:n.editorConfig}),n.getMainMenu().setApi(n.api).addListener("editcomplete",n.onEditComplete,n),n.getStatusInfo().setApi(n.api).addListener("editcomplete",n.onEditComplete,n),n.getDocumentHolder().setApi(n.api).addListener("editcomplete",n.onEditComplete,n),n.getCellInfo().addListener("editcomplete",n.onEditComplete,n),n.getViewport().createDelayedElements(),n.getStatusInfo().createDelayedElements(),n.getMainMenu().createDelayedElements(),n.getChatPanel().createDelayedElements();var r=setInterval(function(){if(window.editor_elements_prepared){clearInterval(r),e&&(n.onDocumentHolderResize(),n.hidePreloader(),n.onLongActionEnd(c_oAscAsyncActionType.BlockInteraction,LoadingDocument)),n.getFileMenu().loadConfig({config:n.editorConfig}),n.getFileMenu().setMode(n.appComputedMode,!0),n.getFileMenu().createDelayedElements(),n.getMainMenu().disableMenu("all",!1),n.getCellInfo().updateCellInfo(n.api.asc_getCellInfo()),n.getStatusInfo().updateInfo(),n.getDocumentInfo().loadConfig({config:n.editorConfig}).updateInfo(n.spreadsheet);if(n.appComputedMode.isEdit)var t=setInterval(function(){window.styles_loaded&&(clearInterval(t),n.getController("Common.controller.CommentsList").onApiAddComments(n.api.asc_getWorkbookComments()),n.getController("Common.controller.CommentsPopover").onDocumentContentReady(),n.getDocumentHolder().createDelayedElements(),n.getToolbar().createDelayedElements(),n.getController("Toolbar").createDelayedElements(),n.getRightMenu().createDelayedElements(),n.getRightPanel().createDelayedElements(),n.bindComponent.call(n,"sseimagesettings"),n.bindComponent.call(n,"sseshapesettings"),n.api.asc_registerCallback("asc_onInitEditorShapes",Ext.bind(n.fillAutoShapes,n)),n.api.asc_registerCallback("asc_onSendThemeColors",Ext.bind(n._onSendThemeColors,n)),n.api.asc_registerCallback("asc_onSaveUrl",Ext.bind(n.onSaveUrl,n)),n.api.asc_registerCallback("asc_onDocumentModifiedChanged",Ext.bind(n.onDocumentModifiedChanged,n)),window.dlgFormulas=Ext.create("SSE.view.FormulaDialog",{closeAction:"hide"}))},50)}},50);n.appComputedMode.canAutosave>-1&&(t=window.localStorage.getItem("sse-settings-autosave"),t=t!==null?parseInt(t):600,t>0&&n.appComputedMode.canAutosave>t&&(t=n.appComputedMode.canAutosave,window.localStorage.setItem("sse-settings-autosave",t)),n.api.asc_setAutoSaveGap(t)),Common.component.Analytics.initialize("UA-12442749-13","Spreadsheet Editor");var i,s=n.getDocumentHolder(),o=n.getFormulaInput();Ext.FocusManager.enable(),Ext.FocusManager.addXTypeToWhitelist("button"),Ext.FocusManager.keyNav.disable(),Ext.FocusManager.addListener("componentfocus",function(e,t){if(this.isAppDisabled===!0)return;i=t instanceof Ext.form.field.Text&&t.id!="infobox-cell-edit",!i&&(i=t instanceof Ext.window.Window),!i&&(i=this.fullscalemenu===!0),!i&&(i=$("body > .x-mask").filter(":visible").length>0),!i&&(i=$("body > .x-boundlist").filter(":visible").length>0);if(!i){var n=$("body > .x-menu").filter(":visible"),r=n.length;n.each(function(e,t){$(t).css("visibility")=="hidden"?r--:(t.style.left==="-10000px"||t.style.top==="-10000px")&&r--}),i=r>0}!i&&!/infobox-cell-input|editor_sdk/.test(document.activeElement.id)&&!/sdk-element/.test(document.activeElement.className)&&(this.api.isTextAreaBlur?o:s).focus(!1,!1),this.api.asc_enableKeyEvents(i==0)},n),Ext.getDoc().on("contextmenu",Ext.bind(n.onContextMenu,n)),n.getViewport().getEl().un("keypress",n.lockEscapeKey,n);var u=[],a=Ext.fly(document.body.parentNode);Ext.isSafari&&Ext.safariVersion>=7&&a.addCls("safari-7"),Common.userAgent.ieVersion==9&&u.push(n.warnBrowserIE9),!Ext.isGecko&&!n.appComputedMode.nativeApp&&Math.abs(n.getBrowseZoomLevel()-1)>.011&&u.push(n.warnBrowserZoom),u.length&&n.showTips(u),window.canHotKey=function(){var e=Ext.ComponentQuery.query("window");for(var t=e.length;--t;)if(e[t].isVisible()&&e[t].modal)return!1;return!0}},50)},onLongActionEnd:function(e,t){var n={id:t,type:e};this.stackLongActions.pop(n),this.getHeader().setDocumentCaption(this.api.asc_getDocumentName()),this.updateWindowTitle(),e===c_oAscAsyncActionType.BlockInteraction&&(t==c_oAscAsyncAction.Open?(Common.Gateway.internalMessage("documentReady",{}),this.onDocumentReady()):t==c_oAscAsyncAction.PrepareToSave&&(this.getToolbar().synchronizeChanges(),this.getController("Common.controller.CommentsPopover").setAutoPopup(!0))),n=this.stackLongActions.get({type:c_oAscAsyncActionType.Information}),n?this.setLongActionView(n):null,n=this.stackLongActions.get({type:c_oAscAsyncActionType.BlockInteraction}),n?this.setLongActionView(n):(this.loadMask&&this.loadMask.hide(),this.onEditComplete(this.loadMask,{checkorder:!0}))},_compareActionStrong:function(e,t){return e.id===t.id&&e.type===t.type},_compareActionWeak:function(e,t){return e.type===t.type},onError:function(e,t){this.hidePreloader(),this.onLongActionEnd(c_oAscAsyncActionType.BlockInteraction,LoadingDocument);var n={closable:!1};switch(e){case c_oAscError.ID.Unknown:n.msg=this.unknownErrorText;break;case c_oAscError.ID.ConvertationTimeout:n.msg=this.convertationTimeoutText;break;case c_oAscError.ID.ConvertationError:n.msg=this.convertationErrorText;break;case c_oAscError.ID.DownloadError:n.msg=this.downloadErrorText;break;case c_oAscError.ID.UplImageSize:n.msg=this.uploadImageSizeMessage;break;case c_oAscError.ID.UplImageExt:n.msg=this.uploadImageExtMessage;break;case c_oAscError.ID.UplImageFileCount:n.msg=this.uploadImageFileCountMessage;break;case c_oAscError.ID.PastInMergeAreaError:n.msg=this.pastInMergeAreaError;break;case c_oAscError.ID.FrmlWrongCountParentheses:n.msg=this.errorWrongBracketsCount;break;case c_oAscError.ID.FrmlWrongOperator:n.msg=this.errorWrongOperator;break;case c_oAscError.ID.FrmlWrongMaxArgument:n.msg=this.errorCountArgExceed;break;case c_oAscError.ID.FrmlWrongCountArgument:n.msg=this.errorCountArg;break;case c_oAscError.ID.FrmlWrongFunctionName:n.msg=this.errorFormulaName;break;case c_oAscError.ID.FrmlAnotherParsingError:n.msg=this.errorFormulaParsing;break;case c_oAscError.ID.FrmlWrongArgumentRange:n.msg=this.errorArgsRange;break;case c_oAscError.ID.UnexpectedGuid:n.msg=this.errorUnexpectedGuid;break;case c_oAscError.ID.Database:n.msg=this.errorDatabaseConnection;break;case c_oAscError.ID.FileRequest:n.msg=this.errorFileRequest;break;case c_oAscError.ID.FileVKey:n.msg=this.errorFileVKey;break;case c_oAscError.ID.StockChartError:n.msg=this.errorStockChart;break;case c_oAscError.ID.DataRangeError:n.msg=this.errorDataRange;break;case c_oAscError.ID.FrmlOperandExpected:n.msg=this.errorOperandExpected;break;case c_oAscError.ID.VKeyEncrypt:n.msg=this.errorKeyEncrypt;break;case c_oAscError.ID.KeyExpire:n.msg=this.errorKeyExpire;break;case c_oAscError.ID.UserCountExceed:n.msg=this.errorUsersExceed;break;case c_oAscError.ID.CannotMoveRange:n.msg=this.errorMoveRange;break;case c_oAscError.ID.UplImageUrl:n.msg=this.errorBadImageUrl;break;case c_oAscError.ID.CoAuthoringDisconnect:n.msg=this.errorCoAuthoringDisconnect;break;case c_oAscError.ID.ConvertationPassword:n.msg=this.errorFilePassProtect;break;case c_oAscError.ID.AutoFilterDataRangeError:n.msg=this.errorAutoFilterDataRange;break;case c_oAscError.ID.AutoFilterChangeFormatTableError:n.msg=this.errorAutoFilterChangeFormatTable;break;case c_oAscError.ID.AutoFilterChangeError:n.msg=this.errorAutoFilterChange;break;default:n.msg=this.errorDefaultMessage.replace("%1",e)}if(Common.userAgent.isIE){var r=Ext.FocusManager.navigateIn;Ext.FocusManager.navigateIn=Ext.emptyFn}if(t==c_oAscError.Level.Critical)Common.Gateway.reportError(e,n.msg),n.title=this.criticalErrorTitle,n.icon=Ext.Msg.ERROR,this.editorConfig.canBackToFolder&&(n.msg+="<br/><br/>"+this.criticalErrorExtText+"<br/>&nbsp;",n.buttons=Ext.Msg.OK,n.fn=function(e){r&&(Ext.FocusManager.navigateIn=r),e=="ok"&&Common.Gateway.goBack()});else{var i=new Ext.util.TextMetrics;n.title=this.notcriticalErrorTitle,n.icon=Ext.Msg.WARNING,n.buttons=Ext.Msg.OK,n.width=i.getWidth(n.msg)+85,n.fn=Ext.bind(function(e){r&&(Ext.FocusManager.navigateIn=r),this.onEditComplete()},this)}Ext.FocusManager.enabled||Ext.FocusManager.enable(),Ext.Msg.show(n)},onCoAuthoringDisconnect:function(){this.getFileMenu()&&this.getFileMenu().setMode({isDisconnected:!0}),this.getViewport().setMode({isDisconnected:!0})},onExternalMessage:function(e){if(e){var t=e.msg.charAt(0).toUpperCase()+e.msg.substring(1),n=e.severity.indexOf("error")>=0?this.criticalErrorTitle:this.notcriticalErrorTitle;this.showTips([t],!1,n)}},onDocumentModifiedChanged:function(){this.updateWindowTitle(),Common.Gateway.setDocumentModified(this.api.asc_isDocumentModified())},onContextMenu:function(e,t){if(!(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||(new Boolean(t.getAttribute("data-can-copy"))).valueOf()))return e.stopEvent(),!1},onBeforeUnload:function(){var e=this.permissions.edit===!0&&this.editorConfig.mode!=="view";if(e&&this.api.asc_isDocumentModified())return this.leavePageText},onApplyEditRights:function(e){if(e)if(e.allowed){this.onLongActionBegin(c_oAscAsyncActionType.BlockInteraction,ApplyEditRights);var t=this;setTimeout(function(){t.appComputedMode.isEdit=!0,t.applyModeCommonElements(),t.applyModeEditorElements("view"),t.api.asc_setViewerMode(!1),t.getController("Search").setMode(t.appComputedMode);var e=setInterval(function(){if(window.editor_elements_prepared){clearInterval(e),t.getController("Toolbar").loadStyles();var n=setInterval(function(){window.styles_loaded&&(clearInterval(n),t.getDocumentHolder().createDelayedElements(),t.getToolbar().createDelayedElements(),t.getController("Toolbar").createDelayedElements(),t.getController("DocumentHolder").resetApi(),t.getRightMenu().createDelayedElements(),t.getRightPanel().createDelayedElements(),t.getStatusInfo().updateInfo(),t.api.asc_registerCallback("asc_onInitEditorShapes",Ext.bind(t.fillAutoShapes,t)),t.api.asc_registerCallback("asc_onSendThemeColors",Ext.bind(t._onSendThemeColors,t)),t.bindComponent.call(t,"sseimagesettings"),t.bindComponent.call(t,"sseshapesettings"),t.api.asc_registerCallback("asc_onSaveUrl",Ext.bind(t.onSaveUrl,t)),t.api.asc_registerCallback("asc_onDocumentModifiedChanged",Ext.bind(t.onDocumentModifiedChanged,t)),window.dlgFormulas=Ext.create("SSE.view.FormulaDialog",{closeAction:"hide"}))},50)}},50)},50)}else Ext.Msg.show({title:this.requestEditFailedTitleText,msg:e.message||this.requestEditFailedMessageText,icon:Ext.Msg.INFO,buttons:Ext.Msg.OK})},requestEditRights:function(){Common.Gateway.requestEditRights()},updateWindowTitle:function(){var e=this.defaultTitleText;this.getHeader().getDocumentCaption().length>0&&(e=this.getHeader().getDocumentCaption()+" - "+e),this.api.asc_isDocumentModified()&&(e="* "+e),window.document.title=e},hidePreloader:function(){this.stackLongActions.pop({id:InitApplication,type:c_oAscAsyncActionType.BlockInteraction});var e=Ext.fly("loading-mask");e&&(e.hide(),e.dom.parentNode.removeChild(e.dom))},onSaveUrl:function(e){Common.Gateway.save(e)},onOpenDocument:function(e){var t=document.getElementById("loadmask-text"),n=(e.CurrentFont+e.CurrentImage)/(e.FontsCount+e.ImagesCount);t?t.innerHTML=this.textLoadingDocument+": "+Ext.util.Format.round(n*100,0)+"%":this.loadMask&&this.loadMask.setTitle(this.textLoadingDocument+": "+Ext.util.Format.round(n*100,0)+"%")},onAdvancedOptions:function(e){if(e.asc_getOptionId()==c_oAscAdvancedOptionsID.CSV){var t=Ext.create("SSE.view.OpenDialog",{codepages:e.asc_getOptions().asc_getCodePages()});t.setSettings(e.asc_getOptions().asc_getRecommendedSettings()),t.addListener("onmodalresult",Ext.bind(function(e,t,n){t&&this.api&&this.api.asc_setAdvancedOptions(c_oAscAdvancedOptionsID.CSV,new Asc.asc_CCSVAdvancedOptions(n.encoding,n.delimiter))},this),!1),this.onDocumentHolderResize(),this.hidePreloader(),this.onLongActionEnd(c_oAscAsyncActionType.BlockInteraction,LoadingDocument),t.show()}},lockEscapeKey:function(e){e.getKey()==e.ESC&&(e.preventDefault(),e.stopPropagation())},getBrowseZoomLevel:function(){if(Common.userAgent.isIE)return screen.logicalXDPI/screen.deviceXDPI;var e=window.outerWidth/document.documentElement.clientWidth;return Ext.isSafari&&(e=Math.floor(e*10)/10),e},showTips:function(e,t,n){function r(){var t=e.shift();if(t){i.update(t),i.show();var n=i.getEl().getAlignToXY("infobox-cell-edit","t-b?",[-65,30]);i.showAt(n)}else i.destroy()}if(!e.length)return;typeof e!="object"&&(e=[e]);var i=Ext.create("Ext.tip.ToolTip",{closable:!0,title:Ext.isDefined(n)?n:this.notcriticalErrorTitle,maxWidth:800,minWidth:200,style:"white-space: nowrap;",autoHide:Ext.isDefined(t)?t:!0,listeners:{beforehide:function(e){setTimeout(r,200)},show:function(e){e.getEl().setStyle("z-index","20003")}}});r()},onActiveSheetChanged:function(e){this.appComputedMode.isEdit&&!this.appComputedMode.isEditDiagram&&window.editor_elements_prepared&&(this.getController("Common.controller.CommentsPopover").onApiHideComment(),this.getController("Common.controller.CommentsList").applyCommentsFilter([{property:"id",value:new RegExp("^(doc_|sheet"+this.api.asc_getWorksheetId(e)+"_)")}]))},loadEditorStylesheets:function(e){var t=getEditorStylesheets(),n=this,r=t.length,i=0;if(!Ext.isSafari){function s(){++i<r||setTimeout(function(){n.loadEditorScripts.call(n,e)},10)}for(u=0;u<r;u++)a=document.createElement("link"),a.setAttribute("rel","stylesheet"),a.type="text/css",a.addEventListener?a.addEventListener("load",s,!1):a.onload=s,a.href=t[u],document.head.appendChild(a)}else{var o=document.styleSheets.length;for(var u=0;u<r;u++){var a=document.createElement("link");a.setAttribute("rel","stylesheet"),a.type="text/css",a.href=t[u],document.head.appendChild(a)}var f=setInterval(function(){document.styleSheets.length>=o+r&&(clearInterval(f),n.loadEditorScripts.call(n,e))},30)}},loadEditorScripts:function(e){function s(){i++,i<r||setTimeout(function(){e()},10)}var t=[],n=this;if(typeof getEditorScripts=="undefined"){setTimeout(function(){e()},10);return}t=getEditorScripts();var r=t.length,i=0;for(var o=0;o<r;o++){var u=document.createElement("script");u.type="text/javascript",u.addEventListener?u.addEventListener("load",s,!1):u.onload=s,u.src=t[o],document.body.appendChild(u)}},onConfirmAction:function(e,t){if(e==c_oAscConfirm.ConfirmReplaceRange){var n=this;Ext.create("Ext.window.MessageBox",{buttonText:{ok:"OK",yes:this.textYes,no:this.textNo,cancel:"Cancel"}}).show({title:this.textConfirm,msg:this.confirmMoveCellRange,icon:Ext.Msg.QUESTION,buttons:Ext.Msg.YESNO,fn:function(e){t&&t(e=="yes"),n.onEditComplete(n.getDocumentHolder())}})}},onProcessMouse:function(e){if(e.type=="mouseup"){var t=document.getElementById("editor_sdk");if(t){var n=t.getBoundingClientRect();this.api.asc_onMouseUp(e.x-n.left,e.y-n.top)}}},initNames:function(){this.shapeGroupNames=[this.txtBasicShapes,this.txtFiguredArrows,this.txtMath,this.txtCharts,this.txtStarsRibbons,this.txtCallouts,this.txtButtons,this.txtRectangles,this.txtLines],this.ThemeValues=[6,15,7,16,0,1,2,3,4,5]},fillAutoShapes:function(e,t){if(Ext.isEmpty(t)||Ext.isEmpty(e)||t.length!=e.length)return;var n=this,r=[],i=this.getStore("ShapeGroups");i.removeAll();var s=e.length;Ext.each(e,function(e,i){var s=Ext.create("Ext.data.Store",{model:"SSE.model.ShapeModel"}),o=t[i].length>18?7:6,u=Math.ceil(t[i].length/o)*35+3,a=30*o;Ext.each(t[i],function(e){s.add({imageUrl:e.Image,data:{shapeType:e.Type}})}),r.push({groupName:n.shapeGroupNames[i],groupStore:s,groupWidth:a,groupHeight:u})});if(s>0){var o=Ext.create("Ext.data.Store",{model:"SSE.model.ShapeModel"}),u=t[s-1].length-3>18?7:6,a=Math.ceil((t[s-1].length-3)/u)*35+3,f=30*u;for(var l=0;l<t[s-1].length-3;l++){var c=t[s-1][l];o.add({imageUrl:c.Image,data:{shapeType:c.Type}})}r.push({groupName:n.shapeGroupNames[s-1],groupStore:o,groupWidth:f,groupHeight:a})}i.add(r),setTimeout(function(){n.getController("Toolbar").FillAutoShapes()},50)},onInsertImage:function(){var e=this.getRightPanel();e&&e.onInsertImage()},recognizeBrowser:function(){var e=/trident\/(\d+)\.(\d+)/i.exec(navigator.userAgent);Common.userAgent={isIE:!!e};if(Common.userAgent.isIE&&e.length>1)switch(e[1]){case"5":Common.userAgent.ieVersion=9;break;case"6":Common.userAgent.ieVersion=10;break;case"7":Common.userAgent.ieVersion=11;break;default:Common.userAgent.ieVersion=0}},getHexColor:function(e,t,n){return e=e.toString(16),t=t.toString(16),n=n.toString(16),e.length==1&&(e="0"+e),t.length==1&&(t="0"+t),n.length==1&&(n="0"+n),e+t+n},_onSendThemeColors:function(e,t){var n=this,r=[];if(t)for(var i=0;i<t.length;i++){var s=this.getHexColor(t[i].get_r(),t[i].get_g(),t[i].get_b());r.push(s)}var o=[];for(i=0;i<6;i++)for(var u=0;u<10;u++){var a=i+u*6,s={color:this.getHexColor(e[a].get_r(),e[a].get_g(),e[a].get_b()),effectId:a,effectValue:this.ThemeValues[u]};o.push(s)}setTimeout(function(){n.getRightPanel().SendThemeColors(o,r)},50),setTimeout(function(){n.getToolbar()._onSendThemeColors(e,t)},50)},leavePageText:"You have unsaved changes in this document. Click 'Stay on this Page' then 'Save' to save them. Click 'Leave this Page' to discard all the unsaved changes.",criticalErrorTitle:"Error",notcriticalErrorTitle:"Warning",errorDefaultMessage:"Error code: %1",criticalErrorExtText:'Press "Ok" to to back to document list.',openTitleText:"Opening Document",openTextText:"Opening document...",saveTitleText:"Saving Document",saveTextText:"Saving document...",loadFontsTitleText:"Loading Data",loadFontsTextText:"Loading data...",loadImagesTitleText:"Loading Images",loadImagesTextText:"Loading images...",loadFontTitleText:"Loading Data",loadFontTextText:"Loading data...",loadImageTitleText:"Loading Image",loadImageTextText:"Loading image...",downloadTitleText:"Downloading Document",downloadTextText:"Downloading document...",printTitleText:"Printing Document",printTextText:"Printing document...",uploadImageTitleText:"Uploading Image",uploadImageTextText:"Uploading image...",savePreparingText:"Preparing to save",savePreparingTitle:"Preparing to save. Please wait...",loadingDocumentTitleText:"Loading Document",uploadImageSizeMessage:"Maximium image size limit exceeded.",uploadImageExtMessage:"Unknown image format.",uploadImageFileCountMessage:"No images uploaded.",reloadButtonText:"Reload Page",unknownErrorText:"Unknown error.",convertationTimeoutText:"Convertation timeout exceeded.",convertationErrorText:"Convertation failed.",downloadErrorText:"Download failed.",unsupportedBrowserErrorText:"Your browser is not supported.",requestEditRightsText:"Requesting editing rights...",requestEditFailedTitleText:"Access denied",requestEditFailedMessageText:"Someone is editing this document right now. Please try again later.",warnBrowserZoom:"Your browser's current zoom setting is not fully supported. Please reset to the default zoom by pressing Ctrl+0.",warnBrowserIE9:"The application has low capabilities on IE9. Use IE10 or higher",pastInMergeAreaError:"Cannot change part of a merged cell",titleRecalcFormulas:"Calculating formulas...",textRecalcFormulas:"Calculating formulas...",textPleaseWait:"It's working hard. Please wait...",errorWrongBracketsCount:"Found an error in the formula entered.<br>Wrong cout of brackets.",errorWrongOperator:"Found an error in the formula entered.<br>Wrong operator.",errorCountArgExceed:"Found an error in the formula entered.<br>Count of arguments exceeded.",errorCountArg:"Found an error in the formula entered.<br>Invalid number of arguments.",errorFormulaName:"Found an error in the formula entered.<br>Incorrect formula name.",errorFormulaParsing:"Internal error while the formula parsing.",errorArgsRange:"Found an error in the formula entered.<br>Incorrect arguments range.",errorUnexpectedGuid:"External error.<br>Unexpected Guid. Please, contact support.",errorDatabaseConnection:"External error.<br>Database connection error. Please, contact support.",errorFileRequest:"External error.<br>File Request. Please, contact support.",errorFileVKey:"External error.<br>Incorrect securety key. Please, contact support.",errorStockChart:"Incorrect rows order.",errorDataRange:"Incorrect data range.",errorOperandExpected:"Operand expected",errorKeyEncrypt:"Unknown key descriptor",errorKeyExpire:"Key descriptor expired",errorUsersExceed:"Count of users was exceed",errorMoveRange:"Cann't change a part of merged cell",errorBadImageUrl:"Image url is incorrect",errorCoAuthoringDisconnect:"Server connection lost. You can't edit anymore.",errorFilePassProtect:"The document is password protected.",txtEditingMode:"Set editing mode...",textLoadingDocument:"LOADING DOCUMENT",textConfirm:"Confirmation",confirmMoveCellRange:"The destination cell's range can contain data. Continue the operation?",textYes:"Yes",textNo:"No",textAnonymous:"Anonymous",txtBasicShapes:"Basic Shapes",txtFiguredArrows:"Figured Arrows",txtMath:"Math",txtCharts:"Charts",txtStarsRibbons:"Stars & Ribbons",txtCallouts:"Callouts",txtButtons:"Buttons",txtRectangles:"Rectangles",txtLines:"Lines",txtXAxis:"X Axis",txtYAxis:"Y Axis",txtSeries:"Seria",warnProcessRightsChange:"You have been denied the right to edit the file.",errorProcessSaveResult:"Saving is failed.",errorAutoFilterDataRange:"The operation could not be done for the selected range of cells. Select a single cell and then try again.",errorAutoFilterChangeFormatTable:"The operation is attempting to change a filtered range on the worksheet and cannot be completed. Remove Auto Filters from the sheet to complete the operation.",errorAutoFilterChange:"The operation is not allowed, as it is attempting to shift cells in a table on your worksheet."});var url_create_template="{0}?title={1}&template={2}&action=create&doctype=spreadsheet",url_create_new="{0}?title={1}&action=create&doctype=spreadsheet";Ext.define("SSE.controller.CreateFile",{extend:"Ext.app.Controller",uses:["SSE.view.OpenDialog"],views:["CreateFile"],stores:["FileTemplates"],refs:[{ref:"filePanel",selector:"ssefile"}],init:function(){Common.Gateway.on("init",Ext.bind(this.loadConfig,this)),this.control({ssecreatenew:{afterrender:Ext.bind(this.onRenderView,this,{single:!0})},"ssecreatenew dataview":{itemclick:this.onTemplateClick},"ssefile #file-button-createnew":{click:function(e,t){var n=this.getFileTemplatesStore();(!n||!n.getCount())&&this.onBlankDocClick(t,e)}},"ssefile button[docType]":{click:this.clickBtnDownloadAs},"ssefile button[docType=0]":{click:this.clickBtnDownloadAs}})},loadConfig:function(e){var t=this.getFileTemplatesStore();t&&(t.removeAll(),e&&e.config&&(this.createUrl=e.config.createUrl,this.nativeApp=e.config.nativeApp,e.config.templates&&t.add(e.config.templates)))},onRenderView:function(){var e=Ext.fly("id-create-blank-document");e&&(e.addClsOnOver("over"),e.on("click",this.onBlankDocClick,this))},onBlankDocClick:function(e,t){var n=this.getFilePanel();n&&n.closeMenu();if(this.nativeApp===!0)this.api.asc_openNewDocument();else if(this.createUrl&&this.createUrl.length){var r=window.open(Ext.String.format(url_create_new,this.createUrl,this.newDocumentTitle));r&&r.focus()}Common.component.Analytics.trackEvent("Create New","Blank")},onTemplateClick:function(e,t,n,r,i){var s=this.getFilePanel();s&&s.closeMenu();if(this.nativeApp===!0)this.api.asc_openNewDocument(t.data.name);else if(this.createUrl&&this.createUrl.length){var o=window.open(Ext.String.format(url_create_template,this.createUrl,this.newDocumentTitle,t.data.name));o&&o.focus()}Common.component.Analytics.trackEvent("Create New")},setApi:function(e){return this.api=e,this},clickBtnDownloadAs:function(e){this.api&&(this.api.asc_drawingObjectsExist()&&e.docType!=c_oAscFileType.XLSX?Ext.create("Ext.window.MessageBox",{buttonText:{ok:"OK",yes:"Yes",no:"No",cancel:this.textCancel}}).show({title:this.textWarning,msg:this.warnDownloadAs,icon:Ext.Msg.QUESTION,buttons:Ext.Msg.OKCANCEL,scope:this,fn:function(t,n){t=="ok"&&(this.getFilePanel().fireEvent("downloadas"),this.api.asc_DownloadAs(e.docType),this.getFilePanel().closeMenu())}}):(this.getFilePanel().fireEvent("downloadas"),this.api.asc_DownloadAs(e.docType),this.getFilePanel().closeMenu())),Common.component.Analytics.trackEvent("Download As",String(e.docType))},warnDownloadAs:"If you continue saving in this format all the charts and images will be lost.<br>Are you sure you want to continue?",newDocumentTitle:"Unnamed document",textWarning:"Warning",textCancel:"Cancel"}),Ext.define("SSE.controller.CellEdit",{extend:"Ext.app.Controller",views:["CellInfo"],refs:[{ref:"infoBox",selector:"ssecellinfo"},{ref:"dlgFormula",selector:"sseformuladialog"},{ref:"formulaList",selector:"#formulas-list"},{ref:"toolBar",selector:"ssetoolbar"},{ref:"cellTextBox",selector:"#infobox-cell-edit"},{ref:"buttonExpand",selector:"#infobox-cell-multiline-button"}],init:function(){this.control({sseformuladialog:{beforeshow:function(e,t){},show:function(){this.getFormulaList().getSelectionModel().select(0),this.getDlgFormula().focus(undefined,100)},beforerender:function(){this.getFormulaList().getStore().getCount()>0||this._reloadFormulas(),this.getDlgFormula().setGroups(this.arrGroups)},hide:function(){this.getToolBar().fireEvent("editcomplete",this.getToolBar())}},"sseformuladialog #formulas-group-combo":{select:function(e,t,n){this.getFormulaList().getStore().clearFilter(),t[0].data.groupid!=="all"&&this.getFormulaList().getStore().filter("group",t[0].data.groupid)}},"sseformuladialog #formulas-button-ok":{click:function(e){var t=this.getFormulaList().getSelectionModel().getSelection()[0].data;this.api.asc_insertFormula(t.func),this.getDlgFormula().hide()}},"#formulas-list > gridview":{afterrender:function(e){this.funcSearch={index:0,update:!1,word:""},e.addElListener("keypress",Ext.bind(this.keypressFormulasList,this))}},"#toolbar-button-insertformula":{click:function(e){this._handleInsertFormula(e.menu,{func:"SUM"})}},"#toolbar-menu-insertformula":{click:this._handleInsertFormula},"#infobox-cell-edit":{blur:function(e){this.api.isTextAreaBlur!==null&&(this.api.isTextAreaBlur=!0)},specialkey:function(e,t){t.getKey()==t.ENTER&&!t.altKey&&(this.api.isTextAreaBlur=null)}},"ssecellinfo #infobox-cell-name":{specialkey:function(e,t){t.getKey()==t.ENTER&&(this.api.asc_findCell(e.getValue()),this.getInfoBox().fireEvent("editcomplete",this.getInfoBox()))}},ssecellinfo:{resize:function(e,t,n,r){this.getButtonExpand()[n>23?"addCls":"removeCls"]("button-collapse")}},"ssecellinfo #infobox-cell-multiline-button":{click:this._expandFormulaField},"#field-formula-splitter":{beforedragstart:function(e,t){return t.currentTarget&&!t.currentTarget.disabled},move:function(e,t,n){delete this.getInfoBox().width}}})},setApi:function(e){this.api=e,this.api&&(this.api.isTextAreaBlur=!1,this.api.asc_registerCallback("asc_onSelectionNameChanged",Ext.bind(this.updateBox,this)),this.api.asc_registerCallback("asc_onEditCell",Ext.bind(this._onEditCell,this)),this.api.asc_registerCallback("asc_onoAuthoringDisconnect",Ext.bind(this.onCoAuthoringDisconnect,this)))},updateBox:function(e){this.getInfoBox().updateCellInfo(e)},_onEditCell:function(e){e==c_oAscCellEditorState.editStart?this.api.isCellEdited=!0:e==c_oAscCellEditorState.editEnd&&(this.api.isCellEdited=!1)},_reloadFormulas:function(){var e=[];this.arrGroups=[],dlgFormulas.arrayFormula=[];var t,n,r,i=this.api.asc_getFormulasInfo();for(var s=0;s<i.length;s++){n=i[s].asc_getGroupName(),t=i[s].asc_getFormulasArray(),r=!1;for(var o=0;o<t.length;o++)r!==!0&&(this.arrGroups.push(n),r=!0),e.push({group:n,func:t[o].asc_getName(),args:t[o].asc_getArguments()}),dlgFormulas.arrayFormula.push(t[o].asc_getName())}this.getFormulaList().getStore().loadData(e)},_smoothScrollIntoView:function(e,t){var n=Ext.getDom(t)||Ext.getBody().dom,r=e.getOffsetsTo(n),i=r[1]+n.scrollTop,s=i-n.clientHeight/2;s<0&&(s=0),t.scrollTo("top",s,!0)},scrollViewToNode:function(e,t){if(e&&t){var n=e.getPlugin("scrollpane");if(n){var r=new Ext.util.DelayedTask(function(){n.scrollToElement(t,!1,!0)});r.delay(100)}}},keypressFormulasList:function(e,t){(new Date).getTime()-this.funcSearch.presstime>3e3&&(this.funcSearch.word="");var n=this.getFormulaList().getStore(),r=String.fromCharCode(e.getCharCode()),i=this.funcSearch.index;if(/[a-zA-Z]/.test(r)){this.funcSearch.word+=r,this.funcSearch.index=n.find("func",this.funcSearch.word,i),this.funcSearch.index<0&&(this.funcSearch.word=r,this.funcSearch.index=n.find("func",this.funcSearch.word,i+1)),this.funcSearch.index<0&&(this.funcSearch.index=n.find("func",this.funcSearch.word,0));if(!(this.funcSearch.index<0)){this.getFormulaList().getSelectionModel().select(this.funcSearch.index);var s=this.getFormulaList().getView().getNode(this.funcSearch.index);this.scrollViewToNode(this.getFormulaList(),s)}}this.funcSearch.presstime=(new Date).getTime()},_handleInsertFormula:function(e,t,n){if(t.func==="more"){var r=this;dlgFormulas.addListener("onmodalresult",function(e,t,n){r.getToolBar().fireEvent("editcomplete",r.getToolBar(),{checkorder:!0}),Common.component.Analytics.trackEvent("Toolbar","Insert formula")},this,{single:!0}),dlgFormulas.show()}else{this.getFormulaList().getStore().getCount()>0||this._reloadFormulas();var i=this.getFormulaList().getStore().findExact("func",t.func);if(!(i<0)){var s=this.getFormulaList().getStore().getAt(i);this.api.asc_insertFormula(s.data.func,!0)}this.getToolBar().fireEvent("editcomplete",this.getToolBar(),{checkorder:!0}),Common.component.Analytics.trackEvent("ToolBar","Insert formula")}},_expandFormulaField:function(){this.getInfoBox().getHeight()>23?(this.getInfoBox().keep_height=this.getInfoBox().getHeight(),this.getInfoBox().setHeight(23),this.getButtonExpand().removeCls("button-collapse")):(this.getInfoBox().setHeight(this.getInfoBox().keep_height),this.getButtonExpand().addCls("button-collapse"))},onCoAuthoringDisconnect:function(){dlgFormulas.isVisible()&&dlgFormulas.hide(),this.getInfoBox().setMode({isDisconnected:!0})}}),Ext.define("SSE.controller.Search",{extend:"Ext.app.Controller",refs:[{ref:"searchDialog",selector:"commonsearchdialog"},{ref:"searchQuery",selector:"#search-dialog-text-search"},{ref:"replaceQuery",selector:"#search-dialog-text-replace"}],init:function(){var e=this;this.control({commonsearchdialog:{show:function(){e.api.asc_closeCellEditor(),e.setDefaultView()}},"commonsearchdialog  button[group=search-text]":{click:function(e){this._startSearch(e.direction)}},"commonsearchdialog  button[group=replace-text]":{click:this.btnReplaceText},"#search-dialog-text-search":{searchstart:function(e,t){this._startSearch("next"),e.stopSearch(!0)}},"ssemainmenu #main-menu-search":{toggle:this.showSearchDialog}})},setMode:function(e){this.mode=e,this._frmSearch&&this._frmSearch.setViewMode(!this.mode.isEdit)},setApi:function(e){this.api=e,this.api.asc_registerCallback("asc_onRenameCellTextEnd",Ext.bind(this._onRenameText,this)),this.api.asc_registerCallback("asc_onoAuthoringDisconnect",Ext.bind(this.onCoAuthoringDisconnect,this))},setDefaultView:function(){this.getSearchDialog().searchMode()},showWarning:function(e){var t=this;this.msgbox||(this.msgbox=Ext.create("Ext.window.MessageBox",{listeners:{beforehide:function(){t.getSearchQuery().focus(!0,100)}}}));var n={title:this.textSearch,msg:e,icon:Ext.Msg.INFO,buttons:Ext.Msg.OK};if(Common.userAgent.isIE){var r={enter:Ext.FocusManager.navigateIn,esc:Ext.FocusManager.navigateOut};Ext.FocusManager.navigateIn=Ext.emptyFn,Ext.FocusManager.navigateOut=function(e){t.msgbox.close()},n.fn=function(e){Ext.FocusManager.navigateIn=r.enter,Ext.FocusManager.navigateOut=r.esc}}this.msgbox.show(n)},btnReplaceText:function(e,t,n){var r=this;if(r.getSearchQuery().isValueValid()){var i=this.getSearchDialog().getSettings();this.api.isReplaceAll=e.type=="all",this.api.asc_replaceText(i.textsearch,i.textreplace,e.type=="all",i.casesensitive,i.wholewords)}},_startSearch:function(e){if(this.api&&this.getSearchQuery().isValueValid()){var t=this.getSearchDialog().getSettings();this.api.asc_findText(t.textsearch,!0,e=="next",t.casesensitive,t.wholewords)||this.showWarning(this.textNoTextFound)}},_onRenameText:function(e,t){var n=this;if(this.api.isReplaceAll)e?e-t?n.showWarning(Ext.String.format(this.textReplaceSkipped,e-t)):n.showWarning(Ext.String.format(this.textReplaceSuccess,t)):n.showWarning(n.textNoTextFound);else{var r=this.getSearchDialog().getSettings();n.api.asc_findText(r.textsearch,!0,!0,r.casesensitive,r.wholewords)||n.showWarning(n.textNoTextFound)}},showSearchDialog:function(e,t){if(t){var n=e.up("#view-main-menu");n.closeFullScaleMenu();var r=this;r._frmSearch||(r._frmSearch=Ext.create("Common.view.SearchDialog",{animateTarget:"main-menu-search",closeAction:"hide",isViewMode:!r.mode.isEdit,highlight:!1,listeners:{hide:function(t,r){e.ownrise||(e.ownrise=!0,e.toggle(!1,!0),n.fireEvent("editcomplete",n)),e.ownrise=!1}}})),r._frmSearch.show()}else this._frmSearch&&!e.ownrise&&(e.ownrise=!0,this._frmSearch.hide())},onCoAuthoringDisconnect:function(){this.mode.isEdit=!1,this._frmSearch&&this._frmSearch.setViewMode(!0)},textSearch:"Search",textNoTextFound:"Text not found",textReplaceSuccess:"Search has been done. {0} occurrences have been replaced",textReplaceSkipped:"The replacement has been made. {0} occurrences were skipped."});if(Common===undefined)var Common={};Common.Locale=new function(){var l10n={},_createXMLHTTPObject=function(){var e;try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){e=!1}}return!e&&typeof XMLHttpRequest!="undefined"&&(e=new XMLHttpRequest),e},_applyLocalization=function(){try{for(var e in l10n){var t=e.split(".");if(t&&t.length>2){var n=window;for(var r=0;r<t.length-1;++r){n=n[t[r]];if(n==undefined)break}n&&(n.prototype[t[t.length-1]]=l10n[e])}}}catch(i){}};try{var urlParams=Ext.urlDecode(location.search.substring(1)),xhrObj=_createXMLHTTPObject();if(xhrObj&&urlParams&&urlParams.lang){var lang=urlParams.lang.split("-")[0];xhrObj.open("GET","locale/"+lang+".json",!1),xhrObj.send(""),l10n=eval("("+xhrObj.responseText+")"),_applyLocalization()}}catch(e){}return{apply:_applyLocalization}},Ext.application({name:"SSE",autoCreateViewport:!0,controllers:["Main"]});var isBrowserSupported=function(){return!(Ext.ieVersion!=0&&Ext.ieVersion<9||Ext.safariVersion!=0&&Ext.safariVersion<5||Ext.firefoxVersion!=0&&Ext.firefoxVersion<4||Ext.chromeVersion!=0&&Ext.chromeVersion<7||Ext.operaVersion!=0&&Ext.operaVersion<10.5)};isBrowserSupported()||document.write('<div class="application-error-panel"><div class="application-error-message-block"><div class="application-error-message-inner"><div class="application-error-message-title">Your browser is not supported.</div><div class="application-error-message-text">Sorry, Spreadsheet Editor is currently only supported in the latest versions of the Chrome, Firefox, Safari or Internet Explorer web browsers.</div></div></div><div class="application-error-message-auxiliary"></div></div>');var getEditorStylesheets=function(){return["../../../apps/spreadsheeteditor/main/resources/css/app-edit.css"]},getEditorScripts=function(){return["../../../apps/spreadsheeteditor/main/app-edit.js"]};